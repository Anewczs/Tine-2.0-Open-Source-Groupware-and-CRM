Ext.namespace("Egw.Addressbook");Egw.Addressbook=function(){var S;var U;var X;var m;var h,j;var V=function(g){if(Ext.isEmpty(g)){return false;}var I=g.data,t=I.getCount(),f=new Array();for(i=0;i<t;i++){var K=I.itemAt(i).data;f.push(K);}return Ext.util.JSON.encode(f);};var z=function(C,l){var g=C.getRegion("center",false);g.remove(0);var f=Ext.Element.get("content");var L=f.createChild({tag:"div",id:"outergriddiv"});switch(l.attributes.datatype){case "list":var a={listId:l.attributes.listId};break;case "contacts":var a={displayContacts:true,displayLists:true};break;case "otherpeople":var a={displayContacts:true,displayLists:true,};break;case "sharedaddressbooks":var a={displayContacts:true,displayLists:true,};break;}S=new Ext.data.JsonStore({url:"index.php",baseParams:{method:"Addressbook.getContacts",datatype:l.attributes.datatype,owner:l.attributes.owner,nodeid:l.attributes.id,options:Ext.encode(a),},root:"results",totalProperty:"totalcount",id:"contact_id",fields:[{name:"contact_id"},{name:"contact_tid"},{name:"contact_owner"},{name:"contact_private"},{name:"cat_id"},{name:"n_family"},{name:"n_given"},{name:"n_middle"},{name:"n_prefix"},{name:"n_suffix"},{name:"n_fn"},{name:"n_fileas"},{name:"contact_bday"},{name:"org_name"},{name:"org_unit"},{name:"contact_title"},{name:"contact_role"},{name:"contact_assistent"},{name:"contact_room"},{name:"adr_one_street"},{name:"adr_one_street2"},{name:"adr_one_locality"},{name:"adr_one_region"},{name:"adr_one_postalcode"},{name:"adr_one_countryname"},{name:"contact_label"},{name:"adr_two_street"},{name:"adr_two_street2"},{name:"adr_two_locality"},{name:"adr_two_region"},{name:"adr_two_postalcode"},{name:"adr_two_countryname"},{name:"tel_work"},{name:"tel_cell"},{name:"tel_fax"},{name:"tel_assistent"},{name:"tel_car"},{name:"tel_pager"},{name:"tel_home"},{name:"tel_fax_home"},{name:"tel_cell_private"},{name:"tel_other"},{name:"tel_prefer"},{name:"contact_email"},{name:"contact_email_home"},{name:"contact_url"},{name:"contact_url_home"},{name:"contact_freebusy_uri"},{name:"contact_calendar_uri"},{name:"contact_note"},{name:"contact_tz"},{name:"contact_geo"},{name:"contact_pubkey"},{name:"contact_created"},{name:"contact_creator"},{name:"contact_modified"},{name:"contact_modifier"},{name:"contact_jpegphoto"},{name:"account_id"}],remoteSort:true});S.setDefaultSort("contact_id","desc");S.load({params:{start:0,limit:50}});S.on("beforeload",function(B,N){B.baseParams.options=Ext.encode({displayContacts:h.pressed,displayLists:j.pressed});});var M=new Ext.grid.ColumnModel([{resizable:true,id:"contact_id",header:"Id",dataIndex:"contact_id",width:30},{resizable:true,id:"contact_tid",dataIndex:"contact_tid",width:30,renderer:H},{resizable:true,id:"n_family",header:"Family name",dataIndex:"n_family"},{resizable:true,id:"n_given",header:"Given name",dataIndex:"n_given"},{resizable:true,header:"Middle name",dataIndex:"n_middle",hidden:true},{resizable:true,id:"n_prefix",header:"Prefix",dataIndex:"n_prefix",hidden:true},{resizable:true,header:"Suffix",dataIndex:"n_suffix",hidden:true},{resizable:true,header:"Full name",dataIndex:"n_fn",hidden:true},{resizable:true,header:"Birthday",dataIndex:"contact_bday",hidden:true},{resizable:true,header:"Organisation",dataIndex:"org_name"},{resizable:true,header:"Unit",dataIndex:"org_unit"},{resizable:true,header:"Title",dataIndex:"contact_title",},{resizable:true,header:"Role",dataIndex:"contact_role",},{resizable:true,id:"addressbook",header:"addressbook",dataIndex:"addressbook",hidden:true}]);M.defaultSortable=true;U=new Ext.grid.Grid(L,{ds:S,cm:M,autoSizeColumns:false,selModel:new Ext.grid.RowSelectionModel({multiSelect:true}),enableColLock:false,loadMask:true,enableDragDrop:true,ddGroup:"TreeDD",autoExpandColumn:"n_given"});U.render();U.on("rowclick",function(Z,W,R){var N=U.getSelectionModel().getCount();var B=I.items.map;if(N<1){B.editbtn.disable();B.deletebtn.disable();}else{if(N==1){B.editbtn.enable();B.deletebtn.enable();}else{B.editbtn.disable();B.deletebtn.enable();}}});U.on("rowdblclick",function(B,W,R){var N=B.getDataSource().getAt(W);if(N.data.contact_tid=="l"){try{A(N.data.contact_id,"list");}catch(Z){}}else{try{A(N.data.contact_id);}catch(Z){}}});U.on("rowcontextmenu",function(R,W,B){B.stopEvent();var N=R.getDataSource().getAt(W);if(N.data.contact_tid=="l"){p.showAt(B.getXY());}else{o.showAt(B.getXY());}});var O=U.getView().getHeaderPanel(true);var I=new Ext.Toolbar(O);var K=Ext.DomHelper.append(I.el,{tag:"div",id:Ext.id()},true);var r=new Ext.PagingToolbar(K,S,{pageSize:50,cls:"x-btn-icon-22",displayInfo:true,displayMsg:"Displaying contacts {0} - {1} of {2}",emptyMsg:"No contacts to display"});I.addButton({id:"addbtn",cls:"x-btn-icon-22",icon:"images/oxygen/22x22/actions/add-user.png",tooltip:"add new contact",handler:d});I.addButton({id:"addlstbtn",cls:"x-btn-icon-22",icon:"images/oxygen/22x22/actions/add-users.png",tooltip:"add new list",handler:J});I.addButton({id:"editbtn",cls:"x-btn-icon-22",icon:"images/oxygen/22x22/actions/edit.png",tooltip:"edit current item",disabled:true,handler:Q});I.addButton({id:"deletebtn",cls:"x-btn-icon-22",icon:"images/oxygen/22x22/actions/edit-delete.png",tooltip:"delete selected items",disabled:true,handler:Y});I.insertButton(4,new Ext.Toolbar.Separator());h=I.addButton({id:"filtercontactsbtn",cls:"x-btn-icon-22",icon:"images/oxygen/22x22/actions/user.png",tooltip:"display contacts",enableToggle:true,pressed:true,handler:n});j=I.addButton({id:"filterlistsbtn",cls:"x-btn-icon-22",icon:"images/oxygen/22x22/actions/users.png",tooltip:"display lists",enableToggle:true,pressed:true,handler:w});I.addButton({id:"exportbtn",cls:"x-btn-icon-22",icon:"images/oxygen/22x22/actions/file-export.png",tooltip:"export selected contacts",disabled:false,onClick:k});var t=new Ext.form.TextField({height:22,width:200,emptyText:"Suchparameter ...",allowBlank:false});t.on("specialkey",function(B,N){if(N.getKey()==N.ENTER||N.getKey()==e.RETURN){S.removeAll();S.load({params:{start:0,limit:50,filter1:t.getValue()}});}});I.add(new Ext.Toolbar.Fill());I.addField(t);I.add({id:"clearsearchbtn",cls:"x-btn-icon-22",icon:"images/oxygen/22x22/actions/clear-left.png",tooltip:"Lï¿½sche bestehende Sucheingabe",disabled:false,onClick:function(){t.setValue("");}});I.add({id:"searchbtn",cls:"x-btn-icon-22",icon:"images/oxygen/22x22/actions/mail-find.png",tooltip:"Suche Adresse/Adressliste",disabled:false,onClick:function(){S.removeAll();S.load({params:{start:0,limit:50,searchParam1:t.getValue()}});}});g.add(new Ext.GridPanel(U));};var H=function(K,O,t,g,f,I){switch(K){case "l":return "<img src='images/oxygen/16x16/actions/users.png' width='12' height='12' alt='list'/>";default:return "<img src='images/oxygen/16x16/actions/user.png' width='12' height='12' alt='contact'/>";}};var n=function(f,g){S.reload();};var w=function(f,g){S.reload();};var Y=function(I,g){var t=Array();var K=U.getSelectionModel().getSelections();for(var f=0;f<K.length;++f){t.push(K[f].id);}F(t,function(){EGWNameSpace.Addressbook.reload();});S.reload();};var Q=function(K,g){var t=U.getSelectionModel().getSelections();var f=t[0].id;if(t[0].data.contact_tid=="l"){A(f,"list");}else{A(f);}};var d=function(f,g){A();};var J=function(f,g){A("","list");};var v=function(I,g){var t=Array();var K=U.getSelectionModel().getSelections();for(var f=0;f<K.length;++f){t.push(K[f].id);}F(t,function(){EGWNameSpace.Addressbook.reload();});S.reload();};var b=function(K,g){var t=U.getSelectionModel().getSelections();var f=t[0].id;A(f,"list");};var o=new Ext.menu.Menu({id:"ctxMenuAddress",items:[{id:"edit",text:"edit contact",icon:"images/oxygen/16x16/actions/edit.png",handler:Q},{id:"delete",text:"delete contact",icon:"images/oxygen/16x16/actions/edit-delete.png",handler:Y},"-",{id:"new",text:"new contact",icon:"images/oxygen/16x16/actions/add-user.png",handler:d}]});var p=new Ext.menu.Menu({id:"ctxMenuList",items:[{id:"edit",text:"edit list",icon:"images/oxygen/16x16/actions/edit.png",handler:b},{id:"delete",text:"delete list",icon:"images/oxygen/16x16/actions/edit-delete.png",handler:v},"-",{id:"new",text:"new list",icon:"images/oxygen/16x16/actions/add-users.png",handler:J}]});var k=function(f,g){};var A=function(M,t){var f;var C=1024,L=786;var K=950,r=600;if(t=="list"){K=450,r=600;}if(document.all){C=document.body.clientWidth;L=document.body.clientHeight;x=window.screenTop;y=window.screenLeft;}else{if(window.innerWidth){C=window.innerWidth;L=window.innerHeight;x=window.screenX;y=window.screenY;}}var I=((C-K)/2)+y,O=((L-r)/2)+x;if(t=="list"&&!M){f="index.php?method=Addressbook.editList";}else{if(t=="list"&&M){f="index.php?method=Addressbook.editList&contactid="+M;}else{if(t!="list"&&M){f="index.php?method=Addressbook.editContact&contactid="+M;}else{f="index.php?method=Addressbook.editContact";}}}appId="addressbook";var g=window.open(f,"popupname","width="+K+",height="+r+",top="+O+",left="+I+",directories=no,toolbar=no,location=no,menubar=no,scrollbars=no,status=no,resizable=no,dependent=no");return ;};var G=function(g){g=(g==null)?false:g;window.opener.EGWNameSpace.Addressbook.reload();if(g==true){window.setTimeout("window.close()",400);}};var F=function(f,g,t){var K=Ext.util.JSON.encode(f);new Ext.data.Connection().request({url:"index.php",method:"post",scope:this,params:{method:"Addressbook.deleteContacts",_contactIDs:K},success:function(O,L){var I;try{I=Ext.util.JSON.decode(O.responseText);if(I.success){if(typeof g=="function"){g;}}else{Ext.MessageBox.alert("Failure!","Deleting contact failed!");}}catch(M){Ext.MessageBox.alert("Failure!",M.message);}},failure:function(I,O){}});window.location.reload();console.log(response);Ext.MessageBox.alert("Success!","Deleted contact!");console.log(decodedResponse);};var s=function(f,g){Ext.MessageBox.alert("Export","Not yet implemented.");};var E=function(){Ext.QuickTips.init();Ext.form.Field.prototype.msgTarget="side";var K=new Ext.BorderLayout(document.body,{north:{split:false,initialSize:28},center:{autoScroll:true}});K.beginUpdate();K.add("north",new Ext.ContentPanel("header",{fitToFrame:true}));K.add("center",new Ext.ContentPanel("content"));K.endUpdate();var r=true;if(formData.values){r=false;}var f=new Ext.Toolbar("header");f.add({id:"savebtn",cls:"x-btn-text-icon",text:"Save and Close",icon:"images/oxygen/22x22/actions/document-save.png",tooltip:"save this contact and close window",onClick:function(){if(t.isValid()){var C={};if(formData.values){C._contactID=formData.values.contact_id;}else{C._contactID=0;}t.submit({waitTitle:"Please wait!",waitMsg:"saving contact...",params:C,success:function(l,a,N){window.opener.EGWNameSpace.Addressbook.reload();},failure:function(l,a){}});}else{Ext.MessageBox.alert("Errors","Please fix the errors noted.");}}},{id:"savebtn",cls:"x-btn-icon-22",icon:"images/oxygen/22x22/actions/save-all.png",tooltip:"apply changes for this contact",onClick:function(){if(t.isValid()){var C={};if(formData.values){C._contactID=formData.values.contact_id;}else{C._contactID=0;}t.submit({waitTitle:"Please wait!",waitMsg:"saving contact...",params:C,success:function(l,a,N){window.opener.EGWNameSpace.Addressbook.reload();},failure:function(l,a){}});}else{Ext.MessageBox.alert("Errors","Please fix the errors noted.");}}},{id:"deletebtn",cls:"x-btn-icon-22",icon:"images/oxygen/22x22/actions/edit-delete.png",tooltip:"delete this contact",disabled:r,handler:function(l,C){if(formData.values.contact_id){Ext.MessageBox.wait("Deleting contact...","Please wait!");F([formData.values.contact_id]);G(true);}}},{id:"exportbtn",cls:"x-btn-icon-22",icon:"images/oxygen/22x22/actions/file-export.png",tooltip:"export this contact",disabled:r,handler:s});var L=new Ext.data.JsonStore({url:"index.php",baseParams:{method:"Egwbase.getCountryList"},root:"results",id:"shortName",fields:["shortName","translatedName"],remoteSort:false});var I=new Ext.data.SimpleStore({fields:["id","addressbooks"],data:formData.config.addressbooks});var g=Ext.Element.get("content");var t=new Ext.form.Form({labelWidth:75,url:"index.php?method=Addressbook.saveAddress",reader:new Ext.data.JsonReader({root:"results"},[{name:"contact_id"},{name:"contact_tid"},{name:"contact_owner"},{name:"contact_private"},{name:"cat_id"},{name:"n_family"},{name:"n_given"},{name:"n_middle"},{name:"n_prefix"},{name:"n_suffix"},{name:"n_fn"},{name:"n_fileas"},{name:"contact_bday"},{name:"org_name"},{name:"org_unit"},{name:"contact_title"},{name:"contact_role"},{name:"contact_assistent"},{name:"contact_room"},{name:"adr_one_street"},{name:"adr_one_street2"},{name:"adr_one_locality"},{name:"adr_one_region"},{name:"adr_one_postalcode"},{name:"adr_one_countryname"},{name:"contact_label"},{name:"adr_two_street"},{name:"adr_two_street2"},{name:"adr_two_locality"},{name:"adr_two_region"},{name:"adr_two_postalcode"},{name:"adr_two_countryname"},{name:"tel_work"},{name:"tel_cell"},{name:"tel_fax"},{name:"tel_assistent"},{name:"tel_car"},{name:"tel_pager"},{name:"tel_home"},{name:"tel_fax_home"},{name:"tel_cell_private"},{name:"tel_other"},{name:"tel_prefer"},{name:"contact_email"},{name:"contact_email_home"},{name:"contact_url"},{name:"contact_url_home"},{name:"contact_freebusy_uri"},{name:"contact_calendar_uri"},{name:"contact_note"},{name:"contact_tz"},{name:"contact_geo"},{name:"contact_pubkey"},{name:"contact_created"},{name:"contact_creator"},{name:"contact_modified"},{name:"contact_modifier"},{name:"contact_jpegphoto"},{name:"account_id"}])});t.on("beforeaction",function(l,C){l.baseParams={};l.baseParams._contactOwner=l.getValues().contact_owner;if(formData.values&&formData.values.contact_id){l.baseParams._contactID=formData.values.contact_id;}else{l.baseParams._contactID=0;}console.log(l.baseParams);});t.fieldset({legend:"Contact information"});t.column({width:"33%",labelWidth:90,labelSeparator:""},new Ext.form.TextField({fieldLabel:"First Name",name:"n_given",width:175}),new Ext.form.TextField({fieldLabel:"Middle Name",name:"n_middle",width:175}),new Ext.form.TextField({fieldLabel:"Last Name",name:"n_family",width:175,allowBlank:false}));t.column({width:"33%",labelWidth:90,labelSeparator:""},new Ext.form.TextField({fieldLabel:"Prefix",name:"n_prefix",width:175}),new Ext.form.TextField({fieldLabel:"Suffix",name:"n_suffix",width:175}),new Ext.form.ComboBox({fieldLabel:"Addressbook",name:"contact_owner",hiddenName:"contact_owner",store:I,displayField:"addressbooks",valueField:"id",allowBlank:false,editable:false,mode:"remote",triggerAction:"all",emptyText:"Select a addressbook...",selectOnFocus:true,width:175}));t.end();t.fieldset({legend:"Business information"});t.column({width:"33%",labelWidth:90,labelSeparator:""},new Ext.form.TextField({fieldLabel:"Company",name:"org_name",width:175}),new Ext.form.TextField({fieldLabel:"Street",name:"adr_one_street",width:175}),new Ext.form.TextField({fieldLabel:"Street 2",name:"adr_one_street2",width:175}),new Ext.form.TextField({fieldLabel:"Postalcode",name:"adr_one_postalcode",width:175}),new Ext.form.TextField({fieldLabel:"City",name:"adr_one_locality",width:175}),new Ext.form.TextField({fieldLabel:"Region",name:"adr_one_region",width:175}),new Ext.form.ComboBox({fieldLabel:"Country",name:"adr_one_countryname",hiddenName:"adr_one_countryname",store:L,displayField:"translatedName",valueField:"shortName",typeAhead:true,mode:"remote",triggerAction:"all",emptyText:"Select a state...",selectOnFocus:true,width:175}));t.column({width:"33%",labelWidth:90,labelSeparator:""},new Ext.form.TextField({fieldLabel:"Phone",name:"tel_work",width:175}),new Ext.form.TextField({fieldLabel:"Cellphone",name:"tel_cell",width:175}),new Ext.form.TextField({fieldLabel:"Fax",name:"tel_fax",width:175}),new Ext.form.TextField({fieldLabel:"Car phone",name:"tel_car",width:175}),new Ext.form.TextField({fieldLabel:"Pager",name:"tel_pager",width:175}),new Ext.form.TextField({fieldLabel:"Email",name:"contact_email",vtype:"email",width:175}),new Ext.form.TextField({fieldLabel:"URL",name:"contact_url",vtype:"url",width:175}));t.column({width:"33%",labelWidth:90,labelSeparator:""},new Ext.form.TextField({fieldLabel:"Unit",name:"org_unit",width:175}),new Ext.form.TextField({fieldLabel:"Role",name:"contact_role",width:175}),new Ext.form.TextField({fieldLabel:"Title",name:"contact_title",width:175}),new Ext.form.TextField({fieldLabel:"Room",name:"contact_room",width:175}),new Ext.form.TextField({fieldLabel:"Name Assistent",name:"contact_assistent",width:175}),new Ext.form.TextField({fieldLabel:"Phone Assistent",name:"tel_assistent",width:175}));t.end();t.fieldset({legend:"Private information"});t.column({width:"33%",labelWidth:90,labelSeparator:""},new Ext.form.TextField({fieldLabel:"Street",name:"adr_two_street",width:175}),new Ext.form.TextField({fieldLabel:"Street2",name:"adr_two_street2",width:175}),new Ext.form.TextField({fieldLabel:"Postalcode",name:"adr_two_postalcode",width:175}),new Ext.form.TextField({fieldLabel:"City",name:"adr_two_locality",width:175}),new Ext.form.TextField({fieldLabel:"Region",name:"adr_two_region",width:175}),new Ext.form.ComboBox({fieldLabel:"Country",name:"adr_two_countryname",hiddenName:"adr_two_countryname",store:L,displayField:"translatedName",valueField:"shortName",typeAhead:true,mode:"remote",triggerAction:"all",emptyText:"Select a state...",selectOnFocus:true,width:175}));t.column({width:"33%",labelWidth:90,labelSeparator:""},new Ext.form.DateField({fieldLabel:"Birthday",name:"contact_bday",format:formData.config.dateFormat,altFormats:"Y-m-d",width:175}),new Ext.form.TextField({fieldLabel:"Phone",name:"tel_home",width:175}),new Ext.form.TextField({fieldLabel:"Cellphone",name:"tel_cell_private",width:175}),new Ext.form.TextField({fieldLabel:"Fax",name:"tel_fax_home",width:175}),new Ext.form.TextField({fieldLabel:"Email",name:"contact_email_home",vtype:"email",width:175}),new Ext.form.TextField({fieldLabel:"URL",name:"contact_url_home",vtype:"url",width:175}));t.column({width:"33%",labelSeparator:"",hideLabels:true},new Ext.form.TextArea({name:"contact_note",grow:false,preventScrollbars:false,width:"95%",maxLength:255,height:150}));t.end();var M=new Ext.form.TriggerField({fieldLabel:"Categories",name:"categories",width:320,readOnly:true});M.onTriggerClick=function(){var B=Ext.Element.get("container");var W=B.createChild({tag:"div",id:"iWindowTag"});var R=B.createChild({tag:"div",id:"iWindowContTag"});var C=new Ext.data.SimpleStore({fields:["category_id","category_realname"],data:[["1","erste Kategorie"],["2","zweite Kategorie"],["3","dritte Kategorie"],["4","vierte Kategorie"],["5","fuenfte Kategorie"],["6","sechste Kategorie"],["7","siebte Kategorie"],["8","achte Kategorie"]]});C.load();ds_checked=new Ext.data.SimpleStore({fields:["category_id","category_realname"],data:[["2","zweite Kategorie"],["5","fuenfte Kategorie"],["6","sechste Kategorie"],["8","achte Kategorie"]]});ds_checked.load();var Z=new Ext.form.Form({labelWidth:75,url:"index.php?method=Addressbook.saveAdditionalData",reader:new Ext.data.JsonReader({root:"results"},[{name:"category_id"},{name:"category_realname"},])});var l=1;var q=new Array();ds_checked.each(function(D){q[D.data.category_id]=D.data.category_realname;});C.each(function(D){if((l%12)==1){Z.column({width:"33%",labelWidth:50,labelSeparator:""});}if(q[D.data.category_id]){Z.add(new Ext.form.Checkbox({boxLabel:D.data.category_realname,name:D.data.category_realname,checked:true}));}else{Z.add(new Ext.form.Checkbox({boxLabel:D.data.category_realname,name:D.data.category_realname}));}if((l%12)==0){Z.end();}l=l+1;});Z.render("iWindowContTag");if(!N){var N=new Ext.LayoutDialog("iWindowTag",{modal:true,width:700,height:400,shadow:true,minWidth:700,minHeight:400,autoTabs:true,proxyDrag:true,center:{autoScroll:true,tabPosition:"top",closeOnTab:true,alwaysShowTabs:true}});N.addKeyListener(27,this.hide);N.addButton("save",function(){Ext.MessageBox.alert("Todo","Not yet implemented!");N.hide;},N);N.addButton("cancel",function(){Ext.MessageBox.alert("Todo","Not yet implemented!");N.hide;},N);var a=N.getLayout();a.beginUpdate();a.add("center",new Ext.ContentPanel("iWindowContTag",{autoCreate:true,title:"Category"}));a.endUpdate();}N.show();};t.column({width:"45%",labelWidth:80,labelSeparator:" ",labelAlign:"right"},M);var O=new Ext.form.TriggerField({fieldLabel:"Lists",name:"lists",width:320,readOnly:true});O.onTriggerClick=function(){var B=Ext.Element.get("container");var W=B.createChild({tag:"div",id:"iWindowTag"});var R=B.createChild({tag:"div",id:"iWindowContTag"});var C=new Ext.data.SimpleStore({fields:["list_id","list_realname"],data:[["1","Liste A"],["2","Liste B"],["3","Liste C"],["4","Liste D"],["5","Liste E"],["6","Liste F"],["7","Liste G"],["8","Liste H"]]});C.load();ds_checked=new Ext.data.SimpleStore({fields:["list_id","list_realname"],data:[["2","Liste B"],["5","Liste E"],["6","Liste F"],["8","Liste H"]]});ds_checked.load();var Z=new Ext.form.Form({labelWidth:75,url:"index.php?method=Addressbook.saveAdditionalData",reader:new Ext.data.JsonReader({root:"results"},[{name:"list_id"},{name:"list_realname"},])});var l=1;var q=new Array();ds_checked.each(function(D){q[D.data.list_id]=D.data.list_realname;});C.each(function(D){if((l%12)==1){Z.column({width:"33%",labelWidth:50,labelSeparator:""});}if(q[D.data.list_id]){Z.add(new Ext.form.Checkbox({boxLabel:D.data.list_realname,name:D.data.list_realname,checked:true}));}else{Z.add(new Ext.form.Checkbox({boxLabel:D.data.list_realname,name:D.data.list_realname}));}if((l%12)==0){Z.end();}l=l+1;});Z.render("iWindowContTag");if(!N){var N=new Ext.LayoutDialog("iWindowTag",{modal:true,width:700,height:400,shadow:true,minWidth:700,minHeight:400,autoTabs:true,proxyDrag:true,center:{autoScroll:true,tabPosition:"top",closeOnTab:true,alwaysShowTabs:true}});N.addKeyListener(27,this.hide);N.addButton("save",function(){Ext.MessageBox.alert("Todo","Not yet implemented!");},N);N.addButton("cancel",function(){window.location.reload();N.hide;},N);var a=N.getLayout();a.beginUpdate();a.add("center",new Ext.ContentPanel("iWindowContTag",{autoCreate:true,title:"Lists"}));a.endUpdate();}N.show();};t.column({width:"45%",labelWidth:80,labelSeparator:" ",labelAlign:"right"},O);t.column({width:"10%",labelWidth:50,labelSeparator:" ",labelAlign:"right"},new Ext.form.Checkbox({fieldLabel:"Private",name:"categories",width:10}));t.render("content");return t;};var u=function(f,t){for(var K in t){var g=f.findField(K);if(g){g.setValue(t[K]);}}};return {show:z,reload:function(){S.reload();},handleDragDrop:function(g){alert("Best Regards From Addressbook");},openDialog:function(){A();},displayContactDialog:function(){var g=E();if(formData.values){u(g,formData.values);}}};}();Egw.Addressbook.ListEditDialog=function(){var V=function(){Ext.QuickTips.init();Ext.form.Field.prototype.msgTarget="side";var E=new Ext.BorderLayout(document.body,{north:{split:false,initialSize:28},center:{autoScroll:true},south:{split:false,initialSize:256}});E.beginUpdate();E.add("north",new Ext.ContentPanel("header",{fitToFrame:true}));E.add("center",new Ext.ContentPanel("content"));E.add("south",new Ext.ContentPanel("south"));E.endUpdate();var X=true;if(formData.values){X=false;}var d=new Ext.Toolbar("header");d.add({id:"savebtn",cls:"x-btn-text-icon",text:"Save and Close",icon:"images/oxygen/22x22/actions/document-save.png",tooltip:"save this list and close window",onClick:function(){if(v.isValid()){var b={};if(formData.values){b._contactID=formData.values.contact_id;}else{b._contactID=0;}v.submit({waitTitle:"Please wait!",waitMsg:"saving contact...",params:b,success:function(z,m,J){window.opener.EGWNameSpace.Addressbook.reload();},failure:function(z,m){}});}else{Ext.MessageBox.alert("Errors","Please fix the errors noted.");}}},{id:"savebtn",cls:"x-btn-icon-22",icon:"images/oxygen/22x22/actions/save-all.png",tooltip:"apply changes for this list",onClick:function(){if(v.isValid()){var b={};if(formData.values){b._contactID=formData.values.contact_id;}else{b._contactID=0;}v.submit({waitTitle:"Please wait!",waitMsg:"saving contact...",params:b,success:function(z,m,J){window.opener.EGWNameSpace.Addressbook.reload();},failure:function(z,m){}});}else{Ext.MessageBox.alert("Errors","Please fix the errors noted.");}}},{id:"deletebtn",cls:"x-btn-icon-22",icon:"images/oxygen/22x22/actions/edit-delete.png",tooltip:"delete this contact",disabled:X,handler:function(z,b){if(formData.values.contact_id){Ext.MessageBox.wait("Deleting contact...","Please wait!");_deleteContact([formData.values.contact_id]);_reloadMainWindow(true);}}});var n=new Ext.data.SimpleStore({fields:["id","addressbooks"],data:formData.config.addressbooks});var s=Ext.Element.get("content");var v=new Ext.form.Form({labelWidth:75,url:"index.php?method=Addressbook.saveList",reader:new Ext.data.JsonReader({root:"results"},[{name:"contact_id"},{name:"contact_tid"},{name:"contact_owner"},{name:"n_given"},{name:"n_middle"},{name:"n_fileas"},{name:"contact_created"},{name:"contact_creator"},{name:"account_id"}])});v.on("beforeaction",function(z,b){z.baseParams={};z.baseParams._contactOwner=z.getValues().contact_owner;z.baseParams._addressType="l";z.baseParams._listmembers=_getJSONDsRecs(Q);if(formData.values&&formData.values.contact_id){z.baseParams._contactID=formData.values.contact_id;}else{z.baseParams._contactID=0;}console.log(z.baseParams);});v.fieldset({legend:"List information"});v.column({width:"100%",labelWidth:90,labelSeparator:""},new Ext.form.ComboBox({fieldLabel:"Addressbook",name:"contact_owner",hiddenName:"contact_owner",store:n,displayField:"addressbooks",valueField:"id",allowBlank:false,editable:false,mode:"remote",triggerAction:"all",emptyText:"Select a addressbook...",selectOnFocus:true,width:325}),new Ext.form.TextField({fieldLabel:"List Name",name:"n_family",width:325}),new Ext.form.TextField({fieldLabel:"List Nickname",name:"n_given",width:325}),new Ext.form.TextField({fieldLabel:"List Description",name:"org_name",width:325}));v.end();searchDS=new Ext.data.JsonStore({url:"index.php",baseParams:{method:"Addressbook.getContacts",datatype:"contacts",owner:formData.values.contact_owner,nodeid:"mycontacts",options:"{\"displayContacts\":true,\"displayLists\":false}",},root:"results",totalProperty:"totalcount",id:"contact_id",fields:[{name:"contact_id"},{name:"n_family"},{name:"contact_email"}],remoteSort:true,success:function(b,z){},failure:function(b,z){}});searchDS.setDefaultSort("n_family","asc");searchDS.load({params:{start:0,limit:50}});var S=new Ext.Template("<div class=\"search-item\">","<h3>{n_family} - {contact_email}</h3>","{excerpt}","</div>");var Y=new Ext.form.ComboBox({store:searchDS,displayField:"n_family",typeAhead:false,loadingText:"Searching...",width:325,pageSize:10,hideTrigger:true,tpl:S,onSelect:function(b){var z=new w({contact_id:b.data.contact_id,n_family:b.data.n_family,contact_email:b.data.contact_email});Q.insert(0,z);searchDS.remove(b);Y.reset();Y.collapse();searchDS.removeAll();}});v.fieldset({legend:"Select new List members"});v.column({width:"100%",labelWidth:90,labelSeparator:""},Y);v.end();v.render("content");var w=Ext.data.Record.create([{name:"contact_id",type:"int"},{name:"n_family",type:"string"},{name:"contact_email",type:"string"}]);var Q=new Ext.data.JsonStore({url:"index.php",baseParams:{method:"Addressbook.getContacts",datatype:"list",owner:formData.values.contact_owner,options:"{\"listID\":\""+formData.values.contact_id+"\"}",},root:"results",totalProperty:"totalcount",id:"contact_id",fields:[{name:"contact_id"},{name:"n_family"},{name:"contact_email"}],remoteSort:true});var A=new Ext.grid.ColumnModel([{resizable:true,id:"n_family",header:"Family name",dataIndex:"n_family"},{resizable:true,id:"contact_email",header:"eMal address",dataIndex:"contact_email"}]);A.defaultSortable=true;var j=new Ext.grid.Grid("south",{ds:Q,cm:A,selModel:new Ext.grid.RowSelectionModel({multiSelect:true}),autoSizeColumns:true,monitorWindowResize:false,trackMouseOver:true,contextMenu:"ctxMenuPicAssignTree",autoExpandColumn:"contact_email"});j.on("rowcontextmenu",function(m,o,z){z.stopEvent();var b=m.getDataSource().getAt(o);if(b.data.contact_tid=="l"){F.showAt(z.getXY());}else{F.showAt(z.getXY());}});j.render("south");var k=function(J,b){var m=Array();var o=j.getSelectionModel().getSelections();for(var z=0;z<o.length;++z){Q.remove(o[z]);}};var F=new Ext.menu.Menu({id:"ctxListMenu",items:[{id:"delete",text:"delete entry",icon:"images/oxygen/16x16/actions/edit-delete.png",handler:k}]});return v;};var u=function(s,w){for(var A in w){var j=s.findField(A);if(j){j.setValue(w[A]);}}};return {display:function(){var j=V();if(formData.values){u(listedit,formData.values);}}};}();