Ext.namespace("Egw");var EGWNameSpace=Egw;Egw.Addressbook=function(){var k;var E;var i;var u,f;var h=function(X,n){var d=X.getRegion("center",false);d.remove(0);var q=Ext.Element.get("content");var B=q.createChild({tag:"div",id:"outergriddiv"});switch(n.attributes.datatype){case "list":var Z={listId:n.attributes.listId};break;case "contacts":var Z={displayContacts:true,displayLists:true};break;case "otherpeople":var Z={displayContacts:true,displayLists:true,};break;case "sharedaddressbooks":var Z={displayContacts:true,displayLists:true,};break;}k=new Ext.data.JsonStore({url:"index.php",baseParams:{method:"Addressbook.getContacts",datatype:n.attributes.datatype,owner:n.attributes.owner,nodeid:n.attributes.id,options:Ext.encode(Z),},root:"results",totalProperty:"totalcount",id:"contact_id",fields:[{name:"contact_id"},{name:"contact_tid"},{name:"contact_owner"},{name:"contact_private"},{name:"cat_id"},{name:"n_family"},{name:"n_given"},{name:"n_middle"},{name:"n_prefix"},{name:"n_suffix"},{name:"n_fn"},{name:"n_fileas"},{name:"contact_bday"},{name:"org_name"},{name:"org_unit"},{name:"contact_title"},{name:"contact_role"},{name:"contact_assistent"},{name:"contact_room"},{name:"adr_one_street"},{name:"adr_one_street2"},{name:"adr_one_locality"},{name:"adr_one_region"},{name:"adr_one_postalcode"},{name:"adr_one_countryname"},{name:"contact_label"},{name:"adr_two_street"},{name:"adr_two_street2"},{name:"adr_two_locality"},{name:"adr_two_region"},{name:"adr_two_postalcode"},{name:"adr_two_countryname"},{name:"tel_work"},{name:"tel_cell"},{name:"tel_fax"},{name:"tel_assistent"},{name:"tel_car"},{name:"tel_pager"},{name:"tel_home"},{name:"tel_fax_home"},{name:"tel_cell_private"},{name:"tel_other"},{name:"tel_prefer"},{name:"contact_email"},{name:"contact_email_home"},{name:"contact_url"},{name:"contact_url_home"},{name:"contact_freebusy_uri"},{name:"contact_calendar_uri"},{name:"contact_note"},{name:"contact_tz"},{name:"contact_geo"},{name:"contact_pubkey"},{name:"contact_created"},{name:"contact_creator"},{name:"contact_modified"},{name:"contact_modifier"},{name:"contact_jpegphoto"},{name:"account_id"}],remoteSort:true});k.setDefaultSort("contact_id","desc");k.load({params:{start:0,limit:50}});k.on("beforeload",function(g,S){g.baseParams.options=Ext.encode({displayContacts:u.pressed,displayLists:f.pressed});});var r=new Ext.grid.ColumnModel([{resizable:true,id:"contact_id",header:"Id",dataIndex:"contact_id",width:30},{resizable:true,id:"contact_tid",dataIndex:"contact_tid",width:30,renderer:O},{resizable:true,id:"n_family",header:"Family name",dataIndex:"n_family"},{resizable:true,id:"n_given",header:"Given name",dataIndex:"n_given"},{resizable:true,header:"Middle name",dataIndex:"n_middle",hidden:true},{resizable:true,id:"n_prefix",header:"Prefix",dataIndex:"n_prefix",hidden:true},{resizable:true,header:"Suffix",dataIndex:"n_suffix",hidden:true},{resizable:true,header:"Full name",dataIndex:"n_fn",hidden:true},{resizable:true,header:"Birthday",dataIndex:"contact_bday",hidden:true},{resizable:true,header:"Organisation",dataIndex:"org_name"},{resizable:true,header:"Unit",dataIndex:"org_unit"},{resizable:true,header:"Title",dataIndex:"contact_title",},{resizable:true,header:"Role",dataIndex:"contact_role",},{resizable:true,id:"addressbook",header:"addressbook",dataIndex:"addressbook",hidden:true}]);r.defaultSortable=true;E=new Ext.grid.Grid(B,{ds:k,cm:r,autoSizeColumns:false,selModel:new Ext.grid.RowSelectionModel({multiSelect:true}),enableColLock:false,loadMask:true,enableDragDrop:true,ddGroup:"TreeDD",autoExpandColumn:"n_given"});E.render();E.on("rowclick",function(e,C,v){var S=E.getSelectionModel().getCount();var g=Y.items.map;if(S<1){g.editbtn.disable();g.deletebtn.disable();}else{if(S==1){g.editbtn.enable();g.deletebtn.enable();}else{g.editbtn.disable();g.deletebtn.enable();}}});E.on("rowdblclick",function(g,C,v){var S=g.getDataSource().getAt(C);if(S.data.contact_tid=="l"){try{s(S.data.contact_id,"list");}catch(F){}}else{try{s(S.data.contact_id);}catch(F){}}});E.on("rowcontextmenu",function(v,C,g){g.stopEvent();var S=v.getDataSource().getAt(C);if(S.data.contact_tid=="l"){R.showAt(g.getXY());}else{l.showAt(g.getXY());}});var L=E.getView().getHeaderPanel(true);var Y=new Ext.PagingToolbar(L,k,{pageSize:50,cls:"x-btn-icon-22",displayInfo:true,displayMsg:"Displaying contacts {0} - {1} of {2}",emptyMsg:"No contacts to display"});Y.insertButton(0,{id:"addbtn",cls:"x-btn-icon-22",icon:"images/oxygen/22x22/actions/add-user.png",tooltip:"add new contact",handler:m});Y.insertButton(1,{id:"addlstbtn",cls:"x-btn-icon-22",icon:"images/oxygen/22x22/actions/add-users.png",tooltip:"add new list",handler:G});Y.insertButton(2,{id:"editbtn",cls:"x-btn-icon-22",icon:"images/oxygen/22x22/actions/edit.png",tooltip:"edit current item",disabled:true,handler:A});Y.insertButton(3,{id:"deletebtn",cls:"x-btn-icon-22",icon:"images/oxygen/22x22/actions/edit-delete.png",tooltip:"delete selected items",disabled:true,handler:p});Y.insertButton(4,new Ext.Toolbar.Separator());u=Y.insertButton(5,{id:"filtercontactsbtn",cls:"x-btn-icon-22",icon:"images/oxygen/22x22/actions/user.png",tooltip:"display contacts",enableToggle:true,pressed:true,handler:a});f=Y.insertButton(6,{id:"filterlistsbtn",cls:"x-btn-icon-22",icon:"images/oxygen/22x22/actions/users.png",tooltip:"display lists",enableToggle:true,pressed:true,handler:M});Y.insertButton(7,{id:"exportbtn",cls:"x-btn-icon-22",icon:"images/oxygen/22x22/actions/file-export.png",tooltip:"export selected contacts",disabled:false,onClick:t});d.add(new Ext.GridPanel(E));};var O=function(L,r,Y,d,q,B){switch(L){case "l":return "<img src='images/oxygen/16x16/actions/users.png' width='12' height='12' alt='list'/>";default:return "<img src='images/oxygen/16x16/actions/user.png' width='12' height='12' alt='contact'/>";}};var a=function(q,d){k.reload();};var M=function(q,d){k.reload();};var p=function(B,d){var Y=Array();var L=E.getSelectionModel().getSelections();for(var q=0;q<L.length;++q){Y.push(L[q].id);}o(Y,function(){EGWNameSpace.Addressbook.reload();});k.reload();};var A=function(L,d){var Y=E.getSelectionModel().getSelections();var q=Y[0].id;s(q);};var m=function(q,d){s();};var G=function(q,d){s("","list");};var W=function(B,d){var Y=Array();var L=E.getSelectionModel().getSelections();for(var q=0;q<L.length;++q){Y.push(L[q].id);}o(Y,function(){EGWNameSpace.Addressbook.reload();});k.reload();};var Q=function(L,d){var Y=E.getSelectionModel().getSelections();var q=Y[0].id;s(q,"list");};var l=new Ext.menu.Menu({id:"ctxMenuAddress",items:[{id:"edit",text:"edit contact",icon:"images/oxygen/16x16/actions/edit.png",handler:A},{id:"delete",text:"delete contact",icon:"images/oxygen/16x16/actions/edit-delete.png",handler:p},"-",{id:"new",text:"new contact",icon:"images/oxygen/16x16/actions/add-user.png",handler:m}]});var R=new Ext.menu.Menu({id:"ctxMenuList",items:[{id:"edit",text:"edit list",icon:"images/oxygen/16x16/actions/edit.png",handler:Q},{id:"delete",text:"delete list",icon:"images/oxygen/16x16/actions/edit-delete.png",handler:W},"-",{id:"new",text:"new list",icon:"images/oxygen/16x16/actions/add-users.png",handler:G}]});var t=function(q,d){};var s=function(n,Y){var q;var S=1024,X=786;var L=950,Z=600;if(document.all){S=document.body.clientWidth;X=document.body.clientHeight;x=window.screenTop;y=window.screenLeft;}else{if(window.innerWidth){S=window.innerWidth;X=window.innerHeight;x=window.screenX;y=window.screenY;}}var B=((S-L)/2)+y,r=((X-Z)/2)+x;if(Y=="list"&&!n){q="index.php?getpopup=addressbook.editlist";}else{if(Y=="list"&&n){q="index.php?getpopup=addressbook.editlist&contactid="+n;}else{if(Y!="list"&&n){q="index.php?getpopup=addressbook.editcontact&contactid="+n;}else{q="index.php?getpopup=addressbook.editcontact";}}}appId="addressbook";var d=window.open(q,"popupname","width="+L+",height="+Z+",top="+r+",left="+B+",directories=no,toolbar=no,location=no,menubar=no,scrollbars=no,status=no,resizable=no,dependent=no");return ;};var c=function(d){d=(d==null)?false:d;window.opener.EGWNameSpace.Addressbook.reload();if(d==true){window.setTimeout("window.close()",400);}};var o=function(q,d,Y){var L=Ext.util.JSON.encode(q);new Ext.data.Connection().request({url:"index.php",method:"post",scope:this,params:{method:"Addressbook.deleteContacts",_contactIDs:L},success:function(r,X){var B;try{B=Ext.util.JSON.decode(r.responseText);if(B.success){if(typeof d=="function"){d;}}else{Ext.MessageBox.alert("Failure!","Deleting contact failed!");}}catch(n){Ext.MessageBox.alert("Failure!",n.message);}},failure:function(B,r){}});};var D=function(q,d){Ext.MessageBox.alert("Export","Not yet implemented.");};var b=function(){Ext.QuickTips.init();Ext.form.Field.prototype.msgTarget="side";var L=new Ext.BorderLayout(document.body,{north:{split:false,initialSize:28},center:{autoScroll:true}});L.beginUpdate();L.add("north",new Ext.ContentPanel("header",{fitToFrame:true}));L.add("center",new Ext.ContentPanel("content"));L.endUpdate();var Z=true;if(formData.values){Z=false;}var q=new Ext.Toolbar("header");q.add({id:"savebtn",cls:"x-btn-text-icon",text:"Save and Close",icon:"images/oxygen/22x22/actions/document-save.png",tooltip:"save this contact and close window",onClick:function(){if(Y.isValid()){var S={};if(formData.values){S._contactID=formData.values.contact_id;}else{S._contactID=0;}Y.submit({waitTitle:"Please wait!",waitMsg:"saving contact...",params:S,success:function(g,v,C){window.opener.EGWNameSpace.Addressbook.reload();window.setTimeout("window.close()",400);},failure:function(g,v){}});}else{Ext.MessageBox.alert("Errors","Please fix the errors noted.");}}},{id:"savebtn",cls:"x-btn-icon-22",icon:"images/oxygen/22x22/actions/save-all.png",tooltip:"apply changes for this contact",onClick:function(){if(Y.isValid()){var S={};if(formData.values){S._contactID=formData.values.contact_id;}else{S._contactID=0;}Y.submit({waitTitle:"Please wait!",waitMsg:"saving contact...",params:S,success:function(g,v,C){window.opener.EGWNameSpace.Addressbook.reload();},failure:function(g,v){}});}else{Ext.MessageBox.alert("Errors","Please fix the errors noted.");}}},{id:"deletebtn",cls:"x-btn-icon-22",icon:"images/oxygen/22x22/actions/edit-delete.png",tooltip:"delete this contact",disabled:Z,handler:function(g,S){if(formData.values.contact_id){Ext.MessageBox.wait("Deleting contact...","Please wait!");o([formData.values.contact_id]);c(true);}}},{id:"exportbtn",cls:"x-btn-icon-22",icon:"images/oxygen/22x22/actions/file-export.png",tooltip:"export this contact",disabled:Z,handler:D});var X=new Ext.data.JsonStore({url:"index.php",baseParams:{method:"Egwbase.getCountryList"},root:"results",id:"shortName",fields:["shortName","translatedName"],remoteSort:false});var B=new Ext.data.SimpleStore({fields:["id","addressbooks"],data:formData.config.addressbooks});var d=Ext.Element.get("content");var Y=new Ext.form.Form({labelWidth:75,url:"index.php?method=Addressbook.saveAddress",reader:new Ext.data.JsonReader({root:"results"},[{name:"contact_id"},{name:"contact_tid"},{name:"contact_owner"},{name:"contact_private"},{name:"cat_id"},{name:"n_family"},{name:"n_given"},{name:"n_middle"},{name:"n_prefix"},{name:"n_suffix"},{name:"n_fn"},{name:"n_fileas"},{name:"contact_bday"},{name:"org_name"},{name:"org_unit"},{name:"contact_title"},{name:"contact_role"},{name:"contact_assistent"},{name:"contact_room"},{name:"adr_one_street"},{name:"adr_one_street2"},{name:"adr_one_locality"},{name:"adr_one_region"},{name:"adr_one_postalcode"},{name:"adr_one_countryname"},{name:"contact_label"},{name:"adr_two_street"},{name:"adr_two_street2"},{name:"adr_two_locality"},{name:"adr_two_region"},{name:"adr_two_postalcode"},{name:"adr_two_countryname"},{name:"tel_work"},{name:"tel_cell"},{name:"tel_fax"},{name:"tel_assistent"},{name:"tel_car"},{name:"tel_pager"},{name:"tel_home"},{name:"tel_fax_home"},{name:"tel_cell_private"},{name:"tel_other"},{name:"tel_prefer"},{name:"contact_email"},{name:"contact_email_home"},{name:"contact_url"},{name:"contact_url_home"},{name:"contact_freebusy_uri"},{name:"contact_calendar_uri"},{name:"contact_note"},{name:"contact_tz"},{name:"contact_geo"},{name:"contact_pubkey"},{name:"contact_created"},{name:"contact_creator"},{name:"contact_modified"},{name:"contact_modifier"},{name:"contact_jpegphoto"},{name:"account_id"}])});Y.on("beforeaction",function(g,S){g.baseParams={};g.baseParams._contactOwner=g.getValues().contact_owner;if(formData.values&&formData.values.contact_id){g.baseParams._contactID=formData.values.contact_id;}else{g.baseParams._contactID=0;}console.log(g.baseParams);});Y.fieldset({legend:"Contact information"});Y.column({width:"33%",labelWidth:90,labelSeparator:""},new Ext.form.TextField({fieldLabel:"First Name",name:"n_given",width:175}),new Ext.form.TextField({fieldLabel:"Middle Name",name:"n_middle",width:175}),new Ext.form.TextField({fieldLabel:"Last Name",name:"n_family",width:175,allowBlank:false}));Y.column({width:"33%",labelWidth:90,labelSeparator:""},new Ext.form.TextField({fieldLabel:"Prefix",name:"n_prefix",width:175}),new Ext.form.TextField({fieldLabel:"Suffix",name:"n_suffix",width:175}),new Ext.form.ComboBox({fieldLabel:"Addressbook",name:"contact_owner",hiddenName:"contact_owner",store:B,displayField:"addressbooks",valueField:"id",allowBlank:false,editable:false,mode:"remote",triggerAction:"all",emptyText:"Select a addressbook...",selectOnFocus:true,width:175}));Y.end();Y.fieldset({legend:"Business information"});Y.column({width:"33%",labelWidth:90,labelSeparator:""},new Ext.form.TextField({fieldLabel:"Company",name:"org_name",width:175}),new Ext.form.TextField({fieldLabel:"Street",name:"adr_one_street",width:175}),new Ext.form.TextField({fieldLabel:"Street 2",name:"adr_one_street2",width:175}),new Ext.form.TextField({fieldLabel:"Postalcode",name:"adr_one_postalcode",width:175}),new Ext.form.TextField({fieldLabel:"City",name:"adr_one_locality",width:175}),new Ext.form.TextField({fieldLabel:"Region",name:"adr_one_region",width:175}),new Ext.form.ComboBox({fieldLabel:"Country",name:"adr_one_countryname",hiddenName:"adr_one_countryname",store:X,displayField:"translatedName",valueField:"shortName",typeAhead:true,mode:"remote",triggerAction:"all",emptyText:"Select a state...",selectOnFocus:true,width:175}));Y.column({width:"33%",labelWidth:90,labelSeparator:""},new Ext.form.TextField({fieldLabel:"Phone",name:"tel_work",width:175}),new Ext.form.TextField({fieldLabel:"Cellphone",name:"tel_cell",width:175}),new Ext.form.TextField({fieldLabel:"Fax",name:"tel_fax",width:175}),new Ext.form.TextField({fieldLabel:"Car phone",name:"tel_car",width:175}),new Ext.form.TextField({fieldLabel:"Pager",name:"tel_pager",width:175}),new Ext.form.TextField({fieldLabel:"Email",name:"contact_email",vtype:"email",width:175}),new Ext.form.TextField({fieldLabel:"URL",name:"contact_url",vtype:"url",width:175}));Y.column({width:"33%",labelWidth:90,labelSeparator:""},new Ext.form.TextField({fieldLabel:"Unit",name:"org_unit",width:175}),new Ext.form.TextField({fieldLabel:"Role",name:"contact_role",width:175}),new Ext.form.TextField({fieldLabel:"Title",name:"contact_title",width:175}),new Ext.form.TextField({fieldLabel:"Room",name:"contact_room",width:175}),new Ext.form.TextField({fieldLabel:"Name Assistent",name:"contact_assistent",width:175}),new Ext.form.TextField({fieldLabel:"Phone Assistent",name:"tel_assistent",width:175}));Y.end();Y.fieldset({legend:"Private information"});Y.column({width:"33%",labelWidth:90,labelSeparator:""},new Ext.form.TextField({fieldLabel:"Street",name:"adr_two_street",width:175}),new Ext.form.TextField({fieldLabel:"Street2",name:"adr_two_street2",width:175}),new Ext.form.TextField({fieldLabel:"Postalcode",name:"adr_two_postalcode",width:175}),new Ext.form.TextField({fieldLabel:"City",name:"adr_two_locality",width:175}),new Ext.form.TextField({fieldLabel:"Region",name:"adr_two_region",width:175}),new Ext.form.ComboBox({fieldLabel:"Country",name:"adr_two_countryname",hiddenName:"adr_two_countryname",store:X,displayField:"translatedName",valueField:"shortName",typeAhead:true,mode:"remote",triggerAction:"all",emptyText:"Select a state...",selectOnFocus:true,width:175}));Y.column({width:"33%",labelWidth:90,labelSeparator:""},new Ext.form.DateField({fieldLabel:"Birthday",name:"contact_bday",format:formData.config.dateFormat,altFormats:"Y-m-d",width:175}),new Ext.form.TextField({fieldLabel:"Phone",name:"tel_home",width:175}),new Ext.form.TextField({fieldLabel:"Cellphone",name:"tel_cell_private",width:175}),new Ext.form.TextField({fieldLabel:"Fax",name:"tel_fax_home",width:175}),new Ext.form.TextField({fieldLabel:"Email",name:"contact_email_home",vtype:"email",width:175}),new Ext.form.TextField({fieldLabel:"URL",name:"contact_url_home",vtype:"url",width:175}));Y.column({width:"33%",labelSeparator:"",hideLabels:true},new Ext.form.TextArea({name:"contact_note",grow:false,preventScrollbars:false,width:"95%",maxLength:255,height:150}));Y.end();var n=new Ext.form.TriggerField({fieldLabel:"Categories",name:"categories",width:320,readOnly:true});n.onTriggerClick=function(){var e=Ext.Element.get("container");var T=e.createChild({tag:"div",id:"iWindowTag"});var F=e.createChild({tag:"div",id:"iWindowContTag"});var S=new Ext.data.SimpleStore({fields:["category_id","category_realname"],data:[["1","erste Kategorie"],["2","zweite Kategorie"],["3","dritte Kategorie"],["4","vierte Kategorie"],["5","fuenfte Kategorie"],["6","sechste Kategorie"],["7","siebte Kategorie"],["8","achte Kategorie"]]});S.load();ds_checked=new Ext.data.SimpleStore({fields:["category_id","category_realname"],data:[["2","zweite Kategorie"],["5","fuenfte Kategorie"],["6","sechste Kategorie"],["8","achte Kategorie"]]});ds_checked.load();var H=new Ext.form.Form({labelWidth:75,url:"index.php?method=Addressbook.saveAdditionalData",reader:new Ext.data.JsonReader({root:"results"},[{name:"category_id"},{name:"category_realname"},])});var g=1;var U=new Array();ds_checked.each(function(V){U[V.data.category_id]=V.data.category_realname;});S.each(function(V){if((g%12)==1){H.column({width:"33%",labelWidth:50,labelSeparator:""});}if(U[V.data.category_id]){H.add(new Ext.form.Checkbox({boxLabel:V.data.category_realname,name:V.data.category_realname,checked:true}));}else{H.add(new Ext.form.Checkbox({boxLabel:V.data.category_realname,name:V.data.category_realname}));}if((g%12)==0){H.end();}g=g+1;});H.render("iWindowContTag");if(!C){var C=new Ext.LayoutDialog("iWindowTag",{modal:true,width:700,height:400,shadow:true,minWidth:700,minHeight:400,autoTabs:true,proxyDrag:true,center:{autoScroll:true,tabPosition:"top",closeOnTab:true,alwaysShowTabs:true}});C.addKeyListener(27,this.hide);C.addButton("save",function(){Ext.MessageBox.alert("Todo","Not yet implemented!");C.hide;},C);C.addButton("cancel",function(){Ext.MessageBox.alert("Todo","Not yet implemented!");C.hide;},C);var v=C.getLayout();v.beginUpdate();v.add("center",new Ext.ContentPanel("iWindowContTag",{autoCreate:true,title:"Category"}));v.endUpdate();}C.show();};Y.column({width:"45%",labelWidth:80,labelSeparator:" ",labelAlign:"right"},n);var r=new Ext.form.TriggerField({fieldLabel:"Lists",name:"lists",width:320,readOnly:true});r.onTriggerClick=function(){var e=Ext.Element.get("container");var T=e.createChild({tag:"div",id:"iWindowTag"});var F=e.createChild({tag:"div",id:"iWindowContTag"});var S=new Ext.data.SimpleStore({fields:["list_id","list_realname"],data:[["1","Liste A"],["2","Liste B"],["3","Liste C"],["4","Liste D"],["5","Liste E"],["6","Liste F"],["7","Liste G"],["8","Liste H"]]});S.load();ds_checked=new Ext.data.SimpleStore({fields:["list_id","list_realname"],data:[["2","Liste B"],["5","Liste E"],["6","Liste F"],["8","Liste H"]]});ds_checked.load();var H=new Ext.form.Form({labelWidth:75,url:"index.php?method=Addressbook.saveAdditionalData",reader:new Ext.data.JsonReader({root:"results"},[{name:"list_id"},{name:"list_realname"},])});var g=1;var U=new Array();ds_checked.each(function(V){U[V.data.list_id]=V.data.list_realname;});S.each(function(V){if((g%12)==1){H.column({width:"33%",labelWidth:50,labelSeparator:""});}if(U[V.data.list_id]){H.add(new Ext.form.Checkbox({boxLabel:V.data.list_realname,name:V.data.list_realname,checked:true}));}else{H.add(new Ext.form.Checkbox({boxLabel:V.data.list_realname,name:V.data.list_realname}));}if((g%12)==0){H.end();}g=g+1;});H.render("iWindowContTag");if(!C){var C=new Ext.LayoutDialog("iWindowTag",{modal:true,width:700,height:400,shadow:true,minWidth:700,minHeight:400,autoTabs:true,proxyDrag:true,center:{autoScroll:true,tabPosition:"top",closeOnTab:true,alwaysShowTabs:true}});C.addKeyListener(27,this.hide);C.addButton("save",function(){Ext.MessageBox.alert("Todo","Not yet implemented!");},C);C.addButton("cancel",function(){window.location.reload();C.hide;},C);var v=C.getLayout();v.beginUpdate();v.add("center",new Ext.ContentPanel("iWindowContTag",{autoCreate:true,title:"Lists"}));v.endUpdate();}C.show();};Y.column({width:"45%",labelWidth:80,labelSeparator:" ",labelAlign:"right"},r);Y.column({width:"10%",labelWidth:50,labelSeparator:" ",labelAlign:"right"},new Ext.form.Checkbox({fieldLabel:"Private",name:"categories",width:10}));Y.render("content");return Y;};var K=function(q,Y){for(var L in Y){var d=q.findField(L);if(d){d.setValue(Y[L]);}}};return {show:h,reload:function(){k.reload();},handleDragDrop:function(d){alert("Best Regards From Addressbook");},openDialog:function(){s();},displayContactDialog:function(){var d=b();if(formData.values){K(d,formData.values);}},};}();Egw.Addressbook.ListEditDialog=function(){var K=function(){Ext.QuickTips.init();Ext.form.Field.prototype.msgTarget="side";var D=Ext.Element.get("south");var k=D.createChild({tag:"div",id:"outergriddiv"});var t=new Ext.grid.ColumnModel([{resizable:true,id:"contact_id",header:"Id",dataIndex:"contact_id",width:30},{resizable:true,id:"n_family",header:"Family name",dataIndex:"n_family"},{resizable:true,id:"n_given",header:"Given name",dataIndex:"n_given"},{resizable:true,header:"Full name",dataIndex:"n_fn",hidden:true},{resizable:true,header:"Organisation",dataIndex:"org_name"},{resizable:true,header:"Unit",dataIndex:"org_unit"}]);t.defaultSortable=true;var f=new Ext.data.SimpleStore({fields:["contact_id","n_family"],data:[["1","Kneschke"],["2","Hemmerling"]]});f.load();var p=new Ext.grid.Grid(k,{ds:f,cm:t,autoSizeColumns:false,selModel:new Ext.grid.RowSelectionModel({multiSelect:true}),enableColLock:false,loadMask:true,autoExpandColumn:"n_family"});p.render();var s=new Ext.BorderLayout(document.body,{north:{split:false,initialSize:28},center:{autoScroll:true},south:{split:false,initialSize:128}});s.beginUpdate();s.add("north",new Ext.ContentPanel("header",{fitToFrame:true}));s.add("center",new Ext.ContentPanel("content"));s.add("south",new Ext.GridPanel(p));s.endUpdate();var W=true;if(formData.values){W=false;}var M=new Ext.Toolbar("header");M.add({id:"savebtn",cls:"x-btn-text-icon",text:"Save and Close",icon:"images/oxygen/22x22/actions/document-save.png",tooltip:"save this list and close window",onClick:function(){if(m.isValid()){var o={};if(formData.values){o._contactID=formData.values.contact_id;}else{o._contactID=0;}m.submit({waitTitle:"Please wait!",waitMsg:"saving contact...",params:o,success:function(a,A,Q){window.opener.EGWNameSpace.Addressbook.reload();window.setTimeout("window.close()",400);},failure:function(a,A){}});}else{Ext.MessageBox.alert("Errors","Please fix the errors noted.");}}},{id:"savebtn",cls:"x-btn-icon-22",icon:"images/oxygen/22x22/actions/save-all.png",tooltip:"apply changes for this list",onClick:function(){if(m.isValid()){var o={};if(formData.values){o._contactID=formData.values.contact_id;}else{o._contactID=0;}m.submit({waitTitle:"Please wait!",waitMsg:"saving contact...",params:o,success:function(a,A,Q){window.opener.EGWNameSpace.Addressbook.reload();},failure:function(a,A){}});}else{Ext.MessageBox.alert("Errors","Please fix the errors noted.");}}},{id:"deletebtn",cls:"x-btn-icon-22",icon:"images/oxygen/22x22/actions/edit-delete.png",tooltip:"delete this contact",disabled:W,handler:function(a,o){if(formData.values.contact_id){Ext.MessageBox.wait("Deleting contact...","Please wait!");_deleteContact([formData.values.contact_id]);_reloadMainWindow(true);}}},{id:"exportbtn",cls:"x-btn-icon-22",icon:"images/oxygen/22x22/actions/file-export.png",tooltip:"export this contact",disabled:W,});var b=new Ext.data.SimpleStore({fields:["id","addressbooks"],data:formData.config.addressbooks});var D=Ext.Element.get("content");var m=new Ext.form.Form({labelWidth:75,url:"index.php?method=Addressbook.saveAddress",reader:new Ext.data.JsonReader({root:"results"},[{name:"contact_id"},{name:"contact_tid"},{name:"contact_owner"},{name:"n_given"},{name:"n_middle"},{name:"n_fileas"},{name:"contact_created"},{name:"contact_creator"},{name:"account_id"}])});m.on("beforeaction",function(a,o){a.baseParams={};a.baseParams._contactOwner=a.getValues().contact_owner;a.baseParams._addressType="l";if(formData.values&&formData.values.contact_id){a.baseParams._contactID=formData.values.contact_id;}else{a.baseParams._contactID=0;}console.log(a.baseParams);});m.fieldset({legend:"List information"});m.column({width:"100%",labelWidth:90,labelSeparator:""},new Ext.form.ComboBox({fieldLabel:"Addressbook",name:"contact_owner",hiddenName:"contact_owner",store:b,displayField:"addressbooks",valueField:"id",allowBlank:false,editable:false,mode:"remote",triggerAction:"all",emptyText:"Select a addressbook...",selectOnFocus:true,width:300}),new Ext.form.TextField({fieldLabel:"List Name",name:"n_family",width:300}),new Ext.form.TextField({fieldLabel:"List Nickname",name:"n_given",width:300}),new Ext.form.TextField({fieldLabel:"List Description",name:"org_name",width:300}));m.end();m.fieldset({legend:"List members"});m.column({width:"100%",labelWidth:90,labelSeparator:""},new Ext.form.ComboBox({fieldLabel:"add member",name:"new_member",hiddenName:"new_member",store:b,displayField:"n_fn",valueField:"id",mode:"remote",emptyText:"enter new list member...",selectOnFocus:true,hideTrigger:true,width:300}),new Ext.form.TextArea({fieldLabel:"List Members",name:"n_given",width:300}));m.end();m.render("content");return m;};return {display:function(){var f=K();if(formData.values){_setContactDialogValues(dialog,formData.values);}},displayDialog:K};}();