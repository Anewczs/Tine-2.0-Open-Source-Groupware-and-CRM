Ext.namespace("Egw.Addressbook");Egw.Addressbook=function(){var K;var a;var Q;var F=function(c){c.baseParams.filter=Ext.getCmp("quickSearchField").getRawValue()};var D=function(d,c){Egw.Egwbase.openWindow("contactWindow","index.php?method=Addressbook.editContact&_contactId=",850,600)};var V=function(d,c){Egw.Egwbase.openWindow("listWindow","index.php?method=Addressbook.editList&_listId=",800,450)};var E=function(j,c){var g=Ext.getCmp("contacts-tree").getSelectionModel().getSelectedNode();if(g.attributes.dataPanelType=="lists"){var f=Array();var h=a.getSelectionModel().getSelections();for(var e=0;e<h.length;++e){f.push(h[e].id)}f=Ext.util.JSON.encode(f);Ext.Ajax.request({url:"index.php",params:{method:"Addressbook.deleteLists",listIds:f},text:"Deleting list...",success:function(k,i){K.reload()},failure:function(i,k){Ext.MessageBox.alert("Failed","Some error occured while trying to delete the list.")}})}else{var d=Array();var h=a.getSelectionModel().getSelections();for(var e=0;e<h.length;++e){d.push(h[e].id)}d=Ext.util.JSON.encode(d);Ext.Ajax.request({url:"index.php",params:{method:"Addressbook.deleteContacts",_contactIds:d},text:"Deleting contact...",success:function(k,i){K.reload()},failure:function(i,k){Ext.MessageBox.alert("Failed","Some error occured while trying to delete the conctact.")}})}};var J=function(g,c){var d=Ext.getCmp("contacts-tree").getSelectionModel().getSelectedNode();var f=a.getSelectionModel().getSelections();var e=f[0].id;if(d.attributes.dataPanelType=="lists"){Egw.Egwbase.openWindow("listWindow","index.php?method=Addressbook.editList&_listId="+e,800,450)}else{Egw.Egwbase.openWindow("contactWindow","index.php?method=Addressbook.editContact&_contactId="+e,850,600)}};var T=function(c,d){K.reload()};var W=new Ext.Action({text:"add contact",handler:D,iconCls:"action_addContact"});var U=new Ext.Action({text:"add list",handler:V,iconCls:"action_addList"});var I=new Ext.Action({text:"edit",disabled:true,handler:J,iconCls:"action_edit"});var X=new Ext.Action({text:"delete",disabled:true,handler:E,iconCls:"action_delete"});var C=function(){var d=new Ext.app.SearchField({id:"quickSearchField",width:240,emptyText:"enter searchfilter"});d.on("change",T);var c=new Ext.Toolbar({region:"south",id:"applicationToolbar",split:false,height:26,items:[W,U,I,X,"->","Search:"," "," ",d]});Egw.Egwbase.setActiveToolbar(c)};var R=function(){var f=new Ext.tree.TreeLoader({dataUrl:"index.php"});f.on("beforeload",function(h,g){h.baseParams.method="Addressbook.getSubTree";h.baseParams.node=g.id;h.baseParams.datatype=g.attributes.datatype;h.baseParams.owner=g.attributes.owner;h.baseParams.location="mainTree"},this);var e=new Ext.tree.TreePanel({title:"Contacts",id:"contacts-tree",loader:f,rootVisible:false,border:false});var c=new Ext.tree.TreeNode({text:"root",draggable:false,allowDrop:false,id:"root"});e.setRootNode(c);for(var d=0;d<initialTree.Addressbook.length;d++){c.appendChild(new Ext.tree.AsyncTreeNode(initialTree.Addressbook[d]))}e.on("click",function(h,g){I.setDisabled(true);X.setDisabled(true);switch(h.attributes.dataPanelType){case"contacts":if(Q!=h.attributes.dataPanelType){P(h);G();Q=h.attributes.dataPanelType}else{K.baseParams=H(h);K.load({params:{start:0,limit:50}})}break;case"lists":if(Q!=h.attributes.dataPanelType){N(h);S();Q=h.attributes.dataPanelType}else{K.baseParams=B(h);K.load({params:{start:0,limit:50}})}break}},this);e.on("beforeexpand",function(g){C();if(g.getSelectionModel().getSelectedNode()==null){g.expandPath("/root/alllists");g.expandPath("/root/allcontacts");g.selectPath("/root/allcontacts")}g.fireEvent("click",g.getSelectionModel().getSelectedNode())},this);e.on("contextmenu",function(h,g){g.stopEvent();switch(h.attributes.contextMenuClass){case"ctxMenuContactsTree":M.showAt(g.getXY());break}});return e};var B=function(c){return{method:c.attributes.jsonMethod,owner:c.attributes.owner,datatype:c.attributes.datatype}};var N=function(c){K=new Ext.data.JsonStore({url:"index.php",baseParams:B(c),root:"results",totalProperty:"totalcount",id:"list_id",fields:[{name:"list_id"},{name:"list_name"},{name:"list_owner"}],remoteSort:true});K.setDefaultSort("list_name","asc");K.on("beforeload",F);K.load({params:{start:0,limit:50}})};var H=function(c){switch(c.attributes.datatype){case"listMembers":var d={method:c.attributes.jsonMethod,owner:c.attributes.owner,listId:c.attributes.listId,datatype:c.attributes.datatype};break;default:var d={method:c.attributes.jsonMethod,owner:c.attributes.owner,datatype:c.attributes.datatype};break}return d};var P=function(c){K=new Ext.data.JsonStore({url:"index.php",baseParams:H(c),root:"results",totalProperty:"totalcount",id:"contact_id",fields:[{name:"contact_id"},{name:"contact_tid"},{name:"contact_owner"},{name:"contact_private"},{name:"cat_id"},{name:"n_family"},{name:"n_given"},{name:"n_middle"},{name:"n_prefix"},{name:"n_suffix"},{name:"n_fn"},{name:"n_fileas"},{name:"contact_bday"},{name:"org_name"},{name:"org_unit"},{name:"contact_title"},{name:"contact_role"},{name:"contact_assistent"},{name:"contact_room"},{name:"adr_one_street"},{name:"adr_one_street2"},{name:"adr_one_locality"},{name:"adr_one_region"},{name:"adr_one_postalcode"},{name:"adr_one_countryname"},{name:"contact_label"},{name:"adr_two_street"},{name:"adr_two_street2"},{name:"adr_two_locality"},{name:"adr_two_region"},{name:"adr_two_postalcode"},{name:"adr_two_countryname"},{name:"tel_work"},{name:"tel_cell"},{name:"tel_fax"},{name:"tel_assistent"},{name:"tel_car"},{name:"tel_pager"},{name:"tel_home"},{name:"tel_fax_home"},{name:"tel_cell_private"},{name:"tel_other"},{name:"tel_prefer"},{name:"contact_email"},{name:"contact_email_home"},{name:"contact_url"},{name:"contact_url_home"},{name:"contact_freebusy_uri"},{name:"contact_calendar_uri"},{name:"contact_note"},{name:"contact_tz"},{name:"contact_geo"},{name:"contact_pubkey"},{name:"contact_created"},{name:"contact_creator"},{name:"contact_modified"},{name:"contact_modifier"},{name:"contact_jpegphoto"},{name:"account_id"}],remoteSort:true});K.setDefaultSort("n_family","asc");K.on("beforeload",F);K.load({params:{start:0,limit:50}})};var S=function(){var c=Ext.getCmp("center-panel");if(c.items){for(var d=0;d<c.items.length;d++){c.remove(c.items.get(d))}}var e=new Ext.PagingToolbar({pageSize:50,store:K,displayInfo:true,displayMsg:"Displaying contacts {0} - {1} of {2}",emptyMsg:"No contacts to display"});var f=new Ext.grid.ColumnModel([{resizable:true,header:"List name",id:"list_name",dataIndex:"list_name"}]);f.defaultSortable=true;a=new Ext.grid.GridPanel({store:K,cm:f,tbar:e,autoSizeColumns:false,selModel:new Ext.grid.RowSelectionModel({multiSelect:true}),enableColLock:false,autoExpandColumn:"list_name",border:false});c.add(a);c.show();c.doLayout();a.on("rowclick",function(j,i,h){var g=a.getSelectionModel().getCount();if(g<1){I.setDisabled(true);X.setDisabled(true)}else{if(g==1){I.setDisabled(false);X.setDisabled(false)}else{I.setDisabled(true);X.setDisabled(false)}}});a.on("rowcontextmenu",function(h,g,i){i.stopEvent();if(!h.getSelectionModel().isSelected(g)){h.getSelectionModel().selectRow(g);I.setDisabled(false);X.setDisabled(false)}b.showAt(i.getXY())});a.on("rowdblclick",function(h,i,j){var g=h.getStore().getAt(i);try{Egw.Egwbase.openWindow("listWindow","index.php?method=Addressbook.editList&_listId="+g.data.list_id,800,450)}catch(k){}});return };var G=function(){var c=Ext.getCmp("center-panel");if(c.items){for(var d=0;d<c.items.length;d++){c.remove(c.items.get(d))}}var e=new Ext.PagingToolbar({pageSize:25,store:K,displayInfo:true,displayMsg:"Displaying contacts {0} - {1} of {2}",emptyMsg:"No contacts to display"});var f=new Ext.grid.ColumnModel([{resizable:true,id:"contact_tid",header:"Type",dataIndex:"contact_tid",width:30,renderer:Z},{resizable:true,id:"n_family",header:"Family name",dataIndex:"n_family"},{resizable:true,id:"n_given",header:"Given name",dataIndex:"n_given",width:80},{resizable:true,id:"n_fn",header:"Full name",dataIndex:"n_fn",hidden:true},{resizable:true,id:"n_fileas",header:"Name + Firm",dataIndex:"n_fileas",hidden:true},{resizable:true,id:"contact_email",header:"eMail",dataIndex:"contact_email",width:150,hidden:false},{resizable:true,id:"contact_bday",header:"Birthday",dataIndex:"contact_bday",hidden:true},{resizable:true,id:"org_name",header:"Organisation",dataIndex:"org_name",width:150},{resizable:true,id:"org_unit",header:"Unit",dataIndex:"org_unit",hidden:true},{resizable:true,id:"contact_title",header:"Title",dataIndex:"contact_title",hidden:true},{resizable:true,id:"contact_role",header:"Role",dataIndex:"contact_role",hidden:true},{resizable:true,id:"contact_room",header:"Room",dataIndex:"contact_room",hidden:true},{resizable:true,id:"adr_one_street",header:"Street",dataIndex:"adr_one_street",hidden:true},{resizable:true,id:"adr_one_locality",header:"Locality",dataIndex:"adr_one_locality",width:80,hidden:false},{resizable:true,id:"adr_one_region",header:"Region",dataIndex:"adr_one_region",hidden:true},{resizable:true,id:"adr_one_postalcode",header:"Postalcode",dataIndex:"adr_one_postalcode",hidden:true},{resizable:true,id:"adr_one_countryname",header:"Country",dataIndex:"adr_one_countryname",hidden:true},{resizable:true,id:"adr_two_street",header:"Street (private)",dataIndex:"adr_two_street",hidden:true},{resizable:true,id:"adr_two_locality",header:"Locality (private)",dataIndex:"adr_two_locality",hidden:true},{resizable:true,id:"adr_two_region",header:"Region (private)",dataIndex:"adr_two_region",hidden:true},{resizable:true,id:"adr_two_postalcode",header:"Postalcode (private)",dataIndex:"adr_two_postalcode",hidden:true},{resizable:true,id:"adr_two_countryname",header:"Country (private)",dataIndex:"adr_two_countryname",hidden:true},{resizable:true,id:"tel_work",header:"Phone",dataIndex:"tel_work",hidden:false},{resizable:true,id:"tel_cell",header:"Cellphone",dataIndex:"tel_cell",hidden:false},{resizable:true,id:"tel_fax",header:"Fax",dataIndex:"tel_fax",hidden:true},{resizable:true,id:"tel_car",header:"Car phone",dataIndex:"tel_car",hidden:true},{resizable:true,id:"tel_pager",header:"Pager",dataIndex:"tel_pager",hidden:true},{resizable:true,id:"tel_home",header:"Phone (private)",dataIndex:"tel_home",hidden:true},{resizable:true,id:"tel_fax_home",header:"Fax (private)",dataIndex:"tel_fax_home",hidden:true},{resizable:true,id:"tel_cell_private",header:"Cellphone (private)",dataIndex:"tel_cell_private",hidden:true},{resizable:true,id:"contact_email_home",header:"eMail (private)",dataIndex:"contact_email_home",hidden:true},{resizable:true,id:"contact_url",header:"URL",dataIndex:"contact_url",hidden:true},{resizable:true,id:"contact_url_home",header:"URL (private)",dataIndex:"contact_url_home",hidden:true},{resizable:true,id:"contact_note",header:"Note",dataIndex:"contact_note",hidden:true},{resizable:true,id:"contact_tz",header:"Timezone",dataIndex:"contact_tz",hidden:true},{resizable:true,id:"contact_geo",header:"Geo",dataIndex:"contact_geo",hidden:true}]);f.defaultSortable=true;a=new Ext.grid.GridPanel({store:K,cm:f,tbar:e,autoSizeColumns:false,selModel:new Ext.grid.RowSelectionModel({multiSelect:true}),enableColLock:false,autoExpandColumn:"n_family",border:false});c.add(a);c.show();c.doLayout();a.on("rowclick",function(h,j,i){var g=h.getSelectionModel().getCount();if(g<1){I.setDisabled(true);X.setDisabled(true)}else{if(g==1){I.setDisabled(false);X.setDisabled(false)}else{I.setDisabled(true);X.setDisabled(false)}}});a.on("rowcontextmenu",function(h,g,i){i.stopEvent();if(!h.getSelectionModel().isSelected(g)){h.getSelectionModel().selectRow(g);I.setDisabled(false);X.setDisabled(false)}L.showAt(i.getXY())});a.on("rowdblclick",function(h,i,j){var g=h.getStore().getAt(i);if(g.data.contact_tid=="l"){try{Egw.Egwbase.openWindow("listWindow","index.php?method=Addressbook.editList&_listId="+g.data.contact_id,800,450)}catch(k){}}else{try{Egw.Egwbase.openWindow("contactWindow","index.php?method=Addressbook.editContact&_contactId="+g.data.contact_id,850,600)}catch(k){}}});return };var Z=function(f,h,e,c,d,g){switch(f){case"l":return"<img src='images/oxygen/16x16/actions/users.png' width='12' height='12' alt='list'/>";default:return"<img src='images/oxygen/16x16/actions/user.png' width='12' height='12' alt='contact'/>"}};var L=new Ext.menu.Menu({id:"ctxMenuAddress1",items:[I,X,"-",W]});var b=new Ext.menu.Menu({id:"ctxMenuAddress2",items:[I,X,"-",U]});var M=new Ext.menu.Menu({id:"ctxMenuAddress3",items:[W]});var A=function(l,e){var d;var o=1024,j=786,m,k;var f=850,n=600;if(e=="list"){f=450,n=600}if(document.all){o=document.body.clientWidth;j=document.body.clientHeight;m=window.screenTop;k=window.screenLeft}else{if(window.innerWidth){o=window.innerWidth;j=window.innerHeight;m=window.screenX;k=window.screenY}}var g=((o-f)/2)+k,i=((j-n)/2)+m;if(e=="list"&&!l){d="index.php?method=Addressbook.editList"}else{if(e=="list"&&l){d="index.php?method=Addressbook.editList&contactid="+l}else{if(e!="list"&&l){d="index.php?method=Addressbook.editContact&contactid="+l}else{d="index.php?method=Addressbook.editContact"}}}var p="addressbook";var c=window.open(d,"popupname","width="+f+",height="+n+",top="+i+",left="+g+",directories=no,toolbar=no,location=no,menubar=no,scrollbars=no,status=no,resizable=no,dependent=no");return };var Y=function(c){c=(c==null)?false:c;window.opener.Egw.Addressbook.reload();if(c==true){window.setTimeout("window.close()",400)}};var O=function(h){if(!e){var e=new Ext.Window({title:"please select addressbook",modal:true,width:375,height:400,minWidth:375,minHeight:400,layout:"fit",plain:true,bodyStyle:"padding:5px;",buttonAlign:"center"});var f=Ext.tree;var g=new f.TreeLoader({dataUrl:"index.php"});g.on("beforeload",function(j,i){j.baseParams.method="Addressbook.getSubTree";j.baseParams.node=i.id;j.baseParams.datatype=i.attributes.datatype;j.baseParams.owner=i.attributes.owner;j.baseParams.location="selectFolder"},this);var c=new f.TreePanel({animate:true,id:"addressbookTree",loader:g,containerScroll:true,rootVisible:false});var d=new f.TreeNode({text:"root",draggable:false,allowDrop:false,id:"root"});c.setRootNode(d);Ext.each(formData.config.initialTree,function(i){d.appendChild(new f.AsyncTreeNode(i))});c.on("click",function(i){if(i.attributes.datatype=="contacts"){Ext.getCmp(h).setValue(i.attributes.owner);Ext.getCmp(h+"_name").setValue(i.text);e.hide()}});e.add(c);e.show()}};return{show:function(c){C();_showContactTree();_showContactGrid(c)},displayAddressbookSelectDialog:O,getPanel:R,reload:function(){K.reload()}}}();Egw.Addressbook.ContactEditDialog=function(){var C;var I;var G;var A=function(P,N){var M=Ext.getCmp("contactDialog").getForm();M.render();if(M.isValid()){var O={};if(formData.values){O.contact_id=formData.values.contact_id}M.submit({waitTitle:"Please wait!",waitMsg:"saving contact...",params:O,success:function(Q,R,S){window.opener.Egw.Addressbook.reload()},failure:function(Q,R){}})}else{Ext.MessageBox.alert("Errors","Please fix the errors noted.")}};var B=function(P,N){var M=Ext.getCmp("contactDialog").getForm();M.render();if(M.isValid()){var O={};if(formData.values){O.contact_id=formData.values.contact_id}M.submit({waitTitle:"Please wait!",waitMsg:"saving contact...",params:O,success:function(Q,R,S){window.opener.Egw.Addressbook.reload();window.setTimeout("window.close()",400)},failure:function(Q,R){}})}else{Ext.MessageBox.alert("Errors","Please fix the errors noted.")}};var D=function(O,M){var N=Ext.util.JSON.encode([formData.values.contact_id]);Ext.Ajax.request({url:"index.php",params:{method:"Addressbook.deleteContacts",_contactIds:N},text:"Deleting contact...",success:function(Q,P){window.opener.Egw.Addressbook.reload();window.setTimeout("window.close()",400)},failure:function(P,Q){Ext.MessageBox.alert("Failed","Some error occured while trying to delete the conctact.")}})};var J=new Ext.Action({text:"save and close",handler:B,iconCls:"action_saveAndClose"});var K=new Ext.Action({text:"apply changes",handler:A,iconCls:"action_applyChanges"});var H=new Ext.Action({text:"delete contact",handler:D,iconCls:"action_delete"});var E=function(){Ext.QuickTips.init();Ext.form.Field.prototype.msgTarget="side";var c=true;if(formData.values){c=false}var Z=new Ext.Toolbar({region:"south",id:"applicationToolbar",split:false,height:26,items:[J,K,H]});var a=new Ext.data.JsonStore({url:"index.php",baseParams:{method:"Egwbase.getCountryList"},root:"results",id:"shortName",fields:["shortName","translatedName"],remoteSort:false});var T=new Ext.form.TriggerField({fieldLabel:"Addressbook",id:"contact_owner_name",anchor:"95%",allowBlank:false,readOnly:true});T.onTriggerClick=function(){Egw.Addressbook.displayAddressbookSelectDialog("contact_owner")};var O=function(d){d.baseParams.method="Addressbook.getContacts";d.baseParams.options=Ext.encode({displayContacts:false,displayLists:true})};var b=[["AL","Alabama"],["AK","Alaska"],["AZ","Arizona"],["WV","West Virginia"],["WI","Wisconsin"],["WY","Wyoming"]];var Q=new Ext.data.SimpleStore({fields:["contact_id","contact_tid"],data:b});var P=new Ext.data.SimpleStore({fields:["contact_id","contact_tid"]});var X=new Ext.DataView({style:"overflow:auto",multiSelect:true,id:"list_source_",cls:"x-list-small",selectedClass:"x-list-selected",itemSelector:"div.x-view",store:Q,tpl:new Ext.XTemplate('<tpl for=".">','<div class="x-view" id="{contact_id}">{contact_tid}</div>',"</tpl>")});function M(e,d){return e-d}var Y=function(k,l,m,e){var l=Ext.getCmp("list_source_");var j=String(l.getSelectedIndexes());var f=l.getSelectionCount();if(l.getSelectionCount()>"1"){var d=j.split(",")}else{if(l.getSelectionCount()=="1"){var d=new Array(j)}}d.sort(M);d.reverse();for(var g=0;g<f;g++){var h=Q.getAt(d[g]);P.add(h)}P.sort("contact_tid","ASC");for(g=0;g<f;g++){var h=Q.getAt(d[g]);Q.remove(h)}Q.sort("contact_tid","ASC")};var N=function(k,l,m,e){var l=Ext.getCmp("list_selected_");var j=String(l.getSelectedIndexes());var f=l.getSelectionCount();if(l.getSelectionCount()>"1"){var d=j.split(",")}else{if(l.getSelectionCount()=="1"){var d=new Array(j)}}d.sort(M);d.reverse();for(var g=0;g<f;g++){var h=P.getAt(d[g]);Q.add(h)}Q.sort("contact_tid","ASC");for(var g=0;g<f;g++){var h=P.getAt(d[g]);P.remove(h)}P.sort("contact_tid","ASC")};X.on("dblclick",Y);var W=new Ext.DataView({style:"overflow:auto",multiSelect:true,id:"list_selected_",cls:"x-list-small",selectedClass:"x-list-selected",itemSelector:"div.x-view",store:P,tpl:new Ext.XTemplate('<tpl for=".">','<div class="x-view" id="{contact_id}">{contact_tid}</div>',"</tpl>")});W.on("dblclick",N);var S=new Ext.Panel({id:"list_source",title:"available lists",region:"center",margins:"5 5 5 0",layout:"fit",items:X});var U=new Ext.Panel({id:"list_selected",title:"chosen lists",region:"center",margins:"5 5 5 0",layout:"fit",items:W});var R=new Ext.FormPanel({url:"index.php",baseParams:{method:"Addressbook.saveContact"},labelAlign:"top",bodyStyle:"padding:5px",anchor:"100%",region:"center",id:"contactDialog",tbar:Z,deferredRender:false,items:[{layout:"column",border:false,deferredRender:false,anchor:"100%",items:[{columnWidth:0.4,layout:"form",border:false,items:[{xtype:"textfield",fieldLabel:"First Name",name:"n_given",anchor:"95%"},{xtype:"textfield",fieldLabel:"Middle Name",name:"n_middle",anchor:"95%"},{xtype:"textfield",fieldLabel:"Last Name",name:"n_family",allowBlank:false,anchor:"95%"}]},{columnWidth:0.2,layout:"form",border:false,items:[{xtype:"textfield",fieldLabel:"Prefix",name:"n_prefix",anchor:"95%"},{xtype:"textfield",fieldLabel:"Suffix",name:"n_suffix",anchor:"95%"},T]},{columnWidth:0.4,layout:"form",border:false,items:[{xtype:"textarea",name:"contact_note",fieldLabel:"Notes",grow:false,preventScrollbars:false,anchor:"95% 100%"}]}]},{xtype:"tabpanel",plain:true,activeTab:0,deferredRender:false,anchor:"100% 70%",defaults:{bodyStyle:"padding:10px"},items:[{title:"Business information",layout:"column",deferredRender:false,border:false,items:[{columnWidth:0.333,layout:"form",border:false,items:[{xtype:"textfield",fieldLabel:"Company",name:"org_name",anchor:"95%"},{xtype:"textfield",fieldLabel:"Street",name:"adr_one_street",anchor:"95%"},{xtype:"textfield",fieldLabel:"Street 2",name:"adr_one_street2",anchor:"95%"},{xtype:"textfield",fieldLabel:"Postalcode",name:"adr_one_postalcode",anchor:"95%"},{xtype:"textfield",fieldLabel:"City",name:"adr_one_locality",anchor:"95%"},{xtype:"textfield",fieldLabel:"Region",name:"adr_one_region",anchor:"95%"},new Ext.form.ComboBox({fieldLabel:"Country",name:"adr_one_countryname",hiddenName:"adr_one_countryname",store:a,displayField:"translatedName",valueField:"shortName",typeAhead:true,mode:"remote",triggerAction:"all",emptyText:"Select a state...",selectOnFocus:true,anchor:"95%"})]},{columnWidth:0.333,layout:"form",border:false,items:[{xtype:"textfield",fieldLabel:"Phone",name:"tel_work",anchor:"95%"},{xtype:"textfield",fieldLabel:"Cellphone",name:"tel_cell",anchor:"95%"},{xtype:"textfield",fieldLabel:"Fax",name:"tel_fax",anchor:"95%"},{xtype:"textfield",fieldLabel:"Car phone",name:"tel_car",anchor:"95%"},{xtype:"textfield",fieldLabel:"Pager",name:"tel_pager",anchor:"95%"},{xtype:"textfield",fieldLabel:"Email",name:"contact_email",vtype:"email",anchor:"95%"},{xtype:"textfield",fieldLabel:"URL",name:"contact_url",vtype:"url",anchor:"95%"}]},{columnWidth:0.333,layout:"form",border:false,items:[{xtype:"textfield",fieldLabel:"Unit",name:"org_unit",anchor:"95%"},{xtype:"textfield",fieldLabel:"Role",name:"contact_role",anchor:"95%"},{xtype:"textfield",fieldLabel:"Title",name:"contact_title",anchor:"95%"},{xtype:"textfield",fieldLabel:"Room",name:"contact_room",anchor:"95%"},{xtype:"textfield",fieldLabel:"Name Assistent",name:"contact_assistent",anchor:"95%"},{xtype:"textfield",fieldLabel:"Phone Assistent",name:"tel_assistent",anchor:"95%"}]}]},{title:"Private information",layout:"column",deferredRender:false,border:false,items:[{columnWidth:0.333,layout:"form",border:false,items:[{xtype:"textfield",fieldLabel:"Street",name:"adr_two_street",anchor:"95%"},{xtype:"textfield",fieldLabel:"Street2",name:"adr_two_street2",anchor:"95%"},{xtype:"textfield",fieldLabel:"Postalcode",name:"adr_two_postalcode",anchor:"95%"},{xtype:"textfield",fieldLabel:"City",name:"adr_two_locality",anchor:"95%"},{xtype:"textfield",fieldLabel:"Region",name:"adr_two_region",anchor:"95%"},new Ext.form.ComboBox({fieldLabel:"Country",name:"adr_two_countryname",hiddenName:"adr_two_countryname",store:a,displayField:"translatedName",valueField:"shortName",typeAhead:true,mode:"remote",triggerAction:"all",emptyText:"Select a state...",selectOnFocus:true,anchor:"95%"})]},{columnWidth:0.333,layout:"form",border:false,items:[new Ext.form.DateField({fieldLabel:"Birthday",name:"contact_bday",format:formData.config.dateFormat,altFormats:"Y-m-d",anchor:"95%"}),{xtype:"textfield",fieldLabel:"Phone",name:"tel_home",anchor:"95%"},{xtype:"textfield",fieldLabel:"Cellphone",name:"tel_cell_private",anchor:"95%"},{xtype:"textfield",fieldLabel:"Fax",name:"tel_fax_home",anchor:"95%"},{xtype:"textfield",fieldLabel:"Email",name:"contact_email_home",vtype:"email",anchor:"95%"},{xtype:"textfield",fieldLabel:"URL",name:"contact_url_home",vtype:"url",anchor:"95%"}]},{columnWidth:0.333,layout:"form",border:false}]},{title:"Lists",layout:"column",deferredRender:false,border:false,items:[{columnWidth:0.333,layout:"form",border:false,items:[new Ext.Panel({layout:"fit",id:"source",width:250,height:350,items:[S]})]},{columnWidth:0.333,layout:"form",border:false,extraCls:"list-butons",items:[new Ext.Button({text:"add",iconCls:"blist",minWidth:80,handler:Y,icon:"images/oxygen/16x16/actions/arrow-right-double.png"}),new Ext.Button({text:"remove",iconCls:"blist",minWidth:80,handler:N,icon:"images/oxygen/16x16/actions/arrow-left-double.png"})]},{columnWidth:0.333,layout:"form",border:false,items:[new Ext.Panel({layout:"fit",id:"destination",width:250,height:350,items:[U]})]}]},{title:"Categories",disabled:true,layout:"column",deferredRender:false,border:false,items:[{}]}]},{xtype:"hidden",name:"contact_owner",id:"contact_owner"}]});var V=new Ext.Viewport({layout:"border",items:R})};var L=function(N){var M=Ext.getCmp("contactDialog").getForm();M.setValues(N);M.findField("contact_owner_name").setRawValue(formData.config.addressbookName);if(formData.config.oneCountryName){M.findField("adr_one_countryname").setRawValue(formData.config.oneCountryName)}if(formData.config.twoCountryName){M.findField("adr_two_countryname").setRawValue(formData.config.twoCountryName)}};var F=function(N,M){Ext.MessageBox.alert("Export","Not yet implemented.")};return{display:function(){var M=E();if(formData.values){L(formData.values)}}}}();Egw.Addressbook.ListEditDialog=function(){var F;var A=function(S,P){var O=Ext.getCmp("listDialog").getForm();var N=Ext.getCmp("listGrid").getStore();var Q=new Array();N.each(function(T){Q.push(T.data)});if(O.isValid()){var R={listMembers:Ext.util.JSON.encode(Q),};O.submit({waitTitle:"Please wait!",waitMsg:"saving contact...",params:R,success:function(T,U,V){window.opener.Egw.Addressbook.reload()},failure:function(T,U){}})}else{Ext.MessageBox.alert("Errors","Please fix the errors noted.")}};var B=function(S,P){var O=Ext.getCmp("listDialog").getForm();var N=Ext.getCmp("listGrid").getStore();var Q=new Array();N.each(function(T){Q.push(T.data)});if(O.isValid()){var R={listMembers:Ext.util.JSON.encode(Q),};O.submit({waitTitle:"Please wait!",waitMsg:"saving contact...",params:R,success:function(T,U,V){window.opener.Egw.Addressbook.reload();window.setTimeout("window.close()",400)},failure:function(T,U){}})}else{Ext.MessageBox.alert("Errors","Please fix the errors noted.")}};var C=function(P,N){var O=Ext.util.JSON.encode([formData.values.list_id]);Ext.Ajax.request({url:"index.php",params:{method:"Addressbook.deleteLists",listIds:O},text:"Deleting list...",success:function(R,Q){window.opener.Egw.Addressbook.reload();window.setTimeout("window.close()",400)},failure:function(Q,R){Ext.MessageBox.alert("Failed","Some error occured while trying to delete the conctact.")}})};var H=function(S,N){var P=Ext.getCmp("listGrid");var Q=P.getStore();var R=P.getSelectionModel().getSelections();for(var O=0;O<R.length;++O){Q.remove(R[O])}M.setDisabled(true)};var I=new Ext.Action({text:"save and close",handler:B,iconCls:"action_saveAndClose"});var J=new Ext.Action({text:"apply changes",handler:A,iconCls:"action_applyChanges"});var E=new Ext.Action({text:"delete list",handler:C,iconCls:"action_delete"});var M=new Ext.Action({text:"remove list member",disabled:true,handler:H,iconCls:"action_delete"});var D=function(){Ext.QuickTips.init();Ext.form.Field.prototype.msgTarget="side";var Z=true;if(formData.values){Z=false}var Y=new Ext.Toolbar({region:"south",id:"applicationToolbar",split:false,height:26,items:[I,J,E,"-",M]});var S=new Ext.form.TriggerField({fieldLabel:"Addressbook",id:"list_owner_name",anchor:"100%",allowBlank:false,readOnly:true});S.onTriggerClick=function(){Egw.Addressbook.displayAddressbookSelectDialog("list_owner")};var T=new Ext.data.JsonStore({url:"index.php",baseParams:{method:"Addressbook.getOverview",options:'{"displayContacts":true,"displayLists":false}'},root:"results",totalProperty:"totalcount",id:"contact_id",fields:[{name:"contact_id"},{name:"n_family"},{name:"n_given"},{name:"contact_email"}],remoteSort:true});T.setDefaultSort("n_family","asc");var R=new Ext.form.ComboBox({store:T,fieldLabel:"Add new list members",displayField:"n_family",typeAhead:false,loadingText:"Searching...",anchor:"100%",pageSize:10,hideTrigger:true,itemSelector:"div.search-item",tpl:new Ext.XTemplate('<tpl for=".">','<div class="search-item">{n_family}, {n_given} {contact_email}</div>',"</tpl>")});R.on("select",function(d,a,b){var c=new Q({contact_id:a.data.contact_id,n_family:a.data.n_family,contact_email:a.data.contact_email});N.add(c);N.sort("n_family");R.reset();R.collapse()});R.on("change",function(c,b,a){console.log(b+" "+a)});R.on("specialkey",function(h,c){if(T.getCount()==0){var g=/^[a-z0-9_-]+(\.[a-z0-9_-]+)*@([0-9a-z][0-9a-z-]*[0-9a-z]\.)+([a-z]{2,4}|museum)$/;var b=g.exec(R.getValue());if(b&&(c.getKey()==c.ENTER||c.getKey()==c.RETURN)){var f=R.getValue();var a=f.indexOf("@");if(a!=-1){var e=Ext.util.Format.capitalize(f.substr(0,a))}else{var e=f}var d=new Q({contact_id:null,n_family:e,contact_email:f});N.add(d);N.sort("n_family");R.reset()}}});var U=new Ext.FormPanel({url:"index.php",baseParams:{method:"Addressbook.saveList"},labelAlign:"top",bodyStyle:"padding:5px",width:450,deferredRender:false,id:"listDialog",width:300,items:[{layout:"form",border:false,anchor:"100%",items:[S,{xtype:"textfield",fieldLabel:"List Name",id:"list_name",anchor:"100%"},{xtype:"textarea",fieldLabel:"List Description",id:"list_description",height:100,grow:false,anchor:"100%"},R,{xtype:"hidden",id:"list_owner"},{xtype:"hidden",id:"list_id"}]}]});var Q=Ext.data.Record.create([{name:"contact_id",type:"int"},{name:"n_family",type:"string"},{name:"contact_email",type:"string"}]);if(formData.values.list_members){var O=formData.values.list_members}else{var O=[]}var N=new Ext.data.SimpleStore({id:"list_Members",fields:["contact_id","n_family","contact_email"],data:O});N.sort("n_family","asc");var W=new Ext.grid.ColumnModel([{resizable:true,id:"n_family",header:"Family name",dataIndex:"n_family"},{resizable:true,id:"contact_email",header:"eMail address",dataIndex:"contact_email"}]);W.defaultSortable=true;var X=new Ext.menu.Menu({id:"ctxListMenu",items:[M]});var P=new Ext.grid.GridPanel({store:N,cm:W,id:"listGrid",layout:"fit",selModel:new Ext.grid.RowSelectionModel({multiSelect:true}),autoSizeColumns:true,trackMouseOver:true,contextMenu:"ctxListMenu",autoExpandColumn:"contact_email"});P.on("rowclick",function(c,a,d){var b=c.getSelectionModel().getCount();if(b<1){M.setDisabled(true)}else{M.setDisabled(false)}});P.on("rowcontextmenu",function(b,a,c){c.stopEvent();if(!b.getSelectionModel().isSelected(a)){b.getSelectionModel().selectRow(a);M.setDisabled(false)}X.showAt(c.getXY())});var V=new Ext.Viewport({layout:"border",items:[{region:"north",id:"north-panel",split:false,border:false,tbar:Y},{region:"west",id:"west-panel",useShim:true,layout:"fit",width:300,split:false,border:false,items:[U]},{region:"center",id:"center-panel",useShim:true,layout:"fit",split:false,border:false,items:[P]}]})};var G=function(N,O){F.setValues([{id:"list_owner",value:O}])};var L=function(O){var N=Ext.getCmp("listDialog").getForm();N.setValues(O);N.findField("list_owner_name").setRawValue(formData.config.addressbookName)};var K=function(O){var N=new Array();O.each(function(P){N.push(P.data)},this);return Ext.util.JSON.encode(N)};return{display:function(){var N=D();if(formData.values){L(formData.values)}}}}()