Ext.namespace("Egw.Addressbook");Egw.Addressbook=function(){var B;var j;var G;var I=function(a){a.baseParams.filter=Ext.getCmp("quickSearchField").getRawValue();};var K=function(w,a){Egw.Egwbase.openWindow("contactWindow","index.php?method=Addressbook.editContact&_contactId=",850,600);};var o=function(w,a){Egw.Egwbase.openWindow("listWindow","index.php?method=Addressbook.editList&_listId=",800,450);};var D=function(f,a){var n=Ext.getCmp("contacts-tree").getSelectionModel().getSelectedNode();if(n.attributes.dataPanelType=="lists"){var c=Array();var U=j.getSelectionModel().getSelections();for(var g=0;g<U.length;++g){c.push(U[g].id);}c=Ext.util.JSON.encode(c);Ext.Ajax.request({url:"index.php",params:{method:"Addressbook.deleteLists",listIds:c},text:"Deleting list...",success:function(p,k){B.reload();},failure:function(k,p){Ext.MessageBox.alert("Failed","Some error occured while trying to delete the list.");}});}else{var w=Array();var U=j.getSelectionModel().getSelections();for(var g=0;g<U.length;++g){w.push(U[g].id);}w=Ext.util.JSON.encode(w);Ext.Ajax.request({url:"index.php",params:{method:"Addressbook.deleteContacts",_contactIds:w},text:"Deleting contact...",success:function(p,k){B.reload();},failure:function(k,p){Ext.MessageBox.alert("Failed","Some error occured while trying to delete the conctact.");}});}};var u=function(n,a){var w=Ext.getCmp("contacts-tree").getSelectionModel().getSelectedNode();var c=j.getSelectionModel().getSelections();var g=c[0].id;if(w.attributes.dataPanelType=="lists"){Egw.Egwbase.openWindow("listWindow","index.php?method=Addressbook.editList&_listId="+g,800,450);}else{Egw.Egwbase.openWindow("contactWindow","index.php?method=Addressbook.editContact&_contactId="+g,850,600);}};var X=function(a,w){B.reload();};var T=new Ext.Action({text:"add contact",handler:K,iconCls:"action_addContact"});var s=new Ext.Action({text:"add list",handler:o,iconCls:"action_addList"});var t=new Ext.Action({text:"edit",disabled:true,handler:u,iconCls:"action_edit"});var N=new Ext.Action({text:"delete",disabled:true,handler:D,iconCls:"action_delete"});var E=function(){var w=new Ext.app.SearchField({id:"quickSearchField",width:240,emptyText:"enter searchfilter"});w.on("change",X);var a=new Ext.Toolbar({region:"south",id:"applicationToolbar",split:false,height:26,items:[T,s,t,N,"->","Search:"," "," ",w]});Egw.Egwbase.setActiveToolbar(a);};var v=function(){var g=new Ext.tree.TreeLoader({dataUrl:"index.php"});g.on("beforeload",function(n,c){n.baseParams.method="Addressbook.getSubTree";n.baseParams.node=c.id;n.baseParams.datatype=c.attributes.datatype;n.baseParams.owner=c.attributes.owner;n.baseParams.location="mainTree";},this);var w=new Ext.tree.TreePanel({title:"Contacts",id:"contacts-tree",loader:g,rootVisible:false,border:false});var a=new Ext.tree.TreeNode({text:"root",draggable:false,allowDrop:false,id:"root"});w.setRootNode(a);for(i=0;i<initialTree.Addressbook.length;i++){a.appendChild(new Ext.tree.AsyncTreeNode(initialTree.Addressbook[i]));}w.on("click",function(n,c){t.setDisabled(true);N.setDisabled(true);switch(n.attributes.dataPanelType){case "contacts":if(G!=n.attributes.dataPanelType){C(n);d();G=n.attributes.dataPanelType;}else{B.baseParams=A(n);B.load({params:{start:0,limit:50}});}break;case "lists":if(G!=n.attributes.dataPanelType){h(n);R();G=n.attributes.dataPanelType;}else{B.baseParams=H(n);B.load({params:{start:0,limit:50}});}break;}},this);w.on("beforeexpand",function(c){E();if(c.getSelectionModel().getSelectedNode()==null){c.expandPath("/root/alllists");c.expandPath("/root/allcontacts");c.selectPath("/root/allcontacts");}c.fireEvent("click",c.getSelectionModel().getSelectedNode());},this);w.on("contextmenu",function(n,c){c.stopEvent();switch(n.attributes.contextMenuClass){case "ctxMenuContactsTree":e.showAt(c.getXY());break;}});return w;};var H=function(a){return {method:a.attributes.jsonMethod,owner:a.attributes.owner,datatype:a.attributes.datatype};};var h=function(a){B=new Ext.data.JsonStore({url:"index.php",baseParams:H(a),root:"results",totalProperty:"totalcount",id:"list_id",fields:[{name:"list_id"},{name:"list_name"},{name:"list_owner"}],remoteSort:true});B.setDefaultSort("list_name","asc");B.on("beforeload",I);B.load({params:{start:0,limit:50}});};var A=function(a){switch(a.attributes.datatype){case "listMembers":var w={method:a.attributes.jsonMethod,owner:a.attributes.owner,listId:a.attributes.listId,datatype:a.attributes.datatype};break;default:var w={method:a.attributes.jsonMethod,owner:a.attributes.owner,datatype:a.attributes.datatype};break;}return w;};var C=function(a){B=new Ext.data.JsonStore({url:"index.php",baseParams:A(a),root:"results",totalProperty:"totalcount",id:"contact_id",fields:[{name:"contact_id"},{name:"contact_tid"},{name:"contact_owner"},{name:"contact_private"},{name:"cat_id"},{name:"n_family"},{name:"n_given"},{name:"n_middle"},{name:"n_prefix"},{name:"n_suffix"},{name:"n_fn"},{name:"n_fileas"},{name:"contact_bday"},{name:"org_name"},{name:"org_unit"},{name:"contact_title"},{name:"contact_role"},{name:"contact_assistent"},{name:"contact_room"},{name:"adr_one_street"},{name:"adr_one_street2"},{name:"adr_one_locality"},{name:"adr_one_region"},{name:"adr_one_postalcode"},{name:"adr_one_countryname"},{name:"contact_label"},{name:"adr_two_street"},{name:"adr_two_street2"},{name:"adr_two_locality"},{name:"adr_two_region"},{name:"adr_two_postalcode"},{name:"adr_two_countryname"},{name:"tel_work"},{name:"tel_cell"},{name:"tel_fax"},{name:"tel_assistent"},{name:"tel_car"},{name:"tel_pager"},{name:"tel_home"},{name:"tel_fax_home"},{name:"tel_cell_private"},{name:"tel_other"},{name:"tel_prefer"},{name:"contact_email"},{name:"contact_email_home"},{name:"contact_url"},{name:"contact_url_home"},{name:"contact_freebusy_uri"},{name:"contact_calendar_uri"},{name:"contact_note"},{name:"contact_tz"},{name:"contact_geo"},{name:"contact_pubkey"},{name:"contact_created"},{name:"contact_creator"},{name:"contact_modified"},{name:"contact_modifier"},{name:"contact_jpegphoto"},{name:"account_id"}],remoteSort:true});B.setDefaultSort("n_family","asc");B.on("beforeload",I);B.load({params:{start:0,limit:50}});};var R=function(){var a=Ext.getCmp("center-panel");if(a.items){for(var w=0;w<a.items.length;w++){a.remove(a.items.get(w));}}var g=new Ext.PagingToolbar({pageSize:50,store:B,displayInfo:true,displayMsg:"Displaying contacts {0} - {1} of {2}",emptyMsg:"No contacts to display"});var c=new Ext.grid.ColumnModel([{resizable:true,header:"List name",id:"list_name",dataIndex:"list_name"}]);c.defaultSortable=true;j=new Ext.grid.GridPanel({store:B,cm:c,tbar:g,autoSizeColumns:false,selModel:new Ext.grid.RowSelectionModel({multiSelect:true}),enableColLock:false,autoExpandColumn:"list_name",border:false});a.add(j);a.show();a.doLayout();j.on("rowclick",function(k,f,U){var n=j.getSelectionModel().getCount();if(n<1){t.setDisabled(true);N.setDisabled(true);}else{if(n==1){t.setDisabled(false);N.setDisabled(false);}else{t.setDisabled(true);N.setDisabled(false);}}});j.on("rowcontextmenu",function(U,n,f){f.stopEvent();if(!U.getSelectionModel().isSelected(n)){U.getSelectionModel().selectRow(n);t.setDisabled(false);N.setDisabled(false);}m.showAt(f.getXY());});j.on("rowdblclick",function(U,f,k){var n=U.getStore().getAt(f);try{Egw.Egwbase.openWindow("listWindow","index.php?method=Addressbook.editList&_listId="+n.data.list_id,800,450);}catch(p){}});return ;};var d=function(){var a=Ext.getCmp("center-panel");if(a.items){for(var w=0;w<a.items.length;w++){a.remove(a.items.get(w));}}var g=new Ext.PagingToolbar({pageSize:25,store:B,displayInfo:true,displayMsg:"Displaying contacts {0} - {1} of {2}",emptyMsg:"No contacts to display"});var c=new Ext.grid.ColumnModel([{resizable:true,id:"contact_tid",header:"Type",dataIndex:"contact_tid",width:30,renderer:r},{resizable:true,id:"n_family",header:"Family name",dataIndex:"n_family"},{resizable:true,id:"n_given",header:"Given name",dataIndex:"n_given",width:80},{resizable:true,id:"n_fn",header:"Full name",dataIndex:"n_fn",hidden:true},{resizable:true,id:"n_fileas",header:"Name + Firm",dataIndex:"n_fileas",hidden:true},{resizable:true,id:"contact_email",header:"eMail",dataIndex:"contact_email",width:150,hidden:false},{resizable:true,id:"contact_bday",header:"Birthday",dataIndex:"contact_bday",hidden:true},{resizable:true,id:"org_name",header:"Organisation",dataIndex:"org_name",width:150},{resizable:true,id:"org_unit",header:"Unit",dataIndex:"org_unit",hidden:true},{resizable:true,id:"contact_title",header:"Title",dataIndex:"contact_title",hidden:true},{resizable:true,id:"contact_role",header:"Role",dataIndex:"contact_role",hidden:true},{resizable:true,id:"contact_room",header:"Room",dataIndex:"contact_room",hidden:true},{resizable:true,id:"adr_one_street",header:"Street",dataIndex:"adr_one_street",hidden:true},{resizable:true,id:"adr_one_locality",header:"Locality",dataIndex:"adr_one_locality",width:80,hidden:false},{resizable:true,id:"adr_one_region",header:"Region",dataIndex:"adr_one_region",hidden:true},{resizable:true,id:"adr_one_postalcode",header:"Postalcode",dataIndex:"adr_one_postalcode",hidden:true},{resizable:true,id:"adr_one_countryname",header:"Country",dataIndex:"adr_one_countryname",hidden:true},{resizable:true,id:"adr_two_street",header:"Street (private)",dataIndex:"adr_two_street",hidden:true},{resizable:true,id:"adr_two_locality",header:"Locality (private)",dataIndex:"adr_two_locality",hidden:true},{resizable:true,id:"adr_two_region",header:"Region (private)",dataIndex:"adr_two_region",hidden:true},{resizable:true,id:"adr_two_postalcode",header:"Postalcode (private)",dataIndex:"adr_two_postalcode",hidden:true},{resizable:true,id:"adr_two_countryname",header:"Country (private)",dataIndex:"adr_two_countryname",hidden:true},{resizable:true,id:"tel_work",header:"Phone",dataIndex:"tel_work",hidden:false},{resizable:true,id:"tel_cell",header:"Cellphone",dataIndex:"tel_cell",hidden:false},{resizable:true,id:"tel_fax",header:"Fax",dataIndex:"tel_fax",hidden:true},{resizable:true,id:"tel_car",header:"Car phone",dataIndex:"tel_car",hidden:true},{resizable:true,id:"tel_pager",header:"Pager",dataIndex:"tel_pager",hidden:true},{resizable:true,id:"tel_home",header:"Phone (private)",dataIndex:"tel_home",hidden:true},{resizable:true,id:"tel_fax_home",header:"Fax (private)",dataIndex:"tel_fax_home",hidden:true},{resizable:true,id:"tel_cell_private",header:"Cellphone (private)",dataIndex:"tel_cell_private",hidden:true},{resizable:true,id:"contact_email_home",header:"eMail (private)",dataIndex:"contact_email_home",hidden:true},{resizable:true,id:"contact_url",header:"URL",dataIndex:"contact_url",hidden:true},{resizable:true,id:"contact_url_home",header:"URL (private)",dataIndex:"contact_url_home",hidden:true},{resizable:true,id:"contact_note",header:"Note",dataIndex:"contact_note",hidden:true},{resizable:true,id:"contact_tz",header:"Timezone",dataIndex:"contact_tz",hidden:true},{resizable:true,id:"contact_geo",header:"Geo",dataIndex:"contact_geo",hidden:true}]);c.defaultSortable=true;j=new Ext.grid.GridPanel({store:B,cm:c,tbar:g,autoSizeColumns:false,selModel:new Ext.grid.RowSelectionModel({multiSelect:true}),enableColLock:false,autoExpandColumn:"n_family",border:false});a.add(j);a.show();a.doLayout();j.on("rowclick",function(U,k,f){var n=U.getSelectionModel().getCount();if(n<1){t.setDisabled(true);N.setDisabled(true);}else{if(n==1){t.setDisabled(false);N.setDisabled(false);}else{t.setDisabled(true);N.setDisabled(false);}}});j.on("rowcontextmenu",function(U,n,f){f.stopEvent();if(!U.getSelectionModel().isSelected(n)){U.getSelectionModel().selectRow(n);t.setDisabled(false);N.setDisabled(false);}L.showAt(f.getXY());});j.on("rowdblclick",function(U,f,k){var n=U.getStore().getAt(f);if(n.data.contact_tid=="l"){try{Egw.Egwbase.openWindow("listWindow","index.php?method=Addressbook.editList&_listId="+n.data.contact_id,800,450);}catch(p){}}else{try{Egw.Egwbase.openWindow("contactWindow","index.php?method=Addressbook.editContact&_contactId="+n.data.contact_id,850,600);}catch(p){}}});return ;};var r=function(c,U,g,a,w,n){switch(c){case "l":return "<img src='images/oxygen/16x16/actions/users.png' width='12' height='12' alt='list'/>";default:return "<img src='images/oxygen/16x16/actions/user.png' width='12' height='12' alt='contact'/>";}};var L=new Ext.menu.Menu({id:"ctxMenuAddress1",items:[t,N,"-",T]});var m=new Ext.menu.Menu({id:"ctxMenuAddress2",items:[t,N,"-",s]});var e=new Ext.menu.Menu({id:"ctxMenuAddress3",items:[T]});var W=function(p,c){var g;var J=1024,k=786;var n=850,b=600;if(c=="list"){n=450,b=600;}if(document.all){J=document.body.clientWidth;k=document.body.clientHeight;x=window.screenTop;y=window.screenLeft;}else{if(window.innerWidth){J=window.innerWidth;k=window.innerHeight;x=window.screenX;y=window.screenY;}}var U=((J-n)/2)+y,f=((k-b)/2)+x;if(c=="list"&&!p){g="index.php?method=Addressbook.editList";}else{if(c=="list"&&p){g="index.php?method=Addressbook.editList&contactid="+p;}else{if(c!="list"&&p){g="index.php?method=Addressbook.editContact&contactid="+p;}else{g="index.php?method=Addressbook.editContact";}}}appId="addressbook";var a=window.open(g,"popupname","width="+n+",height="+b+",top="+f+",left="+U+",directories=no,toolbar=no,location=no,menubar=no,scrollbars=no,status=no,resizable=no,dependent=no");return ;};var q=function(a){a=(a==null)?false:a;window.opener.Egw.Addressbook.reload();if(a==true){window.setTimeout("window.close()",400);}};var F=function(n){if(!g){var g=new Ext.Window({title:"please select addressbook",modal:true,width:375,height:400,minWidth:375,minHeight:400,layout:"fit",plain:true,bodyStyle:"padding:5px;",buttonAlign:"center"});var c=Ext.tree;treeLoader=new c.TreeLoader({dataUrl:"index.php"});treeLoader.on("beforeload",function(f,U){f.baseParams.method="Addressbook.getSubTree";f.baseParams.node=U.id;f.baseParams.datatype=U.attributes.datatype;f.baseParams.owner=U.attributes.owner;f.baseParams.location="selectFolder";},this);var a=new c.TreePanel({animate:true,id:"addressbookTree",loader:treeLoader,containerScroll:true,rootVisible:false});var w=new c.TreeNode({text:"root",draggable:false,allowDrop:false,id:"root"});a.setRootNode(w);Ext.each(formData.config.initialTree,function(U){w.appendChild(new c.AsyncTreeNode(U));});a.on("click",function(U){if(U.attributes.datatype=="contacts"){Ext.getCmp(n).setValue(U.attributes.owner);Ext.getCmp(n+"_name").setValue(U.text);g.hide();}});g.add(a);g.show();}};return {show:function(a){E();_showContactTree();_showContactGrid(a);},displayAddressbookSelectDialog:F,getPanel:v,reload:function(){B.reload();}};}();Egw.Addressbook.ContactEditDialog=function(){var E;var t;var d;var W=function(C,h){var e=Ext.getCmp("contactDialog").getForm();e.render();if(e.isValid()){var F={};if(formData.values){F.contact_id=formData.values.contact_id;}e.submit({waitTitle:"Please wait!",waitMsg:"saving contact...",params:F,success:function(G,v,R){window.opener.Egw.Addressbook.reload();},failure:function(G,v){}});}else{Ext.MessageBox.alert("Errors","Please fix the errors noted.");}};var H=function(C,h){var e=Ext.getCmp("contactDialog").getForm();e.render();if(e.isValid()){var F={};if(formData.values){F.contact_id=formData.values.contact_id;}e.submit({waitTitle:"Please wait!",waitMsg:"saving contact...",params:F,success:function(G,v,R){window.opener.Egw.Addressbook.reload();window.setTimeout("window.close()",400);},failure:function(G,v){}});}else{Ext.MessageBox.alert("Errors","Please fix the errors noted.");}};var K=function(F,e){var h=Ext.util.JSON.encode([formData.values.contact_id]);Ext.Ajax.request({url:"index.php",params:{method:"Addressbook.deleteContacts",_contactIds:h},text:"Deleting contact...",success:function(G,C){window.opener.Egw.Addressbook.reload();window.setTimeout("window.close()",400);},failure:function(C,G){Ext.MessageBox.alert("Failed","Some error occured while trying to delete the conctact.");}});};var u=new Ext.Action({text:"save and close",handler:H,iconCls:"action_saveAndClose"});var B=new Ext.Action({text:"apply changes",handler:W,iconCls:"action_applyChanges"});var A=new Ext.Action({text:"delete contact",handler:K,iconCls:"action_delete"});var D=function(){Ext.QuickTips.init();Ext.form.Field.prototype.msgTarget="side";var a=true;if(formData.values){a=false;}var r=new Ext.Toolbar({region:"south",id:"applicationToolbar",split:false,height:26,items:[u,B,A]});var j=new Ext.data.JsonStore({url:"index.php",baseParams:{method:"Egwbase.getCountryList"},root:"results",id:"shortName",fields:["shortName","translatedName"],remoteSort:false});var X=new Ext.form.TriggerField({fieldLabel:"Addressbook",id:"contact_owner_name",anchor:"95%",allowBlank:false,readOnly:true});X.onTriggerClick=function(){Egw.Addressbook.displayAddressbookSelectDialog("contact_owner");};var F=function(w){w.baseParams.method="Addressbook.getContacts";w.baseParams.options=Ext.encode({displayContacts:false,displayLists:true});};var m=[["AL","Alabama"],["AK","Alaska"],["AZ","Arizona"],["WV","West Virginia"],["WI","Wisconsin"],["WY","Wyoming"]];var G=new Ext.data.SimpleStore({fields:["contact_id","contact_tid"],data:m});var C=new Ext.data.SimpleStore({fields:["contact_id","contact_tid"]});var N=new Ext.DataView({style:"overflow:auto",multiSelect:true,id:"list_source_",cls:"x-list-small",selectedClass:"x-list-selected",itemSelector:"div.x-view",store:G,tpl:new Ext.XTemplate("<tpl for=\".\">","<div class=\"x-view\" id=\"{contact_id}\">{contact_tid}</div>","</tpl>")});function e(g,w){return g-w;}var q=function(n,k,U,c){var k=Ext.getCmp("list_source_");var g=String(k.getSelectedIndexes());var f=k.getSelectionCount();if(k.getSelectionCount()>"1"){var p=g.split(",");}else{if(k.getSelectionCount()=="1"){var p=new Array(g);}}p.sort(e);p.reverse();for(i=0;i<f;i++){var w=G.getAt(p[i]);C.add(w);}C.sort("contact_tid","ASC");for(i=0;i<f;i++){var w=G.getAt(p[i]);G.remove(w);}G.sort("contact_tid","ASC");};var h=function(n,k,U,c){var k=Ext.getCmp("list_selected_");var g=String(k.getSelectedIndexes());var f=k.getSelectionCount();if(k.getSelectionCount()>"1"){var p=g.split(",");}else{if(k.getSelectionCount()=="1"){var p=new Array(g);}}p.sort(e);p.reverse();for(i=0;i<f;i++){var w=C.getAt(p[i]);G.add(w);}G.sort("contact_tid","ASC");for(i=0;i<f;i++){var w=C.getAt(p[i]);C.remove(w);}C.sort("contact_tid","ASC");};N.on("dblclick",q);var T=new Ext.DataView({style:"overflow:auto",multiSelect:true,id:"list_selected_",cls:"x-list-small",selectedClass:"x-list-selected",itemSelector:"div.x-view",store:C,tpl:new Ext.XTemplate("<tpl for=\".\">","<div class=\"x-view\" id=\"{contact_id}\">{contact_tid}</div>","</tpl>")});T.on("dblclick",h);var R=new Ext.Panel({id:"list_source",title:"available lists",region:"center",margins:"5 5 5 0",layout:"fit",items:N});var s=new Ext.Panel({id:"list_selected",title:"chosen lists",region:"center",margins:"5 5 5 0",layout:"fit",items:T});var v=new Ext.FormPanel({url:"index.php",baseParams:{method:"Addressbook.saveContact"},labelAlign:"top",bodyStyle:"padding:5px",anchor:"100%",region:"center",id:"contactDialog",tbar:r,deferredRender:false,items:[{layout:"column",border:false,deferredRender:false,anchor:"100%",items:[{columnWidth:0.4,layout:"form",border:false,items:[{xtype:"textfield",fieldLabel:"First Name",name:"n_given",anchor:"95%"},{xtype:"textfield",fieldLabel:"Middle Name",name:"n_middle",anchor:"95%"},{xtype:"textfield",fieldLabel:"Last Name",name:"n_family",allowBlank:false,anchor:"95%"}]},{columnWidth:0.2,layout:"form",border:false,items:[{xtype:"textfield",fieldLabel:"Prefix",name:"n_prefix",anchor:"95%"},{xtype:"textfield",fieldLabel:"Suffix",name:"n_suffix",anchor:"95%"},X]},{columnWidth:0.4,layout:"form",border:false,items:[{xtype:"textarea",name:"contact_note",fieldLabel:"Notes",grow:false,preventScrollbars:false,anchor:"95% 100%"}]}]},{xtype:"tabpanel",plain:true,activeTab:0,deferredRender:false,anchor:"100% 70%",defaults:{bodyStyle:"padding:10px"},items:[{title:"Business information",layout:"column",deferredRender:false,border:false,items:[{columnWidth:0.333,layout:"form",border:false,items:[{xtype:"textfield",fieldLabel:"Company",name:"org_name",anchor:"95%"},{xtype:"textfield",fieldLabel:"Street",name:"adr_one_street",anchor:"95%"},{xtype:"textfield",fieldLabel:"Street 2",name:"adr_one_street2",anchor:"95%"},{xtype:"textfield",fieldLabel:"Postalcode",name:"adr_one_postalcode",anchor:"95%"},{xtype:"textfield",fieldLabel:"City",name:"adr_one_locality",anchor:"95%"},{xtype:"textfield",fieldLabel:"Region",name:"adr_one_region",anchor:"95%"},new Ext.form.ComboBox({fieldLabel:"Country",name:"adr_one_countryname",hiddenName:"adr_one_countryname",store:j,displayField:"translatedName",valueField:"shortName",typeAhead:true,mode:"remote",triggerAction:"all",emptyText:"Select a state...",selectOnFocus:true,anchor:"95%"})]},{columnWidth:0.333,layout:"form",border:false,items:[{xtype:"textfield",fieldLabel:"Phone",name:"tel_work",anchor:"95%"},{xtype:"textfield",fieldLabel:"Cellphone",name:"tel_cell",anchor:"95%"},{xtype:"textfield",fieldLabel:"Fax",name:"tel_fax",anchor:"95%"},{xtype:"textfield",fieldLabel:"Car phone",name:"tel_car",anchor:"95%"},{xtype:"textfield",fieldLabel:"Pager",name:"tel_pager",anchor:"95%"},{xtype:"textfield",fieldLabel:"Email",name:"contact_email",vtype:"email",anchor:"95%"},{xtype:"textfield",fieldLabel:"URL",name:"contact_url",vtype:"url",anchor:"95%"}]},{columnWidth:0.333,layout:"form",border:false,items:[{xtype:"textfield",fieldLabel:"Unit",name:"org_unit",anchor:"95%"},{xtype:"textfield",fieldLabel:"Role",name:"contact_role",anchor:"95%"},{xtype:"textfield",fieldLabel:"Title",name:"contact_title",anchor:"95%"},{xtype:"textfield",fieldLabel:"Room",name:"contact_room",anchor:"95%"},{xtype:"textfield",fieldLabel:"Name Assistent",name:"contact_assistent",anchor:"95%"},{xtype:"textfield",fieldLabel:"Phone Assistent",name:"tel_assistent",anchor:"95%"}]}]},{title:"Private information",layout:"column",deferredRender:false,border:false,items:[{columnWidth:0.333,layout:"form",border:false,items:[{xtype:"textfield",fieldLabel:"Street",name:"adr_two_street",anchor:"95%"},{xtype:"textfield",fieldLabel:"Street2",name:"adr_two_street2",anchor:"95%"},{xtype:"textfield",fieldLabel:"Postalcode",name:"adr_two_postalcode",anchor:"95%"},{xtype:"textfield",fieldLabel:"City",name:"adr_two_locality",anchor:"95%"},{xtype:"textfield",fieldLabel:"Region",name:"adr_two_region",anchor:"95%"},new Ext.form.ComboBox({fieldLabel:"Country",name:"adr_two_countryname",hiddenName:"adr_two_countryname",store:j,displayField:"translatedName",valueField:"shortName",typeAhead:true,mode:"remote",triggerAction:"all",emptyText:"Select a state...",selectOnFocus:true,anchor:"95%"})]},{columnWidth:0.333,layout:"form",border:false,items:[new Ext.form.DateField({fieldLabel:"Birthday",name:"contact_bday",format:formData.config.dateFormat,altFormats:"Y-m-d",anchor:"95%"}),{xtype:"textfield",fieldLabel:"Phone",name:"tel_home",anchor:"95%"},{xtype:"textfield",fieldLabel:"Cellphone",name:"tel_cell_private",anchor:"95%"},{xtype:"textfield",fieldLabel:"Fax",name:"tel_fax_home",anchor:"95%"},{xtype:"textfield",fieldLabel:"Email",name:"contact_email_home",vtype:"email",anchor:"95%"},{xtype:"textfield",fieldLabel:"URL",name:"contact_url_home",vtype:"url",anchor:"95%"}]},{columnWidth:0.333,layout:"form",border:false}]},{title:"Lists",layout:"column",deferredRender:false,border:false,items:[{columnWidth:0.333,layout:"form",border:false,items:[new Ext.Panel({layout:"fit",id:"source",width:250,height:350,items:[R]})]},{columnWidth:0.333,layout:"form",border:false,extraCls:"list-butons",items:[new Ext.Button({text:"add",iconCls:"blist",minWidth:80,handler:q,icon:"images/oxygen/16x16/actions/arrow-right-double.png"}),new Ext.Button({text:"remove",iconCls:"blist",minWidth:80,handler:h,icon:"images/oxygen/16x16/actions/arrow-left-double.png"})]},{columnWidth:0.333,layout:"form",border:false,items:[new Ext.Panel({layout:"fit",id:"destination",width:250,height:350,items:[s]})]}]},{title:"Categories",disabled:true,layout:"column",deferredRender:false,border:false,items:[{}]}]},{xtype:"hidden",name:"contact_owner",id:"contact_owner"}]});var o=new Ext.Viewport({layout:"border",items:v});};var L=function(h){var e=Ext.getCmp("contactDialog").getForm();e.setValues(h);e.findField("contact_owner_name").setRawValue(formData.config.addressbookName);if(formData.config.oneCountryName){e.findField("adr_one_countryname").setRawValue(formData.config.oneCountryName);}if(formData.config.twoCountryName){e.findField("adr_two_countryname").setRawValue(formData.config.twoCountryName);}};var I=function(h,e){Ext.MessageBox.alert("Export","Not yet implemented.");};return {display:function(){var e=D();if(formData.values){L(formData.values);}}};}();Egw.Addressbook.ListEditDialog=function(){var I;var W=function(R,C){var F=Ext.getCmp("listDialog").getForm();var h=Ext.getCmp("listGrid").getStore();var G=new Array();h.each(function(X){G.push(X.data);});if(F.isValid()){var v={listMembers:Ext.util.JSON.encode(G),};F.submit({waitTitle:"Please wait!",waitMsg:"saving contact...",params:v,success:function(X,s,T){window.opener.Egw.Addressbook.reload();},failure:function(X,s){}});}else{Ext.MessageBox.alert("Errors","Please fix the errors noted.");}};var H=function(R,C){var F=Ext.getCmp("listDialog").getForm();var h=Ext.getCmp("listGrid").getStore();var G=new Array();h.each(function(X){G.push(X.data);});if(F.isValid()){var v={listMembers:Ext.util.JSON.encode(G),};F.submit({waitTitle:"Please wait!",waitMsg:"saving contact...",params:v,success:function(X,s,T){window.opener.Egw.Addressbook.reload();window.setTimeout("window.close()",400);},failure:function(X,s){}});}else{Ext.MessageBox.alert("Errors","Please fix the errors noted.");}};var E=function(C,h){var F=Ext.util.JSON.encode([formData.values.list_id]);Ext.Ajax.request({url:"index.php",params:{method:"Addressbook.deleteLists",listIds:F},text:"Deleting list...",success:function(v,G){window.opener.Egw.Addressbook.reload();window.setTimeout("window.close()",400);},failure:function(G,v){Ext.MessageBox.alert("Failed","Some error occured while trying to delete the conctact.");}});};var A=function(R,h){var C=Ext.getCmp("listGrid");var G=C.getStore();var v=C.getSelectionModel().getSelections();for(var F=0;F<v.length;++F){G.remove(v[F]);}e.setDisabled(true);};var t=new Ext.Action({text:"save and close",handler:H,iconCls:"action_saveAndClose"});var u=new Ext.Action({text:"apply changes",handler:W,iconCls:"action_applyChanges"});var D=new Ext.Action({text:"delete list",handler:E,iconCls:"action_delete"});var e=new Ext.Action({text:"remove list member",disabled:true,handler:A,iconCls:"action_delete"});var K=function(){Ext.QuickTips.init();Ext.form.Field.prototype.msgTarget="side";var q=true;if(formData.values){q=false;}var N=new Ext.Toolbar({region:"south",id:"applicationToolbar",split:false,height:26,items:[t,u,D,"-",e]});var R=new Ext.form.TriggerField({fieldLabel:"Addressbook",id:"list_owner_name",anchor:"100%",allowBlank:false,readOnly:true});R.onTriggerClick=function(){Egw.Addressbook.displayAddressbookSelectDialog("list_owner");};searchDS=new Ext.data.JsonStore({url:"index.php",baseParams:{method:"Addressbook.getOverview",options:"{\"displayContacts\":true,\"displayLists\":false}"},root:"results",totalProperty:"totalcount",id:"contact_id",fields:[{name:"contact_id"},{name:"n_family"},{name:"n_given"},{name:"contact_email"}],remoteSort:true});searchDS.setDefaultSort("n_family","asc");var v=new Ext.form.ComboBox({store:searchDS,fieldLabel:"Add new list members",displayField:"n_family",typeAhead:false,loadingText:"Searching...",anchor:"100%",pageSize:10,hideTrigger:true,itemSelector:"div.search-item",tpl:new Ext.XTemplate("<tpl for=\".\">","<div class=\"search-item\">{n_family}, {n_given} {contact_email}</div>","</tpl>")});v.on("select",function(a,r,j){var m=new G({contact_id:r.data.contact_id,n_family:r.data.n_family,contact_email:r.data.contact_email});h.add(m);h.sort("n_family");v.reset();v.collapse();});v.on("change",function(m,j,r){console.log(j+" "+r);});v.on("specialkey",function(n,m){if(searchDS.getCount()==0){var c=/^[a-z0-9_-]+(\.[a-z0-9_-]+)*@([0-9a-z][0-9a-z-]*[0-9a-z]\.)+([a-z]{2,4}|museum)$/;var j=c.exec(v.getValue());if(j&&(m.getKey()==m.ENTER||m.getKey()==m.RETURN)){var g=v.getValue();var r=g.indexOf("@");if(r!=-1){var w=Ext.util.Format.capitalize(g.substr(0,r));}else{var w=g;}var a=new G({contact_id:null,n_family:w,contact_email:g});h.add(a);h.sort("n_family");v.reset();}}});var X=new Ext.FormPanel({url:"index.php",baseParams:{method:"Addressbook.saveList"},labelAlign:"top",bodyStyle:"padding:5px",width:450,deferredRender:false,id:"listDialog",width:300,items:[{layout:"form",border:false,anchor:"100%",items:[R,{xtype:"textfield",fieldLabel:"List Name",id:"list_name",anchor:"100%"},{xtype:"textarea",fieldLabel:"List Description",id:"list_description",height:100,grow:false,anchor:"100%"},v,{xtype:"hidden",id:"list_owner"},{xtype:"hidden",id:"list_id"}]}]});var G=Ext.data.Record.create([{name:"contact_id",type:"int"},{name:"n_family",type:"string"},{name:"contact_email",type:"string"}]);if(formData.values.list_members){var F=formData.values.list_members;}else{var F=[];}var h=new Ext.data.SimpleStore({id:"list_Members",fields:["contact_id","n_family","contact_email"],data:F});h.sort("n_family","asc");var o=new Ext.grid.ColumnModel([{resizable:true,id:"n_family",header:"Family name",dataIndex:"n_family"},{resizable:true,id:"contact_email",header:"eMail address",dataIndex:"contact_email"}]);o.defaultSortable=true;var T=new Ext.menu.Menu({id:"ctxListMenu",items:[e]});var C=new Ext.grid.GridPanel({store:h,cm:o,id:"listGrid",layout:"fit",selModel:new Ext.grid.RowSelectionModel({multiSelect:true}),autoSizeColumns:true,trackMouseOver:true,contextMenu:"ctxListMenu",autoExpandColumn:"contact_email"});C.on("rowclick",function(m,r,a){var j=m.getSelectionModel().getCount();if(j<1){e.setDisabled(true);}else{e.setDisabled(false);}});C.on("rowcontextmenu",function(j,r,m){m.stopEvent();if(!j.getSelectionModel().isSelected(r)){j.getSelectionModel().selectRow(r);e.setDisabled(false);}T.showAt(m.getXY());});var s=new Ext.Viewport({layout:"border",items:[{region:"north",id:"north-panel",split:false,border:false,tbar:N},{region:"west",id:"west-panel",useShim:true,layout:"fit",width:300,split:false,border:false,items:[X]},{region:"center",id:"center-panel",useShim:true,layout:"fit",split:false,border:false,items:[C]}]});};var d=function(h,F){I.setValues([{id:"list_owner",value:F}]);};var L=function(F){var h=Ext.getCmp("listDialog").getForm();h.setValues(F);h.findField("list_owner_name").setRawValue(formData.config.addressbookName);};var B=function(F){var h=new Array();F.each(function(C){h.push(C.data);},this);return Ext.util.JSON.encode(h);};return {display:function(){var h=K();if(formData.values){L(formData.values);}}};}();