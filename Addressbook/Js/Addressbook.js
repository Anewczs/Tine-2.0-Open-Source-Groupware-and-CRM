
Ext.namespace('Egw');var EGWNameSpace=Egw;Egw.Addressbook=function(){var contactDS;var contactGrid;var listGrid;var dialog;var filterContactsButton,filterListsButton;var _getJSONDsRecs=function(_dataSrc){if(Ext.isEmpty(_dataSrc)){return false;}
var data=_dataSrc.data,dataLen=data.getCount(),jsonData=new Array();for(i=0;i<dataLen;i++){var curRecData=data.itemAt(i).data;jsonData.push(curRecData);}
return Ext.util.JSON.encode(jsonData);}
var _showAddressGrid=function(_layout,_node){var center=_layout.getRegion('center',false);center.remove(0);var contentTag=Ext.Element.get('content');var outerDivTag=contentTag.createChild({tag:'div',id:'outergriddiv'});switch(_node.attributes.datatype){case'list':var options={listId:_node.attributes.listId};break;case'contacts':var options={displayContacts:true,displayLists:true};break;case'otherpeople':var options={displayContacts:true,displayLists:true,};break;case'sharedaddressbooks':var options={displayContacts:true,displayLists:true,};break;}
contactDS=new Ext.data.JsonStore({url:'index.php',baseParams:{method:'Addressbook.getContacts',datatype:_node.attributes.datatype,owner:_node.attributes.owner,nodeid:_node.attributes.id,options:Ext.encode(options),},root:'results',totalProperty:'totalcount',id:'contact_id',fields:[{name:'contact_id'},{name:'contact_tid'},{name:'contact_owner'},{name:'contact_private'},{name:'cat_id'},{name:'n_family'},{name:'n_given'},{name:'n_middle'},{name:'n_prefix'},{name:'n_suffix'},{name:'n_fn'},{name:'n_fileas'},{name:'contact_bday'},{name:'org_name'},{name:'org_unit'},{name:'contact_title'},{name:'contact_role'},{name:'contact_assistent'},{name:'contact_room'},{name:'adr_one_street'},{name:'adr_one_street2'},{name:'adr_one_locality'},{name:'adr_one_region'},{name:'adr_one_postalcode'},{name:'adr_one_countryname'},{name:'contact_label'},{name:'adr_two_street'},{name:'adr_two_street2'},{name:'adr_two_locality'},{name:'adr_two_region'},{name:'adr_two_postalcode'},{name:'adr_two_countryname'},{name:'tel_work'},{name:'tel_cell'},{name:'tel_fax'},{name:'tel_assistent'},{name:'tel_car'},{name:'tel_pager'},{name:'tel_home'},{name:'tel_fax_home'},{name:'tel_cell_private'},{name:'tel_other'},{name:'tel_prefer'},{name:'contact_email'},{name:'contact_email_home'},{name:'contact_url'},{name:'contact_url_home'},{name:'contact_freebusy_uri'},{name:'contact_calendar_uri'},{name:'contact_note'},{name:'contact_tz'},{name:'contact_geo'},{name:'contact_pubkey'},{name:'contact_created'},{name:'contact_creator'},{name:'contact_modified'},{name:'contact_modifier'},{name:'contact_jpegphoto'},{name:'account_id'}],remoteSort:true});contactDS.setDefaultSort('contact_id','desc');contactDS.load({params:{start:0,limit:50}});contactDS.on('beforeload',function(_loader,_node){_loader.baseParams.options=Ext.encode({displayContacts:filterContactsButton.pressed,displayLists:filterListsButton.pressed});});var cm=new Ext.grid.ColumnModel([{resizable:true,id:'contact_id',header:'Id',dataIndex:'contact_id',width:30},{resizable:true,id:'contact_tid',dataIndex:'contact_tid',width:30,renderer:_renderContactTid},{resizable:true,id:'n_family',header:'Family name',dataIndex:'n_family'},{resizable:true,id:'n_given',header:'Given name',dataIndex:'n_given'},{resizable:true,header:'Middle name',dataIndex:'n_middle',hidden:true},{resizable:true,id:'n_prefix',header:'Prefix',dataIndex:'n_prefix',hidden:true},{resizable:true,header:'Suffix',dataIndex:'n_suffix',hidden:true},{resizable:true,header:'Full name',dataIndex:'n_fn',hidden:true},{resizable:true,header:'Birthday',dataIndex:'contact_bday',hidden:true},{resizable:true,header:'Organisation',dataIndex:'org_name'},{resizable:true,header:'Unit',dataIndex:'org_unit'},{resizable:true,header:'Title',dataIndex:'contact_title',},{resizable:true,header:'Role',dataIndex:'contact_role',},{resizable:true,id:'addressbook',header:'addressbook',dataIndex:'addressbook',hidden:true}]);cm.defaultSortable=true;contactGrid=new Ext.grid.Grid(outerDivTag,{ds:contactDS,cm:cm,autoSizeColumns:false,selModel:new Ext.grid.RowSelectionModel({multiSelect:true}),enableColLock:false,loadMask:true,enableDragDrop:true,ddGroup:'TreeDD',autoExpandColumn:'n_given'});contactGrid.render();contactGrid.on('rowclick',function(gridP,rowIndexP,eventP){var rowCount=contactGrid.getSelectionModel().getCount();var btns=pagingHeader.items.map;if(rowCount<1){btns.editbtn.disable();btns.deletebtn.disable();}else if(rowCount==1){btns.editbtn.enable();btns.deletebtn.enable();}else{btns.editbtn.disable();btns.deletebtn.enable();}});contactGrid.on('rowdblclick',function(gridPar,rowIndexPar,ePar){var record=gridPar.getDataSource().getAt(rowIndexPar);if(record.data.contact_tid=='l')
{try{_openDialog(record.data.contact_id,'list');}catch(e){}}
else
{try{_openDialog(record.data.contact_id);}catch(e){}}});contactGrid.on('rowcontextmenu',function(grid,rowIndex,eventObject){eventObject.stopEvent();var record=grid.getDataSource().getAt(rowIndex);if(record.data.contact_tid=='l'){ctxMenuList.showAt(eventObject.getXY());}
else{ctxMenuAddress.showAt(eventObject.getXY());}});var gridHeader=contactGrid.getView().getHeaderPanel(true);var pagingHeader=new Ext.PagingToolbar(gridHeader,contactDS,{pageSize:50,cls:'x-btn-icon-22',displayInfo:true,displayMsg:'Displaying contacts {0} - {1} of {2}',emptyMsg:"No contacts to display"});var textF1=new Ext.form.TextField({height:22,width:200,emptyText:'Suchparameter ...',allowBlank:false});var searchButton=new Ext.Toolbar.Button({cls:'x-btn-icon',icon:'images/oxygen/22x22/actions/mail-find.png',tooltip:'Suche Adresse/Adressliste',disabled:false,onClick:function(){contactDS.removeAll();contactDS.load({params:{start:0,limit:50,searchParam1:textF1.getValue()}});}});var clearButton=new Ext.Toolbar.Button({icon:'images/oxygen/22x22/actions/clear-left.png',tooltip:'Lösche bestehende Sucheingabe',disabled:false,onClick:function(){textF1.setValue('');}});var secondHeader=Ext.DomHelper.append(pagingHeader.el,{tag:'div',id:Ext.id()},true);var secondToolbar=new Ext.Toolbar(secondHeader);secondToolbar.addField(textF1);secondToolbar.add(clearButton);secondToolbar.add(searchButton);pagingHeader.insertButton(0,{id:'addbtn',cls:'x-btn-icon-22',icon:'images/oxygen/22x22/actions/add-user.png',tooltip:'add new contact',handler:_addBtnHandler});pagingHeader.insertButton(1,{id:'addlstbtn',cls:'x-btn-icon-22',icon:'images/oxygen/22x22/actions/add-users.png',tooltip:'add new list',handler:_addLstBtnHandler});pagingHeader.insertButton(2,{id:'editbtn',cls:'x-btn-icon-22',icon:'images/oxygen/22x22/actions/edit.png',tooltip:'edit current item',disabled:true,handler:_editBtnHandler});pagingHeader.insertButton(3,{id:'deletebtn',cls:'x-btn-icon-22',icon:'images/oxygen/22x22/actions/edit-delete.png',tooltip:'delete selected items',disabled:true,handler:_deleteBtnHandler});pagingHeader.insertButton(4,new Ext.Toolbar.Separator());filterContactsButton=pagingHeader.insertButton(5,{id:'filtercontactsbtn',cls:'x-btn-icon-22',icon:'images/oxygen/22x22/actions/user.png',tooltip:'display contacts',enableToggle:true,pressed:true,handler:_filterUserBtnHandler});filterListsButton=pagingHeader.insertButton(6,{id:'filterlistsbtn',cls:'x-btn-icon-22',icon:'images/oxygen/22x22/actions/users.png',tooltip:'display lists',enableToggle:true,pressed:true,handler:_filterListsBtnHandler});pagingHeader.insertButton(7,{id:'exportbtn',cls:'x-btn-icon-22',icon:'images/oxygen/22x22/actions/file-export.png',tooltip:'export selected contacts',disabled:false,onClick:_exportBtnHandler});center.add(new Ext.GridPanel(contactGrid));}
var _renderContactTid=function(_data,_cell,_record,_rowIndex,_columnIndex,_store){switch(_data){case'l':return"<img src='images/oxygen/16x16/actions/users.png' width='12' height='12' alt='list'/>";default:return"<img src='images/oxygen/16x16/actions/user.png' width='12' height='12' alt='contact'/>";}}
var _filterUserBtnHandler=function(_button,_event){contactDS.reload();}
var _filterListsBtnHandler=function(_button,_event){contactDS.reload();}
var _deleteBtnHandler=function(_button,_event){var contactIDs=Array();var selectedRows=contactGrid.getSelectionModel().getSelections();for(var i=0;i<selectedRows.length;++i){contactIDs.push(selectedRows[i].id);}
_deleteContact(contactIDs,function(){EGWNameSpace.Addressbook.reload();});contactDS.reload();}
var _editBtnHandler=function(_button,_event){var selectedRows=contactGrid.getSelectionModel().getSelections();var contactID=selectedRows[0].id;if(selectedRows[0].data.contact_tid=='l'){_openDialog(contactID,'list');}
else{_openDialog(contactID);}}
var _addBtnHandler=function(_button,_event){_openDialog();}
var _addLstBtnHandler=function(_button,_event){_openDialog('','list');}
var _deleteLstBtnHandler=function(_button,_event){var contactIDs=Array();var selectedRows=contactGrid.getSelectionModel().getSelections();for(var i=0;i<selectedRows.length;++i){contactIDs.push(selectedRows[i].id);}
_deleteContact(contactIDs,function(){EGWNameSpace.Addressbook.reload();});contactDS.reload();}
var _editLstBtnHandler=function(_button,_event){var selectedRows=contactGrid.getSelectionModel().getSelections();var contactID=selectedRows[0].id;_openDialog(contactID,'list');}
var ctxMenuAddress=new Ext.menu.Menu({id:'ctxMenuAddress',items:[{id:'edit',text:'edit contact',icon:'images/oxygen/16x16/actions/edit.png',handler:_editBtnHandler},{id:'delete',text:'delete contact',icon:'images/oxygen/16x16/actions/edit-delete.png',handler:_deleteBtnHandler},'-',{id:'new',text:'new contact',icon:'images/oxygen/16x16/actions/add-user.png',handler:_addBtnHandler}]});var ctxMenuList=new Ext.menu.Menu({id:'ctxMenuList',items:[{id:'edit',text:'edit list',icon:'images/oxygen/16x16/actions/edit.png',handler:_editLstBtnHandler},{id:'delete',text:'delete list',icon:'images/oxygen/16x16/actions/edit-delete.png',handler:_deleteLstBtnHandler},'-',{id:'new',text:'new list',icon:'images/oxygen/16x16/actions/add-users.png',handler:_addLstBtnHandler}]});var _exportBtnHandler=function(_button,_event){}
var _openDialog=function(_id,_dtype){var url;var w=1024,h=786;var popW=950,popH=600;if(_dtype=='list'){popW=450,popH=600;}
if(document.all){w=document.body.clientWidth;h=document.body.clientHeight;x=window.screenTop;y=window.screenLeft;}else if(window.innerWidth){w=window.innerWidth;h=window.innerHeight;x=window.screenX;y=window.screenY;}
var leftPos=((w-popW)/2)+y,topPos=((h-popH)/2)+x;if(_dtype=='list'&&!_id){url='index.php?getpopup=addressbook.editlist';}
else if(_dtype=='list'&&_id){url='index.php?getpopup=addressbook.editlist&contactid='+_id;}
else if(_dtype!='list'&&_id){url='index.php?getpopup=addressbook.editcontact&contactid='+_id;}
else{url='index.php?getpopup=addressbook.editcontact';}
appId='addressbook';var popup=window.open(url,'popupname','width='+popW+',height='+popH+',top='+topPos+',left='+leftPos+',directories=no,toolbar=no,location=no,menubar=no,scrollbars=no,status=no,resizable=no,dependent=no');return;}
var _reloadMainWindow=function(closeCurrentWindow){closeCurrentWindow=(closeCurrentWindow==null)?false:closeCurrentWindow;window.opener.EGWNameSpace.Addressbook.reload();if(closeCurrentWindow==true){window.setTimeout("window.close()",400);}}
var _deleteContact=function(_contactIDs,_onSuccess,_onError){var contactIDs=Ext.util.JSON.encode(_contactIDs);new Ext.data.Connection().request({url:'index.php',method:'post',scope:this,params:{method:'Addressbook.deleteContacts',_contactIDs:contactIDs},success:function(response,options){var decodedResponse;try{decodedResponse=Ext.util.JSON.decode(response.responseText);if(decodedResponse.success){if(typeof _onSuccess=='function'){_onSuccess;}}else{Ext.MessageBox.alert('Failure!','Deleting contact failed!');}}catch(e){Ext.MessageBox.alert('Failure!',e.message);}},failure:function(response,options){}});window.location.reload();console.log(response);Ext.MessageBox.alert('Success!','Deleted contact!');console.log(decodedResponse);}
var _exportContact=function(_btn,_event){Ext.MessageBox.alert('Export','Not yet implemented.');}
var _displayListDialog=function(){Ext.QuickTips.init();Ext.form.Field.prototype.msgTarget='side';var layout=new Ext.BorderLayout(document.body,{north:{split:false,initialSize:28},center:{autoScroll:true},south:{split:false,initialSize:256}});layout.beginUpdate();layout.add('north',new Ext.ContentPanel('header',{fitToFrame:true}));layout.add('center',new Ext.ContentPanel('content'));layout.add('south',new Ext.ContentPanel('south'));layout.endUpdate();var disableButtons=true;if(formData.values){disableButtons=false;}
var tb=new Ext.Toolbar('header');tb.add({id:'savebtn',cls:'x-btn-text-icon',text:'Save and Close',icon:'images/oxygen/22x22/actions/document-save.png',tooltip:'save this list and close window',onClick:function(){if(listedit.isValid()){var additionalData={};if(formData.values){additionalData._contactID=formData.values.contact_id;}else{additionalData._contactID=0;}
listedit.submit({waitTitle:'Please wait!',waitMsg:'saving contact...',params:additionalData,success:function(form,action,o){window.opener.EGWNameSpace.Addressbook.reload();window.setTimeout("window.close()",400);},failure:function(form,action){}});}else{Ext.MessageBox.alert('Errors','Please fix the errors noted.');}}},{id:'savebtn',cls:'x-btn-icon-22',icon:'images/oxygen/22x22/actions/save-all.png',tooltip:'apply changes for this list',onClick:function(){if(listedit.isValid()){var additionalData={};if(formData.values){additionalData._contactID=formData.values.contact_id;}else{additionalData._contactID=0;}
listedit.submit({waitTitle:'Please wait!',waitMsg:'saving contact...',params:additionalData,success:function(form,action,o){window.opener.EGWNameSpace.Addressbook.reload();},failure:function(form,action){}});}else{Ext.MessageBox.alert('Errors','Please fix the errors noted.');}}},{id:'deletebtn',cls:'x-btn-icon-22',icon:'images/oxygen/22x22/actions/edit-delete.png',tooltip:'delete this contact',disabled:disableButtons,handler:function(_btn,_event){if(formData.values.contact_id){Ext.MessageBox.wait('Deleting contact...','Please wait!');_deleteContact([formData.values.contact_id]);_reloadMainWindow(true);}}},{id:'exportbtn',cls:'x-btn-icon-22',icon:'images/oxygen/22x22/actions/file-export.png',tooltip:'export this contact',disabled:disableButtons,handler:_exportContact});var ds_addressbooks=new Ext.data.SimpleStore({fields:['id','addressbooks'],data:formData.config.addressbooks});var contentTag=Ext.Element.get('content');var listedit=new Ext.form.Form({labelWidth:75,url:'index.php?method=Addressbook.saveList',reader:new Ext.data.JsonReader({root:'results'},[{name:'contact_id'},{name:'contact_tid'},{name:'contact_owner'},{name:'n_given'},{name:'n_middle'},{name:'n_fileas'},{name:'contact_created'},{name:'contact_creator'},{name:'account_id'}])});listedit.on('beforeaction',function(_form,_action){_form.baseParams={};_form.baseParams._contactOwner=_form.getValues().contact_owner;_form.baseParams._addressType='l';_form.baseParams._listmembers=_getJSONDsRecs(listMembersDS);if(formData.values&&formData.values.contact_id){_form.baseParams._contactID=formData.values.contact_id;}else{_form.baseParams._contactID=0;}
console.log(_form.baseParams);});listedit.fieldset({legend:'List information'});listedit.column({width:'100%',labelWidth:90,labelSeparator:''},new Ext.form.ComboBox({fieldLabel:'Addressbook',name:'contact_owner',hiddenName:'contact_owner',store:ds_addressbooks,displayField:'addressbooks',valueField:'id',allowBlank:false,editable:false,mode:'remote',triggerAction:'all',emptyText:'Select a addressbook...',selectOnFocus:true,width:325}),new Ext.form.TextField({fieldLabel:'List Name',name:'n_family',width:325}),new Ext.form.TextField({fieldLabel:'List Nickname',name:'n_given',width:325}),new Ext.form.TextField({fieldLabel:'List Description',name:'org_name',width:325}));listedit.end();searchDS=new Ext.data.JsonStore({url:'index.php',baseParams:{method:'Addressbook.getContacts',datatype:'contacts',owner:formData.values.contact_owner,nodeid:'mycontacts',options:'{"displayContacts":true,"displayLists":false}',},root:'results',totalProperty:'totalcount',id:'contact_id',fields:[{name:'contact_id'},{name:'n_family'},{name:'contact_email'}],remoteSort:true,success:function(response,options){},failure:function(response,options){}});searchDS.setDefaultSort('n_family','asc');searchDS.load({params:{start:0,limit:50}});var resultTpl=new Ext.Template('<div class="search-item">','<h3>{n_family} - {contact_email}</h3>','{excerpt}','</div>');var list_search=new Ext.form.ComboBox({store:searchDS,displayField:'n_family',typeAhead:false,loadingText:'Searching...',width:325,pageSize:10,hideTrigger:true,tpl:resultTpl,onSelect:function(record){var tmpText=new Text({contact_id:record.data.contact_id,n_family:record.data.n_family,contact_email:record.data.contact_email});listMembersDS.insert(0,tmpText);searchDS.remove(record);list_search.reset();list_search.collapse();searchDS.removeAll();}});listedit.fieldset({legend:'Select new List members'});listedit.column({width:'100%',labelWidth:90,labelSeparator:''},list_search);listedit.end();listedit.render('content');var Text=Ext.data.Record.create([{name:'contact_id',type:'int'},{name:'n_family',type:'string'},{name:'contact_email',type:'string'}]);var listMembersDS=new Ext.data.JsonStore({url:'index.php',baseParams:{method:'Addressbook.getContacts',datatype:'list',owner:formData.values.contact_owner,options:'{"listID":"'+formData.values.contact_id+'"}',},root:'results',totalProperty:'totalcount',id:'contact_id',fields:[{name:'contact_id'},{name:'n_family'},{name:'contact_email'}],remoteSort:true});var lcm=new Ext.grid.ColumnModel([{resizable:true,id:'n_family',header:'Family name',dataIndex:'n_family'},{resizable:true,id:'contact_email',header:'eMal address',dataIndex:'contact_email'}]);lcm.defaultSortable=true;var listGrid=new Ext.grid.Grid("south",{ds:listMembersDS,cm:lcm,selModel:new Ext.grid.RowSelectionModel({multiSelect:true}),autoSizeColumns:true,monitorWindowResize:false,trackMouseOver:true,contextMenu:'ctxMenuPicAssignTree',autoExpandColumn:'contact_email'});listGrid.on('rowcontextmenu',function(grid,rowIndex,eventObject){eventObject.stopEvent();var record=grid.getDataSource().getAt(rowIndex);if(record.data.contact_tid=='l'){ctxListMenu.showAt(eventObject.getXY());}
else{ctxListMenu.showAt(eventObject.getXY());}});listGrid.render('south');var _deleteLstItemHandler=function(_button,_event){var contactIDs=Array();var selectedRows=listGrid.getSelectionModel().getSelections();for(var i=0;i<selectedRows.length;++i){listMembersDS.remove(selectedRows[i]);}}
var ctxListMenu=new Ext.menu.Menu({id:'ctxListMenu',items:[{id:'delete',text:'delete entry',icon:'images/oxygen/16x16/actions/edit-delete.png',handler:_deleteLstItemHandler}]});return listedit;}
var _displayContactDialog=function(){Ext.QuickTips.init();Ext.form.Field.prototype.msgTarget='side';var layout=new Ext.BorderLayout(document.body,{north:{split:false,initialSize:28},center:{autoScroll:true}});layout.beginUpdate();layout.add('north',new Ext.ContentPanel('header',{fitToFrame:true}));layout.add('center',new Ext.ContentPanel('content'));layout.endUpdate();var disableButtons=true;if(formData.values){disableButtons=false;}
var tb=new Ext.Toolbar('header');tb.add({id:'savebtn',cls:'x-btn-text-icon',text:'Save and Close',icon:'images/oxygen/22x22/actions/document-save.png',tooltip:'save this contact and close window',onClick:function(){if(addressedit.isValid()){var additionalData={};if(formData.values){additionalData._contactID=formData.values.contact_id;}else{additionalData._contactID=0;}
addressedit.submit({waitTitle:'Please wait!',waitMsg:'saving contact...',params:additionalData,success:function(form,action,o){window.opener.EGWNameSpace.Addressbook.reload();window.setTimeout("window.close()",400);},failure:function(form,action){}});}else{Ext.MessageBox.alert('Errors','Please fix the errors noted.');}}},{id:'savebtn',cls:'x-btn-icon-22',icon:'images/oxygen/22x22/actions/save-all.png',tooltip:'apply changes for this contact',onClick:function(){if(addressedit.isValid()){var additionalData={};if(formData.values){additionalData._contactID=formData.values.contact_id;}else{additionalData._contactID=0;}
addressedit.submit({waitTitle:'Please wait!',waitMsg:'saving contact...',params:additionalData,success:function(form,action,o){window.opener.EGWNameSpace.Addressbook.reload();},failure:function(form,action){}});}else{Ext.MessageBox.alert('Errors','Please fix the errors noted.');}}},{id:'deletebtn',cls:'x-btn-icon-22',icon:'images/oxygen/22x22/actions/edit-delete.png',tooltip:'delete this contact',disabled:disableButtons,handler:function(_btn,_event){if(formData.values.contact_id){Ext.MessageBox.wait('Deleting contact...','Please wait!');_deleteContact([formData.values.contact_id]);_reloadMainWindow(true);}}},{id:'exportbtn',cls:'x-btn-icon-22',icon:'images/oxygen/22x22/actions/file-export.png',tooltip:'export this contact',disabled:disableButtons,handler:_exportContact});var ds_country=new Ext.data.JsonStore({url:'index.php',baseParams:{method:'Egwbase.getCountryList'},root:'results',id:'shortName',fields:['shortName','translatedName'],remoteSort:false});var ds_addressbooks=new Ext.data.SimpleStore({fields:['id','addressbooks'],data:formData.config.addressbooks});var contentTag=Ext.Element.get('content');var addressedit=new Ext.form.Form({labelWidth:75,url:'index.php?method=Addressbook.saveAddress',reader:new Ext.data.JsonReader({root:'results'},[{name:'contact_id'},{name:'contact_tid'},{name:'contact_owner'},{name:'contact_private'},{name:'cat_id'},{name:'n_family'},{name:'n_given'},{name:'n_middle'},{name:'n_prefix'},{name:'n_suffix'},{name:'n_fn'},{name:'n_fileas'},{name:'contact_bday'},{name:'org_name'},{name:'org_unit'},{name:'contact_title'},{name:'contact_role'},{name:'contact_assistent'},{name:'contact_room'},{name:'adr_one_street'},{name:'adr_one_street2'},{name:'adr_one_locality'},{name:'adr_one_region'},{name:'adr_one_postalcode'},{name:'adr_one_countryname'},{name:'contact_label'},{name:'adr_two_street'},{name:'adr_two_street2'},{name:'adr_two_locality'},{name:'adr_two_region'},{name:'adr_two_postalcode'},{name:'adr_two_countryname'},{name:'tel_work'},{name:'tel_cell'},{name:'tel_fax'},{name:'tel_assistent'},{name:'tel_car'},{name:'tel_pager'},{name:'tel_home'},{name:'tel_fax_home'},{name:'tel_cell_private'},{name:'tel_other'},{name:'tel_prefer'},{name:'contact_email'},{name:'contact_email_home'},{name:'contact_url'},{name:'contact_url_home'},{name:'contact_freebusy_uri'},{name:'contact_calendar_uri'},{name:'contact_note'},{name:'contact_tz'},{name:'contact_geo'},{name:'contact_pubkey'},{name:'contact_created'},{name:'contact_creator'},{name:'contact_modified'},{name:'contact_modifier'},{name:'contact_jpegphoto'},{name:'account_id'}])});addressedit.on('beforeaction',function(_form,_action){_form.baseParams={};_form.baseParams._contactOwner=_form.getValues().contact_owner;if(formData.values&&formData.values.contact_id){_form.baseParams._contactID=formData.values.contact_id;}else{_form.baseParams._contactID=0;}
console.log(_form.baseParams);});addressedit.fieldset({legend:'Contact information'});addressedit.column({width:'33%',labelWidth:90,labelSeparator:''},new Ext.form.TextField({fieldLabel:'First Name',name:'n_given',width:175}),new Ext.form.TextField({fieldLabel:'Middle Name',name:'n_middle',width:175}),new Ext.form.TextField({fieldLabel:'Last Name',name:'n_family',width:175,allowBlank:false}));addressedit.column({width:'33%',labelWidth:90,labelSeparator:''},new Ext.form.TextField({fieldLabel:'Prefix',name:'n_prefix',width:175}),new Ext.form.TextField({fieldLabel:'Suffix',name:'n_suffix',width:175}),new Ext.form.ComboBox({fieldLabel:'Addressbook',name:'contact_owner',hiddenName:'contact_owner',store:ds_addressbooks,displayField:'addressbooks',valueField:'id',allowBlank:false,editable:false,mode:'remote',triggerAction:'all',emptyText:'Select a addressbook...',selectOnFocus:true,width:175}));addressedit.end();addressedit.fieldset({legend:'Business information'});addressedit.column({width:'33%',labelWidth:90,labelSeparator:''},new Ext.form.TextField({fieldLabel:'Company',name:'org_name',width:175}),new Ext.form.TextField({fieldLabel:'Street',name:'adr_one_street',width:175}),new Ext.form.TextField({fieldLabel:'Street 2',name:'adr_one_street2',width:175}),new Ext.form.TextField({fieldLabel:'Postalcode',name:'adr_one_postalcode',width:175}),new Ext.form.TextField({fieldLabel:'City',name:'adr_one_locality',width:175}),new Ext.form.TextField({fieldLabel:'Region',name:'adr_one_region',width:175}),new Ext.form.ComboBox({fieldLabel:'Country',name:'adr_one_countryname',hiddenName:'adr_one_countryname',store:ds_country,displayField:'translatedName',valueField:'shortName',typeAhead:true,mode:'remote',triggerAction:'all',emptyText:'Select a state...',selectOnFocus:true,width:175}));addressedit.column({width:'33%',labelWidth:90,labelSeparator:''},new Ext.form.TextField({fieldLabel:'Phone',name:'tel_work',width:175}),new Ext.form.TextField({fieldLabel:'Cellphone',name:'tel_cell',width:175}),new Ext.form.TextField({fieldLabel:'Fax',name:'tel_fax',width:175}),new Ext.form.TextField({fieldLabel:'Car phone',name:'tel_car',width:175}),new Ext.form.TextField({fieldLabel:'Pager',name:'tel_pager',width:175}),new Ext.form.TextField({fieldLabel:'Email',name:'contact_email',vtype:'email',width:175}),new Ext.form.TextField({fieldLabel:'URL',name:'contact_url',vtype:'url',width:175}));addressedit.column({width:'33%',labelWidth:90,labelSeparator:''},new Ext.form.TextField({fieldLabel:'Unit',name:'org_unit',width:175}),new Ext.form.TextField({fieldLabel:'Role',name:'contact_role',width:175}),new Ext.form.TextField({fieldLabel:'Title',name:'contact_title',width:175}),new Ext.form.TextField({fieldLabel:'Room',name:'contact_room',width:175}),new Ext.form.TextField({fieldLabel:'Name Assistent',name:'contact_assistent',width:175}),new Ext.form.TextField({fieldLabel:'Phone Assistent',name:'tel_assistent',width:175}));addressedit.end();addressedit.fieldset({legend:'Private information'});addressedit.column({width:'33%',labelWidth:90,labelSeparator:''},new Ext.form.TextField({fieldLabel:'Street',name:'adr_two_street',width:175}),new Ext.form.TextField({fieldLabel:'Street2',name:'adr_two_street2',width:175}),new Ext.form.TextField({fieldLabel:'Postalcode',name:'adr_two_postalcode',width:175}),new Ext.form.TextField({fieldLabel:'City',name:'adr_two_locality',width:175}),new Ext.form.TextField({fieldLabel:'Region',name:'adr_two_region',width:175}),new Ext.form.ComboBox({fieldLabel:'Country',name:'adr_two_countryname',hiddenName:'adr_two_countryname',store:ds_country,displayField:'translatedName',valueField:'shortName',typeAhead:true,mode:'remote',triggerAction:'all',emptyText:'Select a state...',selectOnFocus:true,width:175}));addressedit.column({width:'33%',labelWidth:90,labelSeparator:''},new Ext.form.DateField({fieldLabel:'Birthday',name:'contact_bday',format:formData.config.dateFormat,altFormats:'Y-m-d',width:175}),new Ext.form.TextField({fieldLabel:'Phone',name:'tel_home',width:175}),new Ext.form.TextField({fieldLabel:'Cellphone',name:'tel_cell_private',width:175}),new Ext.form.TextField({fieldLabel:'Fax',name:'tel_fax_home',width:175}),new Ext.form.TextField({fieldLabel:'Email',name:'contact_email_home',vtype:'email',width:175}),new Ext.form.TextField({fieldLabel:'URL',name:'contact_url_home',vtype:'url',width:175}));addressedit.column({width:'33%',labelSeparator:'',hideLabels:true},new Ext.form.TextArea({name:'contact_note',grow:false,preventScrollbars:false,width:'95%',maxLength:255,height:150}));addressedit.end();var categoriesTrigger=new Ext.form.TriggerField({fieldLabel:'Categories',name:'categories',width:320,readOnly:true});categoriesTrigger.onTriggerClick=function(){var containerTag=Ext.Element.get('container');var iWindowTag=containerTag.createChild({tag:'div',id:'iWindowTag'});var iWindowContTag=containerTag.createChild({tag:'div',id:'iWindowContTag'});var ds_category=new Ext.data.SimpleStore({fields:['category_id','category_realname'],data:[['1','erste Kategorie'],['2','zweite Kategorie'],['3','dritte Kategorie'],['4','vierte Kategorie'],['5','fuenfte Kategorie'],['6','sechste Kategorie'],['7','siebte Kategorie'],['8','achte Kategorie']]});ds_category.load();ds_checked=new Ext.data.SimpleStore({fields:['category_id','category_realname'],data:[['2','zweite Kategorie'],['5','fuenfte Kategorie'],['6','sechste Kategorie'],['8','achte Kategorie']]});ds_checked.load();var categoryedit=new Ext.form.Form({labelWidth:75,url:'index.php?method=Addressbook.saveAdditionalData',reader:new Ext.data.JsonReader({root:'results'},[{name:'category_id'},{name:'category_realname'},])});var i=1;var checked=new Array();ds_checked.each(function(record){checked[record.data.category_id]=record.data.category_realname;});ds_category.each(function(fields){if((i%12)==1){categoryedit.column({width:'33%',labelWidth:50,labelSeparator:''});}
if(checked[fields.data.category_id]){categoryedit.add(new Ext.form.Checkbox({boxLabel:fields.data.category_realname,name:fields.data.category_realname,checked:true}));}else{categoryedit.add(new Ext.form.Checkbox({boxLabel:fields.data.category_realname,name:fields.data.category_realname}));}
if((i%12)==0){categoryedit.end();}
i=i+1;});categoryedit.render('iWindowContTag');if(!dialog){var dialog=new Ext.LayoutDialog('iWindowTag',{modal:true,width:700,height:400,shadow:true,minWidth:700,minHeight:400,autoTabs:true,proxyDrag:true,center:{autoScroll:true,tabPosition:'top',closeOnTab:true,alwaysShowTabs:true}});dialog.addKeyListener(27,this.hide);dialog.addButton("save",function(){Ext.MessageBox.alert('Todo','Not yet implemented!');dialog.hide;},dialog);dialog.addButton("cancel",function(){Ext.MessageBox.alert('Todo','Not yet implemented!');dialog.hide;},dialog);var layout=dialog.getLayout();layout.beginUpdate();layout.add("center",new Ext.ContentPanel('iWindowContTag',{autoCreate:true,title:'Category'}));layout.endUpdate();}
dialog.show();}
addressedit.column({width:'45%',labelWidth:80,labelSeparator:' ',labelAlign:'right'},categoriesTrigger);var listsTrigger=new Ext.form.TriggerField({fieldLabel:'Lists',name:'lists',width:320,readOnly:true});listsTrigger.onTriggerClick=function(){var containerTag=Ext.Element.get('container');var iWindowTag=containerTag.createChild({tag:'div',id:'iWindowTag'});var iWindowContTag=containerTag.createChild({tag:'div',id:'iWindowContTag'});var ds_lists=new Ext.data.SimpleStore({fields:['list_id','list_realname'],data:[['1','Liste A'],['2','Liste B'],['3','Liste C'],['4','Liste D'],['5','Liste E'],['6','Liste F'],['7','Liste G'],['8','Liste H']]});ds_lists.load();ds_checked=new Ext.data.SimpleStore({fields:['list_id','list_realname'],data:[['2','Liste B'],['5','Liste E'],['6','Liste F'],['8','Liste H']]});ds_checked.load();var listsedit=new Ext.form.Form({labelWidth:75,url:'index.php?method=Addressbook.saveAdditionalData',reader:new Ext.data.JsonReader({root:'results'},[{name:'list_id'},{name:'list_realname'},])});var i=1;var checked=new Array();ds_checked.each(function(record){checked[record.data.list_id]=record.data.list_realname;});ds_lists.each(function(fields){if((i%12)==1)listsedit.column({width:'33%',labelWidth:50,labelSeparator:''});if(checked[fields.data.list_id]){listsedit.add(new Ext.form.Checkbox({boxLabel:fields.data.list_realname,name:fields.data.list_realname,checked:true}));}else{listsedit.add(new Ext.form.Checkbox({boxLabel:fields.data.list_realname,name:fields.data.list_realname}));}
if((i%12)==0){listsedit.end();}
i=i+1;});listsedit.render('iWindowContTag');if(!dialog){var dialog=new Ext.LayoutDialog('iWindowTag',{modal:true,width:700,height:400,shadow:true,minWidth:700,minHeight:400,autoTabs:true,proxyDrag:true,center:{autoScroll:true,tabPosition:'top',closeOnTab:true,alwaysShowTabs:true}});dialog.addKeyListener(27,this.hide);dialog.addButton("save",function(){Ext.MessageBox.alert('Todo','Not yet implemented!');},dialog);dialog.addButton("cancel",function(){window.location.reload();dialog.hide},dialog);var layout=dialog.getLayout();layout.beginUpdate();layout.add("center",new Ext.ContentPanel('iWindowContTag',{autoCreate:true,title:'Lists'}));layout.endUpdate();}
dialog.show();}
addressedit.column({width:'45%',labelWidth:80,labelSeparator:' ',labelAlign:'right'},listsTrigger);addressedit.column({width:'10%',labelWidth:50,labelSeparator:' ',labelAlign:'right'},new Ext.form.Checkbox({fieldLabel:'Private',name:'categories',width:10}));addressedit.render('content');return addressedit;}
var _setContactDialogValues=function(_dialog,_formData){for(var fieldName in _formData){var field=_dialog.findField(fieldName);if(field){field.setValue(_formData[fieldName]);}}}
return{show:_showAddressGrid,reload:function(){contactDS.reload();},handleDragDrop:function(e){alert('Best Regards From Addressbook');},openDialog:function(){_openDialog();},displayContactDialog:function(){var dialog=_displayContactDialog();if(formData.values){_setContactDialogValues(dialog,formData.values);}},displayListDialog:function(){var dialog=_displayListDialog();if(formData.values){_setContactDialogValues(dialog,formData.values);}}}}();