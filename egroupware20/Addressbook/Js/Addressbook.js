Ext.namespace("Egw.Addressbook");Egw.Addressbook=function(){var M;var Q;var q;var t;var R,u;var k=function(d){if(Ext.isEmpty(d)){return false;}var v=d.data,m=v.getCount(),K=new Array();for(i=0;i<m;i++){var a=v.itemAt(i).data;K.push(a);}return Ext.util.JSON.encode(K);};var l=function(h,N){var K=h.getRegion("center",false);K.remove(0);var m=Ext.Element.get("content");var b=m.createChild({tag:"div",id:"outergriddiv"});console.log(N.attributes.datatype);switch(N.attributes.datatype){case "list":var O={listId:N.attributes.listId};var d="Addressbook.getContacts";break;case "contacts":var O={displayContacts:true,displayLists:true};var d="Addressbook.getContacts";break;case "otherpeople":var O={displayContacts:true,displayLists:true,};var d="Addressbook.getContacts";break;case "sharedaddressbooks":var O={displayContacts:true,displayLists:true,};var d="Addressbook.getContacts";break;case "overview":var O={displayContacts:true,displayLists:true,};var d="Addressbook.getOverview";break;}M=new Ext.data.JsonStore({url:"index.php",baseParams:{method:d,datatype:N.attributes.datatype,owner:N.attributes.owner,nodeid:N.attributes.id,options:Ext.encode(O),query:""},root:"results",totalProperty:"totalcount",id:"contact_id",fields:[{name:"contact_id"},{name:"contact_tid"},{name:"contact_owner"},{name:"contact_private"},{name:"cat_id"},{name:"n_family"},{name:"n_given"},{name:"n_middle"},{name:"n_prefix"},{name:"n_suffix"},{name:"n_fn"},{name:"n_fileas"},{name:"contact_bday"},{name:"org_name"},{name:"org_unit"},{name:"contact_title"},{name:"contact_role"},{name:"contact_assistent"},{name:"contact_room"},{name:"adr_one_street"},{name:"adr_one_street2"},{name:"adr_one_locality"},{name:"adr_one_region"},{name:"adr_one_postalcode"},{name:"adr_one_countryname"},{name:"contact_label"},{name:"adr_two_street"},{name:"adr_two_street2"},{name:"adr_two_locality"},{name:"adr_two_region"},{name:"adr_two_postalcode"},{name:"adr_two_countryname"},{name:"tel_work"},{name:"tel_cell"},{name:"tel_fax"},{name:"tel_assistent"},{name:"tel_car"},{name:"tel_pager"},{name:"tel_home"},{name:"tel_fax_home"},{name:"tel_cell_private"},{name:"tel_other"},{name:"tel_prefer"},{name:"contact_email"},{name:"contact_email_home"},{name:"contact_url"},{name:"contact_url_home"},{name:"contact_freebusy_uri"},{name:"contact_calendar_uri"},{name:"contact_note"},{name:"contact_tz"},{name:"contact_geo"},{name:"contact_pubkey"},{name:"contact_created"},{name:"contact_creator"},{name:"contact_modified"},{name:"contact_modifier"},{name:"contact_jpegphoto"},{name:"account_id"}],remoteSort:true});M.setDefaultSort("n_family","asc");M.load({params:{start:0,limit:50}});M.on("beforeload",function(D,X){D.baseParams.options=Ext.encode({displayContacts:R.pressed,displayLists:u.pressed});D.baseParams.query=a.getValue();});var f=new Ext.grid.ColumnModel([{resizable:true,id:"contact_tid",dataIndex:"contact_tid",width:30,renderer:Z},{resizable:true,id:"contact_private",header:"private?",dataIndex:"contact_private",hidden:true},{resizable:true,id:"n_family",header:"Family name",dataIndex:"n_family"},{resizable:true,id:"n_given",header:"Given name",dataIndex:"n_given"},{resizable:true,id:"n_middle",header:"Middle name",dataIndex:"n_middle",hidden:true},{resizable:true,id:"n_prefix",header:"Prefix",dataIndex:"n_prefix",hidden:true},{resizable:true,id:"n_suffix",header:"Suffix",dataIndex:"n_suffix",hidden:true},{resizable:true,id:"n_fn",header:"Full name",dataIndex:"n_fn",hidden:true},{resizable:true,id:"n_fileas",header:"Name + Firm",dataIndex:"n_fileas",hidden:true},{resizable:true,id:"contact_bday",header:"Birthday",dataIndex:"contact_bday",hidden:true},{resizable:true,id:"org_name",header:"Organisation",dataIndex:"org_name"},{resizable:true,id:"org_unit",header:"Unit",dataIndex:"org_unit"},{resizable:true,id:"contact_title",header:"Title",dataIndex:"contact_title"},{resizable:true,id:"contact_role",header:"Role",dataIndex:"contact_role"},{resizable:true,id:"contact_assistent",header:"Assistent",dataIndex:"contact_assistent",hidden:true},{resizable:true,id:"contact_room",header:"Room",dataIndex:"contact_room",hidden:true},{resizable:true,id:"adr_one_street",header:"Street",dataIndex:"adr_one_street",hidden:true},{resizable:true,id:"adr_one_street2",header:"Street 2",dataIndex:"adr_one_street2",hidden:true},{resizable:true,id:"adr_one_locality",header:"Locality",dataIndex:"adr_one_locality",hidden:true},{resizable:true,id:"adr_one_region",header:"Region",dataIndex:"adr_one_region",hidden:true},{resizable:true,id:"adr_one_postalcode",header:"Postalcode",dataIndex:"adr_one_postalcode",hidden:true},{resizable:true,id:"adr_one_countryname",header:"Country",dataIndex:"adr_one_countryname",hidden:true},{resizable:true,id:"contact_label",header:"Label",dataIndex:"contact_label",hidden:true},{resizable:true,id:"adr_two_street",header:"Street (private)",dataIndex:"adr_two_street",hidden:true},{resizable:true,id:"adr_two_street2",header:"Street 2 (private)",dataIndex:"adr_two_street2",hidden:true},{resizable:true,id:"adr_two_locality",header:"Locality (private)",dataIndex:"adr_two_locality",hidden:true},{resizable:true,id:"adr_two_region",header:"Region (private)",dataIndex:"adr_two_region",hidden:true},{resizable:true,id:"adr_two_postalcode",header:"Postalcode (private)",dataIndex:"adr_two_postalcode",hidden:true},{resizable:true,id:"adr_two_countryname",header:"Country (private)",dataIndex:"adr_two_countryname",hidden:true},{resizable:true,id:"tel_work",header:"Phone",dataIndex:"tel_work",hidden:true},{resizable:true,id:"tel_cell",header:"Cellphone",dataIndex:"tel_cell",hidden:true},{resizable:true,id:"tel_fax",header:"Fax",dataIndex:"tel_fax",hidden:true},{resizable:true,id:"tel_assistent",header:"Assistent phone",dataIndex:"tel_assistent",hidden:true},{resizable:true,id:"tel_car",header:"Car phone",dataIndex:"tel_car",hidden:true},{resizable:true,id:"tel_pager",header:"Pager",dataIndex:"tel_pager",hidden:true},{resizable:true,id:"tel_home",header:"Phone (private)",dataIndex:"tel_home",hidden:true},{resizable:true,id:"tel_fax_home",header:"Fax (private)",dataIndex:"tel_fax_home",hidden:true},{resizable:true,id:"tel_cell_private",header:"Cellphone (private)",dataIndex:"tel_cell_private",hidden:true},{resizable:true,id:"tel_other",header:"Phone other",dataIndex:"tel_other",hidden:true},{resizable:true,id:"tel_prefer",header:"Phone prefer",dataIndex:"tel_prefer",hidden:true},{resizable:true,id:"contact_email",header:"eMail",dataIndex:"contact_email",hidden:true},{resizable:true,id:"contact_email_home",header:"eMail (private)",dataIndex:"contact_email_home",hidden:true},{resizable:true,id:"contact_url",header:"URL",dataIndex:"contact_url",hidden:true},{resizable:true,id:"contact_url_home",header:"URL (private)",dataIndex:"contact_url_home",hidden:true},{resizable:true,id:"contact_freebusy_uri",header:"Freebusy URI",dataIndex:"contact_freebusy_uri",hidden:true},{resizable:true,id:"contact_calendar_uri",header:"Calendar URI",dataIndex:"contact_calendar_uri",hidden:true},{resizable:true,id:"contact_note",header:"Note",dataIndex:"contact_note",hidden:true},{resizable:true,id:"contact_tz",header:"Timezone",dataIndex:"contact_tz",hidden:true},{resizable:true,id:"contact_geo",header:"Geo",dataIndex:"contact_geo",hidden:true},{resizable:true,id:"contact_pubkey",header:"Public Key",dataIndex:"contact_pubkey",hidden:true},{resizable:true,id:"contact_created",header:"Creation Date",dataIndex:"contact_created",hidden:true},{resizable:true,id:"contact_creator",header:"Creator",dataIndex:"contact_creator",hidden:true},{resizable:true,id:"contact_modified",header:"Modification Date",dataIndex:"contact_modified",hidden:true},{resizable:true,id:"contact_modifier",header:"Modifier",dataIndex:"contact_modifier",hidden:true},{resizable:true,id:"contact_jpegphoto",header:"Photo",dataIndex:"contact_jpegphoto",hidden:true},{resizable:true,id:"addressbook",header:"addressbook",dataIndex:"addressbook",hidden:true}]);f.defaultSortable=true;Q=new Ext.grid.Grid(b,{ds:M,cm:f,autoSizeColumns:false,selModel:new Ext.grid.RowSelectionModel({multiSelect:true}),enableColLock:false,loadMask:true,enableDragDrop:true,ddGroup:"TreeDD",autoExpandColumn:"n_given"});Q.render();Q.on("rowclick",function(H,C,L){var X=Q.getSelectionModel().getCount();var D=r.items.map;if(X<1){D.editbtn.disable();D.deletebtn.disable();}else{if(X==1){D.editbtn.enable();D.deletebtn.enable();}else{D.editbtn.disable();D.deletebtn.enable();}}});Q.on("rowdblclick",function(D,C,L){var X=D.getDataSource().getAt(C);if(X.data.contact_tid=="l"){try{n(X.data.contact_id,"list");}catch(H){}}else{try{n(X.data.contact_id);}catch(H){}}});Q.on("rowcontextmenu",function(L,C,D){D.stopEvent();var X=L.getDataSource().getAt(C);if(X.data.contact_tid=="l"){B.showAt(D.getXY());}else{F.showAt(D.getXY());}});var w=Q.getView().getHeaderPanel(true);var r=new Ext.Toolbar(w);var v=Ext.DomHelper.append(r.el,{tag:"div",id:Ext.id()},true);var s=new Ext.PagingToolbar(v,M,{pageSize:50,cls:"x-btn-icon-22",displayInfo:true,displayMsg:"Displaying contacts {0} - {1} of {2}",emptyMsg:"No contacts to display"});r.addButton({id:"addbtn",cls:"x-btn-icon-22",icon:"images/oxygen/22x22/actions/add-user.png",tooltip:"add new contact",handler:S});r.addButton({id:"addlstbtn",cls:"x-btn-icon-22",icon:"images/oxygen/22x22/actions/add-users.png",tooltip:"add new list",handler:V});r.addButton({id:"editbtn",cls:"x-btn-icon-22",icon:"images/oxygen/22x22/actions/edit.png",tooltip:"edit current item",disabled:true,handler:p});r.addButton({id:"deletebtn",cls:"x-btn-icon-22",icon:"images/oxygen/22x22/actions/edit-delete.png",tooltip:"delete selected items",disabled:true,handler:c});r.insertButton(4,new Ext.Toolbar.Separator());R=r.addButton({id:"filtercontactsbtn",cls:"x-btn-icon-22",icon:"images/oxygen/22x22/actions/user.png",tooltip:"display contacts",enableToggle:true,pressed:true,handler:P});u=r.addButton({id:"filterlistsbtn",cls:"x-btn-icon-22",icon:"images/oxygen/22x22/actions/users.png",tooltip:"display lists",enableToggle:true,pressed:true,handler:o});r.addButton({id:"exportbtn",cls:"x-btn-icon-22",icon:"images/oxygen/22x22/actions/file-export.png",tooltip:"export selected contacts",disabled:false,onClick:U});var a=new Ext.form.TextField({height:22,width:200,emptyText:"Suchparameter ...",allowBlank:false});a.on("specialkey",function(D,X){if(X.getKey()==X.ENTER||X.getKey()==e.RETURN){M.reload();}});r.add(new Ext.Toolbar.Fill());r.addField(a);r.add({id:"clearsearchbtn",cls:"x-btn-icon-22",icon:"images/oxygen/22x22/actions/clear-left.png",tooltip:"L�sche bestehende Sucheingabe",disabled:false,onClick:function(){a.setValue("");M.reload();}});r.add({id:"searchbtn",cls:"x-btn-icon-22",icon:"images/oxygen/22x22/actions/mail-find.png",tooltip:"Suche Adresse/Adressliste",disabled:false,onClick:function(){M.reload();}});K.add(new Ext.GridPanel(Q));};var Z=function(a,r,m,d,K,v){switch(a){case "l":return "<img src='images/oxygen/16x16/actions/users.png' width='12' height='12' alt='list'/>";default:return "<img src='images/oxygen/16x16/actions/user.png' width='12' height='12' alt='contact'/>";}};var P=function(K,d){M.reload();};var o=function(K,d){M.reload();};var c=function(v,d){var m=Array();var a=Q.getSelectionModel().getSelections();for(var K=0;K<a.length;++K){m.push(a[K].id);}G(m,function(){EGWNameSpace.Addressbook.reload();});M.reload();};var p=function(a,d){var m=Q.getSelectionModel().getSelections();var K=m[0].id;if(m[0].data.contact_tid=="l"){n(K,"list");}else{n(K);}};var S=function(K,d){n();};var V=function(K,d){n("","list");};var W=function(v,d){var m=Array();var a=Q.getSelectionModel().getSelections();for(var K=0;K<a.length;++K){m.push(a[K].id);}G(m,function(){EGWNameSpace.Addressbook.reload();});M.reload();};var E=function(a,d){var m=Q.getSelectionModel().getSelections();var K=m[0].id;n(K,"list");};var F=new Ext.menu.Menu({id:"ctxMenuAddress",items:[{id:"edit",text:"edit contact",icon:"images/oxygen/16x16/actions/edit.png",handler:p},{id:"delete",text:"delete contact",icon:"images/oxygen/16x16/actions/edit-delete.png",handler:c},"-",{id:"new contact",text:"new contact",icon:"images/oxygen/16x16/actions/add-user.png",handler:S},{id:"new list",text:"new list",icon:"images/oxygen/16x16/actions/add-users.png",handler:V}]});var B=new Ext.menu.Menu({id:"ctxMenuList",items:[{id:"edit",text:"edit list",icon:"images/oxygen/16x16/actions/edit.png",handler:E},{id:"delete",text:"delete list",icon:"images/oxygen/16x16/actions/edit-delete.png",handler:W},"-",{id:"new contact",text:"new contact",icon:"images/oxygen/16x16/actions/add-user.png",handler:S},{id:"new list",text:"new list",icon:"images/oxygen/16x16/actions/add-users.png",handler:V}]});var U=function(K,d){};var n=function(f,m){var K;var N=1024,b=786;var a=950,s=600;if(m=="list"){a=450,s=600;}if(document.all){N=document.body.clientWidth;b=document.body.clientHeight;x=window.screenTop;y=window.screenLeft;}else{if(window.innerWidth){N=window.innerWidth;b=window.innerHeight;x=window.screenX;y=window.screenY;}}var v=((N-a)/2)+y,r=((b-s)/2)+x;if(m=="list"&&!f){K="index.php?method=Addressbook.editList";}else{if(m=="list"&&f){K="index.php?method=Addressbook.editList&contactid="+f;}else{if(m!="list"&&f){K="index.php?method=Addressbook.editContact&contactid="+f;}else{K="index.php?method=Addressbook.editContact";}}}appId="addressbook";var d=window.open(K,"popupname","width="+a+",height="+s+",top="+r+",left="+v+",directories=no,toolbar=no,location=no,menubar=no,scrollbars=no,status=no,resizable=no,dependent=no");return ;};var T=function(d){d=(d==null)?false:d;window.opener.EGWNameSpace.Addressbook.reload();if(d==true){window.setTimeout("window.close()",400);}};var G=function(K,d,m){var a=Ext.util.JSON.encode(K);new Ext.data.Connection().request({url:"index.php",method:"post",scope:this,params:{method:"Addressbook.deleteContacts",_contactIDs:a},success:function(r,w){var v;try{v=Ext.util.JSON.decode(r.responseText);if(v.success){if(typeof d=="function"){d;}}else{Ext.MessageBox.alert("Failure!","Deleting contact failed!");}}catch(b){Ext.MessageBox.alert("Failure!",b.message);}},failure:function(v,r){}});window.location.reload();console.log(response);Ext.MessageBox.alert("Success!","Deleted contact!");console.log(decodedResponse);};var I=function(K,d){Ext.MessageBox.alert("Export","Not yet implemented.");};var Y=function(){Ext.QuickTips.init();Ext.form.Field.prototype.msgTarget="side";var a=new Ext.BorderLayout(document.body,{north:{split:false,initialSize:28},center:{autoScroll:true}});a.beginUpdate();a.add("north",new Ext.ContentPanel("header",{fitToFrame:true}));a.add("center",new Ext.ContentPanel("content"));a.endUpdate();var f=true;if(formData.values){f=false;}var K=new Ext.Toolbar("header");K.add({id:"savebtn",cls:"x-btn-text-icon",text:"Save and Close",icon:"images/oxygen/22x22/actions/document-save.png",tooltip:"save this contact and close window",onClick:function(){if(m.isValid()){var s={};if(formData.values){s._contactID=formData.values.contact_id;}else{s._contactID=0;}m.submit({waitTitle:"Please wait!",waitMsg:"saving contact...",params:s,success:function(h,N,O){window.opener.EGWNameSpace.Addressbook.reload();},failure:function(h,N){}});}else{Ext.MessageBox.alert("Errors","Please fix the errors noted.");}}},{id:"savebtn",cls:"x-btn-icon-22",icon:"images/oxygen/22x22/actions/save-all.png",tooltip:"apply changes for this contact",onClick:function(){if(m.isValid()){var s={};if(formData.values){s._contactID=formData.values.contact_id;}else{s._contactID=0;}m.submit({waitTitle:"Please wait!",waitMsg:"saving contact...",params:s,success:function(h,N,O){window.opener.EGWNameSpace.Addressbook.reload();},failure:function(h,N){}});}else{Ext.MessageBox.alert("Errors","Please fix the errors noted.");}}},{id:"deletebtn",cls:"x-btn-icon-22",icon:"images/oxygen/22x22/actions/edit-delete.png",tooltip:"delete this contact",disabled:f,handler:function(h,s){if(formData.values.contact_id){Ext.MessageBox.wait("Deleting contact...","Please wait!");G([formData.values.contact_id]);T(true);}}},{id:"exportbtn",cls:"x-btn-icon-22",icon:"images/oxygen/22x22/actions/file-export.png",tooltip:"export this contact",disabled:f,handler:I});var w=new Ext.data.JsonStore({url:"index.php",baseParams:{method:"Egwbase.getCountryList"},root:"results",id:"shortName",fields:["shortName","translatedName"],remoteSort:false});var v=new Ext.data.SimpleStore({fields:["id","addressbooks"],data:formData.config.addressbooks});var d=Ext.Element.get("content");var m=new Ext.form.Form({labelWidth:75,url:"index.php?method=Addressbook.saveAddress",reader:new Ext.data.JsonReader({root:"results"},[{name:"contact_id"},{name:"contact_tid"},{name:"contact_owner"},{name:"contact_private"},{name:"cat_id"},{name:"n_family"},{name:"n_given"},{name:"n_middle"},{name:"n_prefix"},{name:"n_suffix"},{name:"n_fn"},{name:"n_fileas"},{name:"contact_bday"},{name:"org_name"},{name:"org_unit"},{name:"contact_title"},{name:"contact_role"},{name:"contact_assistent"},{name:"contact_room"},{name:"adr_one_street"},{name:"adr_one_street2"},{name:"adr_one_locality"},{name:"adr_one_region"},{name:"adr_one_postalcode"},{name:"adr_one_countryname"},{name:"contact_label"},{name:"adr_two_street"},{name:"adr_two_street2"},{name:"adr_two_locality"},{name:"adr_two_region"},{name:"adr_two_postalcode"},{name:"adr_two_countryname"},{name:"tel_work"},{name:"tel_cell"},{name:"tel_fax"},{name:"tel_assistent"},{name:"tel_car"},{name:"tel_pager"},{name:"tel_home"},{name:"tel_fax_home"},{name:"tel_cell_private"},{name:"tel_other"},{name:"tel_prefer"},{name:"contact_email"},{name:"contact_email_home"},{name:"contact_url"},{name:"contact_url_home"},{name:"contact_freebusy_uri"},{name:"contact_calendar_uri"},{name:"contact_note"},{name:"contact_tz"},{name:"contact_geo"},{name:"contact_pubkey"},{name:"contact_created"},{name:"contact_creator"},{name:"contact_modified"},{name:"contact_modifier"},{name:"contact_jpegphoto"},{name:"account_id"}])});m.on("beforeaction",function(h,s){h.baseParams={};h.baseParams._contactOwner=h.getValues().contact_owner;if(formData.values&&formData.values.contact_id){h.baseParams._contactID=formData.values.contact_id;}else{h.baseParams._contactID=0;}console.log(h.baseParams);});m.fieldset({legend:"Contact information"});m.column({width:"33%",labelWidth:90,labelSeparator:""},new Ext.form.TextField({fieldLabel:"First Name",name:"n_given",width:175}),new Ext.form.TextField({fieldLabel:"Middle Name",name:"n_middle",width:175}),new Ext.form.TextField({fieldLabel:"Last Name",name:"n_family",width:175,allowBlank:false}));m.column({width:"33%",labelWidth:90,labelSeparator:""},new Ext.form.TextField({fieldLabel:"Prefix",name:"n_prefix",width:175}),new Ext.form.TextField({fieldLabel:"Suffix",name:"n_suffix",width:175}),new Ext.form.ComboBox({fieldLabel:"Addressbook",name:"contact_owner",hiddenName:"contact_owner",store:v,displayField:"addressbooks",valueField:"id",allowBlank:false,editable:false,mode:"remote",triggerAction:"all",emptyText:"Select a addressbook...",selectOnFocus:true,width:175}));m.end();m.fieldset({legend:"Business information"});m.column({width:"33%",labelWidth:90,labelSeparator:""},new Ext.form.TextField({fieldLabel:"Company",name:"org_name",width:175}),new Ext.form.TextField({fieldLabel:"Street",name:"adr_one_street",width:175}),new Ext.form.TextField({fieldLabel:"Street 2",name:"adr_one_street2",width:175}),new Ext.form.TextField({fieldLabel:"Postalcode",name:"adr_one_postalcode",width:175}),new Ext.form.TextField({fieldLabel:"City",name:"adr_one_locality",width:175}),new Ext.form.TextField({fieldLabel:"Region",name:"adr_one_region",width:175}),new Ext.form.ComboBox({fieldLabel:"Country",name:"adr_one_countryname",hiddenName:"adr_one_countryname",store:w,displayField:"translatedName",valueField:"shortName",typeAhead:true,mode:"remote",triggerAction:"all",emptyText:"Select a state...",selectOnFocus:true,width:175}));m.column({width:"33%",labelWidth:90,labelSeparator:""},new Ext.form.TextField({fieldLabel:"Phone",name:"tel_work",width:175}),new Ext.form.TextField({fieldLabel:"Cellphone",name:"tel_cell",width:175}),new Ext.form.TextField({fieldLabel:"Fax",name:"tel_fax",width:175}),new Ext.form.TextField({fieldLabel:"Car phone",name:"tel_car",width:175}),new Ext.form.TextField({fieldLabel:"Pager",name:"tel_pager",width:175}),new Ext.form.TextField({fieldLabel:"Email",name:"contact_email",vtype:"email",width:175}),new Ext.form.TextField({fieldLabel:"URL",name:"contact_url",vtype:"url",width:175}));m.column({width:"33%",labelWidth:90,labelSeparator:""},new Ext.form.TextField({fieldLabel:"Unit",name:"org_unit",width:175}),new Ext.form.TextField({fieldLabel:"Role",name:"contact_role",width:175}),new Ext.form.TextField({fieldLabel:"Title",name:"contact_title",width:175}),new Ext.form.TextField({fieldLabel:"Room",name:"contact_room",width:175}),new Ext.form.TextField({fieldLabel:"Name Assistent",name:"contact_assistent",width:175}),new Ext.form.TextField({fieldLabel:"Phone Assistent",name:"tel_assistent",width:175}));m.end();m.fieldset({legend:"Private information"});m.column({width:"33%",labelWidth:90,labelSeparator:""},new Ext.form.TextField({fieldLabel:"Street",name:"adr_two_street",width:175}),new Ext.form.TextField({fieldLabel:"Street2",name:"adr_two_street2",width:175}),new Ext.form.TextField({fieldLabel:"Postalcode",name:"adr_two_postalcode",width:175}),new Ext.form.TextField({fieldLabel:"City",name:"adr_two_locality",width:175}),new Ext.form.TextField({fieldLabel:"Region",name:"adr_two_region",width:175}),new Ext.form.ComboBox({fieldLabel:"Country",name:"adr_two_countryname",hiddenName:"adr_two_countryname",store:w,displayField:"translatedName",valueField:"shortName",typeAhead:true,mode:"remote",triggerAction:"all",emptyText:"Select a state...",selectOnFocus:true,width:175}));m.column({width:"33%",labelWidth:90,labelSeparator:""},new Ext.form.DateField({fieldLabel:"Birthday",name:"contact_bday",format:formData.config.dateFormat,altFormats:"Y-m-d",width:175}),new Ext.form.TextField({fieldLabel:"Phone",name:"tel_home",width:175}),new Ext.form.TextField({fieldLabel:"Cellphone",name:"tel_cell_private",width:175}),new Ext.form.TextField({fieldLabel:"Fax",name:"tel_fax_home",width:175}),new Ext.form.TextField({fieldLabel:"Email",name:"contact_email_home",vtype:"email",width:175}),new Ext.form.TextField({fieldLabel:"URL",name:"contact_url_home",vtype:"url",width:175}));m.column({width:"33%",labelSeparator:"",hideLabels:true},new Ext.form.TextArea({name:"contact_note",grow:false,preventScrollbars:false,width:"95%",maxLength:255,height:150}));m.end();var b=new Ext.form.TriggerField({fieldLabel:"Categories",name:"categories",width:320,readOnly:true});b.onTriggerClick=function(){var X=Ext.Element.get("container");var L=X.createChild({tag:"div",id:"iWindowTag"});var D=X.createChild({tag:"div",id:"iWindowContTag"});var s=new Ext.data.SimpleStore({fields:["category_id","category_realname"],data:[["1","erste Kategorie"],["2","zweite Kategorie"],["3","dritte Kategorie"],["4","vierte Kategorie"],["5","fuenfte Kategorie"],["6","sechste Kategorie"],["7","siebte Kategorie"],["8","achte Kategorie"]]});s.load();ds_checked=new Ext.data.SimpleStore({fields:["category_id","category_realname"],data:[["2","zweite Kategorie"],["5","fuenfte Kategorie"],["6","sechste Kategorie"],["8","achte Kategorie"]]});ds_checked.load();var C=new Ext.form.Form({labelWidth:75,url:"index.php?method=Addressbook.saveAdditionalData",reader:new Ext.data.JsonReader({root:"results"},[{name:"category_id"},{name:"category_realname"},])});var h=1;var H=new Array();ds_checked.each(function(g){H[g.data.category_id]=g.data.category_realname;});s.each(function(g){if((h%12)==1){C.column({width:"33%",labelWidth:50,labelSeparator:""});}if(H[g.data.category_id]){C.add(new Ext.form.Checkbox({boxLabel:g.data.category_realname,name:g.data.category_realname,checked:true}));}else{C.add(new Ext.form.Checkbox({boxLabel:g.data.category_realname,name:g.data.category_realname}));}if((h%12)==0){C.end();}h=h+1;});C.render("iWindowContTag");if(!O){var O=new Ext.LayoutDialog("iWindowTag",{modal:true,width:700,height:400,shadow:true,minWidth:700,minHeight:400,autoTabs:true,proxyDrag:true,center:{autoScroll:true,tabPosition:"top",closeOnTab:true,alwaysShowTabs:true}});O.addKeyListener(27,this.hide);O.addButton("save",function(){Ext.MessageBox.alert("Todo","Not yet implemented!");O.hide;},O);O.addButton("cancel",function(){Ext.MessageBox.alert("Todo","Not yet implemented!");O.hide;},O);var N=O.getLayout();N.beginUpdate();N.add("center",new Ext.ContentPanel("iWindowContTag",{autoCreate:true,title:"Category"}));N.endUpdate();}O.show();};m.column({width:"45%",labelWidth:80,labelSeparator:" ",labelAlign:"right"},b);var r=new Ext.form.TriggerField({fieldLabel:"Lists",name:"lists",width:320,readOnly:true});r.onTriggerClick=function(){var X=Ext.Element.get("container");var L=X.createChild({tag:"div",id:"iWindowTag"});var D=X.createChild({tag:"div",id:"iWindowContTag"});var s=new Ext.data.SimpleStore({fields:["list_id","list_realname"],data:[["1","Liste A"],["2","Liste B"],["3","Liste C"],["4","Liste D"],["5","Liste E"],["6","Liste F"],["7","Liste G"],["8","Liste H"]]});s.load();ds_checked=new Ext.data.SimpleStore({fields:["list_id","list_realname"],data:[["2","Liste B"],["5","Liste E"],["6","Liste F"],["8","Liste H"]]});ds_checked.load();var C=new Ext.form.Form({labelWidth:75,url:"index.php?method=Addressbook.saveAdditionalData",reader:new Ext.data.JsonReader({root:"results"},[{name:"list_id"},{name:"list_realname"},])});var h=1;var H=new Array();ds_checked.each(function(g){H[g.data.list_id]=g.data.list_realname;});s.each(function(g){if((h%12)==1){C.column({width:"33%",labelWidth:50,labelSeparator:""});}if(H[g.data.list_id]){C.add(new Ext.form.Checkbox({boxLabel:g.data.list_realname,name:g.data.list_realname,checked:true}));}else{C.add(new Ext.form.Checkbox({boxLabel:g.data.list_realname,name:g.data.list_realname}));}if((h%12)==0){C.end();}h=h+1;});C.render("iWindowContTag");if(!O){var O=new Ext.LayoutDialog("iWindowTag",{modal:true,width:700,height:400,shadow:true,minWidth:700,minHeight:400,autoTabs:true,proxyDrag:true,center:{autoScroll:true,tabPosition:"top",closeOnTab:true,alwaysShowTabs:true}});O.addKeyListener(27,this.hide);O.addButton("save",function(){Ext.MessageBox.alert("Todo","Not yet implemented!");},O);O.addButton("cancel",function(){window.location.reload();O.hide;},O);var N=O.getLayout();N.beginUpdate();N.add("center",new Ext.ContentPanel("iWindowContTag",{autoCreate:true,title:"Lists"}));N.endUpdate();}O.show();};m.column({width:"45%",labelWidth:80,labelSeparator:" ",labelAlign:"right"},r);m.column({width:"10%",labelWidth:50,labelSeparator:" ",labelAlign:"right"},new Ext.form.Checkbox({fieldLabel:"Private",name:"categories",width:10}));m.render("content");return m;};var j=function(K,m){for(var a in m){var d=K.findField(a);if(d){d.setValue(m[a]);}}};return {show:l,reload:function(){M.reload();},handleDragDrop:function(d){alert("Best Regards From Addressbook");},openDialog:function(){n();},displayContactDialog:function(){var d=Y();if(formData.values){j(d,formData.values);}}};}();Egw.Addressbook.ListEditDialog=function(){var k=function(){Ext.QuickTips.init();Ext.form.Field.prototype.msgTarget="side";var W=new Ext.BorderLayout(document.body,{north:{split:false,initialSize:28},center:{split:false,initialSize:70},south:{split:false,initialSize:360,autoScroll:true}});W.beginUpdate();W.add("north",new Ext.ContentPanel("header",{fitToFrame:true}));W.add("center",new Ext.ContentPanel("content",{fitToFrame:true}));W.add("south",new Ext.ContentPanel("south",{fitToFrame:true}));W.endUpdate();var l=true;if(formData.values){l=false;}var c=new Ext.Toolbar("header");c.add({id:"savebtn",cls:"x-btn-text-icon",text:"Save and Close",icon:"images/oxygen/22x22/actions/document-save.png",tooltip:"save this list and close window",onClick:function(){if(G.isValid()){var t={};if(formData.values){t._contactID=formData.values.contact_id;}else{t._contactID=0;}G.submit({waitTitle:"Please wait!",waitMsg:"saving contact...",params:t,success:function(F,V,T){window.opener.EGWNameSpace.Addressbook.reload();},failure:function(F,V){}});}else{Ext.MessageBox.alert("Errors","Please fix the errors noted.");}}},{id:"savebtn",cls:"x-btn-icon-22",icon:"images/oxygen/22x22/actions/save-all.png",tooltip:"apply changes for this list",onClick:function(){if(G.isValid()){var t={};if(formData.values){t._contactID=formData.values.contact_id;}else{t._contactID=0;}G.submit({waitTitle:"Please wait!",waitMsg:"saving contact...",params:t,success:function(F,V,T){window.opener.EGWNameSpace.Addressbook.reload();},failure:function(F,V){}});}else{Ext.MessageBox.alert("Errors","Please fix the errors noted.");}}},{id:"deletebtn",cls:"x-btn-icon-22",icon:"images/oxygen/22x22/actions/edit-delete.png",tooltip:"delete this contact",disabled:l,handler:function(F,t){if(formData.values.contact_id){Ext.MessageBox.wait("Deleting contact...","Please wait!");_deleteContact([formData.values.contact_id]);_reloadMainWindow(true);}}});var p=new Ext.data.SimpleStore({fields:["id","addressbooks"],data:formData.config.addressbooks});var o=Ext.Element.get("content");var G=new Ext.form.Form({labelWidth:75,url:"index.php?method=Addressbook.saveList",reader:new Ext.data.JsonReader({root:"results"},[{name:"contact_id"},{name:"contact_tid"},{name:"contact_owner"},{name:"contact_email"},{name:"n_given"},{name:"n_middle"},{name:"n_fileas"},{name:"contact_created"},{name:"contact_creator"},{name:"account_id"}])});G.on("beforeaction",function(F,t){F.baseParams={};F.baseParams._contactOwner=F.getValues().contact_owner;F.baseParams._addressType="l";F.baseParams._listmembers=_getJSONDsRecs(q);if(formData.values&&formData.values.contact_id){F.baseParams._contactID=formData.values.contact_id;}else{F.baseParams._contactID=0;}console.log(F.baseParams);});G.fieldset({legend:"list information"});G.column({width:"100%",labelWidth:90,labelSeparator:""},new Ext.form.ComboBox({fieldLabel:"Addressbook",name:"contact_owner",hiddenName:"contact_owner",store:p,displayField:"addressbooks",valueField:"id",allowBlank:false,editable:false,mode:"remote",triggerAction:"all",emptyText:"Select a addressbook...",selectOnFocus:true,width:325}),new Ext.form.TextField({fieldLabel:"List Name",name:"n_family",width:325}),new Ext.form.TextField({fieldLabel:"List Nickname",name:"n_given",width:325}),new Ext.form.TextField({fieldLabel:"List Description",name:"org_name",width:325}));G.end();if(formData.values){var u=formData.values.contact_owner;var E=formData.values.contact_id;}else{var u=-1;var E=-1;}searchDS=new Ext.data.JsonStore({url:"index.php",baseParams:{method:"Addressbook.getOverview",owner:u,options:"{\"displayContacts\":true,\"displayLists\":false}",},root:"results",totalProperty:"totalcount",id:"contact_id",fields:[{name:"contact_id"},{name:"n_family"},{name:"n_given"},{name:"contact_email"}],remoteSort:true,success:function(t,F){},failure:function(t,F){}});searchDS.setDefaultSort("n_family","asc");var Y=new Ext.Template("<div class=\"search-item\">","{contact_email} - {n_family}, {n_given}","</div>");var U=new Ext.form.ComboBox({store:searchDS,displayField:"n_family",typeAhead:false,loadingText:"Searching...",width:415,pageSize:10,hideTrigger:true,tpl:Y,onSelect:function(t){var F=new n({contact_id:t.data.contact_id,n_family:t.data.n_family,contact_email:t.data.contact_email});q.insert(0,F);searchDS.remove(t);U.reset();U.collapse();searchDS.removeAll();}});G.fieldset({legend:"select new list members"});G.column({width:"100%",labelWidth:0,labelSeparator:""},U);G.end();G.render("content");var n=Ext.data.Record.create([{name:"contact_id",type:"int"},{name:"n_family",type:"string"},{name:"contact_email",type:"string"}]);var q=new Ext.data.JsonStore({url:"index.php",baseParams:{method:"Addressbook.getContacts",datatype:"list",owner:u,options:"{\"listID\":\""+E+"\"}",},root:"results",totalProperty:"totalcount",id:"contact_id",fields:[{name:"contact_id"},{name:"n_family"},{name:"contact_email"}],remoteSort:true});var S=new Ext.grid.ColumnModel([{resizable:true,id:"n_family",header:"Family name",dataIndex:"n_family"},{resizable:true,id:"contact_email",header:"eMal address",dataIndex:"contact_email"}]);S.defaultSortable=true;var I=new Ext.grid.Grid("south",{ds:q,cm:S,selModel:new Ext.grid.RowSelectionModel({multiSelect:true}),autoSizeColumns:true,monitorWindowResize:false,trackMouseOver:true,contextMenu:"ctxListMenu",autoExpandColumn:"contact_email"});I.on("rowcontextmenu",function(V,T,F){F.stopEvent();var t=V.getDataSource().getAt(T);if(t.data.contact_tid=="l"){P.showAt(F.getXY());}else{P.showAt(F.getXY());}});I.render("south");var M=function(B,t){var V=Array();var T=I.getSelectionModel().getSelections();for(var F=0;F<T.length;++F){q.remove(T[F]);}};var P=new Ext.menu.Menu({id:"ctxListMenu",items:[{id:"delete",text:"delete entry",icon:"images/oxygen/16x16/actions/edit-delete.png",handler:M}]});return G;};var j=function(I,o){for(var n in o){var u=I.findField(n);if(u){u.setValue(o[n]);}}};return {display:function(){var u=k();if(formData.values){j(u,formData.values);}}};}();