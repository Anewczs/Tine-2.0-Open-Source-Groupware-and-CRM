Ext.namespace("Egw.Admin");Egw.Admin=function(){var o=function(){var n=new Ext.tree.TreeLoader({dataUrl:"index.php"});n.on("beforeload",function(U,H){U.baseParams.method="Admin.getSubTree";U.baseParams.node=H.id;U.baseParams.location="mainTree";},this);var x=new Ext.tree.TreePanel({title:"Admin",id:"admin-tree",loader:n,rootVisible:false,border:false});var V=new Ext.tree.TreeNode({text:"root",draggable:false,allowDrop:false,id:"root"});x.setRootNode(V);for(i=0;i<initialTree.Admin.length;i++){V.appendChild(new Ext.tree.AsyncTreeNode(initialTree.Admin[i]));}x.on("click",function(U,H){var S=Egw.Egwbase.getActiveToolbar();switch(U.attributes.dataPanelType){case "accesslog":if(S!=false&&S.id=="toolbarAdminAccessLog"){Ext.getCmp("gridAdminAccessLog").getStore().load({params:{start:0,limit:50}});}else{Egw.Admin.AccessLog.show();}break;case "applications":if(S!=false&&S.id=="toolbarAdminApplications"){Ext.getCmp("gridAdminApplications").getStore().load({params:{start:0,limit:50}});}else{Egw.Admin.Applications.show();}break;}},this);x.on("beforeexpand",function(H){if(H.getSelectionModel().getSelectedNode()==null){H.expandPath("/root");H.selectPath("/root/applications");}H.fireEvent("click",H.getSelectionModel().getSelectedNode());},this);x.on("contextmenu",function(U,H){H.stopEvent();});return x;};return {getPanel:o,};}();Egw.Admin.AccessLog=function(){var x=function(J,S){var B=Ext.getCmp("grid_applications").getSelectionModel().getSelections();var r=B[0].id;Egw.Egwbase.openWindow("applicationWindow","index.php?method=Admin.getApplication&appId="+r,800,450);};var H=new Ext.Action({text:"edit",disabled:true,handler:x,iconCls:"action_edit"});var V=function(){var S=new Ext.data.JsonStore({url:"index.php",baseParams:{method:"Admin.getAccessLog"},root:"results",totalProperty:"totalcount",id:"log_id",fields:[{name:"sessionid"},{name:"loginid"},{name:"ip"},{name:"li"},{name:"lo"},{name:"log_id"},{name:"account_id"},{name:"result"}],remoteSort:true});S.setDefaultSort("li","desc");S.on("beforeload",function(B){B.baseParams.filter=Ext.getCmp("quickSearchField").getRawValue();});S.load({params:{start:0,limit:50}});return S;};var n=function(){var B=new Ext.app.SearchField({id:"quickSearchField",width:240,emptyText:"enter searchfilter"});var S=new Ext.Toolbar({id:"toolbarAdminAccessLog",split:false,height:26,items:[H,"->","Search:"," "," ",B]});Egw.Egwbase.setActiveToolbar(S);};var o=function(B,K,g,S,J,r){switch(B){case "0":return "disabled";break;case "1":return "enabled";break;case "2":return "enabled (but hidden)";break;case "3":return "enabled (new window)";break;default:return "unknown status ("+B+")";break;}};var U=function(){var S=V();var r=new Ext.PagingToolbar({pageSize:50,store:S,displayInfo:true,displayMsg:"Displaying access log entries {0} - {1} of {2}",emptyMsg:"No access log entries to display"});var J=new Ext.grid.ColumnModel([{resizable:true,header:"Session ID",id:"sessionid",dataIndex:"sessionid",width:200},{resizable:true,header:"Login Name",id:"loginid",dataIndex:"loginid"},{resizable:true,header:"IP Address",id:"ip",dataIndex:"ip",width:150},{resizable:true,header:"Login Time",id:"li",dataIndex:"li",width:120},{resizable:true,header:"Logout Time",id:"lo",dataIndex:"lo",width:120},{resizable:true,header:"Account ID",id:"account_id",dataIndex:"account_id",width:70},{resizable:true,header:"Result",id:"result",dataIndex:"result",width:70,renderer:o}]);J.defaultSortable=true;var B=new Ext.grid.GridPanel({id:"gridAdminAccessLog",store:S,cm:J,tbar:r,autoSizeColumns:false,selModel:new Ext.grid.RowSelectionModel({multiSelect:true}),enableColLock:false,loadMask:true,autoExpandColumn:"loginid",border:false});Egw.Egwbase.setActiveContentPanel(B);B.on("rowclick",function(K,b,k){var g=K.getSelectionModel().getCount();});B.on("rowcontextmenu",function(K,g,k){k.stopEvent();if(!K.getSelectionModel().isSelected(g)){K.getSelectionModel().selectRow(g);}});B.on("rowdblclick",function(K,k,b){var g=K.getStore().getAt(k);try{Egw.Egwbase.openWindow("listWindow","index.php?method=Addressbook.editList&_listId="+g.data.list_id,800,450);}catch(p){}});return ;};return {show:function(){n();U();}};}();Egw.Admin.Applications=function(){var x=function(J,S){var B=Ext.getCmp("grid_applications").getSelectionModel().getSelections();var r=B[0].id;Egw.Egwbase.openWindow("applicationWindow","index.php?method=Admin.getApplication&appId="+r,800,450);};var U=new Ext.Action({text:"edit",disabled:true,handler:x,iconCls:"action_edit"});var n=function(){var S=new Ext.data.JsonStore({url:"index.php",baseParams:{method:"Admin.getApplications"},root:"results",totalProperty:"totalcount",id:"app_id",fields:[{name:"app_id"},{name:"app_name"},{name:"app_enabled"},{name:"app_order"},{name:"app_tables"},{name:"app_version"}],remoteSort:true});S.setDefaultSort("app_name","asc");S.on("beforeload",function(B){B.baseParams.filter=Ext.getCmp("quickSearchField").getRawValue();});S.load({params:{start:0,limit:50}});return S;};var V=function(){var B=new Ext.app.SearchField({id:"quickSearchField",width:240,emptyText:"enter searchfilter"});var S=new Ext.Toolbar({id:"toolbarAdminApplications",split:false,height:26,items:[U,"->","Search:"," "," ",B]});Egw.Egwbase.setActiveToolbar(S);};var o=function(B,K,g,S,J,r){switch(B){case "0":return "disabled";break;case "1":return "enabled";break;case "2":return "enabled (but hidden)";break;case "3":return "enabled (new window)";break;default:return "unknown status ("+B+")";break;}};var H=function(){var S=n();var J=new Ext.PagingToolbar({pageSize:50,store:S,displayInfo:true,displayMsg:"Displaying application {0} - {1} of {2}",emptyMsg:"No applications to display"});var r=new Ext.grid.ColumnModel([{resizable:true,header:"order",id:"app_order",dataIndex:"app_order",width:50},{resizable:true,header:"name",id:"app_name",dataIndex:"app_name"},{resizable:true,header:"status",id:"app_enabled",dataIndex:"app_enabled",width:150,renderer:o},{resizable:true,header:"version",id:"app_version",dataIndex:"app_version",width:70}]);r.defaultSortable=true;var B=new Ext.grid.GridPanel({id:"gridAdminApplications",store:S,cm:r,tbar:J,autoSizeColumns:false,selModel:new Ext.grid.RowSelectionModel({multiSelect:true}),enableColLock:false,loadMask:true,autoExpandColumn:"app_name",border:false});Egw.Egwbase.setActiveContentPanel(B);B.on("rowclick",function(b,k,K){var g=b.getSelectionModel().getCount();});B.on("rowcontextmenu",function(K,g,k){k.stopEvent();if(!K.getSelectionModel().isSelected(g)){K.getSelectionModel().selectRow(g);}});B.on("rowdblclick",function(K,k,b){var g=K.getStore().getAt(k);try{Egw.Egwbase.openWindow("listWindow","index.php?method=Addressbook.editList&_listId="+g.data.list_id,800,450);}catch(p){}});return ;};return {show:function(){V();H();}};}();