Ext.namespace("Egw.Addressbook");Egw.Addressbook=function(){var G;var D;var F;var S=function(V){V.baseParams.filter=Ext.getCmp("quickSearchField").getRawValue();};var N=function(d,V){I("contactWindow","index.php?method=Addressbook.editContact&_contactId=",850,600);};var s=function(d,V){I("listWindow","index.php?method=Addressbook.editList&_listId=",450,600);};var t=function(T,V){var K=Array();var r=D.getSelectionModel().getSelections();for(var d=0;d<r.length;++d){K.push(r[d].id);}K=Ext.util.JSON.encode(K);Ext.Ajax.request({url:"index.php",params:{method:"Addressbook.deleteContacts",_contactIds:K},text:"Deleting contact...",success:function(k,q){G.reload();},failure:function(q,k){Ext.MessageBox.alert("Failed","Some error occured while trying to delete the conctact.");}});};var u=function(r,V){var K=D.getSelectionModel().getSelections();var d=K[0].id;if(K[0].data.contact_tid=="l"){I("listWindow","index.php?method=Addressbook.editList&_listId="+d,450,600);}else{I("contactWindow","index.php?method=Addressbook.editContact&_contactId="+d,850,600);}};var Y=function(V,d){G.reload();};var Z=new Ext.Action({text:"add contact",handler:N,iconCls:"action_addContact"});var O=new Ext.Action({text:"add list",handler:s,iconCls:"action_addList"});var Q=new Ext.Action({text:"edit",disabled:true,handler:u,iconCls:"action_edit"});var c=new Ext.Action({text:"delete",disabled:true,handler:t,iconCls:"action_delete"});var a=function(){var d=Ext.getCmp("north-panel");var K=Ext.getCmp("applicationToolbar");d.remove(K);var r=new Ext.app.SearchField({id:"quickSearchField",width:240,emptyText:"enter searchfilter"});r.on("change",Y);var V=new Ext.Toolbar({region:"south",id:"applicationToolbar",split:false,height:26,items:[Z,O,Q,c,"->","Search:"," "," ",r]});d.add(V);d.doLayout();return ;};var l=function(){var K=new Ext.tree.TreeLoader({dataUrl:"index.php"});K.on("beforeload",function(T,r){T.baseParams.method="Addressbook.getSubTree";T.baseParams.node=r.id;T.baseParams.datatype=r.attributes.datatype;T.baseParams.owner=r.attributes.owner;T.baseParams.location="mainTree";},this);var d=new Ext.tree.TreePanel({title:"Contacts",id:"contacts-tree",loader:K,rootVisible:false,border:false});var V=new Ext.tree.TreeNode({text:"root",draggable:false,allowDrop:false,id:"root"});d.setRootNode(V);for(i=0;i<initialTree.length;i++){V.appendChild(new Ext.tree.AsyncTreeNode(initialTree[i]));}d.on("click",function(T,r){Q.setDisabled(true);c.setDisabled(true);switch(T.attributes.dataPanelType){case "contacts":if(F!=T.attributes.dataPanelType){C(T);z();F=T.attributes.dataPanelType;}else{G.baseParams=v(T);G.load({params:{start:0,limit:50}});}break;case "lists":if(F!=T.attributes.dataPanelType){P(T);E();F=T.attributes.dataPanelType;}else{G.baseParams=o(T);G.load({params:{start:0,limit:50}});}break;}},this);d.on("beforeexpand",function(r){a();if(r.getSelectionModel().getSelectedNode()==null){r.expandPath("/root/alllists");r.selectPath("/root/addressbook");}},this);return d;};var o=function(V){return {method:V.attributes.jsonMethod,owner:V.attributes.owner,datatype:V.attributes.datatype};};var P=function(V){G=new Ext.data.JsonStore({url:"index.php",baseParams:o(V),root:"results",totalProperty:"totalcount",id:"list_id",fields:[{name:"list_id"},{name:"list_name"},{name:"list_owner"}],remoteSort:true});G.setDefaultSort("list_name","asc");G.on("beforeload",S);G.load({params:{start:0,limit:50}});};var v=function(V){switch(V.attributes.datatype){case "listMembers":var d={method:V.attributes.jsonMethod,owner:V.attributes.owner,listId:V.attributes.listId,datatype:V.attributes.datatype};break;default:var d={method:V.attributes.jsonMethod,owner:V.attributes.owner,datatype:V.attributes.datatype};break;}return d;};var C=function(V){G=new Ext.data.JsonStore({url:"index.php",baseParams:v(V),root:"results",totalProperty:"totalcount",id:"contact_id",fields:[{name:"contact_id"},{name:"contact_tid"},{name:"contact_owner"},{name:"contact_private"},{name:"cat_id"},{name:"n_family"},{name:"n_given"},{name:"n_middle"},{name:"n_prefix"},{name:"n_suffix"},{name:"n_fn"},{name:"n_fileas"},{name:"contact_bday"},{name:"org_name"},{name:"org_unit"},{name:"contact_title"},{name:"contact_role"},{name:"contact_assistent"},{name:"contact_room"},{name:"adr_one_street"},{name:"adr_one_street2"},{name:"adr_one_locality"},{name:"adr_one_region"},{name:"adr_one_postalcode"},{name:"adr_one_countryname"},{name:"contact_label"},{name:"adr_two_street"},{name:"adr_two_street2"},{name:"adr_two_locality"},{name:"adr_two_region"},{name:"adr_two_postalcode"},{name:"adr_two_countryname"},{name:"tel_work"},{name:"tel_cell"},{name:"tel_fax"},{name:"tel_assistent"},{name:"tel_car"},{name:"tel_pager"},{name:"tel_home"},{name:"tel_fax_home"},{name:"tel_cell_private"},{name:"tel_other"},{name:"tel_prefer"},{name:"contact_email"},{name:"contact_email_home"},{name:"contact_url"},{name:"contact_url_home"},{name:"contact_freebusy_uri"},{name:"contact_calendar_uri"},{name:"contact_note"},{name:"contact_tz"},{name:"contact_geo"},{name:"contact_pubkey"},{name:"contact_created"},{name:"contact_creator"},{name:"contact_modified"},{name:"contact_modifier"},{name:"contact_jpegphoto"},{name:"account_id"}],remoteSort:true});G.setDefaultSort("n_family","asc");G.on("beforeload",S);G.load({params:{start:0,limit:50}});};var E=function(){var V=Ext.getCmp("center-panel");if(V.items){for(var d=0;d<V.items.length;d++){V.remove(V.items.get(d));}}var K=new Ext.PagingToolbar({pageSize:50,store:G,displayInfo:true,displayMsg:"Displaying contacts {0} - {1} of {2}",emptyMsg:"No contacts to display"});var r=new Ext.grid.ColumnModel([{resizable:true,header:"List name",id:"list_name",dataIndex:"list_name"}]);r.defaultSortable=true;D=new Ext.grid.GridPanel({store:G,cm:r,tbar:K,autoSizeColumns:false,selModel:new Ext.grid.RowSelectionModel({multiSelect:true}),enableColLock:false,autoExpandColumn:"list_name",border:false});V.add(D);V.show();V.doLayout();D.on("rowclick",function(L,k,q){var T=D.getSelectionModel().getCount();if(T<1){Q.setDisabled(true);c.setDisabled(true);}else{if(T==1){Q.setDisabled(false);c.setDisabled(false);}else{Q.setDisabled(true);c.setDisabled(false);}}});D.on("rowcontextmenu",function(q,T,k){k.stopEvent();if(!q.getSelectionModel().isSelected(T)){q.getSelectionModel().selectRow(T);Q.setDisabled(false);c.setDisabled(false);}B.showAt(k.getXY());});D.on("rowdblclick",function(q,k,L){var T=q.getStore().getAt(k);if(T.data.contact_tid=="l"){try{I("listWindow","index.php?method=Addressbook.editList&_listId="+T.data.contact_id,450,600);}catch(m){}}else{try{I("contactWindow","index.php?method=Addressbook.editContact&_contactId="+T.data.contact_id,850,600);}catch(m){}}});return ;};var z=function(){var V=Ext.getCmp("center-panel");if(V.items){for(var d=0;d<V.items.length;d++){V.remove(V.items.get(d));}}var K=new Ext.PagingToolbar({pageSize:25,store:G,displayInfo:true,displayMsg:"Displaying contacts {0} - {1} of {2}",emptyMsg:"No contacts to display"});var r=new Ext.grid.ColumnModel([{resizable:true,id:"contact_tid",header:"Type",dataIndex:"contact_tid",width:30,renderer:j},{resizable:true,id:"n_family",header:"Family name",dataIndex:"n_family"},{resizable:true,id:"n_given",header:"Given name",dataIndex:"n_given",width:80},{resizable:true,id:"n_fn",header:"Full name",dataIndex:"n_fn",hidden:true},{resizable:true,id:"n_fileas",header:"Name + Firm",dataIndex:"n_fileas",hidden:true},{resizable:true,id:"contact_email",header:"eMail",dataIndex:"contact_email",width:150,hidden:false},{resizable:true,id:"contact_bday",header:"Birthday",dataIndex:"contact_bday",hidden:true},{resizable:true,id:"org_name",header:"Organisation",dataIndex:"org_name",width:150},{resizable:true,id:"org_unit",header:"Unit",dataIndex:"org_unit",hidden:true},{resizable:true,id:"contact_title",header:"Title",dataIndex:"contact_title",hidden:true},{resizable:true,id:"contact_role",header:"Role",dataIndex:"contact_role",hidden:true},{resizable:true,id:"contact_room",header:"Room",dataIndex:"contact_room",hidden:true},{resizable:true,id:"adr_one_street",header:"Street",dataIndex:"adr_one_street",hidden:true},{resizable:true,id:"adr_one_locality",header:"Locality",dataIndex:"adr_one_locality",width:80,hidden:false},{resizable:true,id:"adr_one_region",header:"Region",dataIndex:"adr_one_region",hidden:true},{resizable:true,id:"adr_one_postalcode",header:"Postalcode",dataIndex:"adr_one_postalcode",hidden:true},{resizable:true,id:"adr_one_countryname",header:"Country",dataIndex:"adr_one_countryname",hidden:true},{resizable:true,id:"adr_two_street",header:"Street (private)",dataIndex:"adr_two_street",hidden:true},{resizable:true,id:"adr_two_locality",header:"Locality (private)",dataIndex:"adr_two_locality",hidden:true},{resizable:true,id:"adr_two_region",header:"Region (private)",dataIndex:"adr_two_region",hidden:true},{resizable:true,id:"adr_two_postalcode",header:"Postalcode (private)",dataIndex:"adr_two_postalcode",hidden:true},{resizable:true,id:"adr_two_countryname",header:"Country (private)",dataIndex:"adr_two_countryname",hidden:true},{resizable:true,id:"tel_work",header:"Phone",dataIndex:"tel_work",hidden:false},{resizable:true,id:"tel_cell",header:"Cellphone",dataIndex:"tel_cell",hidden:false},{resizable:true,id:"tel_fax",header:"Fax",dataIndex:"tel_fax",hidden:true},{resizable:true,id:"tel_car",header:"Car phone",dataIndex:"tel_car",hidden:true},{resizable:true,id:"tel_pager",header:"Pager",dataIndex:"tel_pager",hidden:true},{resizable:true,id:"tel_home",header:"Phone (private)",dataIndex:"tel_home",hidden:true},{resizable:true,id:"tel_fax_home",header:"Fax (private)",dataIndex:"tel_fax_home",hidden:true},{resizable:true,id:"tel_cell_private",header:"Cellphone (private)",dataIndex:"tel_cell_private",hidden:true},{resizable:true,id:"contact_email_home",header:"eMail (private)",dataIndex:"contact_email_home",hidden:true},{resizable:true,id:"contact_url",header:"URL",dataIndex:"contact_url",hidden:true},{resizable:true,id:"contact_url_home",header:"URL (private)",dataIndex:"contact_url_home",hidden:true},{resizable:true,id:"contact_note",header:"Note",dataIndex:"contact_note",hidden:true},{resizable:true,id:"contact_tz",header:"Timezone",dataIndex:"contact_tz",hidden:true},{resizable:true,id:"contact_geo",header:"Geo",dataIndex:"contact_geo",hidden:true}]);r.defaultSortable=true;D=new Ext.grid.GridPanel({store:G,cm:r,tbar:K,autoSizeColumns:false,selModel:new Ext.grid.RowSelectionModel({multiSelect:true}),enableColLock:false,autoExpandColumn:"n_family",border:false});V.add(D);V.show();V.doLayout();D.on("rowclick",function(q,L,k){var T=q.getSelectionModel().getCount();if(T<1){Q.setDisabled(true);c.setDisabled(true);}else{if(T==1){Q.setDisabled(false);c.setDisabled(false);}else{Q.setDisabled(true);c.setDisabled(false);}}});D.on("rowcontextmenu",function(q,T,k){k.stopEvent();if(!q.getSelectionModel().isSelected(T)){q.getSelectionModel().selectRow(T);Q.setDisabled(false);c.setDisabled(false);}B.showAt(k.getXY());});D.on("rowdblclick",function(q,k,L){var T=q.getStore().getAt(k);if(T.data.contact_tid=="l"){try{I("listWindow","index.php?method=Addressbook.editList&_listId="+T.data.contact_id,450,600);}catch(m){}}else{try{I("contactWindow","index.php?method=Addressbook.editContact&_contactId="+T.data.contact_id,850,600);}catch(m){}}});return ;};var j=function(r,q,K,V,d,T){switch(r){case "l":return "<img src='images/oxygen/16x16/actions/users.png' width='12' height='12' alt='list'/>";default:return "<img src='images/oxygen/16x16/actions/user.png' width='12' height='12' alt='contact'/>";}};var B=new Ext.menu.Menu({id:"ctxMenuAddress",items:[Q,c,"-",Z,O]});var p=function(d,V){};var I=function(d,k,V,q){if(document.all){w=document.body.clientWidth;h=document.body.clientHeight;x=window.screenTop;y=window.screenLeft;}else{if(window.innerWidth){w=window.innerWidth;h=window.innerHeight;x=window.screenX;y=window.screenY;}}var T=((w-V)/2)+y;var r=((h-q)/2)+x;var K=window.open(k,d,"width="+V+",height="+q+",top="+r+",left="+T+",directories=no,toolbar=no,location=no,menubar=no,scrollbars=no,status=no,resizable=no,dependent=no");return K;};var n=function(L,K){var d;var M=1024,k=786;var r=850,m=600;if(K=="list"){r=450,m=600;}if(document.all){M=document.body.clientWidth;k=document.body.clientHeight;x=window.screenTop;y=window.screenLeft;}else{if(window.innerWidth){M=window.innerWidth;k=window.innerHeight;x=window.screenX;y=window.screenY;}}var T=((M-r)/2)+y,q=((k-m)/2)+x;if(K=="list"&&!L){d="index.php?method=Addressbook.editList";}else{if(K=="list"&&L){d="index.php?method=Addressbook.editList&contactid="+L;}else{if(K!="list"&&L){d="index.php?method=Addressbook.editContact&contactid="+L;}else{d="index.php?method=Addressbook.editContact";}}}appId="addressbook";var V=window.open(d,"popupname","width="+r+",height="+m+",top="+q+",left="+T+",directories=no,toolbar=no,location=no,menubar=no,scrollbars=no,status=no,resizable=no,dependent=no");return ;};var A=function(V){V=(V==null)?false:V;window.opener.Egw.Addressbook.reload();if(V==true){window.setTimeout("window.close()",400);}};var X=function(r){if(!K){var K=new Ext.Window({title:"please select addressbook",modal:true,width:375,height:400,minWidth:375,minHeight:400,layout:"fit",plain:true,bodyStyle:"padding:5px;",buttonAlign:"center"});var T=Ext.tree;treeLoader=new T.TreeLoader({dataUrl:"index.php"});treeLoader.on("beforeload",function(k,q){k.baseParams.method="Addressbook.getSubTree";k.baseParams._node=q.id;k.baseParams._datatype=q.attributes.datatype;k.baseParams._owner=q.attributes.owner;k.baseParams._location="selectFolder";},this);var V=new T.TreePanel({animate:true,id:"addressbookTree",loader:treeLoader,containerScroll:true,rootVisible:false});var d=new T.TreeNode({text:"root",draggable:false,allowDrop:false,id:"root"});V.setRootNode(d);Ext.each(application,function(q){d.appendChild(new T.AsyncTreeNode(q));});V.on("click",function(L){L.select();if(V.getSelectionModel().getSelectedNode()){var m=V.getSelectionModel().getSelectedNode().id;var k=V.getNodeById(m).attributes.owner;if((k>0)||(k<0)){var q=Ext.getCmp("addressbook_");q.setValue(k);K.hide();}else{Ext.MessageBox.alert("wrong selection","please select a valid addressbook");}}else{Ext.MessageBox.alert("no selection","please select an addressbook");}});K.add(V);K.show();}};return {show:function(V){a();_showContactTree();_showContactGrid(V);},displayAddressbookSelectDialog:X,getPanel:l,reload:function(){G.reload();}};}();Egw.Addressbook.ContactEditDialog=function(){var o;var z;var S;var B=function(F,X){var P=Ext.getCmp("contactDialog").getForm();P.render();if(P.isValid()){var C={};if(formData.values){C.contact_id=formData.values.contact_id;}P.submit({waitTitle:"Please wait!",waitMsg:"saving contact...",params:C,success:function(l,E,Y){window.opener.Egw.Addressbook.reload();},failure:function(l,E){}});}else{Ext.MessageBox.alert("Errors","Please fix the errors noted.");}};var n=function(F,X){var P=Ext.getCmp("contactDialog").getForm();P.render();if(P.isValid()){var C={};if(formData.values){C.contact_id=formData.values.contact_id;}P.submit({waitTitle:"Please wait!",waitMsg:"saving contact...",params:C,success:function(l,E,Y){window.opener.Egw.Addressbook.reload();window.setTimeout("window.close()",400);},failure:function(l,E){}});}else{Ext.MessageBox.alert("Errors","Please fix the errors noted.");}};var a=function(C,P){var X=Ext.util.JSON.encode([formData.values.contact_id]);Ext.Ajax.request({url:"index.php",params:{method:"Addressbook.deleteContacts",_contactIds:X},text:"Deleting contact...",success:function(l,F){window.opener.Egw.Addressbook.reload();window.setTimeout("window.close()",400);},failure:function(F,l){Ext.MessageBox.alert("Failed","Some error occured while trying to delete the conctact.");}});};var u=new Ext.Action({text:"save and close",handler:n,iconCls:"action_saveAndClose"});var G=new Ext.Action({text:"apply changes",handler:B,iconCls:"action_applyChanges"});var p=new Ext.Action({text:"delete contact",handler:a,iconCls:"action_delete"});var N=function(){Ext.QuickTips.init();Ext.form.Field.prototype.msgTarget="side";var P=true;if(formData.values){P=false;}var E=new Ext.Toolbar({region:"south",id:"applicationToolbar",split:false,height:26,items:[u,G,p]});var d=new Ext.data.JsonStore({url:"index.php",baseParams:{method:"Egwbase.getCountryList"},root:"results",id:"shortName",fields:["shortName","translatedName"],remoteSort:false});var K=new Ext.form.TriggerField({fieldLabel:"Addressbook",name:"contact_owner",id:"addressbook_",anchor:"95%",readOnly:true});K.onTriggerClick=function(){Egw.Addressbook.displayAddressbookSelectDialog(Q);};var Y=function(r){r.baseParams.method="Addressbook.getContacts";r.baseParams.options=Ext.encode({displayContacts:false,displayLists:true});};var l=[["AL","Alabama"],["AK","Alaska"],["AZ","Arizona"],["WV","West Virginia"],["WI","Wisconsin"],["WY","Wyoming"]];var I=new Ext.data.SimpleStore({fields:["contact_id","contact_tid"],data:l});var s=new Ext.data.SimpleStore({fields:["contact_id","contact_tid"]});var c=new Ext.DataView({style:"overflow:auto",multiSelect:true,id:"list_source_",cls:"x-list-small",selectedClass:"x-list-selected",itemSelector:"div.x-view",store:I,tpl:new Ext.XTemplate("<tpl for=\".\">","<div class=\"x-view\" id=\"{contact_id}\">{contact_tid}</div>","</tpl>")});function Z(T,r){return T-r;}var C=function(k,M,L,q){var M=Ext.getCmp("list_source_");var T=String(M.getSelectedIndexes());var m=M.getSelectionCount();if(M.getSelectionCount()>"1"){var b=T.split(",");}else{if(M.getSelectionCount()=="1"){var b=new Array(T);}}b.sort(Z);b.reverse();for(i=0;i<m;i++){var r=I.getAt(b[i]);s.add(r);}s.sort("contact_tid","ASC");for(i=0;i<m;i++){var r=I.getAt(b[i]);I.remove(r);}I.sort("contact_tid","ASC");};var F=function(k,M,L,q){var M=Ext.getCmp("list_selected_");var T=String(M.getSelectedIndexes());var m=M.getSelectionCount();if(M.getSelectionCount()>"1"){var b=T.split(",");}else{if(M.getSelectionCount()=="1"){var b=new Array(T);}}b.sort(Z);b.reverse();for(i=0;i<m;i++){var r=s.getAt(b[i]);I.add(r);}I.sort("contact_tid","ASC");for(i=0;i<m;i++){var r=s.getAt(b[i]);s.remove(r);}s.sort("contact_tid","ASC");};c.on("dblclick",C);var D=new Ext.DataView({style:"overflow:auto",multiSelect:true,id:"list_selected_",cls:"x-list-small",selectedClass:"x-list-selected",itemSelector:"div.x-view",store:s,tpl:new Ext.XTemplate("<tpl for=\".\">","<div class=\"x-view\" id=\"{contact_id}\">{contact_tid}</div>","</tpl>")});D.on("dblclick",F);var j=new Ext.Panel({id:"list_source",title:"available lists",region:"center",margins:"5 5 5 0",layout:"fit",items:c});var A=new Ext.Panel({id:"list_selected",title:"chosen lists",region:"center",margins:"5 5 5 0",layout:"fit",items:D});var O=new Ext.FormPanel({url:"index.php",baseParams:{method:"Addressbook.saveContact"},labelAlign:"top",bodyStyle:"padding:5px",anchor:"100%",region:"center",id:"contactDialog",tbar:E,deferredRender:false,items:[{layout:"column",border:false,deferredRender:false,anchor:"100%",items:[{columnWidth:0.4,layout:"form",border:false,items:[{xtype:"textfield",fieldLabel:"First Name",name:"n_given",anchor:"95%"},{xtype:"textfield",fieldLabel:"Middle Name",name:"n_middle",anchor:"95%"},{xtype:"textfield",fieldLabel:"Last Name",name:"n_family",allowBlank:false,anchor:"95%"}]},{columnWidth:0.2,layout:"form",border:false,items:[{xtype:"textfield",fieldLabel:"Prefix",name:"n_prefix",anchor:"95%"},{xtype:"textfield",fieldLabel:"Suffix",name:"n_suffix",anchor:"95%"},K]},{columnWidth:0.4,layout:"form",border:false,items:[{xtype:"textarea",name:"contact_note",fieldLabel:"Notes",grow:false,preventScrollbars:false,anchor:"95% 85%"}]}]},{xtype:"tabpanel",plain:true,activeTab:0,deferredRender:false,anchor:"100% 70%",defaults:{bodyStyle:"padding:10px"},items:[{title:"Business information",layout:"column",deferredRender:false,border:false,items:[{columnWidth:0.333,layout:"form",border:false,items:[{xtype:"textfield",fieldLabel:"Company",name:"org_name",anchor:"95%"},{xtype:"textfield",fieldLabel:"Street",name:"adr_one_street",anchor:"95%"},{xtype:"textfield",fieldLabel:"Street 2",name:"adr_one_street2",anchor:"95%"},{xtype:"textfield",fieldLabel:"Postalcode",name:"adr_one_postalcode",anchor:"95%"},{xtype:"textfield",fieldLabel:"City",name:"adr_one_locality",anchor:"95%"},{xtype:"textfield",fieldLabel:"Region",name:"adr_one_region",anchor:"95%"},new Ext.form.ComboBox({fieldLabel:"Country",name:"adr_one_countryname",hiddenName:"adr_one_countryname",store:d,displayField:"translatedName",valueField:"shortName",typeAhead:true,mode:"remote",triggerAction:"all",emptyText:"Select a state...",selectOnFocus:true,anchor:"95%"})]},{columnWidth:0.333,layout:"form",border:false,items:[{xtype:"textfield",fieldLabel:"Phone",name:"tel_work",anchor:"95%"},{xtype:"textfield",fieldLabel:"Cellphone",name:"tel_cell",anchor:"95%"},{xtype:"textfield",fieldLabel:"Fax",name:"tel_fax",anchor:"95%"},{xtype:"textfield",fieldLabel:"Car phone",name:"tel_car",anchor:"95%"},{xtype:"textfield",fieldLabel:"Pager",name:"tel_pager",anchor:"95%"},{xtype:"textfield",fieldLabel:"Email",name:"contact_email",vtype:"email",anchor:"95%"},{xtype:"textfield",fieldLabel:"URL",name:"contact_url",vtype:"url",anchor:"95%"}]},{columnWidth:0.333,layout:"form",border:false,items:[{xtype:"textfield",fieldLabel:"Unit",name:"org_unit",anchor:"95%"},{xtype:"textfield",fieldLabel:"Role",name:"contact_role",anchor:"95%"},{xtype:"textfield",fieldLabel:"Title",name:"contact_title",anchor:"95%"},{xtype:"textfield",fieldLabel:"Room",name:"contact_room",anchor:"95%"},{xtype:"textfield",fieldLabel:"Name Assistent",name:"contact_assistent",anchor:"95%"},{xtype:"textfield",fieldLabel:"Phone Assistent",name:"tel_assistent",anchor:"95%"}]}]},{title:"Private information",layout:"column",deferredRender:false,border:false,items:[{columnWidth:0.333,layout:"form",border:false,items:[{xtype:"textfield",fieldLabel:"Street",name:"adr_two_street",anchor:"95%"},{xtype:"textfield",fieldLabel:"Street2",name:"adr_two_street2",anchor:"95%"},{xtype:"textfield",fieldLabel:"Postalcode",name:"adr_two_postalcode",anchor:"95%"},{xtype:"textfield",fieldLabel:"City",name:"adr_two_locality",anchor:"95%"},{xtype:"textfield",fieldLabel:"Region",name:"adr_two_region",anchor:"95%"},new Ext.form.ComboBox({fieldLabel:"Country",name:"adr_two_countryname",hiddenName:"adr_two_countryname",store:d,displayField:"translatedName",valueField:"shortName",typeAhead:true,mode:"remote",triggerAction:"all",emptyText:"Select a state...",selectOnFocus:true,anchor:"95%"})]},{columnWidth:0.333,layout:"form",border:false,items:[new Ext.form.DateField({fieldLabel:"Birthday",name:"contact_bday",format:formData.config.dateFormat,altFormats:"Y-m-d",anchor:"95%"}),{xtype:"textfield",fieldLabel:"Phone",name:"tel_home",anchor:"95%"},{xtype:"textfield",fieldLabel:"Cellphone",name:"tel_cell_private",anchor:"95%"},{xtype:"textfield",fieldLabel:"Fax",name:"tel_fax_home",anchor:"95%"},{xtype:"textfield",fieldLabel:"Email",name:"contact_email_home",vtype:"email",anchor:"95%"},{xtype:"textfield",fieldLabel:"URL",name:"contact_url_home",vtype:"url",anchor:"95%"}]},{columnWidth:0.333,layout:"form",border:false,items:[new Ext.form.FieldSet({id:"photo",legend:"Photo"})]}]},{title:"Lists",layout:"column",deferredRender:false,border:false,items:[{columnWidth:0.333,layout:"form",border:false,items:[new Ext.Panel({layout:"fit",id:"source",width:250,height:350,items:[j]})]},{columnWidth:0.333,layout:"form",border:false,extraCls:"list-butons",items:[new Ext.Button({text:"add",iconCls:"blist",minWidth:80,handler:C,icon:"images/oxygen/16x16/actions/arrow-right-double.png"}),new Ext.Button({text:"remove",iconCls:"blist",minWidth:80,handler:F,icon:"images/oxygen/16x16/actions/arrow-left-double.png"})]},{columnWidth:0.333,layout:"form",border:false,items:[new Ext.Panel({layout:"fit",id:"destination",width:250,height:350,items:[A]})]}]},{title:"Categories",layout:"column",deferredRender:false,border:false,items:[{}]}]}]});var V=new Ext.Viewport({layout:"border",items:O});var X=new Ext.data.SimpleStore({fields:["id","addressbooks"],data:formData.config.addressbooks});return ;};var v=function(P,F){var C=Ext.getCmp("contactDialog").getForm();for(var l in F){var X=C.findField(l);if(X){X.setValue(F[l]);}}};var t=function(X,P){Ext.MessageBox.alert("Export","Not yet implemented.");};var Q=function(P,C){var X=Ext.getCmp("addressbook_");X.setValue(C);};return {display:function(){var P=N();if(formData.values){v(P,formData.values);}}};}();Egw.Addressbook.ListEditDialog=function(){var t;var B=function(C,P){var G=Ext.getCmp("listDialog").getForm();if(G.isValid()){var X={listId:"",listMembers:"",};if(formData.values&&formData.values.list_id){X.listId=formData.values.list_id;}G.submit({waitTitle:"Please wait!",waitMsg:"saving contact...",params:X,success:function(F,l,E){window.opener.Egw.Addressbook.reload();},failure:function(F,l){}});}else{Ext.MessageBox.alert("Errors","Please fix the errors noted.");}};var n=function(C,P){var G=Ext.getCmp("listDialog").getForm();if(G.isValid()){var X={};if(formData.values){X.contact_id=formData.values.contact_id;}G.submit({waitTitle:"Please wait!",waitMsg:"saving contact...",params:X,success:function(F,l,E){window.opener.Egw.Addressbook.reload();window.setTimeout("window.close()",400);},failure:function(F,l){}});}else{Ext.MessageBox.alert("Errors","Please fix the errors noted.");}};var o=function(X,G){var P=Ext.util.JSON.encode([formData.values.contact_id]);Ext.Ajax.request({url:"index.php",params:{method:"Addressbook.deleteLists",_contactIds:P},text:"Deleting contact...",success:function(F,C){window.opener.Egw.Addressbook.reload();window.setTimeout("window.close()",400);},failure:function(C,F){Ext.MessageBox.alert("Failed","Some error occured while trying to delete the conctact.");}});};var z=new Ext.Action({text:"save and close",handler:n,iconCls:"action_saveAndClose"});var v=new Ext.Action({text:"apply changes",handler:B,iconCls:"action_applyChanges"});var S=new Ext.Action({text:"delete list",text:"delete list",handler:o,iconCls:"action_delete"});var a=function(){Ext.QuickTips.init();Ext.form.Field.prototype.msgTarget="side";var c=true;if(formData.values){c=false;}var Z=new Ext.Toolbar({region:"south",id:"applicationToolbar",split:false,height:26,items:[z,v,S]});var s=new Ext.data.SimpleStore({fields:["id","addressbooks"],data:formData.config.addressbooks});var l=new Ext.form.TriggerField({fieldLabel:"Addressbook",id:"addressbook_",name:"list_owner",anchor:"100%",readOnly:true});l.onTriggerClick=function(){Egw.Addressbook.displayAddressbookSelectDialog(p);};searchDS=new Ext.data.JsonStore({url:"index.php",baseParams:{method:"Addressbook.getOverview",options:"{\"displayContacts\":true,\"displayLists\":false}"},root:"results",totalProperty:"totalcount",id:"contact_id",fields:[{name:"contact_id"},{name:"n_family"},{name:"n_given"},{name:"contact_email"}],remoteSort:true});searchDS.setDefaultSort("n_family","asc");var F=new Ext.form.ComboBox({store:searchDS,fieldLabel:"Search for new list members",displayField:"n_family",typeAhead:false,loadingText:"Searching...",anchor:"100%",pageSize:10,hideTrigger:true,itemSelector:"div.search-item",tpl:new Ext.XTemplate("<tpl for=\".\">","<div class=\"search-item\">{n_family}, {n_given} {contact_email}</div>","</tpl>")});F.on("select",function(V,A,j){var D=new C({contact_id:A.data.contact_id,n_family:A.data.n_family,contact_email:A.data.contact_email});G.add(D);G.sort("n_family");F.reset();F.collapse();});F.on("specialkey",function(T,D){if(searchDS.getCount()==0){var r=/^[a-z0-9_-]+(\.[a-z0-9_-]+)*@([0-9a-z][0-9a-z-]*[0-9a-z]\.)+([a-z]{2,4}|museum)$/;var j=r.exec(F.getValue());if(j&&(D.getKey()==D.ENTER||D.getKey()==e.RETURN)){var K=F.getValue();var A=K.indexOf("@");if(A!=-1){var d=Ext.util.Format.capitalize(K.substr(0,A));}else{var d=K;}var V=new C({contact_id:"-1",n_family:d,contact_email:K});G.add(V);G.sort("n_family");F.reset();}}});var E=new Ext.FormPanel({url:"index.php",baseParams:{method:"Addressbook.saveList"},labelAlign:"top",bodyStyle:"padding:5px",width:450,region:"center",deferredRender:false,id:"listDialog",tbar:Z,items:[{layout:"form",title:"list information",border:false,anchor:"100%",items:[l,{xtype:"textfield",fieldLabel:"List Name",name:"list_name",anchor:"100%"},{xtype:"textarea",fieldLabel:"List Description",name:"list_description",grow:false,anchor:"100%"},F]}]});var C=Ext.data.Record.create([{name:"contact_id",type:"int"},{name:"n_family",type:"string"},{name:"contact_email",type:"string"}]);if(formData.values.list_members){var P=formData.values.list_members;}else{var P=[];}var G=new Ext.data.SimpleStore({id:"list_Members",fields:["contact_id","n_family","contact_email"],data:P});G.sort("n_family","asc");var O=new Ext.grid.ColumnModel([{resizable:true,id:"n_family",header:"Family name",dataIndex:"n_family"},{resizable:true,id:"contact_email",header:"eMail address",dataIndex:"contact_email"}]);O.defaultSortable=true;var I=new Ext.menu.Menu({id:"ctxListMenu",items:[{id:"delete",text:"delete entry",icon:"images/oxygen/16x16/actions/edit-delete.png",handler:N}]});var X=new Ext.grid.GridPanel({store:G,cm:O,id:"listGrid",selModel:new Ext.grid.RowSelectionModel({multiSelect:true}),autoSizeColumns:true,monitorWindowResize:false,trackMouseOver:true,autoWidth:true,height:300,contextMenu:"ctxListMenu",autoExpandColumn:"contact_email"});X.on("rowcontextmenu",function(D,V,j){j.stopEvent();var A=D.getStore().getAt(V);if(A.data.contact_tid=="l"){I.showAt(j.getXY());}else{I.showAt(j.getXY());}});var Y=new Ext.Viewport({layout:"column",items:[E,X]});return ;};var p=function(G,P){t.setValues([{id:"list_owner",value:P}]);};var N=function(E,G){var F=Array();var C=Ext.getCmp("listGrid");var P=Ext.getCmp("list_Members");var l=C.getSelectionModel().getSelections();for(var X=0;X<l.length;++X){P.remove(l[X]);}};var u=function(G,C){var X=Ext.getCmp("listDialog").getForm();for(var F in C){var P=X.findField(F);if(P){P.setValue(C[F]);}}};var Q=function(P){var G=new Array();P.each(function(X){G.push(X.data);},this);return Ext.util.JSON.encode(G);};return {display:function(){var G=a();if(formData.values){u(G,formData.values);}}};}();