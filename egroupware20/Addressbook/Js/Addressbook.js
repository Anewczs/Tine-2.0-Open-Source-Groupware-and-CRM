Ext.namespace("Egw.Addressbook");Egw.Addressbook=function(){var Z;var t;var P;var g;var U,C,H;var p;var k=function(s){if(U){var R=U.pressed;}else{var R=true;}if(C){var J=C.pressed;}else{var J=true;}switch(p.attributes.datatype){case "list":s.baseParams.listId=p.attributes.listId;s.baseParams.method="Addressbook.getList";break;case "contacts":case "otherpeople":case "sharedaddressbooks":s.baseParams.method="Addressbook.getContacts";s.baseParams.options=Ext.encode({displayContacts:R,displayLists:J});break;case "overview":s.baseParams.method="Addressbook.getOverview";s.baseParams.options=Ext.encode({displayContacts:R,displayLists:J});break;}if(H){s.baseParams.query=H.getValue();}};var M=function(l,V){p=V;var R=l.getRegion("center",false);R.remove(0);var s=Ext.Element.get("content");var m=s.createChild({tag:"div",id:"toolbargriddiv"});var c=s.createChild({tag:"div",id:"outergriddiv"});Z=new Ext.data.JsonStore({url:"index.php",baseParams:{datatype:p.attributes.datatype,owner:p.attributes.owner,query:""},root:"results",totalProperty:"totalcount",id:"contact_id",fields:[{name:"contact_id"},{name:"contact_tid"},{name:"contact_owner"},{name:"contact_private"},{name:"cat_id"},{name:"n_family"},{name:"n_given"},{name:"n_middle"},{name:"n_prefix"},{name:"n_suffix"},{name:"n_fn"},{name:"n_fileas"},{name:"contact_bday"},{name:"org_name"},{name:"org_unit"},{name:"contact_title"},{name:"contact_role"},{name:"contact_assistent"},{name:"contact_room"},{name:"adr_one_street"},{name:"adr_one_street2"},{name:"adr_one_locality"},{name:"adr_one_region"},{name:"adr_one_postalcode"},{name:"adr_one_countryname"},{name:"contact_label"},{name:"adr_two_street"},{name:"adr_two_street2"},{name:"adr_two_locality"},{name:"adr_two_region"},{name:"adr_two_postalcode"},{name:"adr_two_countryname"},{name:"tel_work"},{name:"tel_cell"},{name:"tel_fax"},{name:"tel_assistent"},{name:"tel_car"},{name:"tel_pager"},{name:"tel_home"},{name:"tel_fax_home"},{name:"tel_cell_private"},{name:"tel_other"},{name:"tel_prefer"},{name:"contact_email"},{name:"contact_email_home"},{name:"contact_url"},{name:"contact_url_home"},{name:"contact_freebusy_uri"},{name:"contact_calendar_uri"},{name:"contact_note"},{name:"contact_tz"},{name:"contact_geo"},{name:"contact_pubkey"},{name:"contact_created"},{name:"contact_creator"},{name:"contact_modified"},{name:"contact_modifier"},{name:"contact_jpegphoto"},{name:"account_id"}],remoteSort:true});k(Z);Z.setDefaultSort("n_family","asc");Z.load({params:{start:0,limit:50}});Z.on("beforeload",k);var o=new Ext.grid.ColumnModel([{resizable:true,id:"contact_tid",header:"Type",dataIndex:"contact_tid",width:30,renderer:w},{resizable:true,id:"n_family",header:"Family name",dataIndex:"n_family"},{resizable:true,id:"n_given",header:"Given name",dataIndex:"n_given"},{resizable:true,id:"n_fn",header:"Full name",dataIndex:"n_fn",hidden:true},{resizable:true,id:"n_fileas",header:"Name + Firm",dataIndex:"n_fileas",hidden:true},{resizable:true,id:"contact_email",header:"eMail",dataIndex:"contact_email",width:150,hidden:false},{resizable:true,id:"contact_bday",header:"Birthday",dataIndex:"contact_bday",hidden:true},{resizable:true,id:"org_name",header:"Organisation",dataIndex:"org_name",width:150},{resizable:true,id:"org_unit",header:"Unit",dataIndex:"org_unit",hidden:true},{resizable:true,id:"contact_title",header:"Title",dataIndex:"contact_title",hidden:true},{resizable:true,id:"contact_role",header:"Role",dataIndex:"contact_role",hidden:true},{resizable:true,id:"contact_room",header:"Room",dataIndex:"contact_room",hidden:true},{resizable:true,id:"adr_one_street",header:"Street",dataIndex:"adr_one_street",hidden:true},{resizable:true,id:"adr_one_locality",header:"Locality",dataIndex:"adr_one_locality",hidden:false},{resizable:true,id:"adr_one_region",header:"Region",dataIndex:"adr_one_region",hidden:true},{resizable:true,id:"adr_one_postalcode",header:"Postalcode",dataIndex:"adr_one_postalcode",hidden:true},{resizable:true,id:"adr_one_countryname",header:"Country",dataIndex:"adr_one_countryname",hidden:true},{resizable:true,id:"adr_two_street",header:"Street (private)",dataIndex:"adr_two_street",hidden:true},{resizable:true,id:"adr_two_locality",header:"Locality (private)",dataIndex:"adr_two_locality",hidden:true},{resizable:true,id:"adr_two_region",header:"Region (private)",dataIndex:"adr_two_region",hidden:true},{resizable:true,id:"adr_two_postalcode",header:"Postalcode (private)",dataIndex:"adr_two_postalcode",hidden:true},{resizable:true,id:"adr_two_countryname",header:"Country (private)",dataIndex:"adr_two_countryname",hidden:true},{resizable:true,id:"tel_work",header:"Phone",dataIndex:"tel_work",hidden:false},{resizable:true,id:"tel_cell",header:"Cellphone",dataIndex:"tel_cell",hidden:false},{resizable:true,id:"tel_fax",header:"Fax",dataIndex:"tel_fax",hidden:true},{resizable:true,id:"tel_car",header:"Car phone",dataIndex:"tel_car",hidden:true},{resizable:true,id:"tel_pager",header:"Pager",dataIndex:"tel_pager",hidden:true},{resizable:true,id:"tel_home",header:"Phone (private)",dataIndex:"tel_home",hidden:true},{resizable:true,id:"tel_fax_home",header:"Fax (private)",dataIndex:"tel_fax_home",hidden:true},{resizable:true,id:"tel_cell_private",header:"Cellphone (private)",dataIndex:"tel_cell_private",hidden:true},{resizable:true,id:"contact_email_home",header:"eMail (private)",dataIndex:"contact_email_home",hidden:true},{resizable:true,id:"contact_url",header:"URL",dataIndex:"contact_url",hidden:true},{resizable:true,id:"contact_url_home",header:"URL (private)",dataIndex:"contact_url_home",hidden:true},{resizable:true,id:"contact_note",header:"Note",dataIndex:"contact_note",hidden:true},{resizable:true,id:"contact_tz",header:"Timezone",dataIndex:"contact_tz",hidden:true},{resizable:true,id:"contact_geo",header:"Geo",dataIndex:"contact_geo",hidden:true},]);o.defaultSortable=true;t=new Ext.grid.Grid(c,{ds:Z,cm:o,autoSizeColumns:false,selModel:new Ext.grid.RowSelectionModel({multiSelect:true}),enableColLock:false,loadMask:true,enableDragDrop:true,ddGroup:"TreeDD",autoExpandColumn:"n_given"});t.render();t.on("rowclick",function(W,G,z){var j=t.getSelectionModel().getCount();var B=v.items.map;if(j<1){B.editbtn.disable();B.deletebtn.disable();}else{if(j==1){B.editbtn.enable();B.deletebtn.enable();}else{B.editbtn.disable();B.deletebtn.enable();}}});t.on("rowdblclick",function(B,G,z){var j=B.getDataSource().getAt(G);if(j.data.contact_tid=="l"){try{K(j.data.contact_id,"list");}catch(W){}}else{try{K(j.data.contact_id);}catch(W){}}});t.on("rowcontextmenu",function(z,G,B){B.stopEvent();var j=z.getDataSource().getAt(G);if(j.data.contact_tid=="l"){h.showAt(B.getXY());}else{r.showAt(B.getXY());}});var a=t.getView().getHeaderPanel(true);var v=new Ext.Toolbar(m);var J=Ext.DomHelper.append(v.el,{tag:"div",id:Ext.id()},true);var Q=new Ext.PagingToolbar(J,Z,{pageSize:50,cls:"x-btn-icon-22",displayInfo:true,displayMsg:"Displaying contacts {0} - {1} of {2}",emptyMsg:"No contacts to display"});v.addButton({id:"addbtn",cls:"x-btn-icon-22",icon:"images/oxygen/22x22/actions/add-user.png",tooltip:"add new contact",handler:u});v.addButton({id:"addlstbtn",cls:"x-btn-icon-22",icon:"images/oxygen/22x22/actions/add-users.png",tooltip:"add new list",handler:D});v.addButton({id:"editbtn",cls:"x-btn-icon-22",icon:"images/oxygen/22x22/actions/edit.png",tooltip:"edit current item",disabled:true,handler:d});v.addButton({id:"deletebtn",cls:"x-btn-icon-22",icon:"images/oxygen/22x22/actions/edit-delete.png",tooltip:"delete selected items",disabled:true,handler:n});v.insertButton(4,new Ext.Toolbar.Separator());U=v.addButton({id:"filtercontactsbtn",cls:"x-btn-icon-22",icon:"images/oxygen/22x22/actions/user.png",tooltip:"display contacts",enableToggle:true,pressed:true,handler:I});C=v.addButton({id:"filterlistsbtn",cls:"x-btn-icon-22",icon:"images/oxygen/22x22/actions/users.png",tooltip:"display lists",enableToggle:true,pressed:true,handler:E});v.addButton({id:"exportbtn",cls:"x-btn-icon-22",icon:"images/oxygen/22x22/actions/file-export.png",tooltip:"export selected contacts",disabled:false,onClick:F});H=new Ext.form.TextField({height:22,width:200,emptyText:"Suchparameter ...",allowBlank:false});H.on("specialkey",function(B,j){if(j.getKey()==j.ENTER||j.getKey()==e.RETURN){Z.reload();}});v.add(new Ext.Toolbar.Fill());v.addField(H);v.add({id:"clearsearchbtn",cls:"x-btn-icon-22",icon:"images/oxygen/22x22/actions/clear-left.png",tooltip:"Lï¿½sche bestehende Sucheingabe",disabled:false,onClick:function(){H.setValue("");Z.reload();}});v.add({id:"searchbtn",cls:"x-btn-icon-22",icon:"images/oxygen/22x22/actions/mail-find.png",tooltip:"Suche Adresse/Adressliste",disabled:false,onClick:function(){Z.reload();}});R.add(new Ext.GridPanel(t,{toolbar:v}));};var w=function(v,a,J,R,s,m){switch(v){case "l":return "<img src='images/oxygen/16x16/actions/users.png' width='12' height='12' alt='list'/>";default:return "<img src='images/oxygen/16x16/actions/user.png' width='12' height='12' alt='contact'/>";}};var I=function(s,R){Z.reload();};var E=function(s,R){Z.reload();};var n=function(m,R){var J=Array();var v=t.getSelectionModel().getSelections();for(var s=0;s<v.length;++s){J.push(v[s].id);}L(J,function(){Z.reload();});Z.reload();};var d=function(v,R){var J=t.getSelectionModel().getSelections();var s=J[0].id;if(J[0].data.contact_tid=="l"){K(s,"list");}else{K(s);}};var u=function(s,R){K();};var D=function(s,R){K("","list");};var A=function(m,R){var J=Array();var v=t.getSelectionModel().getSelections();for(var s=0;s<v.length;++s){J.push(v[s].id);}L(J,function(){Egw.Addressbook.reload();});Z.reload();};var i=function(v,R){var J=t.getSelectionModel().getSelections();var s=J[0].id;K(s,"list");};var r=new Ext.menu.Menu({id:"ctxMenuAddress",items:[{id:"edit",text:"edit contact",icon:"images/oxygen/16x16/actions/edit.png",handler:d},{id:"delete",text:"delete contact",icon:"images/oxygen/16x16/actions/edit-delete.png",handler:n},"-",{id:"new contact",text:"new contact",icon:"images/oxygen/16x16/actions/add-user.png",handler:u},{id:"new list",text:"new list",icon:"images/oxygen/16x16/actions/add-users.png",handler:D}]});var h=new Ext.menu.Menu({id:"ctxMenuList",items:[{id:"edit",text:"edit list",icon:"images/oxygen/16x16/actions/edit.png",handler:i},{id:"delete",text:"delete list",icon:"images/oxygen/16x16/actions/edit-delete.png",handler:A},"-",{id:"new contact",text:"new contact",icon:"images/oxygen/16x16/actions/add-user.png",handler:u},{id:"new list",text:"new list",icon:"images/oxygen/16x16/actions/add-users.png",handler:D}]});var F=function(s,R){};var K=function(o,J){var s;var l=1024,c=786;var v=950,Q=600;if(J=="list"){v=450,Q=600;}if(document.all){l=document.body.clientWidth;c=document.body.clientHeight;x=window.screenTop;y=window.screenLeft;}else{if(window.innerWidth){l=window.innerWidth;c=window.innerHeight;x=window.screenX;y=window.screenY;}}var m=((l-v)/2)+y,a=((c-Q)/2)+x;if(J=="list"&&!o){s="index.php?method=Addressbook.editList";}else{if(J=="list"&&o){s="index.php?method=Addressbook.editList&contactid="+o;}else{if(J!="list"&&o){s="index.php?method=Addressbook.editContact&contactid="+o;}else{s="index.php?method=Addressbook.editContact";}}}appId="addressbook";var R=window.open(s,"popupname","width="+v+",height="+Q+",top="+a+",left="+m+",directories=no,toolbar=no,location=no,menubar=no,scrollbars=no,status=no,resizable=no,dependent=no");return ;};var N=function(R){R=(R==null)?false:R;window.opener.Egw.Addressbook.reload();if(R==true){window.setTimeout("window.close()",400);}};var L=function(s,R,J){var v=Ext.util.JSON.encode(s);new Ext.data.Connection().request({url:"index.php",method:"post",scope:this,params:{method:"Addressbook.deleteContacts",_contactIDs:v},success:function(a,c){var m;try{m=Ext.util.JSON.decode(a.responseText);if(m.success==true){if(typeof R=="function"){R;}}else{Ext.MessageBox.alert("Failure!","Deleting contact failed!");}}catch(o){Ext.MessageBox.alert("Failure!",o.message);}},failure:function(m,a){console.log("failure function called");}});};return {show:M,reload:function(){Z.reload();}};}();Egw.Addressbook.ContactEditDialog=function(){var F;var A;var C;var k;var u;var K=function(){Ext.QuickTips.init();Ext.form.Field.prototype.msgTarget="side";var i=new Ext.BorderLayout(document.body,{north:{split:false,initialSize:28},center:{autoScroll:true}});i.beginUpdate();i.add("north",new Ext.ContentPanel("header",{fitToFrame:true}));i.add("center",new Ext.ContentPanel("content"));i.endUpdate();var N=true;if(formData.values){N=false;}var d=new Ext.Toolbar("header");d.add({id:"savebtn",cls:"x-btn-text-icon",text:"Save and Close",icon:"images/oxygen/22x22/actions/document-save.png",tooltip:"save this contact and close window",onClick:function(){if(u.isValid()){var h={};if(formData.values){h.contact_id=formData.values.contact_id;}u.submit({waitTitle:"Please wait!",waitMsg:"saving contact...",params:h,success:function(t,w,U){window.opener.Egw.Addressbook.reload();window.setTimeout("window.close()",400);},failure:function(t,w){}});}else{Ext.MessageBox.alert("Errors","Please fix the errors noted.");}}},{id:"savebtn",cls:"x-btn-icon-22",icon:"images/oxygen/22x22/actions/save-all.png",tooltip:"apply changes for this contact",onClick:function(){if(u.isValid()){var h={};if(formData.values){h.contact_id=formData.values.contact_id;}u.submit({waitTitle:"Please wait!",waitMsg:"saving contact...",params:h,success:function(t,w,U){window.opener.Egw.Addressbook.reload();},failure:function(t,w){}});}else{Ext.MessageBox.alert("Errors","Please fix the errors noted.");}}},{id:"deletebtn",cls:"x-btn-icon-22",icon:"images/oxygen/22x22/actions/edit-delete.png",tooltip:"delete this contact",disabled:N,handler:function(t,h){if(formData.values.contact_id){Ext.MessageBox.wait("Deleting contact...","Please wait!");_deleteContact([formData.values.contact_id]);_reloadMainWindow(true);}}},{id:"exportbtn",cls:"x-btn-icon-22",icon:"images/oxygen/22x22/actions/file-export.png",tooltip:"export this contact",disabled:N,handler:p});var r=new Ext.data.JsonStore({url:"index.php",baseParams:{method:"Egwbase.getCountryList"},root:"results",id:"shortName",fields:["shortName","translatedName"],remoteSort:false});var M=new Ext.data.SimpleStore({fields:["id","addressbooks"],data:formData.config.addressbooks});var I=Ext.Element.get("content");u=new Ext.form.Form({labelWidth:75,url:"index.php?method=Addressbook.saveContact",reader:new Ext.data.JsonReader({root:"results"},[{name:"contact_id"},{name:"contact_tid"},{name:"contact_owner"},{name:"contact_private"},{name:"cat_id"},{name:"n_family"},{name:"n_given"},{name:"n_middle"},{name:"n_prefix"},{name:"n_suffix"},{name:"n_fn"},{name:"n_fileas"},{name:"contact_bday"},{name:"org_name"},{name:"org_unit"},{name:"contact_title"},{name:"contact_role"},{name:"contact_assistent"},{name:"contact_room"},{name:"adr_one_street"},{name:"adr_one_street2"},{name:"adr_one_locality"},{name:"adr_one_region"},{name:"adr_one_postalcode"},{name:"adr_one_countryname"},{name:"contact_label"},{name:"adr_two_street"},{name:"adr_two_street2"},{name:"adr_two_locality"},{name:"adr_two_region"},{name:"adr_two_postalcode"},{name:"adr_two_countryname"},{name:"tel_work"},{name:"tel_cell"},{name:"tel_fax"},{name:"tel_assistent"},{name:"tel_car"},{name:"tel_pager"},{name:"tel_home"},{name:"tel_fax_home"},{name:"tel_cell_private"},{name:"tel_other"},{name:"tel_prefer"},{name:"contact_email"},{name:"contact_email_home"},{name:"contact_url"},{name:"contact_url_home"},{name:"contact_freebusy_uri"},{name:"contact_calendar_uri"},{name:"contact_note"},{name:"contact_tz"},{name:"contact_geo"},{name:"contact_pubkey"},{name:"contact_created"},{name:"contact_creator"},{name:"contact_modified"},{name:"contact_modifier"},{name:"contact_jpegphoto"},{name:"account_id"}])});u.on("beforeaction",function(t,h){t.baseParams={};t.baseParams._contactOwner=t.getValues().contact_owner;if(formData.values&&formData.values.contact_id){t.baseParams.contact_id=formData.values.contact_id;}});u.fieldset({legend:"Contact information"});u.column({width:"33%",labelWidth:90,labelSeparator:""},new Ext.form.TextField({fieldLabel:"First Name",name:"n_given",width:175}),new Ext.form.TextField({fieldLabel:"Middle Name",name:"n_middle",width:175}),new Ext.form.TextField({fieldLabel:"Last Name",name:"n_family",width:175,allowBlank:false}));var P=new Ext.form.TriggerField({fieldLabel:"Addressbook",name:"contact_owner",width:175,readOnly:true});P.onTriggerClick=function(){L(H);};u.column({width:"33%",labelWidth:90,labelSeparator:""},new Ext.form.TextField({fieldLabel:"Prefix",name:"n_prefix",width:175}),new Ext.form.TextField({fieldLabel:"Suffix",name:"n_suffix",width:175}),P);u.end();u.fieldset({legend:"Business information"});u.column({width:"33%",labelWidth:90,labelSeparator:""},new Ext.form.TextField({fieldLabel:"Company",name:"org_name",width:175}),new Ext.form.TextField({fieldLabel:"Street",name:"adr_one_street",width:175}),new Ext.form.TextField({fieldLabel:"Street 2",name:"adr_one_street2",width:175}),new Ext.form.TextField({fieldLabel:"Postalcode",name:"adr_one_postalcode",width:175}),new Ext.form.TextField({fieldLabel:"City",name:"adr_one_locality",width:175}),new Ext.form.TextField({fieldLabel:"Region",name:"adr_one_region",width:175}),new Ext.form.ComboBox({fieldLabel:"Country",name:"adr_one_countryname",hiddenName:"adr_one_countryname",store:r,displayField:"translatedName",valueField:"shortName",typeAhead:true,mode:"remote",triggerAction:"all",emptyText:"Select a state...",selectOnFocus:true,width:175}));u.column({width:"33%",labelWidth:90,labelSeparator:""},new Ext.form.TextField({fieldLabel:"Phone",name:"tel_work",width:175}),new Ext.form.TextField({fieldLabel:"Cellphone",name:"tel_cell",width:175}),new Ext.form.TextField({fieldLabel:"Fax",name:"tel_fax",width:175}),new Ext.form.TextField({fieldLabel:"Car phone",name:"tel_car",width:175}),new Ext.form.TextField({fieldLabel:"Pager",name:"tel_pager",width:175}),new Ext.form.TextField({fieldLabel:"Email",name:"contact_email",vtype:"email",width:175}),new Ext.form.TextField({fieldLabel:"URL",name:"contact_url",vtype:"url",width:175}));u.column({width:"33%",labelWidth:90,labelSeparator:""},new Ext.form.TextField({fieldLabel:"Unit",name:"org_unit",width:175}),new Ext.form.TextField({fieldLabel:"Role",name:"contact_role",width:175}),new Ext.form.TextField({fieldLabel:"Title",name:"contact_title",width:175}),new Ext.form.TextField({fieldLabel:"Room",name:"contact_room",width:175}),new Ext.form.TextField({fieldLabel:"Name Assistent",name:"contact_assistent",width:175}),new Ext.form.TextField({fieldLabel:"Phone Assistent",name:"tel_assistent",width:175}));u.end();u.fieldset({legend:"Private information"});u.column({width:"33%",labelWidth:90,labelSeparator:""},new Ext.form.TextField({fieldLabel:"Street",name:"adr_two_street",width:175}),new Ext.form.TextField({fieldLabel:"Street2",name:"adr_two_street2",width:175}),new Ext.form.TextField({fieldLabel:"Postalcode",name:"adr_two_postalcode",width:175}),new Ext.form.TextField({fieldLabel:"City",name:"adr_two_locality",width:175}),new Ext.form.TextField({fieldLabel:"Region",name:"adr_two_region",width:175}),new Ext.form.ComboBox({fieldLabel:"Country",name:"adr_two_countryname",hiddenName:"adr_two_countryname",store:r,displayField:"translatedName",valueField:"shortName",typeAhead:true,mode:"remote",triggerAction:"all",emptyText:"Select a state...",selectOnFocus:true,width:175}));u.column({width:"33%",labelWidth:90,labelSeparator:""},new Ext.form.DateField({fieldLabel:"Birthday",name:"contact_bday",format:formData.config.dateFormat,altFormats:"Y-m-d",width:175}),new Ext.form.TextField({fieldLabel:"Phone",name:"tel_home",width:175}),new Ext.form.TextField({fieldLabel:"Cellphone",name:"tel_cell_private",width:175}),new Ext.form.TextField({fieldLabel:"Fax",name:"tel_fax_home",width:175}),new Ext.form.TextField({fieldLabel:"Email",name:"contact_email_home",vtype:"email",width:175}),new Ext.form.TextField({fieldLabel:"URL",name:"contact_url_home",vtype:"url",width:175}));u.column({width:"33%",labelSeparator:"",hideLabels:true},new Ext.form.TextArea({name:"contact_note",grow:false,preventScrollbars:false,width:"95%",maxLength:255,height:150}));u.end();var D=new Ext.form.TriggerField({fieldLabel:"Categories",name:"categories",width:320,readOnly:true});D.onTriggerClick=E;u.column({width:"45%",labelWidth:80,labelSeparator:" ",labelAlign:"right"},D);var g=new Ext.form.TriggerField({fieldLabel:"Lists",name:"lists",width:320,readOnly:true});g.onTriggerClick=n;u.column({width:"45%",labelWidth:80,labelSeparator:" ",labelAlign:"right"},g);u.column({width:"10%",labelWidth:50,labelSeparator:" ",labelAlign:"right"},new Ext.form.Checkbox({fieldLabel:"Private",name:"categories",width:10}));u.render("content");return u;};var Z=function(d,P){for(var i in P){var I=d.findField(i);if(I){I.setValue(P[i]);}}};var p=function(d,I){Ext.MessageBox.alert("Export","Not yet implemented.");};var H=function(I,d){u.setValues([{id:"contact_owner",value:d}]);};var E=function(){var g=Ext.Element.get("container");var D=g.createChild({tag:"div",id:"iWindowTag"});var r=g.createChild({tag:"div",id:"iWindowContTag"});var I=new Ext.data.SimpleStore({fields:["category_id","category_realname"],data:[["1","erste Kategorie"],["2","zweite Kategorie"],["3","dritte Kategorie"],["4","vierte Kategorie"],["5","fuenfte Kategorie"],["6","sechste Kategorie"],["7","siebte Kategorie"],["8","achte Kategorie"]]});I.load();ds_checked=new Ext.data.SimpleStore({fields:["category_id","category_realname"],data:[["2","zweite Kategorie"],["5","fuenfte Kategorie"],["6","sechste Kategorie"],["8","achte Kategorie"]]});ds_checked.load();var N=new Ext.form.Form({labelWidth:75,url:"index.php?method=Addressbook.saveAdditionalData",reader:new Ext.data.JsonReader({root:"results"},[{name:"category_id"},{name:"category_realname"},])});var d=1;var h=new Array();ds_checked.each(function(i){h[i.data.category_id]=i.data.category_realname;});I.each(function(i){if((d%12)==1){N.column({width:"33%",labelWidth:50,labelSeparator:""});}if(h[i.data.category_id]){N.add(new Ext.form.Checkbox({boxLabel:i.data.category_realname,name:i.data.category_realname,checked:true}));}else{N.add(new Ext.form.Checkbox({boxLabel:i.data.category_realname,name:i.data.category_realname}));}if((d%12)==0){N.end();}d=d+1;});N.render("iWindowContTag");if(!M){var M=new Ext.LayoutDialog("iWindowTag",{modal:true,width:700,height:400,shadow:true,minWidth:700,minHeight:400,autoTabs:true,proxyDrag:true,center:{autoScroll:true,tabPosition:"top",closeOnTab:true,alwaysShowTabs:true}});M.addKeyListener(27,this.hide);M.addButton("save",function(){Ext.MessageBox.alert("Todo","Not yet implemented!");M.hide;},M);M.addButton("cancel",function(){Ext.MessageBox.alert("Todo","Not yet implemented!");M.hide;},M);var P=M.getLayout();P.beginUpdate();P.add("center",new Ext.ContentPanel("iWindowContTag",{autoCreate:true,title:"Category"}));P.endUpdate();}M.show();};var L=function(N){var i=Ext.Element.get("iWindowContAdrTag");if(i!=null){i.remove();}var I=Ext.Element.get(document.body);var M=I.createChild({tag:"div",id:"adrContainer"});var r=M.createChild({tag:"div",id:"iWindowAdrTag"});var g=M.createChild({tag:"div",id:"iWindowContAdrTag"});if(!h){var h=new Ext.LayoutDialog("iWindowAdrTag",{modal:true,width:375,height:400,shadow:true,minWidth:375,title:"please select addressbook",minHeight:400,collapsible:false,autoTabs:false,proxyDrag:true,center:{autoScroll:true,tabPosition:"top",closeOnTab:true,alwaysShowTabs:false}});h.addKeyListener(27,h.hide,h);var d=Ext.tree;treeLoader=new d.TreeLoader({dataUrl:"index.php"});treeLoader.on("beforeload",function(U,w){U.baseParams.method="Addressbook.getSubTree";U.baseParams._node=w.id;U.baseParams._datatype=w.attributes.datatype;U.baseParams._owner=w.attributes.owner;U.baseParams._location="selectFolder";},this);var t=new d.TreePanel("iWindowContAdrTag",{animate:true,loader:treeLoader,containerScroll:true,rootVisible:false});var D=new d.TreeNode({text:"root",draggable:false,allowDrop:false,id:"root"});t.setRootNode(D);Ext.each(application,function(w){D.appendChild(new d.AsyncTreeNode(w));});t.render();t.on("click",function(){if(t.getSelectionModel().getSelectedNode()){var U=t.getSelectionModel().getSelectedNode().id;var w=t.getNodeById(U).attributes.owner;if((w>0)||(w<0)){N(w,w);h.hide();}else{Ext.MessageBox.alert("wrong selection","please select a valid addressbook");}}else{Ext.MessageBox.alert("no selection","please select an addressbook");}});var P=h.getLayout();P.beginUpdate();P.add("center",new Ext.ContentPanel("iWindowContAdrTag",{autoCreate:true,fitContainer:true}));P.endUpdate();}h.show();};var n=function(){var g=Ext.Element.get("container");var D=g.createChild({tag:"div",id:"iWindowTag"});var r=g.createChild({tag:"div",id:"iWindowContTag"});var I=new Ext.data.SimpleStore({fields:["list_id","list_realname"],data:[["1","Liste A"],["2","Liste B"],["3","Liste C"],["4","Liste D"],["5","Liste E"],["6","Liste F"],["7","Liste G"],["8","Liste H"]]});I.load();ds_checked=new Ext.data.SimpleStore({fields:["list_id","list_realname"],data:[["2","Liste B"],["5","Liste E"],["6","Liste F"],["8","Liste H"]]});ds_checked.load();var N=new Ext.form.Form({labelWidth:75,url:"index.php?method=Addressbook.saveAdditionalData",reader:new Ext.data.JsonReader({root:"results"},[{name:"list_id"},{name:"list_realname"},])});var d=1;var h=new Array();ds_checked.each(function(i){h[i.data.list_id]=i.data.list_realname;});I.each(function(i){if((d%12)==1){N.column({width:"33%",labelWidth:50,labelSeparator:""});}if(h[i.data.list_id]){N.add(new Ext.form.Checkbox({boxLabel:i.data.list_realname,name:i.data.list_realname,checked:true}));}else{N.add(new Ext.form.Checkbox({boxLabel:i.data.list_realname,name:i.data.list_realname}));}if((d%12)==0){N.end();}d=d+1;});N.render("iWindowContTag");if(!M){var M=new Ext.LayoutDialog("iWindowTag",{modal:true,width:700,height:400,shadow:true,minWidth:700,minHeight:400,autoTabs:true,proxyDrag:true,center:{autoScroll:true,tabPosition:"top",closeOnTab:true,alwaysShowTabs:true}});M.addKeyListener(27,this.hide);M.addButton("save",function(){Ext.MessageBox.alert("Todo","Not yet implemented!");},M);M.addButton("cancel",function(){window.location.reload();M.hide;},M);var P=M.getLayout();P.beginUpdate();P.add("center",new Ext.ContentPanel("iWindowContTag",{autoCreate:true,title:"Lists"}));P.endUpdate();}M.show();};return {display:function(){var I=K();if(formData.values){Z(I,formData.values);}}};}();Egw.Addressbook.ListEditDialog=function(){var K=function(){Ext.QuickTips.init();Ext.form.Field.prototype.msgTarget="side";var M=new Ext.BorderLayout(document.body,{north:{split:false,initialSize:28},center:{split:false,initialSize:70},south:{split:false,initialSize:350,autoScroll:true}});M.beginUpdate();M.add("north",new Ext.ContentPanel("header",{fitToFrame:true}));M.add("center",new Ext.ContentPanel("content",{fitToFrame:true}));M.add("south",new Ext.ContentPanel("south",{fitToFrame:true}));M.endUpdate();var u=true;if(formData.values){u=false;}var L=new Ext.Toolbar("header");L.add({id:"savebtn",cls:"x-btn-text-icon",text:"Save and Close",icon:"images/oxygen/22x22/actions/document-save.png",tooltip:"save this list and close window",onClick:function(){if(N.isValid()){var h={};if(formData.values){h.contact_id=formData.values.contact_id;}N.submit({waitTitle:"Please wait!",waitMsg:"saving contact...",params:h,success:function(t,w,U){window.opener.Egw.Addressbook.reload();window.setTimeout("window.close()",400);},failure:function(t,w){}});}else{Ext.MessageBox.alert("Errors","Please fix the errors noted.");}}},{id:"savebtn",cls:"x-btn-icon-22",icon:"images/oxygen/22x22/actions/save-all.png",tooltip:"apply changes for this list",onClick:function(){if(N.isValid()){var h={};if(formData.values){h.contact_id=formData.values.contact_id;}N.submit({waitTitle:"Please wait!",waitMsg:"saving contact...",params:h,success:function(t,w,U){window.opener.Egw.Addressbook.reload();},failure:function(t,w){}});}else{Ext.MessageBox.alert("Errors","Please fix the errors noted.");}}},{id:"deletebtn",cls:"x-btn-icon-22",icon:"images/oxygen/22x22/actions/edit-delete.png",tooltip:"delete this contact",disabled:u,handler:function(t,h){if(formData.values.contact_id){Ext.MessageBox.wait("Deleting contact...","Please wait!");_deleteContact([formData.values.contact_id]);_reloadMainWindow(true);}}});var n=new Ext.data.SimpleStore({fields:["id","addressbooks"],data:formData.config.addressbooks});var p=Ext.Element.get("content");var N=new Ext.form.Form({labelWidth:75,url:"index.php",baseParams:{method:"Addressbook.saveList"}});N.on("beforeaction",function(t,h){t.baseParams._listOwner=t.getValues().list_owner;t.baseParams._listmembers=C(A);if(formData.values&&formData.values.list_id){t.baseParams._listId=formData.values.list_id;}else{t.baseParams._listId="";}});var D=new Ext.form.TriggerField({fieldLabel:"Addressbook",name:"list_owner",width:325,readOnly:true});D.onTriggerClick=function(){test=Ext.Element.get("iWindowContAdrTag");if(test!=null){test.remove();}var h=Ext.Element.get(document.body);var U=h.createChild({tag:"div",id:"adrContainer"});var s=U.createChild({tag:"div",id:"iWindowAdrTag"});var R=U.createChild({tag:"div",id:"iWindowContAdrTag"});if(!v){var v=new Ext.LayoutDialog("iWindowAdrTag",{modal:true,width:375,height:400,shadow:true,title:"please select addressbook",minWidth:375,collapsible:false,minHeight:400,autoTabs:false,proxyDrag:true,center:{autoScroll:true,tabPosition:"top",closeOnTab:true,alwaysShowTabs:false}});v.addKeyListener(27,v.hide,v);var t=Ext.tree;treeLoader=new t.TreeLoader({dataUrl:"index.php"});treeLoader.on("beforeload",function(a,c){a.baseParams.method=c.attributes.application+".getTree";a.baseParams.node=c.id;a.baseParams.datatype=c.attributes.datatype;a.baseParams.owner=c.attributes.owner;a.baseParams.modul="contactedit";},this);var m=new t.TreePanel("iWindowContAdrTag",{animate:true,loader:treeLoader,enableDD:true,ddGroup:"TreeDD",enableDrop:true,containerScroll:true,rootVisible:false});var J=new t.TreeNode({text:"root",draggable:false,allowDrop:false,id:"root"});m.setRootNode(J);J.appendChild(new t.AsyncTreeNode(application));m.render();m.expandPath("/root/addressbook/");m.on("click",function(){if(m.getSelectionModel().getSelectedNode()){var c=m.getSelectionModel().getSelectedNode().id;var a=m.getNodeById(c).attributes.owner;if((a>0)||(a<0)){N.setValues([{id:"list_owner",value:a}]);v.hide();}else{Ext.MessageBox.alert("wrong selection","please select a valid addressbook");}}else{Ext.MessageBox.alert("no selection","please select an addressbook");}});var w=v.getLayout();w.beginUpdate();w.add("center",new Ext.ContentPanel("iWindowContAdrTag",{autoCreate:true,fitContainer:true}));w.endUpdate();}v.show();};N.fieldset({legend:"list information"});N.column({width:"100%",labelWidth:90,labelSeparator:""},D,new Ext.form.TextField({fieldLabel:"List Name",name:"list_name",width:325}),new Ext.form.TextArea({fieldLabel:"List Description",name:"list_description",width:325,grow:false}));N.end();if(formData.values){var P=formData.values.list_owner;var g=formData.values.list_id;}else{var P=-1;var g=-1;}searchDS=new Ext.data.JsonStore({url:"index.php",baseParams:{method:"Addressbook.getOverview",owner:P,options:"{\"displayContacts\":true,\"displayLists\":false}",},root:"results",totalProperty:"totalcount",id:"contact_id",fields:[{name:"contact_id"},{name:"n_family"},{name:"n_given"},{name:"contact_email"}],remoteSort:true,success:function(h,t){},failure:function(h,t){}});searchDS.setDefaultSort("n_family","asc");var r=new Ext.Template("<div class=\"search-item\">","{n_family}, {n_given} {contact_email}","</div>");var Z=new Ext.form.ComboBox({store:searchDS,displayField:"n_family",typeAhead:false,loadingText:"Searching...",width:415,pageSize:10,hideTrigger:true,tpl:r,onSelect:function(t){var h=new F({contact_id:t.data.contact_id,n_family:t.data.n_family,contact_email:t.data.contact_email});A.add(h);A.sort("n_family");Z.reset();Z.collapse();}});Z.on("specialkey",function(v,w){if(searchDS.getCount()==0){var J=/^[a-z0-9_-]+(\.[a-z0-9_-]+)*@([0-9a-z][0-9a-z-]*[0-9a-z]\.)+([a-z]{2,4}|museum)$/;var t=J.exec(Z.getValue());if(t&&(w.getKey()==w.ENTER||w.getKey()==e.RETURN)){var s=Z.getValue();var h=s.indexOf("@");if(h!=-1){var R=Ext.util.Format.capitalize(s.substr(0,h));}else{var R=s;}var U=new F({contact_id:"-1",n_family:R,contact_email:s});A.add(U);A.sort("n_family");Z.reset();}}});N.fieldset({legend:"select new list members"});N.column({width:"100%",labelWidth:0,labelSeparator:""},Z);N.end();N.render("content");var F=Ext.data.Record.create([{name:"contact_id",type:"int"},{name:"n_family",type:"string"},{name:"contact_email",type:"string"}]);if(formData.values){var i=formData.values.list_members;}var A=new Ext.data.SimpleStore({fields:["contact_id","n_family","contact_email"],data:i});A.sort("n_family","ASC");var H=new Ext.grid.ColumnModel([{resizable:true,id:"n_family",header:"Family name",dataIndex:"n_family"},{resizable:true,id:"contact_email",header:"eMail address",dataIndex:"contact_email"}]);H.defaultSortable=true;var d=new Ext.grid.Grid("south",{ds:A,cm:H,selModel:new Ext.grid.RowSelectionModel({multiSelect:true}),autoSizeColumns:true,monitorWindowResize:false,trackMouseOver:true,contextMenu:"ctxListMenu",autoExpandColumn:"contact_email"});d.on("rowcontextmenu",function(w,U,t){t.stopEvent();var h=w.getDataSource().getAt(U);if(h.data.contact_tid=="l"){I.showAt(t.getXY());}else{I.showAt(t.getXY());}});d.render("south");var k=function(R,h){var w=Array();var U=d.getSelectionModel().getSelections();for(var t=0;t<U.length;++t){A.remove(U[t]);}};var I=new Ext.menu.Menu({id:"ctxListMenu",items:[{id:"delete",text:"delete entry",icon:"images/oxygen/16x16/actions/edit-delete.png",handler:k}]});return N;};var E=function(p,u){p.findField("list_name").setValue(u["list_name"]);p.findField("list_description").setValue(u["list_description"]);p.findField("list_owner").setValue(u["list_owner"]);};var C=function(u){var p=new Array();u.each(function(n){p.push(n.data);},this);return Ext.util.JSON.encode(p);};return {display:function(){var p=K();if(formData.values){E(p,formData.values);}}};}();