Ext.namespace("Egw.Admin");Egw.Admin=function(){var a=function(){var n=new Ext.tree.TreeLoader({dataUrl:"index.php"});n.on("beforeload",function(o,g){o.baseParams.method="Admin.getSubTree";o.baseParams.node=g.id;o.baseParams.location="mainTree";},this);var j=new Ext.tree.TreePanel({title:"Admin",id:"admin-tree",loader:n,rootVisible:false,border:false});var e=new Ext.tree.TreeNode({text:"root",draggable:false,allowDrop:false,id:"root"});j.setRootNode(e);for(i=0;i<initialTree.Admin.length;i++){e.appendChild(new Ext.tree.AsyncTreeNode(initialTree.Admin[i]));}j.on("click",function(o,g){var l=Egw.Egwbase.getActiveToolbar();switch(o.attributes.dataPanelType){case "accesslog":if(l!=false&&l.id=="toolbarAdminAccessLog"){Ext.getCmp("gridAdminAccessLog").getStore().load({params:{start:0,limit:50}});}else{Egw.Admin.AccessLog.show();}break;case "applications":if(l!=false&&l.id=="toolbarAdminApplications"){Ext.getCmp("gridAdminApplications").getStore().load({params:{start:0,limit:50}});}else{Egw.Admin.Applications.show();}break;}},this);j.on("beforeexpand",function(g){if(g.getSelectionModel().getSelectedNode()==null){g.expandPath("/root");g.selectPath("/root/applications");}g.fireEvent("click",g.getSelectionModel().getSelectedNode());},this);j.on("contextmenu",function(o,g){g.stopEvent();});return j;};return {getPanel:a,};}();Egw.Admin.AccessLog=function(){var j=function(b,l){var v=Ext.getCmp("grid_applications").getSelectionModel().getSelections();var R=v[0].id;Egw.Egwbase.openWindow("applicationWindow","index.php?method=Admin.getApplication&appId="+R,800,450);};var g=new Ext.Action({text:"edit",disabled:true,handler:j,iconCls:"action_edit"});var e=function(){var l=new Ext.data.JsonStore({url:"index.php",baseParams:{method:"Admin.getAccessLog"},root:"results",totalProperty:"totalcount",id:"log_id",fields:[{name:"sessionid"},{name:"loginid"},{name:"ip"},{name:"li"},{name:"lo"},{name:"log_id"},{name:"account_id"},{name:"result"}],remoteSort:true});l.setDefaultSort("li","desc");l.on("beforeload",function(v){v.baseParams.filter=Ext.getCmp("quickSearchField").getRawValue();});l.load({params:{start:0,limit:50}});return l;};var n=function(){var v=new Ext.app.SearchField({id:"quickSearchField",width:240,emptyText:"enter searchfilter"});var l=new Ext.Toolbar({id:"toolbarAdminAccessLog",split:false,height:26,items:[g,"->","Search:"," "," ",v]});Egw.Egwbase.setActiveToolbar(l);};var a=function(v,r,N,l,b,R){switch(v){case "0":return "disabled";break;case "1":return "enabled";break;case "2":return "enabled (but hidden)";break;case "3":return "enabled (new window)";break;default:return "unknown status ("+v+")";break;}};var o=function(){var l=e();var R=new Ext.PagingToolbar({pageSize:50,store:l,displayInfo:true,displayMsg:"Displaying access log entries {0} - {1} of {2}",emptyMsg:"No access log entries to display"});var b=new Ext.grid.ColumnModel([{resizable:true,header:"Session ID",id:"sessionid",dataIndex:"sessionid",width:200},{resizable:true,header:"Login Name",id:"loginid",dataIndex:"loginid"},{resizable:true,header:"IP Address",id:"ip",dataIndex:"ip",width:150},{resizable:true,header:"Login Time",id:"li",dataIndex:"li",width:120},{resizable:true,header:"Logout Time",id:"lo",dataIndex:"lo",width:120},{resizable:true,header:"Account ID",id:"account_id",dataIndex:"account_id",width:70},{resizable:true,header:"Result",id:"result",dataIndex:"result",width:70,renderer:a}]);b.defaultSortable=true;var v=new Ext.grid.GridPanel({id:"gridAdminAccessLog",store:l,cm:b,tbar:R,autoSizeColumns:false,selModel:new Ext.grid.RowSelectionModel({multiSelect:true}),enableColLock:false,autoExpandColumn:"loginid",border:false});Egw.Egwbase.setActiveContentPanel(v);v.on("rowclick",function(r,Z,Q){var N=r.getSelectionModel().getCount();});v.on("rowcontextmenu",function(r,N,Q){Q.stopEvent();if(!r.getSelectionModel().isSelected(N)){r.getSelectionModel().selectRow(N);}});v.on("rowdblclick",function(r,Q,Z){var N=r.getStore().getAt(Q);try{Egw.Egwbase.openWindow("listWindow","index.php?method=Addressbook.editList&_listId="+N.data.list_id,800,450);}catch(S){}});return ;};return {show:function(){n();o();}};}();Egw.Admin.Applications=function(){var j=function(b,l){var v=Ext.getCmp("grid_applications").getSelectionModel().getSelections();var R=v[0].id;Egw.Egwbase.openWindow("applicationWindow","index.php?method=Admin.getApplication&appId="+R,800,450);};var o=new Ext.Action({text:"edit",disabled:true,handler:j,iconCls:"action_edit"});var n=function(){var l=new Ext.data.JsonStore({url:"index.php",baseParams:{method:"Admin.getApplications"},root:"results",totalProperty:"totalcount",id:"app_id",fields:[{name:"app_id"},{name:"app_name"},{name:"app_enabled"},{name:"app_order"},{name:"app_tables"},{name:"app_version"}],remoteSort:true});l.setDefaultSort("app_name","asc");l.on("beforeload",function(v){v.baseParams.filter=Ext.getCmp("quickSearchField").getRawValue();});l.load({params:{start:0,limit:50}});return l;};var e=function(){var v=new Ext.app.SearchField({id:"quickSearchField",width:240,emptyText:"enter searchfilter"});var l=new Ext.Toolbar({id:"toolbarAdminApplications",split:false,height:26,items:[o,"->","Search:"," "," ",v]});Egw.Egwbase.setActiveToolbar(l);};var a=function(v,r,N,l,b,R){switch(v){case "0":return "disabled";break;case "1":return "enabled";break;case "2":return "enabled (but hidden)";break;case "3":return "enabled (new window)";break;default:return "unknown status ("+v+")";break;}};var g=function(){var l=n();var b=new Ext.PagingToolbar({pageSize:50,store:l,displayInfo:true,displayMsg:"Displaying application {0} - {1} of {2}",emptyMsg:"No applications to display"});var R=new Ext.grid.ColumnModel([{resizable:true,header:"order",id:"app_order",dataIndex:"app_order",width:50},{resizable:true,header:"name",id:"app_name",dataIndex:"app_name"},{resizable:true,header:"status",id:"app_enabled",dataIndex:"app_enabled",width:150,renderer:a},{resizable:true,header:"version",id:"app_version",dataIndex:"app_version",width:70}]);R.defaultSortable=true;var v=new Ext.grid.GridPanel({id:"gridAdminApplications",store:l,cm:R,tbar:b,autoSizeColumns:false,selModel:new Ext.grid.RowSelectionModel({multiSelect:true}),enableColLock:false,autoExpandColumn:"app_name",border:false});Egw.Egwbase.setActiveContentPanel(v);v.on("rowclick",function(Z,Q,r){var N=Z.getSelectionModel().getCount();});v.on("rowcontextmenu",function(r,N,Q){Q.stopEvent();if(!r.getSelectionModel().isSelected(N)){r.getSelectionModel().selectRow(N);}});v.on("rowdblclick",function(r,Q,Z){var N=r.getStore().getAt(Q);try{Egw.Egwbase.openWindow("listWindow","index.php?method=Addressbook.editList&_listId="+N.data.list_id,800,450);}catch(S){}});return ;};return {show:function(){e();g();}};}();