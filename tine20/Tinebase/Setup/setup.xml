<?xml version="1.0" encoding="utf-8"?>
<application>
    <name>Tinebase</name>
    <version>0.2</version>
    <tables>
        <table>
            <name>applications</name>
            <version>0.0.1</version>
            <declaration>
                <field>
                    <name>id</name>
                    <type>integer</type>
                    <autoincrement>true</autoincrement>
                    <unsigned>true</unsigned>
                </field>
                <field>
                    <name>name</name>
                    <type>text</type>
                    <length>25</length>
                    <notnull>true</notnull>
                </field>
                <field>
                    <name>status</name>
                    <type>enum</type>
                    <value>enabled</value>
                    <value>disabled</value>
                    <notnull>true</notnull>
                </field>
                <field>
                    <name>order</name>
                    <type>integer</type>
                    <length>11</length>
                    <unsigned>true</unsigned>
                    <notnull>true</notnull>
                </field>
                <field>
                    <name>version</name>
                    <type>text</type>
                    <length>20</length>
                    <notnull>true</notnull>
                </field>
                <index>
                    <name>id</name>
                    <primary>true</primary>
                    <field>
                        <name>id</name>
                    </field>
                </index>
                <index>
                    <name>name</name>
                    <unique>true</unique>
                    <field>
                        <name>name</name>
                    </field>
                </index>
            </declaration>
        </table>
        
        <table>
            <name>application_tables</name>
            <version>0.0.1</version>
            <declaration>
                <field>
                    <name>application_id</name>
                    <type>integer</type>
                    <unsigned>true</unsigned>
                    <notnull>true</notnull>
                </field>
                <field>
                    <name>name</name>
                    <type>text</type>
                    <length>128</length>
                    <notnull>true</notnull>
                </field>
                <field>
                    <name>version</name>
                    <type>text</type>
                    <length>20</length>
                    <notnull>true</notnull>
                </field>
                <index>
                    <name>name-application_id</name>
                    <primary>true</primary>
                    <field>
                        <name>name</name>
                    </field>
                    <field>
                        <name>application_id</name>
                    </field>
                </index>
                <index>
                    <name>application_tables::application_id--applications::id</name>
                    <field>
                        <name>application_id</name>
                    </field>
                    <foreign>true</foreign>
                    <reference>
                        <table>applications</table>
                        <field>id</field>
                    </reference>
                </index>
            </declaration>
        </table>
        
        <table>
            <name>groups</name>
            <version>0.0.7</version>
            <declaration>
                <field>
                    <name>id</name>
                    <type>integer</type>
                    <unsigned>true</unsigned>
                    <notnull>true</notnull>
                    <autoincrement>true</autoincrement>
                </field>
                <field>
                    <name>name</name>
                    <type>text</type>
                    <length>128</length>
                    <notnull>true</notnull>
                </field>
                <field>
                    <name>description</name>
                    <type>text</type>
                    <length>255</length>
                </field>                
                <index>
                    <name>id</name>
                    <primary>true</primary>
                    <field>
                        <name>id</name>
                    </field>
                </index>                
                <index>
                    <name>name</name>
                    <unique>true</unique>
                    <field>
                        <name>name</name>
                    </field>
                </index>
            </declaration>
        </table>
        
        <table>
            <name>accounts</name>
            <version>0.0.1</version>
            <declaration>
                <field>
                    <name>id</name>
                    <type>integer</type>
                    <unsigned>true</unsigned>
                    <notnull>true</notnull>
                    <autoincrement>true</autoincrement>
                </field>
                <field>
                    <name>login_name</name>
                    <type>text</type>
                    <length>64</length>
                    <notnull>true</notnull>
                </field>
                <field>
                    <name>password</name>
                    <type>text</type>
                    <length>100</length>
                    <notnull>true</notnull>
                </field>
                <field>
                    <name>last_login</name>
                    <type>datetime</type>
                </field>
                <field>
                    <name>last_login_from</name>
                    <type>text</type>
                    <length>20</length>
                </field>
                <field>
                    <name>last_password_change</name>
                    <type>datetime</type>
                </field>                
                <field>
                    <name>status</name>
                    <type>enum</type>
                    <value>enabled</value>
                    <value>disabled</value>
                    <notnull>true</notnull>
                </field>
                <field>
                    <name>expires_at</name>
                    <type>datetime</type>
                </field>
                <field>
                    <name>blocked_until</name>
                    <type>datetime</type>
                </field>
                <field>
                    <name>login_failures</name>
                    <type>integer</type>
                    <length>11</length>
                    <unsigned>true</unsigned>
                </field>    
                <field>
                    <name>last_login_failure_at</name>
                    <type>datetime</type>
                </field>
                <field>
                    <name>primary_group_id</name>
                    <type>integer</type>
                    <length>11</length>
                    <unsigned>true</unsigned>
                    <notnull>true</notnull>
                </field>
                <index>
                    <name>id</name>
                    <primary>true</primary>
                    <field>
                        <name>id</name>
                    </field>
                </index>
                <index>
                    <name>login_name</name>
                    <unique>true</unique>
                    <field>
                        <name>login_name</name>
                    </field>
                </index>

                <index>
                    <name>accounts::primary_group_id--groups::id</name>
                    <field>
                        <name>primary_group_id</name>
                    </field>
                    <foreign>true</foreign>
                    <reference>
                        <table>groups</table>
                        <field>id</field>
                    </reference>
                </index>
            </declaration>
        </table>
        
        <table>
            <name>group_members</name>
            <version>0.0.1</version>
            <declaration>
                <field>
                    <name>group_id</name>
                    <type>integer</type>
                    <unsigned>true</unsigned>
                    <notnull>true</notnull>
                </field>
                <field>
                    <name>account_id</name>
                    <type>integer</type>
                    <length>11</length>
                    <unsigned>true</unsigned>
                    <notnull>true</notnull>
                </field>

                <index>
                    <name>group_id-account_id</name>
                    <unique>true</unique>
                    <field>
                        <name>group_id</name>
                    </field>
                    <field>
                        <name>account_id</name>
                    </field>
                </index>                

                <index>
                    <name>group_members::group_id--groups::id</name>
                    <field>
                        <name>group_id</name>
                    </field>
                    <foreign>true</foreign>
                    <reference>
                        <table>groups</table>
                        <field>id</field>
                    </reference>
                </index>

                <index>
                    <name>group_members::account_id--accounts::id</name>
                    <field>
                        <name>account_id</name>
                    </field>
                    <foreign>true</foreign>
                    <reference>
                        <table>accounts</table>
                        <field>id</field>
                    </reference>
                </index>

            </declaration>
        </table>
        
        <table>
            <name>registrations</name>
            <version>0.0.1</version>
            <declaration>
                <field>
                    <name>id</name>
                    <type>integer</type>
                    <unsigned>true</unsigned>
                    <notnull>true</notnull>
                    <autoincrement>true</autoincrement>
                </field>
                <field>
                    <name>login_name</name>
                    <type>text</type>
                    <length>64</length>
                    <notnull>true</notnull>
                </field>
                <field>
                    <name>login_hash</name>
                    <type>text</type>
                    <length>32</length>
                    <notnull>true</notnull>
                </field>                
                <field>
                    <name>email</name>
                    <type>text</type>
                    <length>128</length>
                    <notnull>true</notnull>
                </field>
                <field>
                    <name>date</name>
                    <type>datetime</type>
                </field>
                <field>
                    <name>status</name>
                    <type>enum</type>
                    <value>justregistered</value>
                    <value>waitingforactivation</value>
                    <value>activated</value>                    
                    <notnull>true</notnull>
                </field>
                <field>
                    <name>expires_at</name>
                    <type>datetime</type>
                </field>
                <field>
                    <name>email_sent</name>
                    <type>integer</type>
                    <length>1</length>
                    <unsigned>true</unsigned>
                    <default>0</default>
                </field>
                <index>
                    <name>account_id</name>
                    <primary>true</primary>
                    <field>
                        <name>id</name>
                    </field>
                </index>
                <index>
                    <name>login_name</name>
                    <unique>true</unique>
                    <field>
                        <name>login_name</name>
                    </field>
                </index>
            </declaration>
        </table>

        <table>
            <name>container</name>
            <version>0.0.1</version>
            <declaration>
                <field>
                    <name>id</name>
                    <type>integer</type>
                    <unsigned>true</unsigned>
                    <notnull>true</notnull>
                    <autoincrement>true</autoincrement>
                </field>
                <field>
                    <name>name</name>
                    <type>text</type>
                    <length>256</length>
                    <notnull>true</notnull>
                </field>
                <field>
                    <name>type</name>
                    <type>enum</type>
                    <value>personal</value>
                    <value>shared</value>
                    <value>internal</value>
                </field>
                <field>
                    <name>backend</name>
                    <type>text</type>
                    <length>64</length>
                    <notnull>true</notnull>
                </field>
                <field>
                    <name>application_id</name>
                    <type>integer</type>
                    <unsigned>true</unsigned>
                    <notnull>true</notnull>
                </field>
                <index>
                    <name>id</name>
                    <primary>true</primary>
                    <field>
                        <name>id</name>
                    </field>
                </index>
                <index>
                    <name>type</name>
                    <field>
                        <name>type</name>
                    </field>
                </index>
                <index>
                    <name>container_application_id</name>
                    <field>
                        <name>application_id</name>
                    </field>
                    <foreign>true</foreign>
                    <reference>
                        <table>applications</table>
                        <field>id</field>
                    </reference>
                </index>
            </declaration>
        </table>

        <table>
            <name>container_acl</name>
            <version>0.0.1</version>
            <declaration>
                <field>
                    <name>id</name>
                    <type>text</type>
                    <length>40</length>
                    <notnull>true</notnull>
                </field>
                <field>
                    <name>container_id</name>
                    <type>integer</type>
                    <unsigned>true</unsigned>
                    <notnull>true</notnull>
                </field>
                <field>
                    <name>account_type</name>
                    <type>enum</type>
                    <value>anyone</value>
                    <value>user</value>
                    <value>group</value>
                    <notnull>true</notnull>
                </field>
                <field>
                    <name>account_id</name>
                    <type>integer</type>
                    <unsigned>true</unsigned>
                    <notnull>false</notnull>
                </field>
                <field>
                    <name>account_grant</name>
                    <type>integer</type>
                    <unsigned>true</unsigned>
                    <notnull>true</notnull>
                </field>
                
                <index>
                    <name>container_id-account-type-account_id-account_grant</name>
                    <primary>true</primary>
                    <field>
                        <name>id</name>
                    </field>
                    <field>
                        <name>container_id</name>
                    </field>
                    <field>
                        <name>account_type</name>
                    </field>
                    <field>
                        <name>account_id</name>
                    </field>
                    <field>
                        <name>account_grant</name>
                    </field>
                </index>
                <index>
                    <name>id-account_type-account_id</name>
                    <field>
                        <name>container_id</name>
                    </field>
                    <field>
                        <name>account_type</name>
                    </field>
                    <field>
                        <name>account_id</name>
                    </field>
                </index>
                <index>
                    <name>container_id</name>
                    <field>
                        <name>container_id</name>
                    </field>
                    <foreign>true</foreign>
                    <reference>
                        <table>container</table>
                        <field>id</field>
                    </reference>
                </index>
            </declaration>
        </table>

        <table>
            <name>access_log</name>
            <version>0.0.1</version>
            <declaration>
                <field>
                    <name>id</name>
                    <type>integer</type>
                    <unsigned>true</unsigned>
                    <notnull>true</notnull>
                    <autoincrement>true</autoincrement>
                </field>
                <field>
                    <name>sessionid</name>
                    <type>text</type>
                    <length>128</length>
                    <notnull>true</notnull>
                </field>
                <field>
                    <name>login_name</name>
                    <type>text</type>
                    <length>64</length>
                    <notnull>true</notnull>
                </field>
                <field>
                    <name>ip</name>
                    <type>text</type>
                    <length>40</length>
                </field>
                <field>
                    <name>li</name>
                    <type>datetime</type>
                    <notnull>true</notnull>
                </field>
                <field>
                    <name>lo</name>
                    <type>datetime</type>
                </field>
                <field>
                    <name>account_id</name>
                    <type>integer</type>
                    <unsigned>true</unsigned>
                </field>
                <field>
                    <name>result</name>
                    <type>integer</type>
                    <unsigned>true</unsigned>
                    <notnull>true</notnull>
                </field>
                
                <index>
                    <name>id</name>
                    <primary>true</primary>
                    <field>
                        <name>id</name>
                    </field>
                </index>
            </declaration>
        </table>

        <table>
            <name>application_rights</name>
            <version>2</version>
            <declaration>
                <field>
                    <name>id</name>
                    <type>integer</type>
                    <unsigned>true</unsigned>
                    <notnull>true</notnull>
                    <autoincrement>true</autoincrement>
                </field>
                <field>
                    <name>application_id</name>
                    <type>integer</type>
                    <unsigned>true</unsigned>
                    <notnull>true</notnull>
                </field>
                <field>
                    <name>right</name>
                    <type>text</type>
                    <length>64</length>
                    <notnull>true</notnull>
                </field>
                <field>
                    <name>account_type</name>
                    <type>enum</type>
                    <value>anyone</value>
                    <value>user</value>
                    <value>group</value>
                    <notnull>true</notnull>
                </field>
                <field>
                    <name>account_id</name>
                    <type>integer</type>
                    <unsigned>true</unsigned>
                    <notnull>false</notnull>
                </field>
                
                <index>
                    <name>id</name>
                    <primary>true</primary>
                    <field>
                        <name>id</name>
                    </field>
                </index>
                <index>
                    <name>account_id-account_type-application_id-right</name>
                    <unique>true</unique>
                    <field>
                        <name>account_id</name>
                    </field>
                    <field>
                        <name>account_type</name>
                    </field>
                    <field>
                        <name>application_id</name>
                    </field>
                    <field>
                        <name>right</name>
                    </field>
                </index>
                <index>
                    <name>right</name>
                    <field>
                        <name>right</name>
                    </field>
                </index>
                <index>
                    <name>application_rights-application_id</name>
                    <field>
                        <name>application_id</name>
                    </field>
                    <foreign>true</foreign>
                    <reference>
                        <table>applications</table>
                        <field>id</field>
                    </reference>
                </index>
            </declaration>
        </table>     

        <table>
            <name>record_persistentobserver</name>
            <version>0.0.1</version>
            <declaration>
                <field>
                    <name>id</name>
                    <type>integer</type>
                    <unsigned>true</unsigned>
                    <notnull>true</notnull>
                    <autoincrement>true</autoincrement>
                </field>
                <field>
                    <name>observable_application</name>
                    <type>integer</type>
                    <unsigned>true</unsigned>
                    <notnull>true</notnull>
                </field>
                <field>
                    <name>observable_identifier</name>
                    <type>integer</type>
                    <unsigned>true</unsigned>
                    <notnull>true</notnull>
                </field>
                <field>
                    <name>observer_application</name>
                    <type>integer</type>
                    <unsigned>true</unsigned>
                    <notnull>false</notnull>
                </field>
                <field>
                    <name>observer_identifier</name>
                    <type>integer</type>
                    <unsigned>true</unsigned>
                    <notnull>false</notnull>
                </field> 
                <field>
                    <name>observed_event</name>
                    <type>text</type>
                    <length>64</length>
                </field>                  
                <field>
                    <name>created_by</name>
                    <type>integer</type>
                    <notnull>true</notnull>
                </field>
                <field>
                    <name>creation_time</name>
                    <type>datetime</type>
                    <notnull>true</notnull>
                </field> 
                <field>
                    <name>last_modified_by</name>
                    <type>integer</type>
                    <notnull>true</notnull>
                </field>
                <field>
                    <name>last_modified_time</name>
                    <type>datetime</type>
                    <notnull>true</notnull>
                </field>
                <field>
                    <name>is_deleted</name>
                    <type>boolean</type>
                    <notnull>true</notnull>
                    <default>false</default>
                </field>
                <field>
                    <name>deleted_by</name>
                    <type>integer</type>
                    <notnull>true</notnull>
                </field>            
                <field>
                    <name>deleted_time</name>
                    <type>datetime</type>
                </field>
                <index>
                    <name>id</name>
                    <primary>true</primary>
                    <field>
                        <name>id</name>
                    </field>
                </index>
                <index>
                    <name>observer_application</name>
                    <field>
                        <name>observer_application</name>
                    </field>
                </index>
                 <index>
                    <name>observer_identifier</name>
                    <field>
                        <name>observer_identifier</name>
                    </field>
                </index>
                <index>
                    <name>observable_id-observer_id-application_id</name>
                    <unique>true</unique>
                    <field>
                        <name>observable_application</name>
                    </field>
                    <field>
                        <name>observable_identifier</name>
                    </field>
                    <field>
                        <name>observer_identifier</name>
                    </field>
                    <field>
                        <name>observed_event</name>
                    </field>
                </index>
            </declaration>
        </table>
        
        <table>
            <name>record_relations</name>
            <version>0.0.1</version>
            <declaration>
                <field>
                    <name>id</name>
                    <type>integer</type>
                    <unsigned>true</unsigned>
                    <notnull>true</notnull>
                    <autoincrement>true</autoincrement>
                </field>
                <field>
                    <name>own_application</name>
                    <type>integer</type>
                    <unsigned>true</unsigned>
                    <notnull>true</notnull>
                </field>
                <field>
                    <name>own_identifier</name>
                    <type>integer</type>
                    <unsigned>true</unsigned>
                    <notnull>true</notnull>
                </field>
                <field>
                    <name>related_application</name>
                    <type>integer</type>
                    <unsigned>true</unsigned>
                    <notnull>false</notnull>
                </field>
                <field>
                    <name>related_identifier</name>
                    <type>integer</type>
                    <unsigned>true</unsigned>
                    <notnull>false</notnull>
                </field> 
                <field>
                    <name>related_role</name>
                    <type>text</type>
                    <length>64</length>
                </field>                  
                <field>
                    <name>created_by</name>
                    <type>integer</type>
                    <notnull>true</notnull>
                </field>
                <field>
                    <name>creation_time</name>
                    <type>datetime</type>
                    <notnull>true</notnull>
                </field> 
                <field>
                    <name>last_modified_by</name>
                    <type>integer</type>
                    <notnull>true</notnull>
                </field>
                <field>
                    <name>last_modified_time</name>
                    <type>datetime</type>
                    <notnull>true</notnull>
                </field>
                <field>
                    <name>is_deleted</name>
                    <type>boolean</type>
                    <notnull>true</notnull>
                    <default>false</default>
                </field>
                <field>
                    <name>deleted_by</name>
                    <type>integer</type>
                    <notnull>true</notnull>
                </field>            
                <field>
                    <name>deleted_time</name>
                    <type>datetime</type>
                </field>
                <index>
                    <name>id</name>
                    <primary>true</primary>
                    <field>
                        <name>id</name>
                    </field>
                </index>
                <index>
                    <name>own_application_id-own_id-related-role_id</name>
                    <unique>true</unique>
                    <field>
                        <name>own_application</name>
                    </field>
                    <field>
                        <name>own_identifier</name>
                    </field>
                    <field>
                        <name>related_role</name>
                    </field>
                    <field>
                        <name>related_application</name>
                    </field>
                    <field>
                        <name>related_identifier</name>
                    </field>
                </index>
            </declaration>
        </table>
		
		<table>
			<name>links</name>
			<version>0.0.1</version>
			<declaration>
				<field>
					<name>link_id</name>
					<type>integer</type>
					<autoincrement>true</autoincrement>
					<notnull>true</notnull>
				</field>
				<field>
					<name>link_app1</name>
					<type>text</type>
					<length>25</length>
					<notnull>true</notnull>
				</field>
				<field>
					<name>link_app2</name>
					<type>text</type>
					<length>25</length>
					<notnull>true</notnull>
				</field>

				<field>
					<name>link_id1</name>
					<type>text</type>
					<length>50</length>
					<notnull>true</notnull>
				</field>
				<field>
					<name>link_id2</name>
					<type>text</type>
					<length>50</length>
					<notnull>true</notnull>
				</field>
				<field>
					<name>link_lastmod</name>
					<type>integer</type>
					<notnull>true</notnull>
				</field>
				<field>
					<name>link_owner</name>
					<type>integer</type>
					<notnull>true</notnull>
				</field>
				<field>
					<name>link_remark</name>
					<type>text</type>
					<length>100</length>
				</field>
				<index>
					<name>egw_links_app1_id1_lastmod</name>
					<field>
						<name>link_app1</name>
					</field>
					<field>
						<name>link_id1</name>
					</field>
					<field>
						<name>link_lastmod</name>
					</field>
				</index>
				<index>
					<name>egw_links_app2_id2_lastmod</name>
					<field>
						<name>link_app2</name>
					</field>
					<field>
						<name>link_id2</name>
					</field>
					<field>
						<name>link_lastmod</name>
					</field>
				</index>
				<index>
					<name>link_id</name>
					<primary>true</primary>
					<unique>true</unique>
					<field>
						<name>link_id</name>
					</field>
				</index>
			</declaration>
		</table>
        
        <table>
            <name>timemachine_modificationlog</name>
            <version>0.0.1</version>
            <declaration>
                <field>
                    <name>id</name>
                    <type>text</type>
                    <length>40</length>
                </field>
                <field>
                    <name>application_id</name>
                    <type>integer</type>
                    <notnull>true</notnull>
                    <unsigned>true</unsigned>
                </field>
                <field>
                    <name>record_id</name>
                    <type>text</type>
                    <length>40</length>
                </field>
                <field>
                    <name>record_type</name>
                    <type>text</type>
                    <length>64</length>
                </field>
                <field>
                    <name>record_backend</name>
                    <type>text</type>
                    <length>64</length>
                </field>
                <field>
                    <name>modification_time</name>
                    <type>datetime</type>
                    <notnull>true</notnull>
                </field>
                <field>
                    <name>modification_account</name>
                    <type>integer</type>
                    <notnull>true</notnull>
                </field>
                <field>
                    <name>modified_attribute</name>
                    <type>text</type>
                    <length>64</length>
                </field>
                <field>
                    <name>old_value</name>
                    <type>clob</type>
                </field>
                <field>
                    <name>new_value</name>
                    <type>clob</type>
                </field>
                <index>
                    <name>id</name>
                    <primary>true</primary>
                    <field>
                        <name>id</name>
                    </field>
                </index>
                <index>
                    <name>unique-fields</name>
                    <unique>true</unique>
                    <field>
                        <name>application_id</name>
                    </field>
                    <field>
                        <name>record_id</name>
                    </field>
                    <field>
                        <name>record_type</name>
                    </field>
                    <field>
                        <name>record_backend</name>
                    </field>
                    <field>
                        <name>modification_time</name>
                    </field>
                    <field>
                        <name>modification_account</name>
                    </field>
                    <field>
                        <name>modified_attribute</name>
                    </field>
                </index>
            </declaration>
        </table>
        
    </tables>
</application>
