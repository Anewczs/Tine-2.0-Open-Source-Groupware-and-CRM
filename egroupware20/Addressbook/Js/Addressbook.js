Ext.namespace("Egw.Addressbook");Egw.Addressbook=function(){var k;var a=true;var v=false;var b;var n;var V=function(F){switch(b.attributes.datatype){case "list":F.baseParams.listId=b.attributes.listId;F.baseParams.method="Addressbook.getList";break;case "contacts":case "otherpeople":case "sharedaddressbooks":F.baseParams.method="Addressbook.getContacts";F.baseParams.options=Ext.encode({displayContacts:a,displayLists:v});break;case "overview":F.baseParams.method="Addressbook.getOverview";F.baseParams.options=Ext.encode({displayContacts:a,displayLists:v});break;}F.baseParams.query="";};var m=function(Y,F){f("contactWindow","index.php?method=Addressbook.editContact&_contactId=",850,600);};var K=function(Y,F){f("listWindow","index.php?method=Addressbook.editList&_listId=",450,600);};var t=function(Y,F){};var S=function(p,F){var P=n.getSelectionModel().getSelections();var Y=P[0].id;if(P[0].data.contact_tid=="l"){f("listWindow","index.php?method=Addressbook.editList&_listId="+Y,450,600);}else{f("contactWindow","index.php?method=Addressbook.editContact&_contactId="+Y,850,600);}};var E=new Ext.Action({text:"add contact",handler:m,iconCls:"action_addContact"});var G=new Ext.Action({text:"add list",handler:K,iconCls:"action_addList"});var D=new Ext.Action({text:"edit",disabled:true,handler:S,iconCls:"action_edit"});var o=new Ext.Action({text:"delete",disabled:true,handler:t,enableToggle:true,iconCls:"action_delete"});var T=function(){var Y=Ext.getCmp("north-panel");var P=Ext.getCmp("applicationToolbar");Y.remove(P);var p=new Ext.Action({handler:A,enableToggle:true,pressed:a,iconCls:"x-btn-icon action_displayContacts"});var U=new Ext.Action({handler:Q,enableToggle:true,pressed:v,iconCls:"x-btn-icon action_displayLists"});var F=new Ext.Toolbar({region:"south",id:"applicationToolbar",split:false,height:26,items:[E,G,D,o,"-","Display",": ",p,U,"->","Search:"," "," ",new Ext.app.SearchField({width:240,paramName:"q"})]});Y.add(F);Y.doLayout();return ;};var g=function(P){b=P;var F=Ext.getCmp("center-panel");if(F.items){for(var Y=0;Y<F.items.length;Y++){F.remove(F.items.get(Y));}}k=new Ext.data.JsonStore({url:"index.php",baseParams:{datatype:b.attributes.datatype,owner:b.attributes.owner,sort:"contact_id",dir:"ASC",query:""},root:"results",totalProperty:"totalcount",id:"contact_id",fields:[{name:"contact_id"},{name:"contact_tid"},{name:"contact_owner"},{name:"contact_private"},{name:"cat_id"},{name:"n_family"},{name:"n_given"},{name:"n_middle"},{name:"n_prefix"},{name:"n_suffix"},{name:"n_fn"},{name:"n_fileas"},{name:"contact_bday"},{name:"org_name"},{name:"org_unit"},{name:"contact_title"},{name:"contact_role"},{name:"contact_assistent"},{name:"contact_room"},{name:"adr_one_street"},{name:"adr_one_street2"},{name:"adr_one_locality"},{name:"adr_one_region"},{name:"adr_one_postalcode"},{name:"adr_one_countryname"},{name:"contact_label"},{name:"adr_two_street"},{name:"adr_two_street2"},{name:"adr_two_locality"},{name:"adr_two_region"},{name:"adr_two_postalcode"},{name:"adr_two_countryname"},{name:"tel_work"},{name:"tel_cell"},{name:"tel_fax"},{name:"tel_assistent"},{name:"tel_car"},{name:"tel_pager"},{name:"tel_home"},{name:"tel_fax_home"},{name:"tel_cell_private"},{name:"tel_other"},{name:"tel_prefer"},{name:"contact_email"},{name:"contact_email_home"},{name:"contact_url"},{name:"contact_url_home"},{name:"contact_freebusy_uri"},{name:"contact_calendar_uri"},{name:"contact_note"},{name:"contact_tz"},{name:"contact_geo"},{name:"contact_pubkey"},{name:"contact_created"},{name:"contact_creator"},{name:"contact_modified"},{name:"contact_modifier"},{name:"contact_jpegphoto"},{name:"account_id"}],remoteSort:true});k.setDefaultSort("n_family","asc");k.loadData({"results":[],"totalcount":"0","status":"success"});k.on("beforeload",V);k.load({params:{start:0,limit:50}});var p=new Ext.PagingToolbar({pageSize:25,store:k,displayInfo:true,displayMsg:"Displaying contacts {0} - {1} of {2}",emptyMsg:"No contacts to display"});var U=new Ext.grid.ColumnModel([{resizable:true,id:"contact_tid",header:"Type",dataIndex:"contact_tid",width:30,renderer:r},{resizable:true,id:"n_family",header:"Family name",dataIndex:"n_family"},{resizable:true,id:"n_given",header:"Given name",dataIndex:"n_given"},{resizable:true,id:"n_fn",header:"Full name",dataIndex:"n_fn",hidden:true},{resizable:true,id:"n_fileas",header:"Name + Firm",dataIndex:"n_fileas",hidden:true},{resizable:true,id:"contact_email",header:"eMail",dataIndex:"contact_email",width:150,hidden:false},{resizable:true,id:"contact_bday",header:"Birthday",dataIndex:"contact_bday",hidden:true},{resizable:true,id:"org_name",header:"Organisation",dataIndex:"org_name",width:150},{resizable:true,id:"org_unit",header:"Unit",dataIndex:"org_unit",hidden:true},{resizable:true,id:"contact_title",header:"Title",dataIndex:"contact_title",hidden:true},{resizable:true,id:"contact_role",header:"Role",dataIndex:"contact_role",hidden:true},{resizable:true,id:"contact_room",header:"Room",dataIndex:"contact_room",hidden:true},{resizable:true,id:"adr_one_street",header:"Street",dataIndex:"adr_one_street",hidden:true},{resizable:true,id:"adr_one_locality",header:"Locality",dataIndex:"adr_one_locality",hidden:false},{resizable:true,id:"adr_one_region",header:"Region",dataIndex:"adr_one_region",hidden:true},{resizable:true,id:"adr_one_postalcode",header:"Postalcode",dataIndex:"adr_one_postalcode",hidden:true},{resizable:true,id:"adr_one_countryname",header:"Country",dataIndex:"adr_one_countryname",hidden:true},{resizable:true,id:"adr_two_street",header:"Street (private)",dataIndex:"adr_two_street",hidden:true},{resizable:true,id:"adr_two_locality",header:"Locality (private)",dataIndex:"adr_two_locality",hidden:true},{resizable:true,id:"adr_two_region",header:"Region (private)",dataIndex:"adr_two_region",hidden:true},{resizable:true,id:"adr_two_postalcode",header:"Postalcode (private)",dataIndex:"adr_two_postalcode",hidden:true},{resizable:true,id:"adr_two_countryname",header:"Country (private)",dataIndex:"adr_two_countryname",hidden:true},{resizable:true,id:"tel_work",header:"Phone",dataIndex:"tel_work",hidden:false},{resizable:true,id:"tel_cell",header:"Cellphone",dataIndex:"tel_cell",hidden:false},{resizable:true,id:"tel_fax",header:"Fax",dataIndex:"tel_fax",hidden:true},{resizable:true,id:"tel_car",header:"Car phone",dataIndex:"tel_car",hidden:true},{resizable:true,id:"tel_pager",header:"Pager",dataIndex:"tel_pager",hidden:true},{resizable:true,id:"tel_home",header:"Phone (private)",dataIndex:"tel_home",hidden:true},{resizable:true,id:"tel_fax_home",header:"Fax (private)",dataIndex:"tel_fax_home",hidden:true},{resizable:true,id:"tel_cell_private",header:"Cellphone (private)",dataIndex:"tel_cell_private",hidden:true},{resizable:true,id:"contact_email_home",header:"eMail (private)",dataIndex:"contact_email_home",hidden:true},{resizable:true,id:"contact_url",header:"URL",dataIndex:"contact_url",hidden:true},{resizable:true,id:"contact_url_home",header:"URL (private)",dataIndex:"contact_url_home",hidden:true},{resizable:true,id:"contact_note",header:"Note",dataIndex:"contact_note",hidden:true},{resizable:true,id:"contact_tz",header:"Timezone",dataIndex:"contact_tz",hidden:true},{resizable:true,id:"contact_geo",header:"Geo",dataIndex:"contact_geo",hidden:true}]);U.defaultSortable=true;n=new Ext.grid.GridPanel({store:k,cm:U,tbar:p,autoSizeColumns:false,selModel:new Ext.grid.RowSelectionModel({multiSelect:true}),enableColLock:false,autoExpandColumn:"n_family",border:false});F.add(n);F.show();F.doLayout();n.on("rowclick",function(X,L,O){var q=n.getSelectionModel().getCount();if(q<1){D.setDisabled(true);o.setDisabled(true);}else{if(q==1){D.setDisabled(false);o.setDisabled(false);}else{D.setDisabled(true);o.setDisabled(false);}}});n.on("rowcontextmenu",function(L,X,O){O.stopEvent();var q=L.getStore().getAt(X);R.showAt(O.getXY());});n.on("rowdblclick",function(O,L,X){var q=O.getStore().getAt(L);if(q.data.contact_tid=="l"){try{f("listWindow","index.php?method=Addressbook.editList&_listId="+q.data.contact_id,450,600);}catch(l){}}else{try{f("contactWindow","index.php?method=Addressbook.editContact&_contactId="+q.data.contact_id,850,600);}catch(l){}}});return ;textF1=new Ext.form.TextField({height:22,width:200,emptyText:"Suchparameter ...",allowBlank:false});textF1.on("specialkey",function(O,q){if(q.getKey()==q.ENTER||q.getKey()==e.RETURN){}});};var r=function(p,q,P,F,Y,U){switch(p){case "l":return "<img src='images/oxygen/16x16/actions/users.png' width='12' height='12' alt='list'/>";default:return "<img src='images/oxygen/16x16/actions/user.png' width='12' height='12' alt='contact'/>";}};var A=function(Y,F){a=Y.pressed;k.reload();};var Q=function(Y,F){v=Y.pressed;k.reload();};var Z=function(U,F){var P=Array();var p=n.getSelectionModel().getSelections();for(var Y=0;Y<p.length;++Y){P.push(p[Y].id);}I(P,function(){Egw.Addressbook.reload();});};var z=function(p,F){var P=n.getSelectionModel().getSelections();var Y=P[0].id;c(Y,"list");};var R=new Ext.menu.Menu({id:"ctxMenuAddress",items:[D,o,"-",E,G]});var N=function(Y,F){};var f=function(Y,O,F,q){if(document.all){w=document.body.clientWidth;h=document.body.clientHeight;x=window.screenTop;y=window.screenLeft;}else{if(window.innerWidth){w=window.innerWidth;h=window.innerHeight;x=window.screenX;y=window.screenY;}}var U=((w-F)/2)+y;var p=((h-q)/2)+x;var P=window.open(O,Y,"width="+F+",height="+q+",top="+p+",left="+U+",directories=no,toolbar=no,location=no,menubar=no,scrollbars=no,status=no,resizable=no,dependent=no");return P;};var c=function(L,P){var Y;var l=1024,O=786;var p=850,X=600;if(P=="list"){p=450,X=600;}if(document.all){l=document.body.clientWidth;O=document.body.clientHeight;x=window.screenTop;y=window.screenLeft;}else{if(window.innerWidth){l=window.innerWidth;O=window.innerHeight;x=window.screenX;y=window.screenY;}}var U=((l-p)/2)+y,q=((O-X)/2)+x;if(P=="list"&&!L){Y="index.php?method=Addressbook.editList";}else{if(P=="list"&&L){Y="index.php?method=Addressbook.editList&contactid="+L;}else{if(P!="list"&&L){Y="index.php?method=Addressbook.editContact&contactid="+L;}else{Y="index.php?method=Addressbook.editContact";}}}appId="addressbook";var F=window.open(Y,"popupname","width="+p+",height="+X+",top="+q+",left="+U+",directories=no,toolbar=no,location=no,menubar=no,scrollbars=no,status=no,resizable=no,dependent=no");return ;};var s=function(F){F=(F==null)?false:F;window.opener.Egw.Addressbook.reload();if(F==true){window.setTimeout("window.close()",400);}};var I=function(Y,F,P){var p=Ext.util.JSON.encode(Y);new Ext.data.Connection().request({url:"index.php",method:"post",scope:this,params:{method:"Addressbook.deleteContacts",_contactIDs:p},success:function(q,O){var U;try{U=Ext.util.JSON.decode(q.responseText);if(U.success==true){if(typeof F=="function"){F;}}else{Ext.MessageBox.alert("Failure!","Deleting contact failed!");}}catch(L){Ext.MessageBox.alert("Failure!",L.message);}},failure:function(U,q){console.log("failure function called");}});};var H=function(p){if(!P){var U=Ext.tree;treeLoader=new U.TreeLoader({dataUrl:"index.php"});treeLoader.on("beforeload",function(O,q){O.baseParams.method="Addressbook.getSubTree";O.baseParams._node=q.id;O.baseParams._datatype=q.attributes.datatype;O.baseParams._owner=q.attributes.owner;O.baseParams._location="selectFolder";},this);var F=new U.TreePanel("iWindowContAdrTag",{animate:true,loader:treeLoader,containerScroll:true,rootVisible:false});var Y=new U.TreeNode({text:"root",draggable:false,allowDrop:false,id:"root"});F.setRootNode(Y);Ext.each(application,function(q){Y.appendChild(new U.AsyncTreeNode(q));});F.render();F.on("click",function(){if(F.getSelectionModel().getSelectedNode()){var O=F.getSelectionModel().getSelectedNode().id;var q=F.getNodeById(O).attributes.owner;if((q>0)||(q<0)){p(q,q);P.hide();}else{Ext.MessageBox.alert("wrong selection","please select a valid addressbook");}}else{Ext.MessageBox.alert("no selection","please select an addressbook");}});var P=new Ext.Window({title:"please select addressbook",width:375,height:400,minWidth:375,minHeight:400,layout:"fit",plain:true,bodyStyle:"padding:5px;",buttonAlign:"center"});}P.show();};return {show:function(F){T();g(F);},displayAddressbookSelectDialog:H,reload:function(){k.reload();}};}();Egw.Addressbook.ContactEditDialog=function(){var c;var Z;var t;var Q=function(a,g){var z=Ext.getCmp("contactDialog").getForm();if(z.isValid()){var H={};if(formData.values){H.contact_id=formData.values.contact_id;}z.submit({waitTitle:"Please wait!",waitMsg:"saving contact...",params:H,success:function(A,G,f){window.opener.Egw.Addressbook.reload();},failure:function(A,G){}});}else{Ext.MessageBox.alert("Errors","Please fix the errors noted.");}};var R=function(a,g){var z=Ext.getCmp("contactDialog").getForm();if(z.isValid()){var H={};if(formData.values){H.contact_id=formData.values.contact_id;}z.submit({waitTitle:"Please wait!",waitMsg:"saving contact...",params:H,success:function(A,G,f){window.opener.Egw.Addressbook.reload();window.setTimeout("window.close()",400);},failure:function(A,G){}});}else{Ext.MessageBox.alert("Errors","Please fix the errors noted.");}};var b=function(H,z){var g=Ext.util.JSON.encode([formData.values.contact_id]);Ext.Ajax.request({url:"index.php",params:{method:"Addressbook.deleteContacts",_contactIds:g},text:"Deleting contact...",success:function(A,a){window.opener.Egw.Addressbook.reload();window.setTimeout("window.close()",400);},failure:function(a,A){Ext.MessageBox.alert("Failed","Some error occured while trying to delete the conctact.");}});};var S=new Ext.Action({text:"save and close",handler:R,iconCls:"action_saveAndClose"});var k=new Ext.Action({text:"apply changes",handler:Q,iconCls:"action_applyChanges"});var N=new Ext.Action({text:"delete contact",handler:b,iconCls:"action_delete"});var m=function(){Ext.QuickTips.init();Ext.form.Field.prototype.msgTarget="side";var G=true;if(formData.values){G=false;}var H=new Ext.Toolbar({region:"south",id:"applicationToolbar",split:false,height:26,items:[S,k,N]});var f=new Ext.data.JsonStore({url:"index.php",baseParams:{method:"Egwbase.getCountryList"},root:"results",id:"shortName",fields:["shortName","translatedName"],remoteSort:false});var a=new Ext.form.TriggerField({fieldLabel:"Addressbook",name:"contact_owner",anchor:"95%",readOnly:true});a.onTriggerClick=function(){Egw.Addressbook.displayAddressbookSelectDialog(D);};var A=new Ext.FormPanel({url:"index.php",baseParams:{method:"Addressbook.saveContact"},labelAlign:"top",bodyStyle:"padding:5px",anchor:"100%",region:"center",id:"contactDialog",tbar:H,items:[{layout:"column",border:false,anchor:"100%",items:[{columnWidth:0.4,layout:"form",border:false,items:[{xtype:"textfield",fieldLabel:"First Name",name:"n_given",anchor:"95%"},{xtype:"textfield",fieldLabel:"Middle Name",name:"n_middle",anchor:"95%"},{xtype:"textfield",fieldLabel:"Last Name",name:"n_family",allowBlank:false,anchor:"95%"}]},{columnWidth:0.2,layout:"form",border:false,items:[{xtype:"textfield",fieldLabel:"Prefix",name:"n_prefix",anchor:"95%"},{xtype:"textfield",fieldLabel:"Suffix",name:"n_suffix",anchor:"95%"},a]},{columnWidth:0.4,layout:"form",border:false,items:[{xtype:"textarea",name:"contact_note",fieldLabel:"Notes",grow:false,preventScrollbars:false,anchor:"95% 85%"}]}]},{xtype:"tabpanel",plain:true,activeTab:0,anchor:"100% 70%",defaults:{bodyStyle:"padding:10px"},items:[{title:"Business information",layout:"column",border:false,items:[{columnWidth:0.333,layout:"form",border:false,items:[{xtype:"textfield",fieldLabel:"Company",name:"org_name",anchor:"95%"},{xtype:"textfield",fieldLabel:"Street",name:"adr_one_street",anchor:"95%"},{xtype:"textfield",fieldLabel:"Street 2",name:"adr_one_street2",anchor:"95%"},{xtype:"textfield",fieldLabel:"Postalcode",name:"adr_one_postalcode",anchor:"95%"},{xtype:"textfield",fieldLabel:"City",name:"adr_one_locality",anchor:"95%"},{xtype:"textfield",fieldLabel:"Region",name:"adr_one_region",anchor:"95%"},new Ext.form.ComboBox({fieldLabel:"Country",name:"adr_one_countryname",hiddenName:"adr_one_countryname",store:f,displayField:"translatedName",valueField:"shortName",typeAhead:true,mode:"remote",triggerAction:"all",emptyText:"Select a state...",selectOnFocus:true,anchor:"95%"})]},{columnWidth:0.333,layout:"form",border:false,items:[{xtype:"textfield",fieldLabel:"Phone",name:"tel_work",anchor:"95%"},{xtype:"textfield",fieldLabel:"Cellphone",name:"tel_cell",anchor:"95%"},{xtype:"textfield",fieldLabel:"Fax",name:"tel_fax",anchor:"95%"},{xtype:"textfield",fieldLabel:"Car phone",name:"tel_car",anchor:"95%"},{xtype:"textfield",fieldLabel:"Pager",name:"tel_pager",anchor:"95%"},{xtype:"textfield",fieldLabel:"Email",name:"contact_email",vtype:"email",anchor:"95%"},{xtype:"textfield",fieldLabel:"URL",name:"contact_url",vtype:"url",anchor:"95%"},]},{columnWidth:0.333,layout:"form",border:false,items:[{xtype:"textfield",fieldLabel:"Unit",name:"org_unit",anchor:"95%"},{xtype:"textfield",fieldLabel:"Role",name:"contact_role",anchor:"95%"},{xtype:"textfield",fieldLabel:"Title",name:"contact_title",anchor:"95%"},{xtype:"textfield",fieldLabel:"Room",name:"contact_room",anchor:"95%"},{xtype:"textfield",fieldLabel:"Name Assistent",name:"contact_assistent",anchor:"95%"},{xtype:"textfield",fieldLabel:"Phone Assistent",name:"tel_assistent",anchor:"95%"},]}]},{title:"Private information",layout:"column",border:false,items:[{columnWidth:0.333,layout:"form",border:false,items:[{xtype:"textfield",fieldLabel:"Street",name:"adr_two_street",anchor:"95%"},{xtype:"textfield",fieldLabel:"Street2",name:"adr_two_street2",anchor:"95%"},{xtype:"textfield",fieldLabel:"Postalcode",name:"adr_two_postalcode",anchor:"95%"},{xtype:"textfield",fieldLabel:"City",name:"adr_two_locality",anchor:"95%"},{xtype:"textfield",fieldLabel:"Region",name:"adr_two_region",anchor:"95%"},new Ext.form.ComboBox({fieldLabel:"Country",name:"adr_two_countryname",hiddenName:"adr_two_countryname",store:f,displayField:"translatedName",valueField:"shortName",typeAhead:true,mode:"remote",triggerAction:"all",emptyText:"Select a state...",selectOnFocus:true,anchor:"95%"})]},{columnWidth:0.333,layout:"form",border:false,items:[new Ext.form.DateField({fieldLabel:"Birthday",name:"contact_bday",format:formData.config.dateFormat,altFormats:"Y-m-d",anchor:"95%"}),{xtype:"textfield",fieldLabel:"Phone",name:"tel_home",anchor:"95%"},{xtype:"textfield",fieldLabel:"Cellphone",name:"tel_cell_private",anchor:"95%"},{xtype:"textfield",fieldLabel:"Fax",name:"tel_fax_home",anchor:"95%"},{xtype:"textfield",fieldLabel:"Email",name:"contact_email_home",vtype:"email",anchor:"95%"},{xtype:"textfield",fieldLabel:"URL",name:"contact_url_home",vtype:"url",anchor:"95%"}]},{columnWidth:0.333,layout:"form",border:false,items:[new Ext.form.FieldSet({id:"photo",legend:"Photo"})]}]},{title:"Lists",layout:"column",border:false,items:[{}]},{title:"Categories",layout:"column",border:false,items:[{}]}]}]});var g=new Ext.Viewport({layout:"border",items:A});var z=new Ext.data.SimpleStore({fields:["id","addressbooks"],data:formData.config.addressbooks});return ;};var I=function(z,a){var H=Ext.getCmp("contactDialog").getForm();for(var A in a){console.log("set "+A+" to "+a[A]);var g=H.findField(A);if(g){g.setValue(a[A]);}}console.log("done");};var v=function(g,z){Ext.MessageBox.alert("Export","Not yet implemented.");};var D=function(z,g){t.setValues([{id:"contact_owner",value:g}]);};var T=function(){var A=Ext.Element.get("container");var f=A.createChild({tag:"div",id:"iWindowTag"});var G=A.createChild({tag:"div",id:"iWindowContTag"});var z=new Ext.data.SimpleStore({fields:["category_id","category_realname"],data:[["1","erste Kategorie"],["2","zweite Kategorie"],["3","dritte Kategorie"],["4","vierte Kategorie"],["5","fuenfte Kategorie"],["6","sechste Kategorie"],["7","siebte Kategorie"],["8","achte Kategorie"]]});z.load();ds_checked=new Ext.data.SimpleStore({fields:["category_id","category_realname"],data:[["2","zweite Kategorie"],["5","fuenfte Kategorie"],["6","sechste Kategorie"],["8","achte Kategorie"]]});ds_checked.load();var K=new Ext.form.Form({labelWidth:75,url:"index.php?method=Addressbook.saveAdditionalData",reader:new Ext.data.JsonReader({root:"results"},[{name:"category_id"},{name:"category_realname"},])});var g=1;var E=new Array();ds_checked.each(function(o){E[o.data.category_id]=o.data.category_realname;});z.each(function(o){if((g%12)==1){K.column({width:"33%",labelWidth:50,labelSeparator:""});}if(E[o.data.category_id]){K.add(new Ext.form.Checkbox({boxLabel:o.data.category_realname,name:o.data.category_realname,checked:true}));}else{K.add(new Ext.form.Checkbox({boxLabel:o.data.category_realname,name:o.data.category_realname}));}if((g%12)==0){K.end();}g=g+1;});K.render("iWindowContTag");if(!a){var a=new Ext.LayoutDialog("iWindowTag",{modal:true,width:700,height:400,shadow:true,minWidth:700,minHeight:400,autoTabs:true,proxyDrag:true,center:{autoScroll:true,tabPosition:"top",closeOnTab:true,alwaysShowTabs:true}});a.addKeyListener(27,this.hide);a.addButton("save",function(){Ext.MessageBox.alert("Todo","Not yet implemented!");a.hide;},a);a.addButton("cancel",function(){Ext.MessageBox.alert("Todo","Not yet implemented!");a.hide;},a);var H=a.getLayout();H.beginUpdate();H.add("center",new Ext.ContentPanel("iWindowContTag",{autoCreate:true,title:"Category"}));H.endUpdate();}a.show();};var V=function(){var A=Ext.Element.get("container");var f=A.createChild({tag:"div",id:"iWindowTag"});var G=A.createChild({tag:"div",id:"iWindowContTag"});var z=new Ext.data.SimpleStore({fields:["list_id","list_realname"],data:[["1","Liste A"],["2","Liste B"],["3","Liste C"],["4","Liste D"],["5","Liste E"],["6","Liste F"],["7","Liste G"],["8","Liste H"]]});z.load();ds_checked=new Ext.data.SimpleStore({fields:["list_id","list_realname"],data:[["2","Liste B"],["5","Liste E"],["6","Liste F"],["8","Liste H"]]});ds_checked.load();var K=new Ext.form.Form({labelWidth:75,url:"index.php?method=Addressbook.saveAdditionalData",reader:new Ext.data.JsonReader({root:"results"},[{name:"list_id"},{name:"list_realname"},])});var g=1;var E=new Array();ds_checked.each(function(o){E[o.data.list_id]=o.data.list_realname;});z.each(function(o){if((g%12)==1){K.column({width:"33%",labelWidth:50,labelSeparator:""});}if(E[o.data.list_id]){K.add(new Ext.form.Checkbox({boxLabel:o.data.list_realname,name:o.data.list_realname,checked:true}));}else{K.add(new Ext.form.Checkbox({boxLabel:o.data.list_realname,name:o.data.list_realname}));}if((g%12)==0){K.end();}g=g+1;});K.render("iWindowContTag");if(!a){var a=new Ext.LayoutDialog("iWindowTag",{modal:true,width:700,height:400,shadow:true,minWidth:700,minHeight:400,autoTabs:true,proxyDrag:true,center:{autoScroll:true,tabPosition:"top",closeOnTab:true,alwaysShowTabs:true}});a.addKeyListener(27,this.hide);a.addButton("save",function(){Ext.MessageBox.alert("Todo","Not yet implemented!");},a);a.addButton("cancel",function(){window.location.reload();a.hide;},a);var H=a.getLayout();H.beginUpdate();H.add("center",new Ext.ContentPanel("iWindowContTag",{autoCreate:true,title:"Lists"}));H.endUpdate();}a.show();};return {display:function(){var z=m();if(formData.values){I(z,formData.values);}}};}();Egw.Addressbook.ListEditDialog=function(){var c;var m=new Ext.Action({text:"save and close",iconCls:"action_saveAndClose"});var v=new Ext.Action({text:"apply changes",iconCls:"action_applyChanges"});var b=new Ext.Action({text:"delete contact",iconCls:"action_delete"});var Q=function(){Ext.QuickTips.init();Ext.form.Field.prototype.msgTarget="side";var o=true;if(formData.values){o=false;}var K=new Ext.Toolbar({region:"south",id:"applicationToolbar",split:false,height:26,items:[m,v,b]});var f=new Ext.data.SimpleStore({fields:["id","addressbooks"],data:formData.config.addressbooks});var z=new Ext.form.TriggerField({fieldLabel:"Addressbook",name:"list_owner",anchor:"95%",readOnly:true});z.onTriggerClick=function(){Egw.Addressbook.displayAddressbookSelectDialog(T);};var H=new Ext.FormPanel({url:"index.php",baseParams:{method:"Addressbook.saveList"},labelAlign:"top",bodyStyle:"padding:5px",anchor:"100%",region:"center",id:"listDialog",tbar:K,items:[{layout:"form",title:"list information",border:false,anchor:"100%",items:[z,{xtype:"textfield",fieldLabel:"List Name",name:"list_name",anchor:"95%"},{xtype:"textarea",fieldLabel:"List Description",name:"list_description",grow:false,anchor:"95%"}]}]});H.on("beforeaction",function(n,s){n.baseParams._listOwner=n.getValues().list_owner;n.baseParams._listmembers=t(N);if(formData.values&&formData.values.list_id){n.baseParams._listId=formData.values.list_id;}else{n.baseParams._listId="";}});if(formData.values){var Z=formData.values.list_owner;var E=formData.values.list_id;}else{var Z=-1;var E=-1;}searchDS=new Ext.data.JsonStore({url:"index.php",baseParams:{method:"Addressbook.getOverview",owner:Z,options:"{\"displayContacts\":true,\"displayLists\":false}",},root:"results",totalProperty:"totalcount",id:"contact_id",fields:[{name:"contact_id"},{name:"n_family"},{name:"n_given"},{name:"contact_email"}],remoteSort:true,success:function(s,n){},failure:function(s,n){}});searchDS.setDefaultSort("n_family","asc");var g=new Ext.Template("<div class=\"search-item\">","{n_family}, {n_given} {contact_email}","</div>");var k=new Ext.form.ComboBox({title:"select new list members",store:searchDS,displayField:"n_family",typeAhead:false,loadingText:"Searching...",width:415,pageSize:10,hideTrigger:true,tpl:g,onSelect:function(n){var s=new S({contact_id:n.data.contact_id,n_family:n.data.n_family,contact_email:n.data.contact_email});N.add(s);N.sort("n_family");k.reset();k.collapse();}});k.on("specialkey",function(U,r){if(searchDS.getCount()==0){var p=/^[a-z0-9_-]+(\.[a-z0-9_-]+)*@([0-9a-z][0-9a-z-]*[0-9a-z]\.)+([a-z]{2,4}|museum)$/;var n=p.exec(k.getValue());if(n&&(r.getKey()==r.ENTER||r.getKey()==e.RETURN)){var P=k.getValue();var s=P.indexOf("@");if(s!=-1){var Y=Ext.util.Format.capitalize(P.substr(0,s));}else{var Y=P;}var F=new S({contact_id:"-1",n_family:Y,contact_email:P});N.add(F);N.sort("n_family");k.reset();}}});H.add(k);var a=new Ext.Viewport({layout:"border",items:H});var S=Ext.data.Record.create([{name:"contact_id",type:"int"},{name:"n_family",type:"string"},{name:"contact_email",type:"string"}]);if(formData.values){var I=formData.values.list_members;}var N=new Ext.data.SimpleStore({fields:["contact_id","n_family","contact_email"],data:I});N.sort("n_family","ASC");var A=new Ext.grid.ColumnModel([{resizable:true,id:"n_family",header:"Family name",dataIndex:"n_family"},{resizable:true,id:"contact_email",header:"eMail address",dataIndex:"contact_email"}]);A.defaultSortable=true;var G=new Ext.menu.Menu({id:"ctxListMenu",items:[{id:"delete",text:"delete entry",icon:"images/oxygen/16x16/actions/edit-delete.png",handler:R}]});var D=new Ext.grid.GridPanel({store:N,columns:A,sm:new Ext.grid.RowSelectionModel({multiSelect:true}),monitorWindowResize:false,trackMouseOver:true,autoExpandColumn:"contact_email"});D.on("rowcontextmenu",function(r,F,n){n.stopEvent();var s=r.getDataSource().getAt(F);if(s.data.contact_tid=="l"){G.showAt(n.getXY());}else{G.showAt(n.getXY());}});a.add(D);return ;};var T=function(N,Z){c.setValues([{id:"list_owner",value:Z}]);};var R=function(S,N){var I=Array();var D=listGrid.getSelectionModel().getSelections();for(var Z=0;Z<D.length;++Z){ds_listMembers.remove(D[Z]);}};var V=function(N,Z){N.findField("list_name").setValue(Z["list_name"]);N.findField("list_description").setValue(Z["list_description"]);N.findField("list_owner").setValue(Z["list_owner"]);};var t=function(Z){var N=new Array();Z.each(function(I){N.push(I.data);},this);return Ext.util.JSON.encode(N);};return {display:function(){var N=Q();if(formData.values){}}};}();