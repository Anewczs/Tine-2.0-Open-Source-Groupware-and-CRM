Ext.namespace("Egw.Addressbook");Egw.Addressbook=function(){var C;var F=true;var p=false;var q;var m;var K=function(z){if(!q){q=Ext.getCmp("contacts-tree").getSelectionModel().getSelectedNode();}switch(q.attributes.datatype){case "list":z.baseParams.listId=q.attributes.listId;z.baseParams.method="Addressbook.getList";break;case "contacts":case "otherpeople":case "sharedaddressbooks":z.baseParams.method="Addressbook.getContacts";break;case "overview":z.baseParams.method="Addressbook.getOverview";break;}z.baseParams.datatype=q.attributes.datatype;z.baseParams.owner=q.attributes.owner;z.baseParams.query=Ext.getCmp("quickSearchField").getRawValue();};var c=function(b,z){Z("contactWindow","index.php?method=Addressbook.editContact&_contactId=",850,600);};var Y=function(b,z){Z("listWindow","index.php?method=Addressbook.editList&_listId=",450,600);};var E=function(d,z){var o=Array();var O=m.getSelectionModel().getSelections();for(var b=0;b<O.length;++b){o.push(O[b].id);}o=Ext.util.JSON.encode(o);Ext.Ajax.request({url:"index.php",params:{method:"Addressbook.deleteContacts",_contactIds:o},text:"Deleting contact...",success:function(T,a){C.reload();},failure:function(a,T){Ext.MessageBox.alert("Failed","Some error occured while trying to delete the conctact.");}});};var s=function(O,z){var o=m.getSelectionModel().getSelections();var b=o[0].id;if(o[0].data.contact_tid=="l"){Z("listWindow","index.php?method=Addressbook.editList&_listId="+b,450,600);}else{Z("contactWindow","index.php?method=Addressbook.editContact&_contactId="+b,850,600);}};var A=function(z,b){C.reload();};var X=new Ext.Action({text:"add contact",handler:c,iconCls:"action_addContact"});var S=new Ext.Action({text:"add list",handler:Y,iconCls:"action_addList"});var D=new Ext.Action({text:"edit",disabled:true,handler:s,iconCls:"action_edit"});var k=new Ext.Action({text:"delete",disabled:true,handler:E,iconCls:"action_delete"});var t=function(){var b=Ext.getCmp("north-panel");var o=Ext.getCmp("applicationToolbar");b.remove(o);var O=new Ext.app.SearchField({id:"quickSearchField",width:240,emptyText:"enter searchfilter"});O.on("change",A);var z=new Ext.Toolbar({region:"south",id:"applicationToolbar",split:false,height:26,items:[X,S,D,k,"->","Search:"," "," ",O]});b.add(z);b.doLayout();return ;};var R=function(){var o=new Ext.tree.TreeLoader({dataUrl:"index.php"});o.on("beforeload",function(d,O){d.baseParams.method="Addressbook.getSubTree";d.baseParams._node=O.id;d.baseParams._datatype=O.attributes.datatype;d.baseParams._owner=O.attributes.owner;d.baseParams._location="mainTree";},this);var b=new Ext.tree.TreePanel({title:"Contacts",id:"contacts-tree",loader:o,rootVisible:false,border:false});var z=new Ext.tree.TreeNode({text:"root",draggable:false,allowDrop:false,id:"root"});b.setRootNode(z);for(i=0;i<initialTree.length;i++){z.appendChild(new Ext.tree.AsyncTreeNode(initialTree[i]));}b.on("click",function(d,O){q=d;C.reload();},this);b.on("expand",function(O){if(O.getSelectionModel().getSelectedNode()==null){O.expandPath("/root/alllists");O.selectPath("/root/addressbook");}t();g(O.getSelectionModel().getSelectedNode());},this);return b;};var Q=function(){var a=Ext.getCmp("west");if(a.items){for(var b=0;b<a.items.length;b++){a.remove(a.items.get(b));}}var d=new Ext.tree.TreeLoader({dataUrl:"index.php"});d.on("beforeload",function(W,T){W.baseParams.method="Addressbook.getSubTree";W.baseParams._node=T.id;W.baseParams._datatype=T.attributes.datatype;W.baseParams._owner=T.attributes.owner;W.baseParams._location="mainTree";},this);var o=new Ext.tree.TreePanel({id:"contact-tree",loader:d,rootVisible:false,border:false});var z=new Ext.tree.TreeNode({text:"root",draggable:false,allowDrop:false,id:"root"});o.setRootNode(z);for(b=0;b<initialTree.length;b++){z.appendChild(new Ext.tree.AsyncTreeNode(initialTree[b]));}o.on("click",function(W,T){q=W;C.reload();},this);a.add(o);a.show();a.doLayout();o.expandPath("/root/alllists");o.selectPath("/root/addressbook");return ;var z=o.getRootNode();var O=Array();z.eachChild(function(T){O.push(T);},this);z.appendChild(new Ext.tree.AsyncTreeNode(initialTree));o.expandPath("/root/addressbook");o.selectPath("/root/addressbook");o.on("click",function(T){C.reload();});};var g=function(){var z=Ext.getCmp("center-panel");if(z.items){for(var b=0;b<z.items.length;b++){z.remove(z.items.get(b));}}C=new Ext.data.JsonStore({url:"index.php",root:"results",totalProperty:"totalcount",id:"contact_id",fields:[{name:"contact_id"},{name:"contact_tid"},{name:"contact_owner"},{name:"contact_private"},{name:"cat_id"},{name:"n_family"},{name:"n_given"},{name:"n_middle"},{name:"n_prefix"},{name:"n_suffix"},{name:"n_fn"},{name:"n_fileas"},{name:"contact_bday"},{name:"org_name"},{name:"org_unit"},{name:"contact_title"},{name:"contact_role"},{name:"contact_assistent"},{name:"contact_room"},{name:"adr_one_street"},{name:"adr_one_street2"},{name:"adr_one_locality"},{name:"adr_one_region"},{name:"adr_one_postalcode"},{name:"adr_one_countryname"},{name:"contact_label"},{name:"adr_two_street"},{name:"adr_two_street2"},{name:"adr_two_locality"},{name:"adr_two_region"},{name:"adr_two_postalcode"},{name:"adr_two_countryname"},{name:"tel_work"},{name:"tel_cell"},{name:"tel_fax"},{name:"tel_assistent"},{name:"tel_car"},{name:"tel_pager"},{name:"tel_home"},{name:"tel_fax_home"},{name:"tel_cell_private"},{name:"tel_other"},{name:"tel_prefer"},{name:"contact_email"},{name:"contact_email_home"},{name:"contact_url"},{name:"contact_url_home"},{name:"contact_freebusy_uri"},{name:"contact_calendar_uri"},{name:"contact_note"},{name:"contact_tz"},{name:"contact_geo"},{name:"contact_pubkey"},{name:"contact_created"},{name:"contact_creator"},{name:"contact_modified"},{name:"contact_modifier"},{name:"contact_jpegphoto"},{name:"account_id"}],remoteSort:true});C.setDefaultSort("n_family","asc");C.loadData({"results":[],"totalcount":"0","status":"success"});C.on("beforeload",K);C.load({params:{start:0,limit:50}});var o=new Ext.PagingToolbar({pageSize:25,store:C,displayInfo:true,displayMsg:"Displaying contacts {0} - {1} of {2}",emptyMsg:"No contacts to display"});var O=new Ext.grid.ColumnModel([{resizable:true,id:"contact_tid",header:"Type",dataIndex:"contact_tid",width:30,renderer:n},{resizable:true,id:"n_family",header:"Family name",dataIndex:"n_family"},{resizable:true,id:"n_given",header:"Given name",dataIndex:"n_given",width:80},{resizable:true,id:"n_fn",header:"Full name",dataIndex:"n_fn",hidden:true},{resizable:true,id:"n_fileas",header:"Name + Firm",dataIndex:"n_fileas",hidden:true},{resizable:true,id:"contact_email",header:"eMail",dataIndex:"contact_email",width:150,hidden:false},{resizable:true,id:"contact_bday",header:"Birthday",dataIndex:"contact_bday",hidden:true},{resizable:true,id:"org_name",header:"Organisation",dataIndex:"org_name",width:150},{resizable:true,id:"org_unit",header:"Unit",dataIndex:"org_unit",hidden:true},{resizable:true,id:"contact_title",header:"Title",dataIndex:"contact_title",hidden:true},{resizable:true,id:"contact_role",header:"Role",dataIndex:"contact_role",hidden:true},{resizable:true,id:"contact_room",header:"Room",dataIndex:"contact_room",hidden:true},{resizable:true,id:"adr_one_street",header:"Street",dataIndex:"adr_one_street",hidden:true},{resizable:true,id:"adr_one_locality",header:"Locality",dataIndex:"adr_one_locality",width:80,hidden:false},{resizable:true,id:"adr_one_region",header:"Region",dataIndex:"adr_one_region",hidden:true},{resizable:true,id:"adr_one_postalcode",header:"Postalcode",dataIndex:"adr_one_postalcode",hidden:true},{resizable:true,id:"adr_one_countryname",header:"Country",dataIndex:"adr_one_countryname",hidden:true},{resizable:true,id:"adr_two_street",header:"Street (private)",dataIndex:"adr_two_street",hidden:true},{resizable:true,id:"adr_two_locality",header:"Locality (private)",dataIndex:"adr_two_locality",hidden:true},{resizable:true,id:"adr_two_region",header:"Region (private)",dataIndex:"adr_two_region",hidden:true},{resizable:true,id:"adr_two_postalcode",header:"Postalcode (private)",dataIndex:"adr_two_postalcode",hidden:true},{resizable:true,id:"adr_two_countryname",header:"Country (private)",dataIndex:"adr_two_countryname",hidden:true},{resizable:true,id:"tel_work",header:"Phone",dataIndex:"tel_work",hidden:false},{resizable:true,id:"tel_cell",header:"Cellphone",dataIndex:"tel_cell",hidden:false},{resizable:true,id:"tel_fax",header:"Fax",dataIndex:"tel_fax",hidden:true},{resizable:true,id:"tel_car",header:"Car phone",dataIndex:"tel_car",hidden:true},{resizable:true,id:"tel_pager",header:"Pager",dataIndex:"tel_pager",hidden:true},{resizable:true,id:"tel_home",header:"Phone (private)",dataIndex:"tel_home",hidden:true},{resizable:true,id:"tel_fax_home",header:"Fax (private)",dataIndex:"tel_fax_home",hidden:true},{resizable:true,id:"tel_cell_private",header:"Cellphone (private)",dataIndex:"tel_cell_private",hidden:true},{resizable:true,id:"contact_email_home",header:"eMail (private)",dataIndex:"contact_email_home",hidden:true},{resizable:true,id:"contact_url",header:"URL",dataIndex:"contact_url",hidden:true},{resizable:true,id:"contact_url_home",header:"URL (private)",dataIndex:"contact_url_home",hidden:true},{resizable:true,id:"contact_note",header:"Note",dataIndex:"contact_note",hidden:true},{resizable:true,id:"contact_tz",header:"Timezone",dataIndex:"contact_tz",hidden:true},{resizable:true,id:"contact_geo",header:"Geo",dataIndex:"contact_geo",hidden:true}]);O.defaultSortable=true;m=new Ext.grid.GridPanel({store:C,cm:O,tbar:o,autoSizeColumns:false,selModel:new Ext.grid.RowSelectionModel({multiSelect:true}),enableColLock:false,autoExpandColumn:"n_family",border:false});z.add(m);z.show();z.doLayout();m.on("rowclick",function(W,T,a){var d=m.getSelectionModel().getCount();if(d<1){D.setDisabled(true);k.setDisabled(true);}else{if(d==1){D.setDisabled(false);k.setDisabled(false);}else{D.setDisabled(true);k.setDisabled(false);}}});m.on("rowcontextmenu",function(T,W,a){a.stopEvent();var d=T.getStore().getAt(W);B.showAt(a.getXY());});m.on("rowdblclick",function(a,T,W){var d=a.getStore().getAt(T);if(d.data.contact_tid=="l"){try{Z("listWindow","index.php?method=Addressbook.editList&_listId="+d.data.contact_id,450,600);}catch(u){}}else{try{Z("contactWindow","index.php?method=Addressbook.editContact&_contactId="+d.data.contact_id,850,600);}catch(u){}}});return ;textF1=new Ext.form.TextField({height:22,width:200,emptyText:"Suchparameter ...",allowBlank:false});textF1.on("specialkey",function(a,d){if(d.getKey()==d.ENTER||d.getKey()==e.RETURN){}});};var n=function(O,a,o,z,b,d){switch(O){case "l":return "<img src='images/oxygen/16x16/actions/users.png' width='12' height='12' alt='list'/>";default:return "<img src='images/oxygen/16x16/actions/user.png' width='12' height='12' alt='contact'/>";}};var J=function(b,z){F=b.pressed;C.reload();};var M=function(b,z){p=b.pressed;C.reload();};var B=new Ext.menu.Menu({id:"ctxMenuAddress",items:[D,k,"-",X,S]});var G=function(b,z){};var Z=function(b,T,z,a){if(document.all){w=document.body.clientWidth;h=document.body.clientHeight;x=window.screenTop;y=window.screenLeft;}else{if(window.innerWidth){w=window.innerWidth;h=window.innerHeight;x=window.screenX;y=window.screenY;}}var d=((w-z)/2)+y;var O=((h-a)/2)+x;var o=window.open(T,b,"width="+z+",height="+a+",top="+O+",left="+d+",directories=no,toolbar=no,location=no,menubar=no,scrollbars=no,status=no,resizable=no,dependent=no");return o;};var V=function(W,o){var b;var H=1024,T=786;var O=850,u=600;if(o=="list"){O=450,u=600;}if(document.all){H=document.body.clientWidth;T=document.body.clientHeight;x=window.screenTop;y=window.screenLeft;}else{if(window.innerWidth){H=window.innerWidth;T=window.innerHeight;x=window.screenX;y=window.screenY;}}var d=((H-O)/2)+y,a=((T-u)/2)+x;if(o=="list"&&!W){b="index.php?method=Addressbook.editList";}else{if(o=="list"&&W){b="index.php?method=Addressbook.editList&contactid="+W;}else{if(o!="list"&&W){b="index.php?method=Addressbook.editContact&contactid="+W;}else{b="index.php?method=Addressbook.editContact";}}}appId="addressbook";var z=window.open(b,"popupname","width="+O+",height="+u+",top="+a+",left="+d+",directories=no,toolbar=no,location=no,menubar=no,scrollbars=no,status=no,resizable=no,dependent=no");return ;};var f=function(z){z=(z==null)?false:z;window.opener.Egw.Addressbook.reload();if(z==true){window.setTimeout("window.close()",400);}};var I=function(O){if(!o){var o=new Ext.Window({title:"please select addressbook",modal:true,width:375,height:400,minWidth:375,minHeight:400,layout:"fit",plain:true,bodyStyle:"padding:5px;",buttonAlign:"center"});var d=Ext.tree;treeLoader=new d.TreeLoader({dataUrl:"index.php"});treeLoader.on("beforeload",function(T,a){T.baseParams.method="Addressbook.getSubTree";T.baseParams._node=a.id;T.baseParams._datatype=a.attributes.datatype;T.baseParams._owner=a.attributes.owner;T.baseParams._location="selectFolder";},this);var z=new d.TreePanel({animate:true,id:"addressbookTree",loader:treeLoader,containerScroll:true,rootVisible:false});var b=new d.TreeNode({text:"root",draggable:false,allowDrop:false,id:"root"});z.setRootNode(b);Ext.each(application,function(a){b.appendChild(new d.AsyncTreeNode(a));});z.on("click",function(W){W.select();if(z.getSelectionModel().getSelectedNode()){var u=z.getSelectionModel().getSelectedNode().id;var T=z.getNodeById(u).attributes.owner;if((T>0)||(T<0)){var a=Ext.getCmp("addressbook_");a.setValue(T);o.hide();}else{Ext.MessageBox.alert("wrong selection","please select a valid addressbook");}}else{Ext.MessageBox.alert("no selection","please select an addressbook");}});o.add(z);o.show();}};return {show:function(z){t();Q();g(z);},displayAddressbookSelectDialog:I,getPanel:R,reload:function(){C.reload();}};}();Egw.Addressbook.ContactEditDialog=function(){var Q;var G;var p;var M=function(F,R){var I=Ext.getCmp("contactDialog").getForm();I.render();if(I.isValid()){var A={};if(formData.values){A.contact_id=formData.values.contact_id;}I.submit({waitTitle:"Please wait!",waitMsg:"saving contact...",params:A,success:function(J,S,Z){window.opener.Egw.Addressbook.reload();},failure:function(J,S){}});}else{Ext.MessageBox.alert("Errors","Please fix the errors noted.");}};var B=function(F,R){var I=Ext.getCmp("contactDialog").getForm();I.render();if(I.isValid()){var A={};if(formData.values){A.contact_id=formData.values.contact_id;}I.submit({waitTitle:"Please wait!",waitMsg:"saving contact...",params:A,success:function(J,S,Z){window.opener.Egw.Addressbook.reload();window.setTimeout("window.close()",400);},failure:function(J,S){}});}else{Ext.MessageBox.alert("Errors","Please fix the errors noted.");}};var V=function(A,I){var R=Ext.util.JSON.encode([formData.values.contact_id]);Ext.Ajax.request({url:"index.php",params:{method:"Addressbook.deleteContacts",_contactIds:R},text:"Deleting contact...",success:function(J,F){window.opener.Egw.Addressbook.reload();window.setTimeout("window.close()",400);},failure:function(F,J){Ext.MessageBox.alert("Failed","Some error occured while trying to delete the conctact.");}});};var C=new Ext.Action({text:"save and close",handler:B,iconCls:"action_saveAndClose"});var g=new Ext.Action({text:"apply changes",handler:M,iconCls:"action_applyChanges"});var K=new Ext.Action({text:"delete contact",handler:V,iconCls:"action_delete"});var t=function(){Ext.QuickTips.init();Ext.form.Field.prototype.msgTarget="side";var I=true;if(formData.values){I=false;}var S=new Ext.Toolbar({region:"south",id:"applicationToolbar",split:false,height:26,items:[C,g,K]});var O=new Ext.data.JsonStore({url:"index.php",baseParams:{method:"Egwbase.getCountryList"},root:"results",id:"shortName",fields:["shortName","translatedName"],remoteSort:false});var d=new Ext.form.TriggerField({fieldLabel:"Addressbook",name:"contact_owner",id:"addressbook_",anchor:"95%",readOnly:true});d.onTriggerClick=function(){Egw.Addressbook.displayAddressbookSelectDialog(s);};var Z=function(a){a.baseParams.method="Addressbook.getContacts";a.baseParams.options=Ext.encode({displayContacts:false,displayLists:true});};var J=[["AL","Alabama"],["AK","Alaska"],["AZ","Arizona"],["WV","West Virginia"],["WI","Wisconsin"],["WY","Wyoming"]];var X=new Ext.data.SimpleStore({fields:["contact_id","contact_tid"],data:J});var k=new Ext.data.SimpleStore({fields:["contact_id","contact_tid"]});var n=new Ext.DataView({style:"overflow:auto",multiSelect:true,id:"list_source_",cls:"x-list-small",selectedClass:"x-list-selected",itemSelector:"div.x-view",store:X,tpl:new Ext.XTemplate("<tpl for=\".\">","<div class=\"x-view\" id=\"{contact_id}\">{contact_tid}</div>","</tpl>")});function f(W,T){return W-T;}var A=function(u,U,H,W){var U=Ext.getCmp("list_source_");var T=String(U.getSelectedIndexes());var l=U.getSelectionCount();if(U.getSelectionCount()>"1"){var L=T.split(",");}else{if(U.getSelectionCount()=="1"){var L=new Array(T);}}L.sort(f);L.reverse();for(i=0;i<l;i++){var a=X.getAt(L[i]);k.add(a);}k.sort("contact_tid","ASC");for(i=0;i<l;i++){var a=X.getAt(L[i]);X.remove(a);}X.sort("contact_tid","ASC");};var F=function(u,U,H,W){var U=Ext.getCmp("list_selected_");var T=String(U.getSelectedIndexes());var l=U.getSelectionCount();if(U.getSelectionCount()>"1"){var L=T.split(",");}else{if(U.getSelectionCount()=="1"){var L=new Array(T);}}L.sort(f);L.reverse();for(i=0;i<l;i++){var a=k.getAt(L[i]);X.add(a);}X.sort("contact_tid","ASC");for(i=0;i<l;i++){var a=k.getAt(L[i]);k.remove(a);}k.sort("contact_tid","ASC");};n.on("dblclick",A);var b=new Ext.DataView({style:"overflow:auto",multiSelect:true,id:"list_selected_",cls:"x-list-small",selectedClass:"x-list-selected",itemSelector:"div.x-view",store:k,tpl:new Ext.XTemplate("<tpl for=\".\">","<div class=\"x-view\" id=\"{contact_id}\">{contact_tid}</div>","</tpl>")});b.on("dblclick",F);var z=new Ext.Panel({id:"list_source",title:"available lists",region:"center",margins:"5 5 5 0",layout:"fit",items:n});var m=new Ext.Panel({id:"list_selected",title:"chosen lists",region:"center",margins:"5 5 5 0",layout:"fit",items:b});var Y=new Ext.FormPanel({url:"index.php",baseParams:{method:"Addressbook.saveContact"},labelAlign:"top",bodyStyle:"padding:5px",anchor:"100%",region:"center",id:"contactDialog",tbar:S,deferredRender:false,items:[{layout:"column",border:false,deferredRender:false,anchor:"100%",items:[{columnWidth:0.4,layout:"form",border:false,items:[{xtype:"textfield",fieldLabel:"First Name",name:"n_given",anchor:"95%"},{xtype:"textfield",fieldLabel:"Middle Name",name:"n_middle",anchor:"95%"},{xtype:"textfield",fieldLabel:"Last Name",name:"n_family",allowBlank:false,anchor:"95%"}]},{columnWidth:0.2,layout:"form",border:false,items:[{xtype:"textfield",fieldLabel:"Prefix",name:"n_prefix",anchor:"95%"},{xtype:"textfield",fieldLabel:"Suffix",name:"n_suffix",anchor:"95%"},d]},{columnWidth:0.4,layout:"form",border:false,items:[{xtype:"textarea",name:"contact_note",fieldLabel:"Notes",grow:false,preventScrollbars:false,anchor:"95% 85%"}]}]},{xtype:"tabpanel",plain:true,activeTab:0,deferredRender:false,anchor:"100% 70%",defaults:{bodyStyle:"padding:10px"},items:[{title:"Business information",layout:"column",deferredRender:false,border:false,items:[{columnWidth:0.333,layout:"form",border:false,items:[{xtype:"textfield",fieldLabel:"Company",name:"org_name",anchor:"95%"},{xtype:"textfield",fieldLabel:"Street",name:"adr_one_street",anchor:"95%"},{xtype:"textfield",fieldLabel:"Street 2",name:"adr_one_street2",anchor:"95%"},{xtype:"textfield",fieldLabel:"Postalcode",name:"adr_one_postalcode",anchor:"95%"},{xtype:"textfield",fieldLabel:"City",name:"adr_one_locality",anchor:"95%"},{xtype:"textfield",fieldLabel:"Region",name:"adr_one_region",anchor:"95%"},new Ext.form.ComboBox({fieldLabel:"Country",name:"adr_one_countryname",hiddenName:"adr_one_countryname",store:O,displayField:"translatedName",valueField:"shortName",typeAhead:true,mode:"remote",triggerAction:"all",emptyText:"Select a state...",selectOnFocus:true,anchor:"95%"})]},{columnWidth:0.333,layout:"form",border:false,items:[{xtype:"textfield",fieldLabel:"Phone",name:"tel_work",anchor:"95%"},{xtype:"textfield",fieldLabel:"Cellphone",name:"tel_cell",anchor:"95%"},{xtype:"textfield",fieldLabel:"Fax",name:"tel_fax",anchor:"95%"},{xtype:"textfield",fieldLabel:"Car phone",name:"tel_car",anchor:"95%"},{xtype:"textfield",fieldLabel:"Pager",name:"tel_pager",anchor:"95%"},{xtype:"textfield",fieldLabel:"Email",name:"contact_email",vtype:"email",anchor:"95%"},{xtype:"textfield",fieldLabel:"URL",name:"contact_url",vtype:"url",anchor:"95%"}]},{columnWidth:0.333,layout:"form",border:false,items:[{xtype:"textfield",fieldLabel:"Unit",name:"org_unit",anchor:"95%"},{xtype:"textfield",fieldLabel:"Role",name:"contact_role",anchor:"95%"},{xtype:"textfield",fieldLabel:"Title",name:"contact_title",anchor:"95%"},{xtype:"textfield",fieldLabel:"Room",name:"contact_room",anchor:"95%"},{xtype:"textfield",fieldLabel:"Name Assistent",name:"contact_assistent",anchor:"95%"},{xtype:"textfield",fieldLabel:"Phone Assistent",name:"tel_assistent",anchor:"95%"}]}]},{title:"Private information",layout:"column",deferredRender:false,border:false,items:[{columnWidth:0.333,layout:"form",border:false,items:[{xtype:"textfield",fieldLabel:"Street",name:"adr_two_street",anchor:"95%"},{xtype:"textfield",fieldLabel:"Street2",name:"adr_two_street2",anchor:"95%"},{xtype:"textfield",fieldLabel:"Postalcode",name:"adr_two_postalcode",anchor:"95%"},{xtype:"textfield",fieldLabel:"City",name:"adr_two_locality",anchor:"95%"},{xtype:"textfield",fieldLabel:"Region",name:"adr_two_region",anchor:"95%"},new Ext.form.ComboBox({fieldLabel:"Country",name:"adr_two_countryname",hiddenName:"adr_two_countryname",store:O,displayField:"translatedName",valueField:"shortName",typeAhead:true,mode:"remote",triggerAction:"all",emptyText:"Select a state...",selectOnFocus:true,anchor:"95%"})]},{columnWidth:0.333,layout:"form",border:false,items:[new Ext.form.DateField({fieldLabel:"Birthday",name:"contact_bday",format:formData.config.dateFormat,altFormats:"Y-m-d",anchor:"95%"}),{xtype:"textfield",fieldLabel:"Phone",name:"tel_home",anchor:"95%"},{xtype:"textfield",fieldLabel:"Cellphone",name:"tel_cell_private",anchor:"95%"},{xtype:"textfield",fieldLabel:"Fax",name:"tel_fax_home",anchor:"95%"},{xtype:"textfield",fieldLabel:"Email",name:"contact_email_home",vtype:"email",anchor:"95%"},{xtype:"textfield",fieldLabel:"URL",name:"contact_url_home",vtype:"url",anchor:"95%"}]},{columnWidth:0.333,layout:"form",border:false,items:[new Ext.form.FieldSet({id:"photo",legend:"Photo"})]}]},{title:"Lists",layout:"column",deferredRender:false,border:false,items:[{columnWidth:0.333,layout:"form",border:false,items:[new Ext.Panel({layout:"fit",id:"source",width:250,height:350,items:[z]})]},{columnWidth:0.333,layout:"form",border:false,extraCls:"list-butons",items:[new Ext.Button({text:"add",iconCls:"blist",minWidth:80,handler:A,icon:"images/oxygen/16x16/actions/arrow-right-double.png"}),new Ext.Button({text:"remove",iconCls:"blist",minWidth:80,handler:F,icon:"images/oxygen/16x16/actions/arrow-left-double.png"})]},{columnWidth:0.333,layout:"form",border:false,items:[new Ext.Panel({layout:"fit",id:"destination",width:250,height:350,items:[m]})]}]},{title:"Categories",layout:"column",deferredRender:false,border:false,items:[{}]}]}]});var o=new Ext.Viewport({layout:"border",items:Y});var R=new Ext.data.SimpleStore({fields:["id","addressbooks"],data:formData.config.addressbooks});return ;};var D=function(I,F){var A=Ext.getCmp("contactDialog").getForm();for(var J in F){var R=A.findField(J);if(R){R.setValue(F[J]);}}};var c=function(R,I){Ext.MessageBox.alert("Export","Not yet implemented.");};var s=function(I,A){var R=Ext.getCmp("addressbook_");R.setValue(A);};var q=function(){var J=Ext.Element.get("container");var Z=J.createChild({tag:"div",id:"iWindowTag"});var S=J.createChild({tag:"div",id:"iWindowContTag"});var I=new Ext.data.SimpleStore({fields:["category_id","category_realname"],data:[["1","erste Kategorie"],["2","zweite Kategorie"],["3","dritte Kategorie"],["4","vierte Kategorie"],["5","fuenfte Kategorie"],["6","sechste Kategorie"],["7","siebte Kategorie"],["8","achte Kategorie"]]});I.load();ds_checked=new Ext.data.SimpleStore({fields:["category_id","category_realname"],data:[["2","zweite Kategorie"],["5","fuenfte Kategorie"],["6","sechste Kategorie"],["8","achte Kategorie"]]});ds_checked.load();var Y=new Ext.form.Form({labelWidth:75,url:"index.php?method=Addressbook.saveAdditionalData",reader:new Ext.data.JsonReader({root:"results"},[{name:"category_id"},{name:"category_realname"}])});var R=1;var X=new Array();ds_checked.each(function(k){X[k.data.category_id]=k.data.category_realname;});I.each(function(k){if((R%12)==1){Y.column({width:"33%",labelWidth:50,labelSeparator:""});}if(X[k.data.category_id]){Y.add(new Ext.form.Checkbox({boxLabel:k.data.category_realname,name:k.data.category_realname,checked:true}));}else{Y.add(new Ext.form.Checkbox({boxLabel:k.data.category_realname,name:k.data.category_realname}));}if((R%12)==0){Y.end();}R=R+1;});Y.render("iWindowContTag");if(!F){var F=new Ext.LayoutDialog("iWindowTag",{modal:true,width:700,height:400,shadow:true,minWidth:700,minHeight:400,autoTabs:true,proxyDrag:true,center:{autoScroll:true,tabPosition:"top",closeOnTab:true,alwaysShowTabs:true}});F.addKeyListener(27,this.hide);F.addButton("save",function(){Ext.MessageBox.alert("Todo","Not yet implemented!");F.hide;},F);F.addButton("cancel",function(){Ext.MessageBox.alert("Todo","Not yet implemented!");F.hide;},F);var A=F.getLayout();A.beginUpdate();A.add("center",new Ext.ContentPanel("iWindowContTag",{autoCreate:true,title:"Category"}));A.endUpdate();}F.show();};var E=function(){var J=Ext.Element.get("container");var Z=J.createChild({tag:"div",id:"iWindowTag"});var S=J.createChild({tag:"div",id:"iWindowContTag"});var I=new Ext.data.SimpleStore({fields:["list_id","list_realname"],data:[["1","Liste A"],["2","Liste B"],["3","Liste C"],["4","Liste D"],["5","Liste E"],["6","Liste F"],["7","Liste G"],["8","Liste H"]]});I.load();ds_checked=new Ext.data.SimpleStore({fields:["list_id","list_realname"],data:[["2","Liste B"],["5","Liste E"],["6","Liste F"],["8","Liste H"]]});ds_checked.load();var Y=new Ext.form.Form({labelWidth:75,url:"index.php?method=Addressbook.saveAdditionalData",reader:new Ext.data.JsonReader({root:"results"},[{name:"list_id"},{name:"list_realname"}])});var R=1;var X=new Array();ds_checked.each(function(k){X[k.data.list_id]=k.data.list_realname;});I.each(function(k){if((R%12)==1){Y.column({width:"33%",labelWidth:50,labelSeparator:""});}if(X[k.data.list_id]){Y.add(new Ext.form.Checkbox({boxLabel:k.data.list_realname,name:k.data.list_realname,checked:true}));}else{Y.add(new Ext.form.Checkbox({boxLabel:k.data.list_realname,name:k.data.list_realname}));}if((R%12)==0){Y.end();}R=R+1;});Y.render("iWindowContTag");if(!F){var F=new Ext.LayoutDialog("iWindowTag",{modal:true,width:700,height:400,shadow:true,minWidth:700,minHeight:400,autoTabs:true,proxyDrag:true,center:{autoScroll:true,tabPosition:"top",closeOnTab:true,alwaysShowTabs:true}});F.addKeyListener(27,this.hide);F.addButton("save",function(){Ext.MessageBox.alert("Todo","Not yet implemented!");},F);F.addButton("cancel",function(){window.location.reload();F.hide;},F);var A=F.getLayout();A.beginUpdate();A.add("center",new Ext.ContentPanel("iWindowContTag",{autoCreate:true,title:"Lists"}));A.endUpdate();}F.show();};return {display:function(){var I=t();if(formData.values){D(I,formData.values);}}};}();Egw.Addressbook.ListEditDialog=function(){var Q;var t=new Ext.Action({text:"save and close",iconCls:"action_saveAndClose"});var c=new Ext.Action({text:"apply changes",iconCls:"action_applyChanges"});var V=new Ext.Action({text:"delete contact",iconCls:"action_delete"});var M=function(){Ext.QuickTips.init();Ext.form.Field.prototype.msgTarget="side";var k=true;if(formData.values){k=false;}var Y=new Ext.Toolbar({region:"south",id:"applicationToolbar",split:false,height:26,items:[t,c,V]});var Z=new Ext.data.SimpleStore({fields:["id","addressbooks"],data:formData.config.addressbooks});var I=new Ext.form.TriggerField({fieldLabel:"Addressbook",id:"addressbook_",name:"list_owner",anchor:"100%",readOnly:true});I.onTriggerClick=function(){Egw.Addressbook.displayAddressbookSelectDialog(q);};var A=new Ext.FormPanel({url:"index.php",baseParams:{method:"Addressbook.saveList"},labelAlign:"top",bodyStyle:"padding:5px",width:450,region:"center",deferredRender:false,id:"listDialog",tbar:Y,items:[{layout:"form",title:"list information",border:false,anchor:"100%",items:[I,{xtype:"textfield",fieldLabel:"List Name",name:"list_name",anchor:"100%"},{xtype:"textarea",fieldLabel:"List Description",name:"list_description",grow:false,anchor:"100%"}]}]});A.on("beforeaction",function(n,f){n.baseParams._listOwner=n.getValues().list_owner;n.baseParams._listmembers=p(K);if(formData.values&&formData.values.list_id){n.baseParams._listId=formData.values.list_id;}else{n.baseParams._listId="";}});if(formData.values){var G=formData.values.list_owner;var X=formData.values.list_id;}else{var G=-1;var X=-1;}searchDS=new Ext.data.JsonStore({url:"index.php",baseParams:{method:"Addressbook.getOverview",owner:G,options:"{\"displayContacts\":true,\"displayLists\":false}"},root:"results",totalProperty:"totalcount",id:"contact_id",fields:[{name:"contact_id"},{name:"n_family"},{name:"n_given"},{name:"contact_email"}],remoteSort:true,success:function(f,n){},failure:function(f,n){}});searchDS.setDefaultSort("n_family","asc");var R=new Ext.Template("<div class=\"search-item\">","{n_family}, {n_given} {contact_email}","</div>");var g=new Ext.form.ComboBox({title:"select new list members",store:searchDS,displayField:"n_family",typeAhead:false,loadingText:"Searching...",anchor:"100%",pageSize:10,hideTrigger:true,tpl:R,onSelect:function(n){var f=new C({contact_id:n.data.contact_id,n_family:n.data.n_family,contact_email:n.data.contact_email});K.add(f);K.sort("n_family");g.reset();g.collapse();}});g.on("specialkey",function(d,m){if(searchDS.getCount()==0){var O=/^[a-z0-9_-]+(\.[a-z0-9_-]+)*@([0-9a-z][0-9a-z-]*[0-9a-z]\.)+([a-z]{2,4}|museum)$/;var n=O.exec(g.getValue());if(n&&(m.getKey()==m.ENTER||m.getKey()==e.RETURN)){var o=g.getValue();var f=o.indexOf("@");if(f!=-1){var b=Ext.util.Format.capitalize(o.substr(0,f));}else{var b=o;}var z=new C({contact_id:"-1",n_family:b,contact_email:o});K.add(z);K.sort("n_family");g.reset();}}});A.add(g);var C=Ext.data.Record.create([{name:"contact_id",type:"int"},{name:"n_family",type:"string"},{name:"contact_email",type:"string"}]);if(formData.values){var D=formData.values.list_members;var K=new Ext.data.SimpleStore({id:"list_Members",fields:["contact_id","n_family","contact_email"],data:D});K.sort("n_family","asc");}var J=new Ext.grid.ColumnModel([{resizable:true,id:"n_family",header:"Family name",dataIndex:"n_family"},{resizable:true,id:"contact_email",header:"eMail address",dataIndex:"contact_email"}]);J.defaultSortable=true;var S=new Ext.menu.Menu({id:"ctxListMenu",items:[{id:"delete",text:"delete entry",icon:"images/oxygen/16x16/actions/edit-delete.png",handler:B}]});var s=new Ext.grid.GridPanel({store:K,cm:J,id:"listGrid",selModel:new Ext.grid.RowSelectionModel({multiSelect:true}),autoSizeColumns:true,monitorWindowResize:false,trackMouseOver:true,autoWidth:true,height:300,contextMenu:"ctxListMenu",autoExpandColumn:"contact_email"});s.on("rowcontextmenu",function(m,z,n){n.stopEvent();var f=m.getStore().getAt(z);if(f.data.contact_tid=="l"){S.showAt(n.getXY());}else{S.showAt(n.getXY());}});var F=new Ext.Viewport({layout:"column",items:[A,s]});return ;};var q=function(K,G){Q.setValues([{id:"list_owner",value:G}]);};var B=function(I,K){var C=Array();var s=Ext.getCmp("listGrid");var G=Ext.getCmp("list_Members");var g=s.getSelectionModel().getSelections();for(var D=0;D<g.length;++D){G.remove(g[D]);}};var E=function(K,G){K.findField("list_name").setValue(G["n_family"]);K.findField("list_description").setValue(G["contact_note"]);K.findField("list_owner").setValue(G["contact_owner"]);};var p=function(G){var K=new Array();G.each(function(D){K.push(D.data);},this);return Ext.util.JSON.encode(K);};return {display:function(G,D){var K=M();if(formData.values){E(formData.values);}}};}();