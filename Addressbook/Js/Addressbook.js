Ext.namespace("Egw.Addressbook");Egw.Addressbook=function(){var A;var v=true;var B=false;var M;var O;var P=function(W){if(!M){M=Ext.getCmp("contacts-tree").getSelectionModel().getSelectedNode();}switch(M.attributes.datatype){case "listmember":W.baseParams.listId=M.attributes.listId;W.baseParams.method="Addressbook.getListMemberById";break;case "lists":case "sharedlists":case "otherlists":case "alllists":W.baseParams.method="Addressbook.getListMemberByOwner";break;case "contacts":case "otherpeople":case "sharedaddressbooks":W.baseParams.method="Addressbook.getContacts";break;case "overview":W.baseParams.method="Addressbook.getOverview";break;}W.baseParams.datatype=M.attributes.datatype;W.baseParams.owner=M.attributes.owner;W.baseParams.query=Ext.getCmp("quickSearchField").getRawValue();};var Q=function(a,W){t("contactWindow","index.php?method=Addressbook.editContact&_contactId=",850,600);};var k=function(a,W){t("listWindow","index.php?method=Addressbook.editList&_listId=",450,600);};var V=function(H,W){var s=Array();var U=O.getSelectionModel().getSelections();for(var a=0;a<U.length;++a){s.push(U[a].id);}s=Ext.util.JSON.encode(s);Ext.Ajax.request({url:"index.php",params:{method:"Addressbook.deleteContacts",_contactIds:s},text:"Deleting contact...",success:function(j,L){A.reload();},failure:function(L,j){Ext.MessageBox.alert("Failed","Some error occured while trying to delete the conctact.");}});};var K=function(U,W){var s=O.getSelectionModel().getSelections();var a=s[0].id;if(s[0].data.contact_tid=="l"){t("listWindow","index.php?method=Addressbook.editList&_listId="+a,450,600);}else{t("contactWindow","index.php?method=Addressbook.editContact&_contactId="+a,850,600);}};var d=function(W,a){A.reload();};var F=new Ext.Action({text:"add contact",handler:Q,iconCls:"action_addContact"});var b=new Ext.Action({text:"add list",handler:k,iconCls:"action_addList"});var m=new Ext.Action({text:"edit",disabled:true,handler:K,iconCls:"action_edit"});var E=new Ext.Action({text:"delete",disabled:true,handler:V,iconCls:"action_delete"});var c=function(){var a=Ext.getCmp("north-panel");var s=Ext.getCmp("applicationToolbar");a.remove(s);var U=new Ext.app.SearchField({id:"quickSearchField",width:240,emptyText:"enter searchfilter"});U.on("change",d);var W=new Ext.Toolbar({region:"south",id:"applicationToolbar",split:false,height:26,items:[F,b,m,E,"->","Search:"," "," ",U]});a.add(W);a.doLayout();return ;};var l=function(){var s=new Ext.tree.TreeLoader({dataUrl:"index.php"});s.on("beforeload",function(H,U){H.baseParams.method="Addressbook.getSubTree";H.baseParams._node=U.id;H.baseParams._datatype=U.attributes.datatype;H.baseParams._owner=U.attributes.owner;H.baseParams._location="mainTree";},this);var a=new Ext.tree.TreePanel({title:"Contacts",id:"contacts-tree",loader:s,rootVisible:false,border:false});var W=new Ext.tree.TreeNode({text:"root",draggable:false,allowDrop:false,id:"root"});a.setRootNode(W);for(i=0;i<initialTree.length;i++){W.appendChild(new Ext.tree.AsyncTreeNode(initialTree[i]));}a.on("click",function(H,U){M=H;A.reload();},this);a.on("expand",function(U){if(U.getSelectionModel().getSelectedNode()==null){U.expandPath("/root/alllists");U.selectPath("/root/addressbook");}c();f(U.getSelectionModel().getSelectedNode());},this);return a;};var D=function(){var L=Ext.getCmp("west");if(L.items){for(var a=0;a<L.items.length;a++){L.remove(L.items.get(a));}}var H=new Ext.tree.TreeLoader({dataUrl:"index.php"});H.on("beforeload",function(Y,j){Y.baseParams.method="Addressbook.getSubTree";Y.baseParams._node=j.id;Y.baseParams._datatype=j.attributes.datatype;Y.baseParams._owner=j.attributes.owner;Y.baseParams._location="mainTree";},this);var s=new Ext.tree.TreePanel({id:"contact-tree",loader:H,rootVisible:false,border:false});var W=new Ext.tree.TreeNode({text:"root",draggable:false,allowDrop:false,id:"root"});s.setRootNode(W);for(a=0;a<initialTree.length;a++){W.appendChild(new Ext.tree.AsyncTreeNode(initialTree[a]));}s.on("click",function(Y,j){M=Y;A.reload();},this);L.add(s);L.show();L.doLayout();s.expandPath("/root/alllists");s.selectPath("/root/addressbook");return ;var W=s.getRootNode();var U=Array();W.eachChild(function(j){U.push(j);},this);W.appendChild(new Ext.tree.AsyncTreeNode(initialTree));s.expandPath("/root/addressbook");s.selectPath("/root/addressbook");s.on("click",function(j){A.reload();});};var f=function(){var W=Ext.getCmp("center-panel");if(W.items){for(var a=0;a<W.items.length;a++){W.remove(W.items.get(a));}}A=new Ext.data.JsonStore({url:"index.php",root:"results",totalProperty:"totalcount",id:"contact_id",fields:[{name:"contact_id"},{name:"contact_tid"},{name:"contact_owner"},{name:"contact_private"},{name:"cat_id"},{name:"n_family"},{name:"n_given"},{name:"n_middle"},{name:"n_prefix"},{name:"n_suffix"},{name:"n_fn"},{name:"n_fileas"},{name:"contact_bday"},{name:"org_name"},{name:"org_unit"},{name:"contact_title"},{name:"contact_role"},{name:"contact_assistent"},{name:"contact_room"},{name:"adr_one_street"},{name:"adr_one_street2"},{name:"adr_one_locality"},{name:"adr_one_region"},{name:"adr_one_postalcode"},{name:"adr_one_countryname"},{name:"contact_label"},{name:"adr_two_street"},{name:"adr_two_street2"},{name:"adr_two_locality"},{name:"adr_two_region"},{name:"adr_two_postalcode"},{name:"adr_two_countryname"},{name:"tel_work"},{name:"tel_cell"},{name:"tel_fax"},{name:"tel_assistent"},{name:"tel_car"},{name:"tel_pager"},{name:"tel_home"},{name:"tel_fax_home"},{name:"tel_cell_private"},{name:"tel_other"},{name:"tel_prefer"},{name:"contact_email"},{name:"contact_email_home"},{name:"contact_url"},{name:"contact_url_home"},{name:"contact_freebusy_uri"},{name:"contact_calendar_uri"},{name:"contact_note"},{name:"contact_tz"},{name:"contact_geo"},{name:"contact_pubkey"},{name:"contact_created"},{name:"contact_creator"},{name:"contact_modified"},{name:"contact_modifier"},{name:"contact_jpegphoto"},{name:"account_id"}],remoteSort:true});A.setDefaultSort("n_family","asc");A.loadData({"results":[],"totalcount":"0","status":"success"});A.on("beforeload",P);A.load({params:{start:0,limit:50}});var s=new Ext.PagingToolbar({pageSize:25,store:A,displayInfo:true,displayMsg:"Displaying contacts {0} - {1} of {2}",emptyMsg:"No contacts to display"});var U=new Ext.grid.ColumnModel([{resizable:true,id:"contact_tid",header:"Type",dataIndex:"contact_tid",width:30,renderer:z},{resizable:true,id:"n_family",header:"Family name",dataIndex:"n_family"},{resizable:true,id:"n_given",header:"Given name",dataIndex:"n_given",width:80},{resizable:true,id:"n_fn",header:"Full name",dataIndex:"n_fn",hidden:true},{resizable:true,id:"n_fileas",header:"Name + Firm",dataIndex:"n_fileas",hidden:true},{resizable:true,id:"contact_email",header:"eMail",dataIndex:"contact_email",width:150,hidden:false},{resizable:true,id:"contact_bday",header:"Birthday",dataIndex:"contact_bday",hidden:true},{resizable:true,id:"org_name",header:"Organisation",dataIndex:"org_name",width:150},{resizable:true,id:"org_unit",header:"Unit",dataIndex:"org_unit",hidden:true},{resizable:true,id:"contact_title",header:"Title",dataIndex:"contact_title",hidden:true},{resizable:true,id:"contact_role",header:"Role",dataIndex:"contact_role",hidden:true},{resizable:true,id:"contact_room",header:"Room",dataIndex:"contact_room",hidden:true},{resizable:true,id:"adr_one_street",header:"Street",dataIndex:"adr_one_street",hidden:true},{resizable:true,id:"adr_one_locality",header:"Locality",dataIndex:"adr_one_locality",width:80,hidden:false},{resizable:true,id:"adr_one_region",header:"Region",dataIndex:"adr_one_region",hidden:true},{resizable:true,id:"adr_one_postalcode",header:"Postalcode",dataIndex:"adr_one_postalcode",hidden:true},{resizable:true,id:"adr_one_countryname",header:"Country",dataIndex:"adr_one_countryname",hidden:true},{resizable:true,id:"adr_two_street",header:"Street (private)",dataIndex:"adr_two_street",hidden:true},{resizable:true,id:"adr_two_locality",header:"Locality (private)",dataIndex:"adr_two_locality",hidden:true},{resizable:true,id:"adr_two_region",header:"Region (private)",dataIndex:"adr_two_region",hidden:true},{resizable:true,id:"adr_two_postalcode",header:"Postalcode (private)",dataIndex:"adr_two_postalcode",hidden:true},{resizable:true,id:"adr_two_countryname",header:"Country (private)",dataIndex:"adr_two_countryname",hidden:true},{resizable:true,id:"tel_work",header:"Phone",dataIndex:"tel_work",hidden:false},{resizable:true,id:"tel_cell",header:"Cellphone",dataIndex:"tel_cell",hidden:false},{resizable:true,id:"tel_fax",header:"Fax",dataIndex:"tel_fax",hidden:true},{resizable:true,id:"tel_car",header:"Car phone",dataIndex:"tel_car",hidden:true},{resizable:true,id:"tel_pager",header:"Pager",dataIndex:"tel_pager",hidden:true},{resizable:true,id:"tel_home",header:"Phone (private)",dataIndex:"tel_home",hidden:true},{resizable:true,id:"tel_fax_home",header:"Fax (private)",dataIndex:"tel_fax_home",hidden:true},{resizable:true,id:"tel_cell_private",header:"Cellphone (private)",dataIndex:"tel_cell_private",hidden:true},{resizable:true,id:"contact_email_home",header:"eMail (private)",dataIndex:"contact_email_home",hidden:true},{resizable:true,id:"contact_url",header:"URL",dataIndex:"contact_url",hidden:true},{resizable:true,id:"contact_url_home",header:"URL (private)",dataIndex:"contact_url_home",hidden:true},{resizable:true,id:"contact_note",header:"Note",dataIndex:"contact_note",hidden:true},{resizable:true,id:"contact_tz",header:"Timezone",dataIndex:"contact_tz",hidden:true},{resizable:true,id:"contact_geo",header:"Geo",dataIndex:"contact_geo",hidden:true}]);U.defaultSortable=true;O=new Ext.grid.GridPanel({store:A,cm:U,tbar:s,autoSizeColumns:false,selModel:new Ext.grid.RowSelectionModel({multiSelect:true}),enableColLock:false,autoExpandColumn:"n_family",border:false});W.add(O);W.show();W.doLayout();O.on("rowclick",function(Y,j,L){var H=O.getSelectionModel().getCount();if(H<1){m.setDisabled(true);E.setDisabled(true);}else{if(H==1){m.setDisabled(false);E.setDisabled(false);}else{m.setDisabled(true);E.setDisabled(false);}}});O.on("rowcontextmenu",function(j,Y,L){L.stopEvent();var H=j.getStore().getAt(Y);p.showAt(L.getXY());});O.on("rowdblclick",function(L,j,Y){var H=L.getStore().getAt(j);if(H.data.contact_tid=="l"){try{t("listWindow","index.php?method=Addressbook.editList&_listId="+H.data.contact_id,450,600);}catch(T){}}else{try{t("contactWindow","index.php?method=Addressbook.editContact&_contactId="+H.data.contact_id,850,600);}catch(T){}}});return ;textF1=new Ext.form.TextField({height:22,width:200,emptyText:"Suchparameter ...",allowBlank:false});textF1.on("specialkey",function(L,H){if(H.getKey()==H.ENTER||H.getKey()==e.RETURN){}});};var z=function(U,L,s,W,a,H){switch(U){case "l":return "<img src='images/oxygen/16x16/actions/users.png' width='12' height='12' alt='list'/>";default:return "<img src='images/oxygen/16x16/actions/user.png' width='12' height='12' alt='contact'/>";}};var u=function(a,W){v=a.pressed;A.reload();};var I=function(a,W){B=a.pressed;A.reload();};var p=new Ext.menu.Menu({id:"ctxMenuAddress",items:[m,E,"-",F,b]});var G=function(a,W){};var t=function(a,j,W,L){if(document.all){w=document.body.clientWidth;h=document.body.clientHeight;x=window.screenTop;y=window.screenLeft;}else{if(window.innerWidth){w=window.innerWidth;h=window.innerHeight;x=window.screenX;y=window.screenY;}}var H=((w-W)/2)+y;var U=((h-L)/2)+x;var s=window.open(j,a,"width="+W+",height="+L+",top="+U+",left="+H+",directories=no,toolbar=no,location=no,menubar=no,scrollbars=no,status=no,resizable=no,dependent=no");return s;};var Z=function(Y,s){var a;var S=1024,j=786;var U=850,T=600;if(s=="list"){U=450,T=600;}if(document.all){S=document.body.clientWidth;j=document.body.clientHeight;x=window.screenTop;y=window.screenLeft;}else{if(window.innerWidth){S=window.innerWidth;j=window.innerHeight;x=window.screenX;y=window.screenY;}}var H=((S-U)/2)+y,L=((j-T)/2)+x;if(s=="list"&&!Y){a="index.php?method=Addressbook.editList";}else{if(s=="list"&&Y){a="index.php?method=Addressbook.editList&contactid="+Y;}else{if(s!="list"&&Y){a="index.php?method=Addressbook.editContact&contactid="+Y;}else{a="index.php?method=Addressbook.editContact";}}}appId="addressbook";var W=window.open(a,"popupname","width="+U+",height="+T+",top="+L+",left="+H+",directories=no,toolbar=no,location=no,menubar=no,scrollbars=no,status=no,resizable=no,dependent=no");return ;};var J=function(W){W=(W==null)?false:W;window.opener.Egw.Addressbook.reload();if(W==true){window.setTimeout("window.close()",400);}};var N=function(U){if(!s){var s=new Ext.Window({title:"please select addressbook",modal:true,width:375,height:400,minWidth:375,minHeight:400,layout:"fit",plain:true,bodyStyle:"padding:5px;",buttonAlign:"center"});var H=Ext.tree;treeLoader=new H.TreeLoader({dataUrl:"index.php"});treeLoader.on("beforeload",function(j,L){j.baseParams.method="Addressbook.getSubTree";j.baseParams._node=L.id;j.baseParams._datatype=L.attributes.datatype;j.baseParams._owner=L.attributes.owner;j.baseParams._location="selectFolder";},this);var W=new H.TreePanel({animate:true,id:"addressbookTree",loader:treeLoader,containerScroll:true,rootVisible:false});var a=new H.TreeNode({text:"root",draggable:false,allowDrop:false,id:"root"});W.setRootNode(a);Ext.each(application,function(L){a.appendChild(new H.AsyncTreeNode(L));});W.on("click",function(Y){Y.select();if(W.getSelectionModel().getSelectedNode()){var T=W.getSelectionModel().getSelectedNode().id;var j=W.getNodeById(T).attributes.owner;if((j>0)||(j<0)){var L=Ext.getCmp("addressbook_");L.setValue(j);s.hide();}else{Ext.MessageBox.alert("wrong selection","please select a valid addressbook");}}else{Ext.MessageBox.alert("no selection","please select an addressbook");}});s.add(W);s.show();}};return {show:function(W){c();D();f(W);},displayAddressbookSelectDialog:N,getPanel:l,reload:function(){A.reload();}};}();Egw.Addressbook.ContactEditDialog=function(){var D;var V;var Q;var I=function(l,f){var A=Ext.getCmp("contactDialog").getForm();A.render();if(A.isValid()){var N={};if(formData.values){N.contact_id=formData.values.contact_id;}A.submit({waitTitle:"Please wait!",waitMsg:"saving contact...",params:N,success:function(d,v,u){window.opener.Egw.Addressbook.reload();},failure:function(d,v){}});}else{Ext.MessageBox.alert("Errors","Please fix the errors noted.");}};var p=function(l,f){var A=Ext.getCmp("contactDialog").getForm();A.render();if(A.isValid()){var N={};if(formData.values){N.contact_id=formData.values.contact_id;}A.submit({waitTitle:"Please wait!",waitMsg:"saving contact...",params:N,success:function(d,v,u){window.opener.Egw.Addressbook.reload();window.setTimeout("window.close()",400);},failure:function(d,v){}});}else{Ext.MessageBox.alert("Errors","Please fix the errors noted.");}};var Z=function(N,A){var f=Ext.util.JSON.encode([formData.values.contact_id]);Ext.Ajax.request({url:"index.php",params:{method:"Addressbook.deleteContacts",_contactIds:f},text:"Deleting contact...",success:function(d,l){window.opener.Egw.Addressbook.reload();window.setTimeout("window.close()",400);},failure:function(l,d){Ext.MessageBox.alert("Failed","Some error occured while trying to delete the conctact.");}});};var m=new Ext.Action({text:"save and close",handler:p,iconCls:"action_saveAndClose"});var K=new Ext.Action({text:"apply changes",handler:I,iconCls:"action_applyChanges"});var B=new Ext.Action({text:"delete contact",handler:Z,iconCls:"action_delete"});var M=function(){Ext.QuickTips.init();Ext.form.Field.prototype.msgTarget="side";var A=true;if(formData.values){A=false;}var v=new Ext.Toolbar({region:"south",id:"applicationToolbar",split:false,height:26,items:[m,K,B]});var a=new Ext.data.JsonStore({url:"index.php",baseParams:{method:"Egwbase.getCountryList"},root:"results",id:"shortName",fields:["shortName","translatedName"],remoteSort:false});var s=new Ext.form.TriggerField({fieldLabel:"Addressbook",name:"contact_owner",id:"addressbook_",anchor:"95%",readOnly:true});s.onTriggerClick=function(){Egw.Addressbook.displayAddressbookSelectDialog(G);};var u=function(U){U.baseParams.method="Addressbook.getContacts";U.baseParams.options=Ext.encode({displayContacts:false,displayLists:true});};var d=[["AL","Alabama"],["AK","Alaska"],["AZ","Arizona"],["WV","West Virginia"],["WI","Wisconsin"],["WY","Wyoming"]];var t=new Ext.data.SimpleStore({fields:["contact_id","contact_tid"],data:d});var k=new Ext.data.SimpleStore({fields:["contact_id","contact_tid"]});var E=new Ext.DataView({style:"overflow:auto",multiSelect:true,id:"list_source_",cls:"x-list-small",selectedClass:"x-list-selected",itemSelector:"div.x-view",store:t,tpl:new Ext.XTemplate("<tpl for=\".\">","<div class=\"x-view\" id=\"{contact_id}\">{contact_tid}</div>","</tpl>")});function F(H,U){return H-U;}var N=function(j,S,Y,L){var S=Ext.getCmp("list_source_");var H=String(S.getSelectedIndexes());var T=S.getSelectionCount();if(S.getSelectionCount()>"1"){var r=H.split(",");}else{if(S.getSelectionCount()=="1"){var r=new Array(H);}}r.sort(F);r.reverse();for(i=0;i<T;i++){var U=t.getAt(r[i]);k.add(U);}k.sort("contact_tid","ASC");for(i=0;i<T;i++){var U=t.getAt(r[i]);t.remove(U);}t.sort("contact_tid","ASC");};var l=function(j,S,Y,L){var S=Ext.getCmp("list_selected_");var H=String(S.getSelectedIndexes());var T=S.getSelectionCount();if(S.getSelectionCount()>"1"){var r=H.split(",");}else{if(S.getSelectionCount()=="1"){var r=new Array(H);}}r.sort(F);r.reverse();for(i=0;i<T;i++){var U=k.getAt(r[i]);t.add(U);}t.sort("contact_tid","ASC");for(i=0;i<T;i++){var U=k.getAt(r[i]);k.remove(U);}k.sort("contact_tid","ASC");};E.on("dblclick",N);var O=new Ext.DataView({style:"overflow:auto",multiSelect:true,id:"list_selected_",cls:"x-list-small",selectedClass:"x-list-selected",itemSelector:"div.x-view",store:k,tpl:new Ext.XTemplate("<tpl for=\".\">","<div class=\"x-view\" id=\"{contact_id}\">{contact_tid}</div>","</tpl>")});O.on("dblclick",l);var z=new Ext.Panel({id:"list_source",title:"available lists",region:"center",margins:"5 5 5 0",layout:"fit",items:E});var J=new Ext.Panel({id:"list_selected",title:"chosen lists",region:"center",margins:"5 5 5 0",layout:"fit",items:O});var b=new Ext.FormPanel({url:"index.php",baseParams:{method:"Addressbook.saveContact"},labelAlign:"top",bodyStyle:"padding:5px",anchor:"100%",region:"center",id:"contactDialog",tbar:v,deferredRender:false,items:[{layout:"column",border:false,deferredRender:false,anchor:"100%",items:[{columnWidth:0.4,layout:"form",border:false,items:[{xtype:"textfield",fieldLabel:"First Name",name:"n_given",anchor:"95%"},{xtype:"textfield",fieldLabel:"Middle Name",name:"n_middle",anchor:"95%"},{xtype:"textfield",fieldLabel:"Last Name",name:"n_family",allowBlank:false,anchor:"95%"}]},{columnWidth:0.2,layout:"form",border:false,items:[{xtype:"textfield",fieldLabel:"Prefix",name:"n_prefix",anchor:"95%"},{xtype:"textfield",fieldLabel:"Suffix",name:"n_suffix",anchor:"95%"},s]},{columnWidth:0.4,layout:"form",border:false,items:[{xtype:"textarea",name:"contact_note",fieldLabel:"Notes",grow:false,preventScrollbars:false,anchor:"95% 85%"}]}]},{xtype:"tabpanel",plain:true,activeTab:0,deferredRender:false,anchor:"100% 70%",defaults:{bodyStyle:"padding:10px"},items:[{title:"Business information",layout:"column",deferredRender:false,border:false,items:[{columnWidth:0.333,layout:"form",border:false,items:[{xtype:"textfield",fieldLabel:"Company",name:"org_name",anchor:"95%"},{xtype:"textfield",fieldLabel:"Street",name:"adr_one_street",anchor:"95%"},{xtype:"textfield",fieldLabel:"Street 2",name:"adr_one_street2",anchor:"95%"},{xtype:"textfield",fieldLabel:"Postalcode",name:"adr_one_postalcode",anchor:"95%"},{xtype:"textfield",fieldLabel:"City",name:"adr_one_locality",anchor:"95%"},{xtype:"textfield",fieldLabel:"Region",name:"adr_one_region",anchor:"95%"},new Ext.form.ComboBox({fieldLabel:"Country",name:"adr_one_countryname",hiddenName:"adr_one_countryname",store:a,displayField:"translatedName",valueField:"shortName",typeAhead:true,mode:"remote",triggerAction:"all",emptyText:"Select a state...",selectOnFocus:true,anchor:"95%"})]},{columnWidth:0.333,layout:"form",border:false,items:[{xtype:"textfield",fieldLabel:"Phone",name:"tel_work",anchor:"95%"},{xtype:"textfield",fieldLabel:"Cellphone",name:"tel_cell",anchor:"95%"},{xtype:"textfield",fieldLabel:"Fax",name:"tel_fax",anchor:"95%"},{xtype:"textfield",fieldLabel:"Car phone",name:"tel_car",anchor:"95%"},{xtype:"textfield",fieldLabel:"Pager",name:"tel_pager",anchor:"95%"},{xtype:"textfield",fieldLabel:"Email",name:"contact_email",vtype:"email",anchor:"95%"},{xtype:"textfield",fieldLabel:"URL",name:"contact_url",vtype:"url",anchor:"95%"}]},{columnWidth:0.333,layout:"form",border:false,items:[{xtype:"textfield",fieldLabel:"Unit",name:"org_unit",anchor:"95%"},{xtype:"textfield",fieldLabel:"Role",name:"contact_role",anchor:"95%"},{xtype:"textfield",fieldLabel:"Title",name:"contact_title",anchor:"95%"},{xtype:"textfield",fieldLabel:"Room",name:"contact_room",anchor:"95%"},{xtype:"textfield",fieldLabel:"Name Assistent",name:"contact_assistent",anchor:"95%"},{xtype:"textfield",fieldLabel:"Phone Assistent",name:"tel_assistent",anchor:"95%"}]}]},{title:"Private information",layout:"column",deferredRender:false,border:false,items:[{columnWidth:0.333,layout:"form",border:false,items:[{xtype:"textfield",fieldLabel:"Street",name:"adr_two_street",anchor:"95%"},{xtype:"textfield",fieldLabel:"Street2",name:"adr_two_street2",anchor:"95%"},{xtype:"textfield",fieldLabel:"Postalcode",name:"adr_two_postalcode",anchor:"95%"},{xtype:"textfield",fieldLabel:"City",name:"adr_two_locality",anchor:"95%"},{xtype:"textfield",fieldLabel:"Region",name:"adr_two_region",anchor:"95%"},new Ext.form.ComboBox({fieldLabel:"Country",name:"adr_two_countryname",hiddenName:"adr_two_countryname",store:a,displayField:"translatedName",valueField:"shortName",typeAhead:true,mode:"remote",triggerAction:"all",emptyText:"Select a state...",selectOnFocus:true,anchor:"95%"})]},{columnWidth:0.333,layout:"form",border:false,items:[new Ext.form.DateField({fieldLabel:"Birthday",name:"contact_bday",format:formData.config.dateFormat,altFormats:"Y-m-d",anchor:"95%"}),{xtype:"textfield",fieldLabel:"Phone",name:"tel_home",anchor:"95%"},{xtype:"textfield",fieldLabel:"Cellphone",name:"tel_cell_private",anchor:"95%"},{xtype:"textfield",fieldLabel:"Fax",name:"tel_fax_home",anchor:"95%"},{xtype:"textfield",fieldLabel:"Email",name:"contact_email_home",vtype:"email",anchor:"95%"},{xtype:"textfield",fieldLabel:"URL",name:"contact_url_home",vtype:"url",anchor:"95%"}]},{columnWidth:0.333,layout:"form",border:false,items:[new Ext.form.FieldSet({id:"photo",legend:"Photo"})]}]},{title:"Lists",layout:"column",deferredRender:false,border:false,items:[{columnWidth:0.333,layout:"form",border:false,items:[new Ext.Panel({layout:"fit",id:"source",width:250,height:350,items:[z]})]},{columnWidth:0.333,layout:"form",border:false,extraCls:"list-butons",items:[new Ext.Button({text:"add",iconCls:"blist",minWidth:80,handler:N,icon:"images/oxygen/16x16/actions/arrow-right-double.png"}),new Ext.Button({text:"remove",iconCls:"blist",minWidth:80,handler:l,icon:"images/oxygen/16x16/actions/arrow-left-double.png"})]},{columnWidth:0.333,layout:"form",border:false,items:[new Ext.Panel({layout:"fit",id:"destination",width:250,height:350,items:[J]})]}]},{title:"Categories",layout:"column",deferredRender:false,border:false,items:[{}]}]}]});var W=new Ext.Viewport({layout:"border",items:b});var f=new Ext.data.SimpleStore({fields:["id","addressbooks"],data:formData.config.addressbooks});return ;};var P=function(A,l){var N=Ext.getCmp("contactDialog").getForm();for(var d in l){var f=N.findField(d);if(f){f.setValue(l[d]);}}};var c=function(f,A){Ext.MessageBox.alert("Export","Not yet implemented.");};var G=function(A,N){var f=Ext.getCmp("addressbook_");f.setValue(N);};return {display:function(){var A=M();if(formData.values){P(A,formData.values);}}};}();Egw.Addressbook.ListEditDialog=function(){var c;var I=function(N,A){var K=Ext.getCmp("listDialog").getForm();if(K.isValid()){var f={listId:"",listMembers:"",};if(formData.values&&formData.values.list_id){f.listId=formData.values.list_id;}K.submit({waitTitle:"Please wait!",waitMsg:"saving contact...",params:f,success:function(l,d,v){window.opener.Egw.Addressbook.reload();},failure:function(l,d){}});}else{Ext.MessageBox.alert("Errors","Please fix the errors noted.");}};var p=function(N,A){var K=Ext.getCmp("listDialog").getForm();if(K.isValid()){var f={};if(formData.values){f.contact_id=formData.values.contact_id;}K.submit({waitTitle:"Please wait!",waitMsg:"saving contact...",params:f,success:function(l,d,v){window.opener.Egw.Addressbook.reload();window.setTimeout("window.close()",400);},failure:function(l,d){}});}else{Ext.MessageBox.alert("Errors","Please fix the errors noted.");}};var D=function(f,K){var A=Ext.util.JSON.encode([formData.values.contact_id]);Ext.Ajax.request({url:"index.php",params:{method:"Addressbook.deleteLists",_contactIds:A},text:"Deleting contact...",success:function(l,N){window.opener.Egw.Addressbook.reload();window.setTimeout("window.close()",400);},failure:function(N,l){Ext.MessageBox.alert("Failed","Some error occured while trying to delete the conctact.");}});};var V=new Ext.Action({text:"save and close",handler:p,iconCls:"action_saveAndClose"});var P=new Ext.Action({text:"apply changes",handler:I,iconCls:"action_applyChanges"});var Q=new Ext.Action({text:"delete list",text:"delete list",handler:D,iconCls:"action_delete"});var Z=function(){Ext.QuickTips.init();Ext.form.Field.prototype.msgTarget="side";var E=true;if(formData.values){E=false;}var F=new Ext.Toolbar({region:"south",id:"applicationToolbar",split:false,height:26,items:[V,P,Q]});var k=new Ext.data.SimpleStore({fields:["id","addressbooks"],data:formData.config.addressbooks});var d=new Ext.form.TriggerField({fieldLabel:"Addressbook",id:"addressbook_",name:"list_owner",anchor:"100%",readOnly:true});d.onTriggerClick=function(){Egw.Addressbook.displayAddressbookSelectDialog(B);};searchDS=new Ext.data.JsonStore({url:"index.php",baseParams:{method:"Addressbook.getOverview",options:"{\"displayContacts\":true,\"displayLists\":false}"},root:"results",totalProperty:"totalcount",id:"contact_id",fields:[{name:"contact_id"},{name:"n_family"},{name:"n_given"},{name:"contact_email"}],remoteSort:true});searchDS.setDefaultSort("n_family","asc");var l=new Ext.form.ComboBox({store:searchDS,fieldLabel:"Search for new list members",displayField:"n_family",typeAhead:false,loadingText:"Searching...",anchor:"100%",pageSize:10,hideTrigger:true,itemSelector:"div.search-item",tpl:new Ext.XTemplate("<tpl for=\".\">","<div class=\"search-item\">{n_family}, {n_given} {contact_email}</div>","</tpl>")});l.on("select",function(W,J,z){var O=new N({contact_id:J.data.contact_id,n_family:J.data.n_family,contact_email:J.data.contact_email});K.add(O);K.sort("n_family");l.reset();l.collapse();});l.on("specialkey",function(H,O){if(searchDS.getCount()==0){var U=/^[a-z0-9_-]+(\.[a-z0-9_-]+)*@([0-9a-z][0-9a-z-]*[0-9a-z]\.)+([a-z]{2,4}|museum)$/;var z=U.exec(l.getValue());if(z&&(O.getKey()==O.ENTER||O.getKey()==e.RETURN)){var s=l.getValue();var J=s.indexOf("@");if(J!=-1){var a=Ext.util.Format.capitalize(s.substr(0,J));}else{var a=s;}var W=new N({contact_id:"-1",n_family:a,contact_email:s});K.add(W);K.sort("n_family");l.reset();}}});var v=new Ext.FormPanel({url:"index.php",baseParams:{method:"Addressbook.saveList"},labelAlign:"top",bodyStyle:"padding:5px",width:450,region:"center",deferredRender:false,id:"listDialog",tbar:F,items:[{layout:"form",title:"list information",border:false,anchor:"100%",items:[d,{xtype:"textfield",fieldLabel:"List Name",name:"list_name",anchor:"100%"},{xtype:"textarea",fieldLabel:"List Description",name:"list_description",grow:false,anchor:"100%"},l]}]});var N=Ext.data.Record.create([{name:"contact_id",type:"int"},{name:"n_family",type:"string"},{name:"contact_email",type:"string"}]);if(formData.values.list_members){var A=formData.values.list_members;}else{var A=[];}var K=new Ext.data.SimpleStore({id:"list_Members",fields:["contact_id","n_family","contact_email"],data:A});K.sort("n_family","asc");var b=new Ext.grid.ColumnModel([{resizable:true,id:"n_family",header:"Family name",dataIndex:"n_family"},{resizable:true,id:"contact_email",header:"eMail address",dataIndex:"contact_email"}]);b.defaultSortable=true;var t=new Ext.menu.Menu({id:"ctxListMenu",items:[{id:"delete",text:"delete entry",icon:"images/oxygen/16x16/actions/edit-delete.png",handler:M}]});var f=new Ext.grid.GridPanel({store:K,cm:b,id:"listGrid",selModel:new Ext.grid.RowSelectionModel({multiSelect:true}),autoSizeColumns:true,monitorWindowResize:false,trackMouseOver:true,autoWidth:true,height:300,contextMenu:"ctxListMenu",autoExpandColumn:"contact_email"});f.on("rowcontextmenu",function(O,W,z){z.stopEvent();var J=O.getStore().getAt(W);if(J.data.contact_tid=="l"){t.showAt(z.getXY());}else{t.showAt(z.getXY());}});var u=new Ext.Viewport({layout:"column",items:[v,f]});return ;};var B=function(K,A){c.setValues([{id:"list_owner",value:A}]);};var M=function(v,K){var l=Array();var N=Ext.getCmp("listGrid");var A=Ext.getCmp("list_Members");var d=N.getSelectionModel().getSelections();for(var f=0;f<d.length;++f){A.remove(d[f]);}};var m=function(K,N){var f=Ext.getCmp("listDialog").getForm();for(var l in N){var A=f.findField(l);if(A){A.setValue(N[l]);}}};var G=function(A){var K=new Array();A.each(function(f){K.push(f.data);},this);return Ext.util.JSON.encode(K);};return {display:function(){var K=Z();if(formData.values){m(K,formData.values);}}};}();